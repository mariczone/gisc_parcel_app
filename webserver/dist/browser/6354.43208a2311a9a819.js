"use strict";(self.webpackChunkparcel_app=self.webpackChunkparcel_app||[]).push([[6354],{36592:(et,G,u)=>{u.d(G,{Q:()=>m});var b=u(85931),T=u(62208),K=u(77029),L=u(14259);class m{constructor(s=9,o){this._compareMinX=X,this._compareMinY=a,this._toBBox=r=>r,this._maxEntries=Math.max(4,s||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),o&&("function"==typeof o?this._toBBox=o:this._initFormat(o)),this.clear()}destroy(){this.clear(),M.prune(),Z.prune(),D.prune(),z.prune()}all(s){this._all(this._data,s)}search(s,o){let r=this._data;const l=this._toBBox;if(v(s,r))for(M.clear();r;){for(let d=0,E=r.children.length;d<E;d++){const C=r.children[d],B=r.leaf?l(C):C;v(s,B)&&(r.leaf?o(C):p(s,B)?this._all(C,o):M.push(C))}r=M.pop()}}collides(s){let o=this._data;const r=this._toBBox;if(!v(s,o))return!1;for(M.clear();o;){for(let l=0,d=o.children.length;l<d;l++){const E=o.children[l],C=o.leaf?r(E):E;if(v(s,C)){if(o.leaf||p(s,C))return!0;M.push(E)}}o=M.pop()}return!1}load(s){if(!s.length)return this;if(s.length<this._minEntries){for(let r=0,l=s.length;r<l;r++)this.insert(s[r]);return this}let o=this._build(s.slice(0,s.length),0,s.length-1,0);if(this._data.children.length)if(this._data.height===o.height)this._splitRoot(this._data,o);else{if(this._data.height<o.height){const r=this._data;this._data=o,o=r}this._insert(o,this._data.height-o.height-1,!0)}else this._data=o;return this}insert(s){return s&&this._insert(s,this._data.height-1),this}clear(){return this._data=new N([]),this}remove(s){if(!s)return this;let o,r=this._data,l=null,d=0,E=!1;const C=this._toBBox(s);for(D.clear(),z.clear();r||D.length>0;){if(r||(r=(0,T.j0)(D.pop()),l=D.data[D.length-1],d=z.pop()??0,E=!0),r.leaf&&(o=(0,b.cq)(r.children,s,r.children.length,r.indexHint),-1!==o))return r.children.splice(o,1),D.push(r),this._condense(D),this;E||r.leaf||!p(r,C)?l?(d++,r=l.children[d],E=!1):r=null:(D.push(r),z.push(d),d=0,l=r,r=r.children[0])}return this}toJSON(){return this._data}fromJSON(s){return this._data=s,this}_all(s,o){let r=s;for(Z.clear();r;){if(!0===r.leaf)for(const l of r.children)o(l);else Z.pushArray(r.children);r=Z.pop()??null}}_build(s,o,r,l){const d=r-o+1;let E=this._maxEntries;if(d<=E){const U=new N(s.slice(o,r+1));return I(U,this._toBBox),U}l||(l=Math.ceil(Math.log(d)/Math.log(E)),E=Math.ceil(d/E**(l-1)));const C=new w([]);C.height=l;const B=Math.ceil(d/E),y=B*Math.ceil(Math.sqrt(E));x(s,o,r,y,this._compareMinX);for(let U=o;U<=r;U+=y){const O=Math.min(U+y-1,r);x(s,U,O,B,this._compareMinY);for(let Q=U;Q<=O;Q+=B){const it=Math.min(Q+B-1,O);C.children.push(this._build(s,Q,it,l-1))}}return I(C,this._toBBox),C}_chooseSubtree(s,o,r,l){for(;l.push(o),!0!==o.leaf&&l.length-1!==r;){let d,E=1/0,C=1/0;for(let B=0,y=o.children.length;B<y;B++){const U=o.children[B],O=c(U),Q=R(s,U)-O;Q<C?(C=Q,E=O<E?O:E,d=U):Q===C&&O<E&&(E=O,d=U)}o=d||o.children[0]}return o}_insert(s,o,r){const d=r?s:(0,this._toBBox)(s);D.clear();const E=this._chooseSubtree(d,this._data,o,D);for(E.children.push(s),S(E,d);o>=0&&D.data[o].children.length>this._maxEntries;)this._split(D,o),o--;this._adjustParentBBoxes(d,D,o)}_split(s,o){const r=s.data[o],l=r.children.length,d=this._minEntries;this._chooseSplitAxis(r,d,l);const E=this._chooseSplitIndex(r,d,l);if(!E)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const C=r.children.splice(E,r.children.length-E),B=r.leaf?new N(C):new w(C);B.height=r.height,I(r,this._toBBox),I(B,this._toBBox),o?s.data[o-1].children.push(B):this._splitRoot(r,B)}_splitRoot(s,o){this._data=new w([s,o]),this._data.height=s.height+1,I(this._data,this._toBBox)}_chooseSplitIndex(s,o,r){let l,d,E;l=d=1/0;for(let C=o;C<=r-o;C++){const B=H(s,0,C,this._toBBox),y=H(s,C,r,this._toBBox),U=f(B,y),O=c(B)+c(y);U<l?(l=U,E=C,d=O<d?O:d):U===l&&O<d&&(d=O,E=C)}return E}_chooseSplitAxis(s,o,r){const l=s.leaf?this._compareMinX:X,d=s.leaf?this._compareMinY:a;this._allDistMargin(s,o,r,l)<this._allDistMargin(s,o,r,d)&&s.children.sort(l)}_allDistMargin(s,o,r,l){s.children.sort(l);const d=this._toBBox,E=H(s,0,o,d),C=H(s,r-o,r,d);let B=F(E)+F(C);for(let y=o;y<r-o;y++){const U=s.children[y];S(E,s.leaf?d(U):U),B+=F(E)}for(let y=r-o-1;y>=o;y--){const U=s.children[y];S(C,s.leaf?d(U):U),B+=F(C)}return B}_adjustParentBBoxes(s,o,r){for(let l=r;l>=0;l--)S(o.data[l],s)}_condense(s){for(let o=s.length-1;o>=0;o--){const r=s.data[o];if(0===r.children.length)if(o>0){const l=s.data[o-1],d=l.children;d.splice((0,b.cq)(d,r,d.length,l.indexHint),1)}else this.clear();else I(r,this._toBBox)}}_initFormat(s){const o=["return a"," - b",";"];this._compareMinX=new Function("a","b",o.join(s[0])),this._compareMinY=new Function("a","b",o.join(s[1])),this._toBBox=new Function("a","return {minX: a"+s[0]+", minY: a"+s[1]+", maxX: a"+s[2]+", maxY: a"+s[3]+"};")}}function I(_,s){H(_,0,_.children.length,s,_)}function H(_,s,o,r,l){l||(l=new N([])),l.minX=1/0,l.minY=1/0,l.maxX=-1/0,l.maxY=-1/0;for(let d,E=s;E<o;E++)d=_.children[E],S(l,_.leaf?r(d):d);return l}function S(_,s){_.minX=Math.min(_.minX,s.minX),_.minY=Math.min(_.minY,s.minY),_.maxX=Math.max(_.maxX,s.maxX),_.maxY=Math.max(_.maxY,s.maxY)}function X(_,s){return _.minX-s.minX}function a(_,s){return _.minY-s.minY}function c(_){return(_.maxX-_.minX)*(_.maxY-_.minY)}function F(_){return _.maxX-_.minX+(_.maxY-_.minY)}function R(_,s){return(Math.max(s.maxX,_.maxX)-Math.min(s.minX,_.minX))*(Math.max(s.maxY,_.maxY)-Math.min(s.minY,_.minY))}function f(_,s){const o=Math.max(_.minX,s.minX),r=Math.max(_.minY,s.minY),l=Math.min(_.maxX,s.maxX),d=Math.min(_.maxY,s.maxY);return Math.max(0,l-o)*Math.max(0,d-r)}function p(_,s){return _.minX<=s.minX&&_.minY<=s.minY&&s.maxX<=_.maxX&&s.maxY<=_.maxY}function v(_,s){return s.minX<=_.maxX&&s.minY<=_.maxY&&s.maxX>=_.minX&&s.maxY>=_.minY}function x(_,s,o,r,l){const d=[s,o];for(;d.length;){const E=(0,T.j0)(d.pop()),C=(0,T.j0)(d.pop());if(E-C<=r)continue;const B=C+Math.ceil((E-C)/r/2)*r;(0,L.q)(_,B,C,E,l),d.push(C,B,B,E)}}const M=new K.Z,Z=new K.Z,D=new K.Z,z=new K.Z({deallocator:void 0});class J{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class A extends J{constructor(){super(...arguments),this.height=1,this.indexHint=new b.SO}}class N extends A{constructor(s){super(),this.children=s,this.leaf=!0}}class w extends A{constructor(s){super(),this.children=s,this.leaf=!1}}},77044:(et,G,u)=>{u.d(G,{Y:()=>K});var b=u(62208);function T(a,c){return a?c?4:3:c?3:2}function K(a,c,F,R,f){if((0,b.Wi)(c)||!c.lengths.length)return null;const p="upperLeft"===f?.originPosition?-1:1;a.lengths.length&&(a.lengths.length=0),a.coords.length&&(a.coords.length=0);const v=a.coords,x=[],M=F?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:Z,coords:D}=c,z=T(F,R);let J=0;for(const A of Z){const N=L(M,D,J,A,F,R,p);N&&x.push(N),J+=A*z}if(x.sort((A,N)=>{let w=p*A[2]-p*N[2];return 0===w&&F&&(w=A[4]-N[4]),w}),x.length){let A=6*x[0][2];v[0]=x[0][0]/A,v[1]=x[0][1]/A,F&&(A=6*x[0][4],v[2]=0!==A?x[0][3]/A:0),(v[0]<M[0]||v[0]>M[1]||v[1]<M[2]||v[1]>M[3]||F&&(v[2]<M[4]||v[2]>M[5]))&&(v.length=0)}if(!v.length){const A=c.lengths[0]?function m(a,c,F,R,f){const p=T(R,f);let v=c,x=c+p,M=0,Z=0,D=0,z=0;for(let J=0,A=F-1;J<A;J++,v+=p,x+=p){const N=a[v],w=a[v+1],_=a[v+2],s=a[x],o=a[x+1],r=a[x+2],l=R?H(N,w,_,s,o,r):I(N,w,s,o);if(l)if(M+=l,R){const d=X(N,w,_,s,o,r);Z+=l*d[0],D+=l*d[1],z+=l*d[2]}else{const d=S(N,w,s,o);Z+=l*d[0],D+=l*d[1]}}return M>0?R?[Z/M,D/M,z/M]:[Z/M,D/M]:F>0?R?[a[c],a[c+1],a[c+2]]:[a[c],a[c+1]]:null}(D,0,Z[0],F,R):null;if(!A)return null;v[0]=A[0],v[1]=A[1],F&&A.length>2&&(v[2]=A[2])}return a}function L(a,c,F,R,f,p,v=1){const x=T(f,p);let M=F,Z=F+x,D=0,z=0,J=0,A=0,N=0;for(let _=0,s=R-1;_<s;_++,M+=x,Z+=x){const o=c[M],r=c[M+1],l=c[M+2],d=c[Z],E=c[Z+1],C=c[Z+2];let B=o*E-d*r;A+=B,D+=(o+d)*B,z+=(r+E)*B,f&&(B=o*C-d*l,J+=(l+C)*B,N+=B),o<a[0]&&(a[0]=o),o>a[1]&&(a[1]=o),r<a[2]&&(a[2]=r),r>a[3]&&(a[3]=r),f&&(l<a[4]&&(a[4]=l),l>a[5]&&(a[5]=l))}if(A*v>0&&(A*=-1),N*v>0&&(N*=-1),!A)return null;const w=[D,z,.5*A];return f&&(w[3]=J,w[4]=.5*N),w}function I(a,c,F,R){const f=F-a,p=R-c;return Math.sqrt(f*f+p*p)}function H(a,c,F,R,f,p){const v=R-a,x=f-c,M=p-F;return Math.sqrt(v*v+x*x+M*M)}function S(a,c,F,R){return[a+.5*(F-a),c+.5*(R-c)]}function X(a,c,F,R,f,p){return[a+.5*(R-a),c+.5*(f-c),F+.5*(p-F)]}},61256:(et,G,u)=>{u.d(G,{H:()=>S});var b=u(8314),T=u(36592),K=u(65401);const m={minX:0,minY:0,maxX:0,maxY:0};class S{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new T.Q(9,(0,b.Z)("esri-csp-restrictions")?a=>({minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const a=new Array(this._idByBounds.size);let c=0;this._idByBounds.forEach((F,R)=>{a[c++]=R}),this._indexInvalid=!1,this._index.clear(),this._index.load(a)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(a=>this._idByBounds.has(a))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const a=(0,K.cS)();for(const c of this._boundsById.values())c&&(a[0]=Math.min(c[0],a[0]),a[1]=Math.min(c[1],a[1]),a[2]=Math.max(c[2],a[2]),a[3]=Math.max(c[3],a[3]));return a}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(a){const c=this._boundsById.get(a);this._boundsById.delete(a),c&&(this._idByBounds.delete(c),this._indexInvalid||this._index.remove(c))}forEachInBounds(a,c){this._loadIndex(),function H(X,a,c){(function I(X){m.minX=X[0],m.minY=X[1],m.maxX=X[2],m.maxY=X[3]})(a),X.search(m,c)}(this._index,a,F=>c(this._idByBounds.get(F)))}get(a){return this._boundsById.get(a)}has(a){return this._boundsById.has(a)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(a,c){if(!this._indexInvalid){const F=this._boundsById.get(a);F&&(this._index.remove(F),this._idByBounds.delete(F))}this._boundsById.set(a,c),c&&(this._idByBounds.set(c,a),this._indexInvalid||(this._boundsToLoad.push(c),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},3579:(et,G,u)=>{u.d(G,{Z:()=>F});var b=u(26584),T=u(61885),K=u(63290),L=u(62208),m=u(5548),I=u(65401),H=u(82054),S=u(61256),X=u(92794),a=u(6185);const c=(0,m.Ue)();class F{constructor(f){this.geometryInfo=f,this._boundsStore=new S.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new T.Z,this.featureAdapter=X.n}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let f=0;return this._featuresById.forEach(p=>{(0,L.pC)(p.geometry)&&p.geometry.coords&&(f+=p.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:f/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(f){if((0,L.Wi)(this.fullBounds))return null;const[p,v,x,M]=this.fullBounds;return{xmin:p,ymin:v,xmax:x,ymax:M,spatialReference:(0,a.S2)(f)}}add(f){this._add(f),this._emitChanged()}addMany(f){for(const p of f)this._add(p);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(f){const p=this._featuresById.get(f);return p?(this._remove(p),this._emitChanged(),p):null}removeManyById(f){this._boundsStore.invalidateIndex();for(const p of f){const v=this._featuresById.get(p);v&&this._remove(v)}this._emitChanged()}forEachBounds(f,p){for(const v of f){const x=this._boundsStore.get(v.objectId);x&&p((0,m.JR)(c,x))}}getFeature(f){return this._featuresById.get(f)}has(f){return this._featuresById.has(f)}forEach(f){this._featuresById.forEach(p=>f(p))}forEachInBounds(f,p){this._boundsStore.forEachInBounds(f,v=>{p(this._featuresById.get(v))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let f=!1;this._featuresById.forEach((p,v)=>{this._markedIds.has(v)||(f=!0,this._remove(p))}),this._markedIds.clear(),f&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(f){if(!f)return;const p=f.objectId;if(null==p)return void K.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new b.Z("featurestore:invalid-feature","feature id is missing",{feature:f}));const v=this._featuresById.get(p);let x;if(this._markedIds.add(p),v?(f.displayId=v.displayId,x=this._boundsStore.get(p),this._boundsStore.delete(p)):(0,L.pC)(this.onFeatureAdd)&&this.onFeatureAdd(f),(0,L.Wi)(f.geometry)||!f.geometry.coords||!f.geometry.coords.length)return this._boundsStore.set(p,null),void this._featuresById.set(p,f);x=(0,H.$)((0,L.pC)(x)?x:(0,I.Ue)(),f.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),(0,L.pC)(x)&&this._boundsStore.set(p,x),this._featuresById.set(p,f)}_remove(f){(0,L.pC)(this.onFeatureRemove)&&this.onFeatureRemove(f);const p=f.objectId;return this._markedIds.delete(p),this._boundsStore.delete(p),this._featuresById.delete(p),f}}},92794:(et,G,u)=>{u.d(G,{n:()=>m});var b=u(62208),T=u(77044),K=u(66385),L=u(88071);const m={getObjectId:I=>I.objectId,getAttributes:I=>I.attributes,getAttribute:(I,H)=>I.attributes[H],cloneWithGeometry:(I,H)=>new K.u_(H,I.attributes,null,I.objectId),getGeometry:I=>I.geometry,getCentroid:(I,H)=>((0,b.Wi)(I.centroid)&&(I.centroid=(0,T.Y)(new L.Z,I.geometry,H.hasZ,H.hasM)),I.centroid)}},86354:(et,G,u)=>{u.r(G),u.d(G,{default:()=>Et});var b=u(15861),T=u(17626),K=u(61885),L=u(72392),m=u(62208),I=u(10699),H=u(32917),S=u(77712),a=(u(90912),u(85931)),c=u(76898),F=u(17760),R=u(65234),f=u(3579),p=u(58175),v=u(2584),x=u(96854),M=u(82706),Z=u(17936),D=u(1520),z=u(83010),J=u(14517);let A=class extends J.Z{constructor(){super(...arguments),this.updating=!1,this._pending=[]}push(t,e){this._pending.push({promise:t,callback:e}),1===this._pending.length&&this._process()}_process(){if(!this._pending.length)return void(this.updating=!1);this.updating=!0;const t=this._pending[0];t.promise.then(e=>t.callback(e)).catch(()=>{}).then(()=>{this._pending.shift(),this._process()})}};(0,T._)([(0,S.Cb)()],A.prototype,"updating",void 0),A=(0,T._)([(0,c.j)("esri.core.AsyncSequence")],A);var y,t,N=u(59213),w=u(80542),_=u(54024),s=u(63290),o=u(2004),r=u(65401),l=u(82054),d=u(38305),E=u(98558),C=u(20477);class B{constructor(e,i){this.data=e,this.resolution=i,this.state={type:y.CREATED},this.alive=!0}process(e){switch(this.state.type){case y.CREATED:return this.state=this._gotoFetchCount(this.state,e),this.state.task.promise.then(e.resume,e.resume);case y.FETCH_COUNT:break;case y.FETCHED_COUNT:return this.state=this._gotoFetchFeatures(this.state,e),this.state.task.promise.then(e.resume,e.resume);case y.FETCH_FEATURES:break;case y.FETCHED_FEATURES:this.state=this._goToDone(this.state,e)}return null}get debugInfo(){return{data:this.data,featureCount:this._featureCount,state:this._stateToString}}get _featureCount(){switch(this.state.type){case y.CREATED:case y.FETCH_COUNT:return 0;case y.FETCHED_COUNT:return this.state.featureCount;case y.FETCH_FEATURES:return this.state.previous.featureCount;case y.FETCHED_FEATURES:return this.state.features.length;case y.DONE:return this.state.previous.features.length}}get _stateToString(){switch(this.state.type){case y.CREATED:return"created";case y.FETCH_COUNT:return"fetch-count";case y.FETCHED_COUNT:return"fetched-count";case y.FETCH_FEATURES:return"fetch-features";case y.FETCHED_FEATURES:return"fetched-features";case y.DONE:return"done"}}_gotoFetchCount(e,i){var n=this;return{type:y.FETCH_COUNT,previous:e,task:(0,N.vr)(function(){var h=(0,b.Z)(function*(g){const P=yield(0,N.mt)(i.fetchCount(n,g));n.state.type===y.FETCH_COUNT&&(n.state=n._gotoFetchedCount(n.state,P.ok?P.value:1/0))});return function(g){return h.apply(this,arguments)}}())}}_gotoFetchedCount(e,i){return{type:y.FETCHED_COUNT,featureCount:i,previous:e}}_gotoFetchFeatures(e,i){var n=this;return{type:y.FETCH_FEATURES,previous:e,task:(0,N.vr)(function(){var h=(0,b.Z)(function*(g){const P=yield(0,N.mt)(i.fetchFeatures(n,e.featureCount,g));n.state.type===y.FETCH_FEATURES&&(n.state=n._gotoFetchedFeatures(n.state,P.ok?P.value:[]))});return function(g){return h.apply(this,arguments)}}())}}_gotoFetchedFeatures(e,i){return{type:y.FETCHED_FEATURES,previous:e,features:i}}_goToDone(e,i){return i.finish(this,e.features),{type:y.DONE,previous:e}}reset(){const e=this.state;switch(this.state={type:y.CREATED},e.type){case y.CREATED:case y.FETCHED_COUNT:case y.FETCHED_FEATURES:case y.DONE:break;case y.FETCH_COUNT:case y.FETCH_FEATURES:e.task.abort()}}intersects(e){return!(!(0,m.Wi)(e)&&this.data.extent)||((0,r.oJ)(e,U),(0,r.kK)(this.data.extent,U))}}(t=y||(y={}))[t.CREATED=0]="CREATED",t[t.FETCH_COUNT=1]="FETCH_COUNT",t[t.FETCHED_COUNT=2]="FETCHED_COUNT",t[t.FETCH_FEATURES=3]="FETCH_FEATURES",t[t.FETCHED_FEATURES=4]="FETCHED_FEATURES",t[t.DONE=5]="DONE";const U=(0,r.Ue)();let O=class extends w.r{get _minimumVerticesPerFeature(){switch(this.store?.featureStore.geometryType){case"esriGeometryPoint":case"esriGeometryMultipoint":return 1;case"esriGeometryPolygon":return 4;case"esriGeometryPolyline":return 2}}set filter(t){const e=this._get("filter"),i=this._filterProperties(t);JSON.stringify(e)!==JSON.stringify(i)&&this._set("filter",i)}set customParameters(t){const e=this._get("customParameters");JSON.stringify(e)!==JSON.stringify(t)&&this._set("customParameters",t)}get _configuration(){return{filter:this.filter,customParameters:this.customParameters,tileInfo:this.tileInfo,tileSize:this.tileSize}}set tileInfo(t){const e=this._get("tileInfo");e!==t&&((0,m.pC)(t)&&(0,m.pC)(e)&&JSON.stringify(t)===JSON.stringify(e)||(this._set("tileInfo",t),this.store.tileInfo=t))}set tileSize(t){this._get("tileSize")!==t&&this._set("tileSize",t)}get updating(){return this.updatingExcludingEdits||this._pendingEdits.updating}get updatingExcludingEdits(){return this.updatingHandles.updating}get hasZ(){return this.store.featureStore.hasZ}constructor(t){super(t),this.tilesOfInterest=[],this.availability=0,this._pendingTiles=new Map,this._pendingEdits=new A,this._pendingEditsAbortController=new AbortController}initialize(){this._initializeFetchExtent(),this.updatingHandles.add(()=>this._configuration,()=>this.refresh()),this.updatingHandles.add(()=>this.tilesOfInterest,(t,e)=>{(0,a.fS)(t,e,({id:i},{id:n})=>i===n)||this._process()},H.Z_)}destroy(){this._pendingTiles.forEach(t=>this._deletePendingTile(t)),this._pendingTiles.clear(),this.store.destroy(),this.tilesOfInterest.length=0,this._pendingEditsAbortController.abort(),this._pendingEditsAbortController=null}refresh(){this.store.refresh(),this._pendingTiles.forEach(t=>this._deletePendingTile(t)),this._process()}applyEdits(t){var e=this;this._pendingEdits.push(t,function(){var i=(0,b.Z)(function*(n){if(0===n.addedFeatures.length&&0===n.updatedFeatures.length&&0===n.deletedFeatures.length)return;for(const[,g]of e._pendingTiles)g.reset();const h={...n,deletedFeatures:n.deletedFeatures.map(({objectId:g,globalId:P})=>g&&-1!==g?g:e._lookupObjectIdByGlobalId(P))};yield e.updatingHandles.addPromise(e.store.processEdits(h,(g,P)=>e._queryFeaturesById(g,P),e._pendingEditsAbortController.signal)),e._processPendingTiles()});return function(n){return i.apply(this,arguments)}}())}_initializeFetchExtent(){var t=this;if(!this.capabilities.query.supportsExtent||!(0,d.M8)(this.url))return;const e=(0,N.vr)(function(){var i=(0,b.Z)(function*(n){try{const h=yield(0,C.Vr)(t.url,new x.Z({where:"1=1",outSpatialReference:t.spatialReference,cacheHint:!!t.capabilities.query.supportsCacheHint||void 0}),{query:t._configuration.customParameters,signal:n});t.store.extent=o.Z.fromJSON(h.data?.extent)}catch(h){(0,I.r9)(h),s.Z.getLogger(t.declaredClass).warn("Failed to fetch data extent",h)}});return function(n){return i.apply(this,arguments)}}());this.updatingHandles.addPromise(e.promise.then(()=>this._process())),this.handles.add((0,_.kB)(()=>e.abort()))}get debugInfo(){return{numberOfFeatures:this.store.featureStore.numFeatures,tilesOfInterest:this.tilesOfInterest,pendingTiles:Array.from(this._pendingTiles.values()).map(t=>t.debugInfo),storedTiles:this.store.debugInfo}}_process(){this._markTilesNotAlive(),this._createPendingTiles(),this._deletePendingTiles(),this._processPendingTiles()}_markTilesNotAlive(){for(const[,t]of this._pendingTiles)t.alive=!1}_createPendingTiles(){const t=this._collectMissingTilesInfo();if(this._setAvailability((0,m.Wi)(t)?1:t.coveredArea/t.fullArea),!(0,m.Wi)(t))for(const{data:e,resolution:i}of t.missingTiles){const n=this._pendingTiles.get(e.id);n?(n.resolution=i,n.alive=!0):this._createPendingTile(e,i)}}_collectMissingTilesInfo(){let t=null;for(let e=this.tilesOfInterest.length-1;e>=0;e--){const n=this.store.process(this.tilesOfInterest[e],(h,g)=>this._verifyTileComplexity(h,g));(0,m.Wi)(t)?t=n:t.prepend(n)}return t}_deletePendingTiles(){for(const[,t]of this._pendingTiles)t.alive||this._deletePendingTile(t)}_processPendingTiles(){const t={fetchCount:(e,i)=>this._fetchCount(e,i),fetchFeatures:(e,i,n)=>this._fetchFeatures(e,i,n),finish:(e,i)=>this._finishPendingTile(e,i),resume:()=>this._processPendingTiles()};if(this._ensureFetchAllCounts(t))for(const[,e]of this._pendingTiles)this._verifyTileComplexity(this.store.getFeatureCount(e.data),e.resolution)&&this.updatingHandles.addPromise(e.process(t))}_verifyTileComplexity(t,e){return this._verifyVertexComplexity(t)&&this._verifyFeatureDensity(t,e)}_verifyVertexComplexity(t){return t*this._minimumVerticesPerFeature<at}_verifyFeatureDensity(t,e){if((0,m.Wi)(this.tileInfo))return!1;const i=this.tileSize*e;return t*(lt/(i*i))<ht}_ensureFetchAllCounts(t){let e=!0;for(const[,i]of this._pendingTiles)i.state.type<y.FETCHED_COUNT&&this.updatingHandles.addPromise(i.process(t)),i.state.type<=y.FETCH_COUNT&&(e=!1);return e}_finishPendingTile(t,e){this.store.add(t.data,e),this._deletePendingTile(t),this._updateAvailability()}_updateAvailability(){const t=this._collectMissingTilesInfo();this._setAvailability((0,m.Wi)(t)?1:t.coveredArea/t.fullArea)}_setAvailability(t){this._set("availability",t)}_createPendingTile(t,e){const i=new B(t,e);return this._pendingTiles.set(t.id,i),i}_deletePendingTile(t){t.reset(),this._pendingTiles.delete(t.data.id)}_fetchCount(t,e){var i=this;return(0,b.Z)(function*(){return i.store.fetchCount(t.data,i.url,i._createCountQuery(t),{query:i.customParameters,timeout:it,signal:e})})()}_fetchFeatures(t,e,i){var n=this;return(0,b.Z)(function*(){let h=0;const g=[];let P=0,Y=e;for(;;){const j=n._createFeaturesQuery(t),W=n._setPagingParameters(j,h,Y),{features:V,exceededTransferLimit:st}=yield n._queryFeatures(j,i);W&&(h+=(0,m.Wg)(j.num)),P+=V.length;for(const Ct of V)g.push(Ct);if(Y=e-P,!W||!st||Y<=0)return g}})()}_filterProperties(t){return(0,m.Wi)(t)?{where:"1=1",gdbVersion:void 0,timeExtent:void 0}:{where:t.where||"1=1",timeExtent:t.timeExtent,gdbVersion:t.gdbVersion}}_lookupObjectIdByGlobalId(t){const e=this.globalIdField,i=this.objectIdField;if((0,m.Wi)(e))throw new Error("Expected globalIdField to be defined");let n=null;if(this.store.featureStore.forEach(h=>{t===h.attributes[e]&&(n=h.objectId??h.attributes[i])}),(0,m.Wi)(n))throw new Error(`Expected to find a feature with globalId ${t}`);return n}_queryFeaturesById(t,e){const i=this._createFeaturesQuery();return i.objectIds=t,this._queryFeatures(i,e)}_queryFeatures(t,e){return this.capabilities.query.supportsFormatPBF?this._queryFeaturesPBF(t,e):this._queryFeaturesJSON(t,e)}_queryFeaturesPBF(t,e){var i=this;return(0,b.Z)(function*(){const{sourceSpatialReference:n}=i,{data:h}=yield(0,C.qp)(i.url,t,new E.J({sourceSpatialReference:n}),{query:i._configuration.customParameters,timeout:it,signal:e});return(0,l.lM)(h)})()}_queryFeaturesJSON(t,e){var i=this;return(0,b.Z)(function*(){const{sourceSpatialReference:n}=i,{data:h}=yield(0,C.JT)(i.url,t,n,{query:i._configuration.customParameters,timeout:it,signal:e});return(0,l.h_)(h,i.objectIdField)})()}_createCountQuery(t){const e=this._createBaseQuery(t);return this.capabilities.query.supportsCacheHint&&(e.cacheHint=!0),e}_createFeaturesQuery(t=null){const e=this._createBaseQuery(t);return e.outFields=this.globalIdField?[this.globalIdField,this.objectIdField]:[this.objectIdField],e.returnGeometry=!0,(0,m.pC)(t)&&(this.capabilities.query.supportsResultType?e.resultType="tile":this.capabilities.query.supportsCacheHint&&(e.cacheHint=!0)),e}_createBaseQuery(t){const e=new x.Z({returnZ:this.hasZ,returnM:!1,geometry:(0,m.pC)(this.tileInfo)&&(0,m.pC)(t)?(0,r.HH)(t.data.extent,this.tileInfo.spatialReference):void 0}),i=this._configuration.filter;return(0,m.pC)(i)&&(e.where=i.where,e.gdbVersion=i.gdbVersion,e.timeExtent=i.timeExtent),e.outSpatialReference=this.spatialReference,e}_setPagingParameters(t,e,i){if(!this.capabilities.query.supportsPagination)return!1;const{supportsMaxRecordCountFactor:n,supportsCacheHint:h,tileMaxRecordCount:g,maxRecordCount:P,supportsResultType:Y}=this.capabilities.query,j=n?x.Z.MAX_MAX_RECORD_COUNT_FACTOR:1,W=j*((Y||h)&&g?g:P||Q);return t.start=e,n?(t.maxRecordCountFactor=Math.min(j,Math.ceil(i/W)),t.num=Math.min(i,t.maxRecordCountFactor*W)):t.num=Math.min(i,W),!0}};(0,T._)([(0,S.Cb)({constructOnly:!0})],O.prototype,"url",void 0),(0,T._)([(0,S.Cb)({constructOnly:!0})],O.prototype,"objectIdField",void 0),(0,T._)([(0,S.Cb)({constructOnly:!0})],O.prototype,"globalIdField",void 0),(0,T._)([(0,S.Cb)({constructOnly:!0})],O.prototype,"capabilities",void 0),(0,T._)([(0,S.Cb)({constructOnly:!0})],O.prototype,"sourceSpatialReference",void 0),(0,T._)([(0,S.Cb)({constructOnly:!0})],O.prototype,"spatialReference",void 0),(0,T._)([(0,S.Cb)({constructOnly:!0})],O.prototype,"store",void 0),(0,T._)([(0,S.Cb)({readOnly:!0})],O.prototype,"_minimumVerticesPerFeature",null),(0,T._)([(0,S.Cb)()],O.prototype,"filter",null),(0,T._)([(0,S.Cb)()],O.prototype,"customParameters",null),(0,T._)([(0,S.Cb)({readOnly:!0})],O.prototype,"_configuration",null),(0,T._)([(0,S.Cb)()],O.prototype,"tileInfo",null),(0,T._)([(0,S.Cb)()],O.prototype,"tileSize",null),(0,T._)([(0,S.Cb)()],O.prototype,"tilesOfInterest",void 0),(0,T._)([(0,S.Cb)({readOnly:!0})],O.prototype,"updating",null),(0,T._)([(0,S.Cb)({readOnly:!0})],O.prototype,"updatingExcludingEdits",null),(0,T._)([(0,S.Cb)({readOnly:!0})],O.prototype,"availability",void 0),(0,T._)([(0,S.Cb)()],O.prototype,"hasZ",null),O=(0,T._)([(0,c.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiledFetcher")],O);const Q=2e3,it=6e5,at=1e6,lt=25,ht=1;var nt=u(27306),ut=u(61256),dt=u(68511);class ct{constructor(){this._store=new Map,this._byteSize=0}set(e,i){this.delete(e),this._store.set(e,i),this._byteSize+=i.byteSize}delete(e){const i=this._store.get(e);return!!this._store.delete(e)&&(null!=i&&(this._byteSize-=i.byteSize),!0)}get(e){return this._used(e),this._store.get(e)}has(e){return this._used(e),this._store.has(e)}clear(){this._store.clear()}applyByteSizeLimit(e,i){for(const[n,h]of this._store){if(this._byteSize<=e)break;this.delete(n),i(h)}}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}_used(e){const i=this._store.get(e);i&&(this._store.delete(e),this._store.set(e,i))}}let q=class extends J.Z{constructor(t){super(t),this.tileInfo=null,this.extent=null,this.maximumByteSize=10*nt.Y8.MEGABYTES,this._tileBounds=new ut.H,this._tiles=new ct,this._refCounts=new Map,this._tileFeatureCounts=new Map,this._tmpBoundingRect=(0,r.Ue)()}add(t,e){const i=[];for(const n of e)this._referenceFeature(n.objectId)===k.ADDED&&i.push(n);this._addTileStorage(t,new Set(e.map(n=>n.objectId)),function _t(t){return t.reduce((e,i)=>e+function ft(t){return 32+function pt(t){if((0,m.Wi)(t))return 0;const e=(0,nt.do)(t.lengths,4);return 32+(0,nt.do)(t.coords,8)+e}(t.geometry)+(0,nt.f2)(t.attributes)}(i),0)}(e)),this.featureStore.addMany(i),this._tiles.applyByteSizeLimit(this.maximumByteSize,n=>this._removeTileStorage(n))}destroy(){this.clear(),this._tileFeatureCounts.clear()}clear(){this.featureStore.clear(),this._tileBounds.clear(),this._tiles.clear(),this._refCounts.clear()}refresh(){this.clear(),this._tileFeatureCounts.clear()}processEdits(t,e,i){return this._processEditsDelete(t.deletedFeatures.concat(t.updatedFeatures)),this._processEditsRefetch(t.addedFeatures.concat(t.updatedFeatures),e,i)}_addTileStorage(t,e,i){const n=t.id;this._tiles.set(n,new gt(t,e,i)),this._tileBounds.set(n,t.extent),this._tileFeatureCounts.set(n,e.size)}_remove({id:t}){const e=this._tiles.get(t);e&&this._removeTileStorage(e)}_removeTileStorage(t){const e=[];for(const n of t.objectIds)this._unreferenceFeature(n)===k.REMOVED&&e.push(n);this.featureStore.removeManyById(e);const i=t.data.id;this._tiles.delete(i),this._tileBounds.delete(i)}_processEditsDelete(t){this.featureStore.removeManyById(t);for(const[,e]of this._tiles){for(const i of t)e.objectIds.delete(i);this._tileFeatureCounts.set(e.data.id,e.objectIds.size)}for(const e of t)this._refCounts.delete(e)}_processEditsRefetch(t,e,i){var n=this;return(0,b.Z)(function*(){const h=(yield e(t,i)).features,{hasZ:g,hasM:P}=n.featureStore;for(const Y of h){const j=(0,l.$)(n._tmpBoundingRect,Y.geometry,g,P);(0,m.Wi)(j)||n._tileBounds.forEachInBounds(j,W=>{const V=n._tiles.get(W);n.featureStore.add(Y);const st=Y.objectId;V.objectIds.has(st)||(V.objectIds.add(st),n._referenceFeature(st),n._tileFeatureCounts.set(V.data.id,V.objectIds.size))})}})()}process(t,e=(()=>!0)){if((0,m.Wi)(this.tileInfo)||!t.extent||(0,m.pC)(this.extent)&&!(0,r.kK)((0,r.oJ)(this.extent,this._tmpBoundingRect),t.extent))return new rt(t);if(this._tiles.has(t.id))return new rt(t);const i=this._createTileTree(t,this.tileInfo);return this._simplify(i,e,null,0,1),this._collectMissingTiles(t,i,this.tileInfo)}get debugInfo(){return Array.from(this._tiles.values()).map(({data:t})=>({data:t,featureCount:this._tileFeatureCounts.get(t.id)||0}))}getFeatureCount(t){return this._tileFeatureCounts.get(t.id)??0}fetchCount(t,e,i,n){var h=this;return(0,b.Z)(function*(){const g=h._tileFeatureCounts.get(t.id);if(null!=g)return g;const P=yield(0,C.hH)(e,i,n);return h._tileFeatureCounts.set(t.id,P.data.count),P.data.count})()}_createTileTree(t,e){const i=new ot(t.level,t.row,t.col);return e.updateTileInfo(i,v.Z.ExtrapolateOptions.POWER_OF_TWO),this._tileBounds.forEachInBounds(t.extent,n=>{const h=this._tiles.get(n)?.data;h&&this._tilesAreRelated(t,h)&&this._populateChildren(i,h,e,this._tileFeatureCounts.get(h.id)||0)}),i}_tilesAreRelated(t,e){if(!t||!e)return!1;if(t.level===e.level)return t.row===e.row&&t.col===e.col;const i=t.level<e.level,n=i?t:e,h=i?e:t,g=1<<h.level-n.level;return Math.floor(h.row/g)===n.row&&Math.floor(h.col/g)===n.col}_populateChildren(t,e,i,n){const h=e.level-t.level-1;if(h<0)return void(t.isLeaf=!0);const g=e.row>>h,P=e.col>>h,j=P-(t.col<<1)+(g-(t.row<<1)<<1),W=t.children[j];if((0,m.pC)(W))this._populateChildren(W,e,i,n);else{const V=new ot(t.level+1,g,P);i.updateTileInfo(V,v.Z.ExtrapolateOptions.POWER_OF_TWO),t.children[j]=V,this._populateChildren(V,e,i,n)}}_simplify(t,e,i,n,h){const g=h*h;if(t.isLeaf)return e(this.getFeatureCount(t),h)?0:(this._remove(t),(0,m.pC)(i)&&(i.children[n]=null),g);const P=h/2,Y=P*P;let j=0;for(let W=0;W<t.children.length;W++){const V=t.children[W];j+=(0,m.pC)(V)?this._simplify(V,e,t,W,P):Y}return 0===j?this._mergeChildren(t):1-j/g<yt&&(this._purge(t),(0,m.pC)(i)&&(i.children[n]=null),j=g),j}_mergeChildren(t){const e=new Set;let i=0;this._forEachLeaf(t,n=>{const h=this._tiles.get(n.id);if(h){i+=h.byteSize;for(const g of h.objectIds)e.has(g)||(e.add(g),this._referenceFeature(g));this._remove(n)}}),this._addTileStorage(t,e,i),t.isLeaf=!0,t.children[0]=t.children[1]=t.children[2]=t.children[3]=null,this._tileFeatureCounts.set(t.id,e.size)}_forEachLeaf(t,e){for(const i of t.children)(0,m.Wi)(i)||(i.isLeaf?e(i):this._forEachLeaf(i,e))}_purge(t){if(!(0,m.Wi)(t))if(t.isLeaf)this._remove(t);else for(let e=0;e<t.children.length;e++)this._purge(t.children[e]),t.children[e]=null}_collectMissingTiles(t,e,i){const n=new mt(i,t,this.extent);return this._collectMissingTilesRecurse(e,n,1),n.info}_collectMissingTilesRecurse(t,e,i){if(t.isLeaf)return;if(!t.hasChildren)return void e.addMissing(t.level,t.row,t.col,i);const n=i/2;for(let h=0;h<t.children.length;h++){const g=t.children[h];(0,m.Wi)(g)?e.addMissing(t.level+1,(t.row<<1)+((2&h)>>1),(t.col<<1)+(1&h),n):this._collectMissingTilesRecurse(g,e,n)}}_referenceFeature(t){const e=(this._refCounts.get(t)||0)+1;return this._refCounts.set(t,e),1===e?k.ADDED:k.UNCHANGED}_unreferenceFeature(t){const e=(this._refCounts.get(t)||0)-1;return 0===e?(this._refCounts.delete(t),k.REMOVED):(e>0&&this._refCounts.set(t,e),k.UNCHANGED)}get test(){return{tiles:Array.from(this._tiles.values()).map(t=>`${t.data.id}:[${Array.from(t.objectIds)}]`),featureReferences:Array.from(this._refCounts.keys()).map(t=>`${t}:${this._refCounts.get(t)}`)}}};(0,T._)([(0,S.Cb)({constructOnly:!0})],q.prototype,"featureStore",void 0),(0,T._)([(0,S.Cb)()],q.prototype,"tileInfo",void 0),(0,T._)([(0,S.Cb)()],q.prototype,"extent",void 0),(0,T._)([(0,S.Cb)()],q.prototype,"maximumByteSize",void 0),q=(0,T._)([(0,c.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTileStore")],q);class gt{constructor(e,i,n){this.data=e,this.objectIds=i,this.byteSize=n}}class ot{constructor(e,i,n){this.level=e,this.row=i,this.col=n,this.isLeaf=!1,this.extent=null,this.children=[null,null,null,null]}get hasChildren(){return!this.isLeaf&&((0,m.pC)(this.children[0])||(0,m.pC)(this.children[1])||(0,m.pC)(this.children[2])||(0,m.pC)(this.children[3]))}}class rt{constructor(e,i=[]){this.missingTiles=i,this.fullArea=0,this.coveredArea=0,this.fullArea=(0,r.SO)(e.extent),this.coveredArea=this.fullArea}prepend(e){this.missingTiles=e.missingTiles.concat(this.missingTiles),this.coveredArea+=e.coveredArea,this.fullArea+=e.fullArea}}class mt{constructor(e,i,n){this._tileInfo=e,this._extent=null,this.info=new rt(i),(0,m.pC)(n)&&(this._extent=(0,r.oJ)(n))}addMissing(e,i,n,h){const g=new dt.f(null,e,i,n);this._tileInfo.updateTileInfo(g,v.Z.ExtrapolateOptions.POWER_OF_TWO),(0,m.Wi)(g.extent)||(0,m.pC)(this._extent)&&!(0,r.kK)(this._extent,g.extent)||(this.info.missingTiles.push({data:g,resolution:h}),this.info.coveredArea-=(0,r.SO)(g.extent))}}const yt=.18751;var k;!function(t){t[t.ADDED=0]="ADDED",t[t.REMOVED=1]="REMOVED",t[t.UNCHANGED=2]="UNCHANGED"}(k||(k={}));let tt=class extends K.Z.EventedAccessor{constructor(){var t;super(...arguments),t=this,this._isInitializing=!0,this.remoteClient=null,this._whenSetup=(0,I.dD)(),this._elevationAligner=(0,Z.p)(),this._elevationFilter=(0,D.c)(),this._symbologyCandidatesFetcher=(0,z.k)(),this._handles=new L.Z,this._updatingHandles=new F.t,this._editsUpdatingHandles=new F.t,this._pendingApplyEdits=new Map,this._alignPointsInFeatures=function(){var e=(0,b.Z)(function*(i,n){const h={points:i},g=yield t.remoteClient.invoke("alignElevation",h,{signal:n});return(0,I.k_)(n),g});return function(i,n){return e.apply(this,arguments)}}(),this._getSymbologyCandidates=function(){var e=(0,b.Z)(function*(i,n){const h={candidates:i,spatialReference:t._spatialReference.toJSON()},g=yield t.remoteClient.invoke("getSymbologyCandidates",h,{signal:n});return(0,I.k_)(n),g});return function(i,n){return e.apply(this,arguments)}}()}get updating(){return this.updatingExcludingEdits||this._editsUpdatingHandles.updating||this._featureFetcher.updating}get updatingExcludingEdits(){return this._featureFetcher.updatingExcludingEdits||this._isInitializing||this._updatingHandles.updating}destroy(){this._featureFetcher?.destroy(),this._queryEngine?.destroy(),this._featureStore?.clear(),this._handles?.destroy()}setup(t){var e=this;return(0,b.Z)(function*(){if(e.destroyed)return{result:{}};const{geometryType:i,objectIdField:n,timeInfo:h,fields:g}=t.serviceInfo,{hasZ:P}=t,Y=R.Z.fromJSON(t.spatialReference);e._spatialReference=Y,e._featureStore=new f.Z({...t.serviceInfo,hasZ:P,hasM:!1}),e._queryEngine=new p.q({spatialReference:t.spatialReference,featureStore:e._featureStore,geometryType:i,fields:g,hasZ:P,hasM:!1,objectIdField:n,timeInfo:h}),e._featureFetcher=new O({store:new q({featureStore:e._featureStore}),url:t.serviceInfo.url,objectIdField:t.serviceInfo.objectIdField,globalIdField:t.serviceInfo.globalIdField,capabilities:t.serviceInfo.capabilities,spatialReference:Y,sourceSpatialReference:R.Z.fromJSON(t.serviceInfo.spatialReference)});const j="3d"===t.configuration.viewType;return e._elevationAligner=(0,Z.p)(j,{elevationInfo:(0,m.pC)(t.elevationInfo)?M.Z.fromJSON(t.elevationInfo):null,alignPointsInFeatures:e._alignPointsInFeatures,spatialReference:Y}),e._elevationFilter=(0,D.c)(j),e._handles.add([(0,H.YP)(()=>e._featureFetcher.availability,W=>e.emit("notify-availability",{availability:W}),H.Z_),(0,H.YP)(()=>e.updating,()=>e._notifyUpdating())]),e._whenSetup.resolve(),e._isInitializing=!1,e.configure(t.configuration)})()}configure(t){var e=this;return(0,b.Z)(function*(){return yield e._updatingHandles.addPromise(e._whenSetup.promise),e._updateFeatureFetcherConfiguration(t),{result:{}}})()}fetchCandidates(t,e){var i=this;return(0,b.Z)(function*(){yield i._whenSetup.promise,(0,I.k_)(e);const n=function vt(t){return{point:t.point,mode:t.mode,distance:t.distance,types:t.types,query:(0,m.pC)(t.filter)?t.filter:{where:"1=1"}}}(t),h=(0,m.pC)(e)?e.signal:null,g=yield i._queryEngine.executeQueryForSnapping(n,h);(0,I.k_)(h);const P=yield i._elevationAligner.alignCandidates(g.candidates,h);(0,I.k_)(h);const Y=yield i._symbologyCandidatesFetcher.fetch(P,h);(0,I.k_)(h);const j=0===Y.length?P:P.concat(Y);return{result:{candidates:i._elevationFilter.filter(n,j)}}})()}updateTiles(t,e){var i=this;return(0,b.Z)(function*(){return yield i._updatingHandles.addPromise(i._whenSetup.promise),(0,I.k_)(e),i._featureFetcher.tileSize=t.tileSize,i._featureFetcher.tilesOfInterest=t.tiles,i._featureFetcher.tileInfo=(0,m.pC)(t.tileInfo)?v.Z.fromJSON(t.tileInfo):null,$})()}refresh(t,e){var i=this;return(0,b.Z)(function*(){return yield i._updatingHandles.addPromise(i._whenSetup.promise),(0,I.k_)(e),i._featureFetcher.refresh(),$})()}whenNotUpdating(t,e){var i=this;return(0,b.Z)(function*(){return yield i._updatingHandles.addPromise(i._whenSetup.promise),(0,I.k_)(e),yield(0,H.N1)(()=>!i.updatingExcludingEdits,e),(0,I.k_)(e),$})()}getDebugInfo(t,e){var i=this;return(0,b.Z)(function*(){return(0,I.k_)(e),{result:i._featureFetcher.debugInfo}})()}beginApplyEdits(t,e){var i=this;return(0,b.Z)(function*(){i._updatingHandles.addPromise(i._whenSetup.promise),(0,I.k_)(e);const n=(0,I.dD)();return i._pendingApplyEdits.set(t.id,n),i._featureFetcher.applyEdits(n.promise),i._editsUpdatingHandles.addPromise(n.promise),$})()}endApplyEdits(t,e){var i=this;return(0,b.Z)(function*(){const n=i._pendingApplyEdits.get(t.id);return n&&n.resolve(t.edits),(0,I.k_)(e),$})()}notifyElevationSourceChange(t,e){var i=this;return(0,b.Z)(function*(){return i._elevationAligner.notifyElevationSourceChange(),$})()}notifySymbologyChange(t,e){var i=this;return(0,b.Z)(function*(){return i._symbologyCandidatesFetcher.notifySymbologyChange(),$})()}setSymbologySnappingSupported(t){var e=this;return(0,b.Z)(function*(){return e._symbologyCandidatesFetcher=(0,z.k)(t,e._getSymbologyCandidates),$})()}_updateFeatureFetcherConfiguration(t){this._featureFetcher.filter=(0,m.pC)(t.filter)?x.Z.fromJSON(t.filter):null,this._featureFetcher.customParameters=t.customParameters}_notifyUpdating(){this.emit("notify-updating",{updating:this.updating})}};(0,T._)([(0,S.Cb)({readOnly:!0})],tt.prototype,"updating",null),(0,T._)([(0,S.Cb)({readOnly:!0})],tt.prototype,"updatingExcludingEdits",null),(0,T._)([(0,S.Cb)()],tt.prototype,"_isInitializing",void 0),tt=(0,T._)([(0,c.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorker")],tt);const Et=tt,$={result:{}}}}]);
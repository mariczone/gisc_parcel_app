"use strict";(self.webpackChunkparcel_app=self.webpackChunkparcel_app||[]).push([[8742],{98148:(j,B,h)=>{function S(T,l){const c=T.count;l||(l=new T.TypedArrayConstructor(c));for(let x=0;x<c;x++)l[x]=T.get(x);return l}h.d(B,{m:()=>S}),Object.freeze(Object.defineProperty({__proto__:null,copy:function y(T,l,c){const x=T.typedBuffer,n=T.typedBufferStride,d=l.typedBuffer,s=l.typedBufferStride,a=c?c.count:l.count;let f=(c&&c.dstIndex?c.dstIndex:0)*n,u=(c&&c.srcIndex?c.srcIndex:0)*s;for(let m=0;m<a;++m)x[f]=d[u],f+=n,u+=s},makeDense:S},Symbol.toStringTag,{value:"Module"}))},35995:(j,B,h)=>{h.d(B,{f:()=>T,n:()=>E});var y=h(81096);function S(c,x,n){const d=c.typedBuffer,s=c.typedBufferStride,a=x.typedBuffer,f=x.typedBufferStride,u=n?n.count:x.count;let m=(n&&n.dstIndex?n.dstIndex:0)*s,b=(n&&n.srcIndex?n.srcIndex:0)*f;for(let g=0;g<u;++g)d[m]=a[b],d[m+1]=a[b+1],m+=s,b+=f}function E(c,x,n){const d=c.typedBuffer,s=c.typedBufferStride,a=x.typedBuffer,f=x.typedBufferStride,u=n?n.count:x.count;let m=(n&&n.dstIndex?n.dstIndex:0)*s,b=(n&&n.srcIndex?n.srcIndex:0)*f;if((0,y.U)(x.elementType)){const g=(0,y.Op)(x.elementType);if((0,y.B3)(x.elementType))for(let w=0;w<u;++w)d[m]=Math.max(a[b]/g,-1),d[m+1]=Math.max(a[b+1]/g,-1),m+=s,b+=f;else for(let w=0;w<u;++w)d[m]=a[b]/g,d[m+1]=a[b+1]/g,m+=s,b+=f}else S(c,x,n);return c}function T(c,x,n,d){const s=c.typedBuffer,a=c.typedBufferStride,f=d?.count??c.count;let u=(d?.dstIndex??0)*a;for(let m=0;m<f;++m)s[u]=x,s[u+1]=n,u+=a}Object.freeze(Object.defineProperty({__proto__:null,copy:S,fill:T,normalizeIntegerBuffer:E},Symbol.toStringTag,{value:"Module"}))},63657:(j,B,h)=>{h.d(B,{a:()=>c,n:()=>T,s:()=>l,t:()=>E});var y=h(96286);function E(n,d,s){if(n.count!==d.count)return void y.c.error("source and destination buffers need to have the same number of elements");const a=n.count,f=s[0],u=s[1],m=s[2],b=s[3],g=s[4],w=s[5],O=s[6],C=s[7],U=s[8],L=n.typedBuffer,N=n.typedBufferStride,H=d.typedBuffer,ee=d.typedBufferStride;for(let K=0;K<a;K++){const W=K*N,$=K*ee,G=H[$],X=H[$+1],Z=H[$+2],z=H[$+3];L[W]=f*G+b*X+O*Z,L[W+1]=u*G+g*X+C*Z,L[W+2]=m*G+w*X+U*Z,L[W+3]=z}}function T(n,d){const s=Math.min(n.count,d.count),a=n.typedBuffer,f=n.typedBufferStride,u=d.typedBuffer,m=d.typedBufferStride;for(let b=0;b<s;b++){const g=b*f,w=b*m,O=u[w],C=u[w+1],U=u[w+2],L=O*O+C*C+U*U;if(L>0){const N=1/Math.sqrt(L);a[g]=N*O,a[g+1]=N*C,a[g+2]=N*U}}}function l(n,d,s){const a=Math.min(n.count,d.count),f=n.typedBuffer,u=n.typedBufferStride,m=d.typedBuffer,b=d.typedBufferStride;for(let g=0;g<a;g++){const w=g*u,O=g*b;f[w]=s*m[O],f[w+1]=s*m[O+1],f[w+2]=s*m[O+2],f[w+3]=s*m[O+3]}}function c(n,d,s){const a=Math.min(n.count,d.count),f=n.typedBuffer,u=n.typedBufferStride,m=d.typedBuffer,b=d.typedBufferStride;for(let g=0;g<a;g++){const w=g*u,O=g*b;f[w]=m[O]>>s,f[w+1]=m[O+1]>>s,f[w+2]=m[O+2]>>s,f[w+3]=m[O+3]>>s}}Object.freeze(Object.defineProperty({__proto__:null,normalize:T,scale:l,shiftRight:c,transformMat3:E,transformMat4:function S(n,d,s){if(n.count!==d.count)return void y.c.error("source and destination buffers need to have the same number of elements");const a=n.count,f=s[0],u=s[1],m=s[2],b=s[3],g=s[4],w=s[5],O=s[6],C=s[7],U=s[8],L=s[9],N=s[10],H=s[11],ee=s[12],K=s[13],W=s[14],$=s[15],G=n.typedBuffer,X=n.typedBufferStride,Z=d.typedBuffer,z=d.typedBufferStride;for(let P=0;P<a;P++){const k=P*X,J=P*z,V=Z[J],Y=Z[J+1],Q=Z[J+2],q=Z[J+3];G[k]=f*V+g*Y+U*Q+ee*q,G[k+1]=u*V+w*Y+L*Q+K*q,G[k+2]=m*V+O*Y+N*Q+W*q,G[k+3]=b*V+C*Y+H*Q+$*q}}},Symbol.toStringTag,{value:"Module"}))},63470:(j,B,h)=>{function y(T,l,c){const x=T.typedBuffer,n=T.typedBufferStride,d=l.typedBuffer,s=l.typedBufferStride,a=c?c.count:l.count;let f=(c&&c.dstIndex?c.dstIndex:0)*n,u=(c&&c.srcIndex?c.srcIndex:0)*s;for(let m=0;m<a;++m)x[f]=d[u],x[f+1]=d[u+1],x[f+2]=d[u+2],x[f+3]=d[u+3],f+=n,u+=s}function S(T,l,c,x,n,d){const s=T.typedBuffer,a=T.typedBufferStride,f=d?.count??T.count;let u=(d?.dstIndex??0)*a;for(let m=0;m<f;++m)s[u]=l,s[u+1]=c,s[u+2]=x,s[u+3]=n,u+=a}h.d(B,{c:()=>y,f:()=>S}),Object.freeze(Object.defineProperty({__proto__:null,copy:y,fill:S},Symbol.toStringTag,{value:"Module"}))},10349:(j,B,h)=>{h.d(B,{G:()=>S});var y=h(26584);let S=class{constructor(E,T,l=""){this.major=E,this.minor=T,this._context=l}lessThan(E,T){return this.major<E||E===this.major&&this.minor<T}since(E,T){return!this.lessThan(E,T)}validate(E){if(this.major!==E.major)throw new y.Z((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:E})}clone(){return new S(this.major,this.minor,this._context)}static parse(E,T=""){const[l,c]=E.split("."),x=/^\s*\d+\s*$/;if(!l||!l.match||!l.match(x))throw new y.Z((T&&T+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:E});if(!c||!c.match||!c.match(x))throw new y.Z((T&&T+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:E});const n=parseInt(l,10),d=parseInt(c,10);return new S(n,d,T)}}},60490:(j,B,h)=>{h.d(B,{gS:()=>s});var y=h(81096);function s(a,f){return new a(new ArrayBuffer(f*a.ElementCount*(0,y.n1)(a.ElementType)))}Object.freeze(Object.defineProperty({__proto__:null,copy:function S(a,f,u){const m=a.typedBuffer,b=a.typedBufferStride,g=f.typedBuffer,w=f.typedBufferStride,O=u?u.count:f.count;let C=(u&&u.dstIndex?u.dstIndex:0)*b,U=(u&&u.srcIndex?u.srcIndex:0)*w;for(let L=0;L<O;++L){for(let N=0;N<9;++N)m[C+N]=g[U+N];C+=b,U+=w}}},Symbol.toStringTag,{value:"Module"})),Object.freeze(Object.defineProperty({__proto__:null,copy:function T(a,f,u){const m=a.typedBuffer,b=a.typedBufferStride,g=f.typedBuffer,w=f.typedBufferStride,O=u?u.count:f.count;let C=(u&&u.dstIndex?u.dstIndex:0)*b,U=(u&&u.srcIndex?u.srcIndex:0)*w;for(let L=0;L<O;++L){for(let N=0;N<16;++N)m[C+N]=g[U+N];C+=b,U+=w}}},Symbol.toStringTag,{value:"Module"})),h(98148),h(35995),h(9554),h(63470)},9160:(j,B,h)=>{h.d(B,{C:()=>n});var y=h(15861),S=h(84792),E=h(59213),T=h(26584),l=h(62208),c=h(10699),x=h(21726);class n{constructor(a){this._streamDataRequester=a}loadJSON(a,f){var u=this;return(0,y.Z)(function*(){return u._load("json",a,f)})()}loadBinary(a,f){var u=this;return(0,y.Z)(function*(){return(0,x.HK)(a)?((0,c.k_)(f),(0,x.AH)(a)):u._load("binary",a,f)})()}loadImage(a,f){var u=this;return(0,y.Z)(function*(){return u._load("image",a,f)})()}_load(a,f,u){var m=this;return(0,y.Z)(function*(){if((0,l.Wi)(m._streamDataRequester))return(yield(0,S.default)(f,{responseType:d[a]})).data;const b=yield(0,E.q6)(m._streamDataRequester.request(f,a,u));if(!0===b.ok)return b.value;throw(0,c.r9)(b.error),new T.Z("",`Request for resource failed: ${b.error}`)})()}}const d={image:"image",binary:"array-buffer",json:"json"}},96170:(j,B,h)=>{h.d(B,{DA:()=>T,jX:()=>l,nh:()=>E});var y=h(55713),S=h(37187);function E(c,x=S.p){return"number"==typeof c?x(c):(0,y.Uc)(c)||(0,y.lq)(c)?new Uint32Array(c):c}function T(c){const x="number"==typeof c?c:c.length;if(x<3)return[];const n=x-2,d=(0,S.$z)(n);if("number"==typeof c){let s=0;for(let a=0;a<n;a+=1)a%2==0?(d[s++]=a,d[s++]=a+1,d[s++]=a+2):(d[s++]=a+1,d[s++]=a,d[s++]=a+2)}else{let s=0;for(let a=0;a<n;a+=1)if(a%2==0){const u=c[a+1],m=c[a+2];d[s++]=c[a],d[s++]=u,d[s++]=m}else{const u=c[a],m=c[a+2];d[s++]=c[a+1],d[s++]=u,d[s++]=m}}return d}function l(c){const x="number"==typeof c?c:c.length;if(x<3)return new Uint16Array(0);const n=x-2,d=n<=65536?new Uint16Array(3*n):new Uint32Array(3*n);if("number"==typeof c){let s=0;for(let a=0;a<n;++a)d[s++]=0,d[s++]=a+1,d[s++]=a+2;return d}{const s=c[0];let a=c[1],f=0;for(let u=0;u<n;++u){const m=c[u+2];d[f++]=s,d[f++]=a,d[f++]=m,a=m}return d}}},19574:(j,B,h)=>{h.d(B,{$A:()=>T,Ml:()=>x,NM:()=>E,i$:()=>l});var y=h(15861),S=h(42743);class E{constructor(s){this.data=s,this.type="encoded-mesh-texture",this.encoding=S.Ti.KTX2_ENCODING}}function T(d){return"encoded-mesh-texture"===d?.type}function l(d){return c.apply(this,arguments)}function c(){return(c=(0,y.Z)(function*(d){return new Promise((s,a)=>{const f=new Blob([d]),u=new FileReader;u.onload=()=>{s(JSON.parse(u.result))},u.onerror=m=>{a(m)},u.readAsText(f)})})).apply(this,arguments)}function x(d,s){return n.apply(this,arguments)}function n(){return(n=(0,y.Z)(function*(d,s){return s===S.Ti.KTX2_ENCODING?new E(d):new Promise((a,f)=>{const u=new Blob([d],{type:s}),m=URL.createObjectURL(u),b=new Image,g=()=>{URL.revokeObjectURL(m),"decode"in b?b.decode().then(()=>a(b),()=>a(b)).then(O):(a(b),O())},w=C=>{URL.revokeObjectURL(m),f(C),O()},O=()=>{b.removeEventListener("load",g),b.removeEventListener("error",w)};b.addEventListener("load",g),b.addEventListener("error",w),b.src=m})})).apply(this,arguments)}},12495:(j,B,h)=>{h.d(B,{Q:()=>pe});var C,U,i,y=h(15861),S=h(63290),E=h(62208),T=h(43703),l=h(67969),n=h(26584),d=h(88159),s=h(10699),a=h(21726),f=h(10349),u=h(28347),m=h(48977),b=h(78451),g=h(60479),w=h(98148);class O{constructor(t){this._data=t,this._offset4=0,this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}readUint32(){const t=this._offset4;return this._offset4+=1,this._dataUint32[t]}readUint8Array(t){const r=4*this._offset4;return this._offset4+=t/4,new Uint8Array(this._data,r,t)}remainingBytes(){return this._data.byteLength-4*this._offset4}}(i=C||(C={})).SCALAR="SCALAR",i.VEC2="VEC2",i.VEC3="VEC3",i.VEC4="VEC4",i.MAT2="MAT2",i.MAT3="MAT3",i.MAT4="MAT4",function(i){i[i.ARRAY_BUFFER=34962]="ARRAY_BUFFER",i[i.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"}(U||(U={}));var L=h(94573);const N={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},H={pbrMetallicRoughness:N,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},ee={ESRI_externalColorMixMode:"tint"},K=(i={})=>{const t={...N,...i.pbrMetallicRoughness},r=function W(i){switch(i.ESRI_externalColorMixMode){case"multiply":case"tint":case"ignore":case"replace":break;default:(0,L.Bg)(i.ESRI_externalColorMixMode),i.ESRI_externalColorMixMode="tint"}return i}({...ee,...i.extras});return{...H,...i,pbrMetallicRoughness:t,extras:r}},$={magFilter:l.cw.LINEAR,minFilter:l.cw.LINEAR_MIPMAP_LINEAR,wrapS:l.e8.REPEAT,wrapT:l.e8.REPEAT};var Z=h(19574);class P{constructor(t,r,o,e){if(this._context=t,this.uri=r,this.json=o,this._glbBuffer=e,this._bufferLoaders=new Map,this._textureLoaders=new Map,this._textureCache=new Map,this._materialCache=new Map,this._nodeParentMap=new Map,this._nodeTransformCache=new Map,this._supportedExtensions=["KHR_texture_basisu"],this._baseUri=function X(i){let t,r;return i.replace(/^(.*\/)?([^/]*)$/,(o,e,p)=>(t=e||"",r=p||"","")),{dirPart:t,filePart:r}}(this.uri).dirPart,this._checkVersionSupported(),this._checkRequiredExtensionsSupported(),null==o.scenes)throw new n.Z("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==o.meshes)throw new n.Z("gltf-loader-unsupported-feature","Meshes must be defined");if(null==o.nodes)throw new n.Z("gltf-loader-unsupported-feature","Nodes must be defined.");this._computeNodeParents()}static load(t,r,o){var e=this;return(0,y.Z)(function*(){if((0,a.HK)(r)){const v=(0,a.sJ)(r);if(v&&"model/gltf-binary"!==v.mediaType)try{const A=JSON.parse(v.isBase64?atob(v.data):v.data);return new P(t,r,A)}catch{}const R=(0,a.AH)(r);if(P._isGLBData(R))return e._fromGLBData(t,r,R)}if(r.endsWith(".gltf")){const v=yield t.loadJSON(r,o);return new P(t,r,v)}const p=yield t.loadBinary(r,o);if(P._isGLBData(p))return e._fromGLBData(t,r,p);const _=yield t.loadJSON(r,o);return new P(t,r,_)})()}static _isGLBData(t){if(null==t)return!1;const r=new O(t);return r.remainingBytes()>=4&&1179937895===r.readUint32()}static _fromGLBData(t,r,o){return(0,y.Z)(function*(){const e=yield P._parseGLBData(o);return new P(t,r,e.json,e.binaryData)})()}static _parseGLBData(t){return(0,y.Z)(function*(){const r=new O(t);if(r.remainingBytes()<12)throw new n.Z("gltf-loader-error","GLB binary data is insufficiently large.");const o=r.readUint32(),e=r.readUint32(),p=r.readUint32();if(1179937895!==o)throw new n.Z("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(t.byteLength<p)throw new n.Z("gltf-loader-error","GLB binary data is smaller than header specifies.");if(2!==e)throw new n.Z("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");let _,v,R=0;for(;r.remainingBytes()>=8;){const A=r.readUint32(),I=r.readUint32();if(0===R){if(1313821514!==I)throw new n.Z("gltf-loader-error","First GLB chunk must be JSON.");if(A<0)throw new n.Z("gltf-loader-error","No JSON data found.");_=yield(0,Z.i$)(r.readUint8Array(A))}else if(1===R){if(5130562!==I)throw new n.Z("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");v=r.readUint8Array(A)}else S.Z.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");R+=1}if(!_)throw new n.Z("gltf-loader-error","No GLB JSON chunk detected.");return{json:_,binaryData:v}})()}getBuffer(t,r){var o=this;return(0,y.Z)(function*(){const e=o.json.buffers[t];if(null==e.uri){if(null==o._glbBuffer)throw new n.Z("gltf-loader-error","GLB buffer not present");return o._glbBuffer}const p=yield o._getBufferLoader(t,r);if(p.byteLength!==e.byteLength)throw new n.Z("gltf-loader-error","Buffer byte lengths should match.");return p})()}_getBufferLoader(t,r){var o=this;return(0,y.Z)(function*(){const e=o._bufferLoaders.get(t);if(e)return e;const _=o._context.loadBinary(o._resolveUri(o.json.buffers[t].uri),r).then(v=>new Uint8Array(v));return o._bufferLoaders.set(t,_),_})()}getAccessor(t,r){var o=this;return(0,y.Z)(function*(){if(!o.json.accessors)throw new n.Z("gltf-loader-unsupported-feature","Accessors missing.");const e=o.json.accessors[t];if(null==e?.bufferView)throw new n.Z("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(e.type in[C.MAT2,C.MAT3,C.MAT4])throw new n.Z("gltf-loader-unsupported-feature",`AttributeType ${e.type} is not supported`);const p=o.json.bufferViews[e.bufferView],_=yield o.getBuffer(p.buffer,r),v=Y[e.type],R=Q[e.componentType],A=v*R,I=p.byteStride||A;return{raw:_.buffer,byteStride:I,byteOffset:_.byteOffset+(p.byteOffset||0)+(e.byteOffset||0),entryCount:e.count,isDenselyPacked:I===A,componentCount:v,componentByteSize:R,componentType:e.componentType,min:e.min,max:e.max,normalized:!!e.normalized}})()}getIndexData(t,r){var o=this;return(0,y.Z)(function*(){if(null==t.indices)return;const e=yield o.getAccessor(t.indices,r);if(e.isDenselyPacked)switch(e.componentType){case l.g.UNSIGNED_BYTE:return new Uint8Array(e.raw,e.byteOffset,e.entryCount);case l.g.UNSIGNED_SHORT:return new Uint16Array(e.raw,e.byteOffset,e.entryCount);case l.g.UNSIGNED_INT:return new Uint32Array(e.raw,e.byteOffset,e.entryCount)}else switch(e.componentType){case l.g.UNSIGNED_BYTE:return(0,w.m)(o._wrapAccessor(g.D_,e));case l.g.UNSIGNED_SHORT:return(0,w.m)(o._wrapAccessor(g.av,e));case l.g.UNSIGNED_INT:return(0,w.m)(o._wrapAccessor(g.Nu,e))}})()}getPositionData(t,r){var o=this;return(0,y.Z)(function*(){if(null==t.attributes.POSITION)throw new n.Z("gltf-loader-unsupported-feature","No POSITION vertex data found.");const e=yield o.getAccessor(t.attributes.POSITION,r);if(e.componentType!==l.g.FLOAT)throw new n.Z("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+l.g[e.componentType]);if(3!==e.componentCount)throw new n.Z("gltf-loader-unsupported-feature","POSITION vertex attribute must have 3 components, but found "+e.componentCount.toFixed());return o._wrapAccessor(g.ct,e)})()}getNormalData(t,r){var o=this;return(0,y.Z)(function*(){if(null==t.attributes.NORMAL)throw new n.Z("gltf-loader-error","No NORMAL vertex data found.");const e=yield o.getAccessor(t.attributes.NORMAL,r);if(e.componentType!==l.g.FLOAT)throw new n.Z("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+l.g[e.componentType]);if(3!==e.componentCount)throw new n.Z("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+e.componentCount.toFixed());return o._wrapAccessor(g.ct,e)})()}getTangentData(t,r){var o=this;return(0,y.Z)(function*(){if(null==t.attributes.TANGENT)throw new n.Z("gltf-loader-error","No TANGENT vertex data found.");const e=yield o.getAccessor(t.attributes.TANGENT,r);if(e.componentType!==l.g.FLOAT)throw new n.Z("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+l.g[e.componentType]);if(4!==e.componentCount)throw new n.Z("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+e.componentCount.toFixed());return new g.ek(e.raw,e.byteOffset,e.byteStride,e.byteOffset+e.byteStride*e.entryCount)})()}getTextureCoordinates(t,r){var o=this;return(0,y.Z)(function*(){if(null==t.attributes.TEXCOORD_0)throw new n.Z("gltf-loader-error","No TEXCOORD_0 vertex data found.");const e=yield o.getAccessor(t.attributes.TEXCOORD_0,r);if(2!==e.componentCount)throw new n.Z("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+e.componentCount.toFixed());if(e.componentType===l.g.FLOAT)return o._wrapAccessor(g.Eu,e);if(!e.normalized)throw new n.Z("gltf-loader-unsupported-feature","Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return function q(i){switch(i.componentType){case l.g.BYTE:return new g.Vs(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount);case l.g.UNSIGNED_BYTE:return new g.xA(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount);case l.g.SHORT:return new g.or(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount);case l.g.UNSIGNED_SHORT:return new g.TS(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount);case l.g.UNSIGNED_INT:return new g.qt(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount);case l.g.FLOAT:return new g.Eu(i.raw,i.byteOffset,i.byteStride,i.byteOffset+i.byteStride*i.entryCount)}}(e)})()}getVertexColors(t,r){var o=this;return(0,y.Z)(function*(){if(null==t.attributes.COLOR_0)throw new n.Z("gltf-loader-error","No COLOR_0 vertex data found.");const e=yield o.getAccessor(t.attributes.COLOR_0,r);if(4!==e.componentCount&&3!==e.componentCount)throw new n.Z("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+e.componentCount.toFixed());if(4===e.componentCount){if(e.componentType===l.g.FLOAT)return o._wrapAccessor(g.ek,e);if(e.componentType===l.g.UNSIGNED_BYTE)return o._wrapAccessor(g.mc,e);if(e.componentType===l.g.UNSIGNED_SHORT)return o._wrapAccessor(g.v6,e)}else if(3===e.componentCount){if(e.componentType===l.g.FLOAT)return o._wrapAccessor(g.ct,e);if(e.componentType===l.g.UNSIGNED_BYTE)return o._wrapAccessor(g.ne,e);if(e.componentType===l.g.UNSIGNED_SHORT)return o._wrapAccessor(g.mw,e)}throw new n.Z("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+l.g[e.componentType])})()}hasPositions(t){return void 0!==t.attributes.POSITION}hasNormals(t){return void 0!==t.attributes.NORMAL}hasVertexColors(t){return void 0!==t.attributes.COLOR_0}hasTextureCoordinates(t){return void 0!==t.attributes.TEXCOORD_0}hasTangents(t){return void 0!==t.attributes.TANGENT}getMaterial(t,r,o){var e=this;return(0,y.Z)(function*(){let p=t.material?e._materialCache.get(t.material):void 0;if(!p){const _=null!=t.material?K(e.json.materials[t.material]):K(),v=_.pbrMetallicRoughness,R=e.hasVertexColors(t),A=e.getTexture(v.baseColorTexture,r),I=e.getTexture(_.normalTexture,r),M=o?e.getTexture(_.occlusionTexture,r):void 0,D=o?e.getTexture(_.emissiveTexture,r):void 0,F=o?e.getTexture(v.metallicRoughnessTexture,r):void 0,re=null!=t.material?t.material:-1;p={alphaMode:_.alphaMode,alphaCutoff:_.alphaCutoff,color:v.baseColorFactor,doubleSided:!!_.doubleSided,colorTexture:yield A,normalTexture:yield I,name:_.name,id:re,occlusionTexture:yield M,emissiveTexture:yield D,emissiveFactor:_.emissiveFactor,metallicFactor:v.metallicFactor,roughnessFactor:v.roughnessFactor,metallicRoughnessTexture:yield F,hasVertexColors:R,ESRI_externalColorMixMode:_.extras.ESRI_externalColorMixMode,colorTextureTransform:v?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:_.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:_.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:_.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:v?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return p})()}getTexture(t,r){var o=this;return(0,y.Z)(function*(){if(!t)return;if(0!==(t.texCoord||0))throw new n.Z("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");const e=t.index,p=o.json.textures[e],_=(i=>({...$,...i}))(null!=p.sampler?o.json.samplers[p.sampler]:{}),v=o._getTextureSourceId(p),R=o.json.images[v],A=yield o._loadTextureImageData(e,p,r);return(0,d.s1)(o._textureCache,e,()=>{const I=D=>33071===D||33648===D||10497===D,M=D=>{throw new n.Z("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${D}`)};return{data:A,wrapS:I(_.wrapS)?_.wrapS:M(_.wrapS),wrapT:I(_.wrapT)?_.wrapT:M(_.wrapT),minFilter:_.minFilter,name:R.name,id:e}})})()}getNodeTransform(t){if(void 0===t)return k;let r=this._nodeTransformCache.get(t);if(!r){const o=this.getNodeTransform(this._getNodeParent(t)),e=this.json.nodes[t];e.matrix?r=(0,u.m)((0,T.c)(),o,e.matrix):e.translation||e.rotation||e.scale?(r=(0,T.b)(o),e.translation&&(0,u.w)(r,r,e.translation),e.rotation&&(V[3]=(0,m.g)(V,e.rotation),(0,u.e)(r,r,V[3],V)),e.scale&&(0,u.k)(r,r,e.scale)):r=(0,T.b)(o),this._nodeTransformCache.set(t,r)}return r}_wrapAccessor(t,r){return new t(r.raw,r.byteOffset,r.byteStride,r.byteOffset+r.byteStride*(r.entryCount-1)+r.componentByteSize*r.componentCount)}_resolveUri(t){return(0,a.hF)(t,this._baseUri)}_getNodeParent(t){return this._nodeParentMap.get(t)}_checkVersionSupported(){const t=f.G.parse(this.json.asset.version,"glTF");J.validate(t)}_checkRequiredExtensionsSupported(){const t=this.json;if(t.extensionsRequired&&!t.extensionsRequired.every(r=>this._supportedExtensions.includes(r)))throw new n.Z("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+t.extensionsRequired.join(", "))}_computeNodeParents(){this.json.nodes.forEach((t,r)=>{t.children&&t.children.forEach(o=>{this._nodeParentMap.set(o,r)})})}_loadTextureImageData(t,r,o){var e=this;return(0,y.Z)(function*(){const p=e._textureLoaders.get(t);if(p)return p;const _=e._createTextureLoader(r,o);return e._textureLoaders.set(t,_),_})()}_getTextureSourceId(t){if(void 0!==t.extensions&&null!==t.extensions.KHR_texture_basisu)return t.extensions.KHR_texture_basisu.source;if(null!==t.source)return t.source;throw new n.Z("gltf-loader-unsupported-feature","Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.")}_createTextureLoader(t,r){var o=this;return(0,y.Z)(function*(){const e=o._getTextureSourceId(t),p=o.json.images[e];if(p.uri){if(p.uri.endsWith(".ktx2")){const A=yield o._context.loadBinary(o._resolveUri(p.uri),r);return new Z.NM(new Uint8Array(A))}return o._context.loadImage(o._resolveUri(p.uri),r)}if(null==p.bufferView)throw new n.Z("gltf-loader-unsupported-feature","Image bufferView must be defined.");if(null==p.mimeType)throw new n.Z("gltf-loader-unsupported-feature","Image mimeType must be defined.");const _=o.json.bufferViews[p.bufferView],v=yield o.getBuffer(_.buffer,r);if(null!=_.byteStride)throw new n.Z("gltf-loader-unsupported-feature","byteStride not supported for image buffer");return(0,Z.Ml)(new Uint8Array(v.buffer,v.byteOffset+(_.byteOffset||0),_.byteLength),p.mimeType)})()}getLoadedBuffersSize(){var t=this;return(0,y.Z)(function*(){if(t._glbBuffer)return t._glbBuffer.byteLength;const r=yield(0,s.WW)(Array.from(t._bufferLoaders.values())),o=yield(0,s.WW)(Array.from(t._textureLoaders.values()));return r.reduce((e,p)=>e+(p?.byteLength??0),0)+o.reduce((e,p)=>e+(p?(0,Z.$A)(p)?p.data.byteLength:p.width*p.height*4:0),0)})()}}const k=(0,u.A)((0,T.c)(),Math.PI/2),J=new f.G(2,0,"glTF"),V=(0,b.a)(),Y={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},Q={[l.g.BYTE]:1,[l.g.UNSIGNED_BYTE]:1,[l.g.SHORT]:2,[l.g.UNSIGNED_SHORT]:2,[l.g.FLOAT]:4,[l.g.UNSIGNED_INT]:4};let fe=0;function pe(i,t){return ne.apply(this,arguments)}function ne(){return ne=(0,y.Z)(function*(i,t,r={},o=!0){const e=yield P.load(i,t,r),p="gltf_"+fe++,_={lods:[],materials:new Map,textures:new Map,meta:me(e)},v=!(!e.json.asset.extras||"symbolResource"!==e.json.asset.extras.ESRI_type),R=new Map;yield _e(e,function(){var I=(0,y.Z)(function*(M,D,F,re){const se=R.get(F)??0;R.set(F,se+1);const te=void 0!==M.mode?M.mode:l.MX.TRIANGLES,ae=te===l.MX.TRIANGLES||te===l.MX.TRIANGLE_STRIP||te===l.MX.TRIANGLE_FAN?te:null;if((0,E.Wi)(ae))return void S.Z.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+l.MX[te]+"). Skipping primitive.");if(!e.hasPositions(M))return void S.Z.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.");const Te=e.getPositionData(M,r),xe=e.getMaterial(M,r,o),ie=e.hasNormals(M)?e.getNormalData(M,r):null,ue=e.hasTangents(M)?e.getTangentData(M,r):null,le=e.hasTextureCoordinates(M)?e.getTextureCoordinates(M,r):null,de=e.hasVertexColors(M)?e.getVertexColors(M,r):null,be=e.getIndexData(M,r),we={transform:(0,T.b)(D),attributes:{position:yield Te,normal:ie?yield ie:null,texCoord0:le?yield le:null,color:de?yield de:null,tangent:ue?yield ue:null},indices:yield be,primitiveType:ae,material:ye(_,yield xe,p)};let ce=null;(0,E.pC)(_.meta)&&(0,E.pC)(_.meta.ESRI_lod)&&"screenSpaceRadius"===_.meta.ESRI_lod.metric&&(ce=_.meta.ESRI_lod.thresholds[F]),_.lods[F]=_.lods[F]||{parts:[],name:re,lodThreshold:ce},_.lods[F].parts[se]=we});return function(M,D,F,re){return I.apply(this,arguments)}}());for(const I of _.lods)I.parts=I.parts.filter(M=>!!M);const A=yield e.getLoadedBuffersSize();return{model:_,meta:{isEsriSymbolResource:v,uri:e.uri},customMeta:{},size:A}}),ne.apply(this,arguments)}function me(i){let r=null;return i.json.nodes.forEach(o=>{const e=o.extras;(0,E.pC)(e)&&(e.ESRI_proxyEllipsoid||e.ESRI_lod)&&(r=e)}),r}function _e(i,t){return oe.apply(this,arguments)}function oe(){return oe=(0,y.Z)(function*(i,t){const r=i.json,o=r.scenes[r.scene||0].nodes,e=o.length>1,p=[];for(const R of o){const A=r.nodes[R];p.push(_(R,0)),he(A)&&!e&&A.extensions.MSFT_lod.ids.forEach((I,M)=>_(I,M+1))}function _(R,A){return v.apply(this,arguments)}function v(){return(v=(0,y.Z)(function*(R,A){const I=r.nodes[R],M=i.getNodeTransform(R);if(null!=I.weights&&S.Z.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported."),null!=I.mesh){const D=r.meshes[I.mesh];for(const F of D.primitives)p.push(t(F,M,A,D.name))}for(const D of I.children||[])p.push(_(D,A))})).apply(this,arguments)}yield Promise.all(p)}),oe.apply(this,arguments)}function he(i){return i.extensions&&i.extensions.MSFT_lod&&Array.isArray(i.extensions.MSFT_lod.ids)}function ye(i,t,r){const o=p=>{const _=`${r}_tex_${p&&p.id}${p&&p.name?"_"+p.name:""}`;if(p&&!i.textures.has(_)){const v=function x(i,t={}){return{data:i,parameters:{wrap:{s:l.e8.REPEAT,t:l.e8.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}}(p.data,{wrap:{s:p.wrapS,t:p.wrapT},mipmap:ge.includes(p.minFilter),noUnpackFlip:!0});i.textures.set(_,v)}return _},e=`${r}_mat_${t.id}_${t.name}`;if(!i.materials.has(e)){const p=function c(i={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...i}}({color:[t.color[0],t.color[1],t.color[2]],opacity:t.color[3],alphaMode:t.alphaMode,alphaCutoff:t.alphaCutoff,doubleSided:t.doubleSided,colorMixMode:t.ESRI_externalColorMixMode,textureColor:t.colorTexture?o(t.colorTexture):void 0,textureNormal:t.normalTexture?o(t.normalTexture):void 0,textureOcclusion:t.occlusionTexture?o(t.occlusionTexture):void 0,textureEmissive:t.emissiveTexture?o(t.emissiveTexture):void 0,textureMetallicRoughness:t.metallicRoughnessTexture?o(t.metallicRoughnessTexture):void 0,emissiveFactor:[t.emissiveFactor[0],t.emissiveFactor[1],t.emissiveFactor[2]],colorTextureTransform:t.colorTextureTransform,normalTextureTransform:t.normalTextureTransform,occlusionTextureTransform:t.occlusionTextureTransform,emissiveTextureTransform:t.emissiveTextureTransform,metallicRoughnessTextureTransform:t.metallicRoughnessTextureTransform,metallicFactor:t.metallicFactor,roughnessFactor:t.roughnessFactor});i.materials.set(e,p)}return e}const ge=[l.cw.LINEAR_MIPMAP_LINEAR,l.cw.LINEAR_MIPMAP_NEAREST]},79331:(j,B,h)=>{h.d(B,{K:()=>y});const y=2.1}}]);
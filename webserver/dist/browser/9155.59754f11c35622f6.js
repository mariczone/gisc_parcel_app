"use strict";(self.webpackChunkparcel_app=self.webpackChunkparcel_app||[]).push([[9155],{36592:(ie,z,m)=>{m.d(z,{Q:()=>j});var C=m(85931),K=m(62208),G=m(77029),Z=m(14259);class j{constructor(e=9,n){this._compareMinX=W,this._compareMinY=r,this._toBBox=i=>i,this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),n&&("function"==typeof n?this._toBBox=n:this._initFormat(n)),this.clear()}destroy(){this.clear(),T.prune(),L.prune(),P.prune(),$.prune()}all(e){this._all(this._data,e)}search(e,n){let i=this._data;const o=this._toBBox;if(E(e,i))for(T.clear();i;){for(let d=0,g=i.children.length;d<g;d++){const B=i.children[d],M=i.leaf?o(B):B;E(e,M)&&(i.leaf?n(B):f(e,M)?this._all(B,n):T.push(B))}i=T.pop()}}collides(e){let n=this._data;const i=this._toBBox;if(!E(e,n))return!1;for(T.clear();n;){for(let o=0,d=n.children.length;o<d;o++){const g=n.children[o],B=n.leaf?i(g):g;if(E(e,B)){if(n.leaf||f(e,B))return!0;T.push(g)}}n=T.pop()}return!1}load(e){if(!e.length)return this;if(e.length<this._minEntries){for(let i=0,o=e.length;i<o;i++)this.insert(e[i]);return this}let n=this._build(e.slice(0,e.length),0,e.length-1,0);if(this._data.children.length)if(this._data.height===n.height)this._splitRoot(this._data,n);else{if(this._data.height<n.height){const i=this._data;this._data=n,n=i}this._insert(n,this._data.height-n.height-1,!0)}else this._data=n;return this}insert(e){return e&&this._insert(e,this._data.height-1),this}clear(){return this._data=new A([]),this}remove(e){if(!e)return this;let n,i=this._data,o=null,d=0,g=!1;const B=this._toBBox(e);for(P.clear(),$.clear();i||P.length>0;){if(i||(i=(0,K.j0)(P.pop()),o=P.data[P.length-1],d=$.pop()??0,g=!0),i.leaf&&(n=(0,C.cq)(i.children,e,i.children.length,i.indexHint),-1!==n))return i.children.splice(n,1),P.push(i),this._condense(P),this;g||i.leaf||!f(i,B)?o?(d++,i=o.children[d],g=!1):i=null:(P.push(i),$.push(d),d=0,o=i,i=i.children[0])}return this}toJSON(){return this._data}fromJSON(e){return this._data=e,this}_all(e,n){let i=e;for(L.clear();i;){if(!0===i.leaf)for(const o of i.children)n(o);else L.pushArray(i.children);i=L.pop()??null}}_build(e,n,i,o){const d=i-n+1;let g=this._maxEntries;if(d<=g){const S=new A(e.slice(n,i+1));return N(S,this._toBBox),S}o||(o=Math.ceil(Math.log(d)/Math.log(g)),g=Math.ceil(d/g**(o-1)));const B=new w([]);B.height=o;const M=Math.ceil(d/g),X=M*Math.ceil(Math.sqrt(g));v(e,n,i,X,this._compareMinX);for(let S=n;S<=i;S+=X){const Q=Math.min(S+X-1,i);v(e,S,Q,M,this._compareMinY);for(let ne=S;ne<=Q;ne+=M){const ae=Math.min(ne+M-1,Q);B.children.push(this._build(e,ne,ae,o-1))}}return N(B,this._toBBox),B}_chooseSubtree(e,n,i,o){for(;o.push(n),!0!==n.leaf&&o.length-1!==i;){let d,g=1/0,B=1/0;for(let M=0,X=n.children.length;M<X;M++){const S=n.children[M],Q=l(S),ne=b(e,S)-Q;ne<B?(B=ne,g=Q<g?Q:g,d=S):ne===B&&Q<g&&(g=Q,d=S)}n=d||n.children[0]}return n}_insert(e,n,i){const d=i?e:(0,this._toBBox)(e);P.clear();const g=this._chooseSubtree(d,this._data,n,P);for(g.children.push(e),V(g,d);n>=0&&P.data[n].children.length>this._maxEntries;)this._split(P,n),n--;this._adjustParentBBoxes(d,P,n)}_split(e,n){const i=e.data[n],o=i.children.length,d=this._minEntries;this._chooseSplitAxis(i,d,o);const g=this._chooseSplitIndex(i,d,o);if(!g)return void console.log("  Error: assertion failed at PooledRBush._split: no valid split index");const B=i.children.splice(g,i.children.length-g),M=i.leaf?new A(B):new w(B);M.height=i.height,N(i,this._toBBox),N(M,this._toBBox),n?e.data[n-1].children.push(M):this._splitRoot(i,M)}_splitRoot(e,n){this._data=new w([e,n]),this._data.height=e.height+1,N(this._data,this._toBBox)}_chooseSplitIndex(e,n,i){let o,d,g;o=d=1/0;for(let B=n;B<=i-n;B++){const M=R(e,0,B,this._toBBox),X=R(e,B,i,this._toBBox),S=u(M,X),Q=l(M)+l(X);S<o?(o=S,g=B,d=Q<d?Q:d):S===o&&Q<d&&(d=Q,g=B)}return g}_chooseSplitAxis(e,n,i){const o=e.leaf?this._compareMinX:W,d=e.leaf?this._compareMinY:r;this._allDistMargin(e,n,i,o)<this._allDistMargin(e,n,i,d)&&e.children.sort(o)}_allDistMargin(e,n,i,o){e.children.sort(o);const d=this._toBBox,g=R(e,0,n,d),B=R(e,i-n,i,d);let M=y(g)+y(B);for(let X=n;X<i-n;X++){const S=e.children[X];V(g,e.leaf?d(S):S),M+=y(g)}for(let X=i-n-1;X>=n;X--){const S=e.children[X];V(B,e.leaf?d(S):S),M+=y(B)}return M}_adjustParentBBoxes(e,n,i){for(let o=i;o>=0;o--)V(n.data[o],e)}_condense(e){for(let n=e.length-1;n>=0;n--){const i=e.data[n];if(0===i.children.length)if(n>0){const o=e.data[n-1],d=o.children;d.splice((0,C.cq)(d,i,d.length,o.indexHint),1)}else this.clear();else N(i,this._toBBox)}}_initFormat(e){const n=["return a"," - b",";"];this._compareMinX=new Function("a","b",n.join(e[0])),this._compareMinY=new Function("a","b",n.join(e[1])),this._toBBox=new Function("a","return {minX: a"+e[0]+", minY: a"+e[1]+", maxX: a"+e[2]+", maxY: a"+e[3]+"};")}}function N(h,e){R(h,0,h.children.length,e,h)}function R(h,e,n,i,o){o||(o=new A([])),o.minX=1/0,o.minY=1/0,o.maxX=-1/0,o.maxY=-1/0;for(let d,g=e;g<n;g++)d=h.children[g],V(o,h.leaf?i(d):d);return o}function V(h,e){h.minX=Math.min(h.minX,e.minX),h.minY=Math.min(h.minY,e.minY),h.maxX=Math.max(h.maxX,e.maxX),h.maxY=Math.max(h.maxY,e.maxY)}function W(h,e){return h.minX-e.minX}function r(h,e){return h.minY-e.minY}function l(h){return(h.maxX-h.minX)*(h.maxY-h.minY)}function y(h){return h.maxX-h.minX+(h.maxY-h.minY)}function b(h,e){return(Math.max(e.maxX,h.maxX)-Math.min(e.minX,h.minX))*(Math.max(e.maxY,h.maxY)-Math.min(e.minY,h.minY))}function u(h,e){const n=Math.max(h.minX,e.minX),i=Math.max(h.minY,e.minY),o=Math.min(h.maxX,e.maxX),d=Math.min(h.maxY,e.maxY);return Math.max(0,o-n)*Math.max(0,d-i)}function f(h,e){return h.minX<=e.minX&&h.minY<=e.minY&&e.maxX<=h.maxX&&e.maxY<=h.maxY}function E(h,e){return e.minX<=h.maxX&&e.minY<=h.maxY&&e.maxX>=h.minX&&e.maxY>=h.minY}function v(h,e,n,i,o){const d=[e,n];for(;d.length;){const g=(0,K.j0)(d.pop()),B=(0,K.j0)(d.pop());if(g-B<=i)continue;const M=B+Math.ceil((g-B)/i/2)*i;(0,Z.q)(h,M,B,g,o),d.push(B,M,M,g)}}const T=new G.Z,L=new G.Z,P=new G.Z,$=new G.Z({deallocator:void 0});class k{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}}class D extends k{constructor(){super(...arguments),this.height=1,this.indexHint=new C.SO}}class A extends D{constructor(e){super(),this.children=e,this.leaf=!0}}class w extends D{constructor(e){super(),this.children=e,this.leaf=!1}}},77044:(ie,z,m)=>{m.d(z,{Y:()=>G});var C=m(62208);function K(r,l){return r?l?4:3:l?3:2}function G(r,l,y,b,u){if((0,C.Wi)(l)||!l.lengths.length)return null;const f="upperLeft"===u?.originPosition?-1:1;r.lengths.length&&(r.lengths.length=0),r.coords.length&&(r.coords.length=0);const E=r.coords,v=[],T=y?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:L,coords:P}=l,$=K(y,b);let k=0;for(const D of L){const A=Z(T,P,k,D,y,b,f);A&&v.push(A),k+=D*$}if(v.sort((D,A)=>{let w=f*D[2]-f*A[2];return 0===w&&y&&(w=D[4]-A[4]),w}),v.length){let D=6*v[0][2];E[0]=v[0][0]/D,E[1]=v[0][1]/D,y&&(D=6*v[0][4],E[2]=0!==D?v[0][3]/D:0),(E[0]<T[0]||E[0]>T[1]||E[1]<T[2]||E[1]>T[3]||y&&(E[2]<T[4]||E[2]>T[5]))&&(E.length=0)}if(!E.length){const D=l.lengths[0]?function j(r,l,y,b,u){const f=K(b,u);let E=l,v=l+f,T=0,L=0,P=0,$=0;for(let k=0,D=y-1;k<D;k++,E+=f,v+=f){const A=r[E],w=r[E+1],h=r[E+2],e=r[v],n=r[v+1],i=r[v+2],o=b?R(A,w,h,e,n,i):N(A,w,e,n);if(o)if(T+=o,b){const d=W(A,w,h,e,n,i);L+=o*d[0],P+=o*d[1],$+=o*d[2]}else{const d=V(A,w,e,n);L+=o*d[0],P+=o*d[1]}}return T>0?b?[L/T,P/T,$/T]:[L/T,P/T]:y>0?b?[r[l],r[l+1],r[l+2]]:[r[l],r[l+1]]:null}(P,0,L[0],y,b):null;if(!D)return null;E[0]=D[0],E[1]=D[1],y&&D.length>2&&(E[2]=D[2])}return r}function Z(r,l,y,b,u,f,E=1){const v=K(u,f);let T=y,L=y+v,P=0,$=0,k=0,D=0,A=0;for(let h=0,e=b-1;h<e;h++,T+=v,L+=v){const n=l[T],i=l[T+1],o=l[T+2],d=l[L],g=l[L+1],B=l[L+2];let M=n*g-d*i;D+=M,P+=(n+d)*M,$+=(i+g)*M,u&&(M=n*B-d*o,k+=(o+B)*M,A+=M),n<r[0]&&(r[0]=n),n>r[1]&&(r[1]=n),i<r[2]&&(r[2]=i),i>r[3]&&(r[3]=i),u&&(o<r[4]&&(r[4]=o),o>r[5]&&(r[5]=o))}if(D*E>0&&(D*=-1),A*E>0&&(A*=-1),!D)return null;const w=[P,$,.5*D];return u&&(w[3]=k,w[4]=.5*A),w}function N(r,l,y,b){const u=y-r,f=b-l;return Math.sqrt(u*u+f*f)}function R(r,l,y,b,u,f){const E=b-r,v=u-l,T=f-y;return Math.sqrt(E*E+v*v+T*T)}function V(r,l,y,b){return[r+.5*(y-r),l+.5*(b-l)]}function W(r,l,y,b,u,f){return[r+.5*(b-r),l+.5*(u-l),y+.5*(f-y)]}},61256:(ie,z,m)=>{m.d(z,{H:()=>V});var C=m(8314),K=m(36592),G=m(65401);const j={minX:0,minY:0,maxX:0,maxY:0};class V{constructor(){this._indexInvalid=!1,this._boundsToLoad=[],this._boundsById=new Map,this._idByBounds=new Map,this._index=new K.Q(9,(0,C.Z)("esri-csp-restrictions")?r=>({minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}):["[0]","[1]","[2]","[3]"]),this._loadIndex=()=>{if(this._indexInvalid){const r=new Array(this._idByBounds.size);let l=0;this._idByBounds.forEach((y,b)=>{r[l++]=b}),this._indexInvalid=!1,this._index.clear(),this._index.load(r)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(r=>this._idByBounds.has(r))))),this._boundsToLoad.length=0)}}get fullBounds(){if(!this._boundsById.size)return null;const r=(0,G.cS)();for(const l of this._boundsById.values())l&&(r[0]=Math.min(l[0],r[0]),r[1]=Math.min(l[1],r[1]),r[2]=Math.max(l[2],r[2]),r[3]=Math.max(l[3],r[3]));return r}get valid(){return!this._indexInvalid}clear(){this._indexInvalid=!1,this._boundsToLoad.length=0,this._boundsById.clear(),this._idByBounds.clear(),this._index.clear()}delete(r){const l=this._boundsById.get(r);this._boundsById.delete(r),l&&(this._idByBounds.delete(l),this._indexInvalid||this._index.remove(l))}forEachInBounds(r,l){this._loadIndex(),function R(W,r,l){(function N(W){j.minX=W[0],j.minY=W[1],j.maxX=W[2],j.maxY=W[3]})(r),W.search(j,l)}(this._index,r,y=>l(this._idByBounds.get(y)))}get(r){return this._boundsById.get(r)}has(r){return this._boundsById.has(r)}invalidateIndex(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)}set(r,l){if(!this._indexInvalid){const y=this._boundsById.get(r);y&&(this._index.remove(y),this._idByBounds.delete(y))}this._boundsById.set(r,l),l&&(this._idByBounds.set(l,r),this._indexInvalid||(this._boundsToLoad.push(l),this._boundsToLoad.length>5e4&&this._loadIndex()))}}},3579:(ie,z,m)=>{m.d(z,{Z:()=>y});var C=m(26584),K=m(61885),G=m(63290),Z=m(62208),j=m(5548),N=m(65401),R=m(82054),V=m(61256),W=m(92794),r=m(6185);const l=(0,j.Ue)();class y{constructor(u){this.geometryInfo=u,this._boundsStore=new V.H,this._featuresById=new Map,this._markedIds=new Set,this.events=new K.Z,this.featureAdapter=W.n}get geometryType(){return this.geometryInfo.geometryType}get hasM(){return this.geometryInfo.hasM}get hasZ(){return this.geometryInfo.hasZ}get numFeatures(){return this._featuresById.size}get fullBounds(){return this._boundsStore.fullBounds}get storeStatistics(){let u=0;return this._featuresById.forEach(f=>{(0,Z.pC)(f.geometry)&&f.geometry.coords&&(u+=f.geometry.coords.length)}),{featureCount:this._featuresById.size,vertexCount:u/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}getFullExtent(u){if((0,Z.Wi)(this.fullBounds))return null;const[f,E,v,T]=this.fullBounds;return{xmin:f,ymin:E,xmax:v,ymax:T,spatialReference:(0,r.S2)(u)}}add(u){this._add(u),this._emitChanged()}addMany(u){for(const f of u)this._add(f);this._emitChanged()}clear(){this._featuresById.clear(),this._boundsStore.clear(),this._emitChanged()}removeById(u){const f=this._featuresById.get(u);return f?(this._remove(f),this._emitChanged(),f):null}removeManyById(u){this._boundsStore.invalidateIndex();for(const f of u){const E=this._featuresById.get(f);E&&this._remove(E)}this._emitChanged()}forEachBounds(u,f){for(const E of u){const v=this._boundsStore.get(E.objectId);v&&f((0,j.JR)(l,v))}}getFeature(u){return this._featuresById.get(u)}has(u){return this._featuresById.has(u)}forEach(u){this._featuresById.forEach(f=>u(f))}forEachInBounds(u,f){this._boundsStore.forEachInBounds(u,E=>{f(this._featuresById.get(E))})}startMarkingUsedFeatures(){this._boundsStore.invalidateIndex(),this._markedIds.clear()}sweep(){let u=!1;this._featuresById.forEach((f,E)=>{this._markedIds.has(E)||(u=!0,this._remove(f))}),this._markedIds.clear(),u&&this._emitChanged()}_emitChanged(){this.events.emit("changed",void 0)}_add(u){if(!u)return;const f=u.objectId;if(null==f)return void G.Z.getLogger("esri.layers.graphics.data.FeatureStore").error(new C.Z("featurestore:invalid-feature","feature id is missing",{feature:u}));const E=this._featuresById.get(f);let v;if(this._markedIds.add(f),E?(u.displayId=E.displayId,v=this._boundsStore.get(f),this._boundsStore.delete(f)):(0,Z.pC)(this.onFeatureAdd)&&this.onFeatureAdd(u),(0,Z.Wi)(u.geometry)||!u.geometry.coords||!u.geometry.coords.length)return this._boundsStore.set(f,null),void this._featuresById.set(f,u);v=(0,R.$)((0,Z.pC)(v)?v:(0,N.Ue)(),u.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),(0,Z.pC)(v)&&this._boundsStore.set(f,v),this._featuresById.set(f,u)}_remove(u){(0,Z.pC)(this.onFeatureRemove)&&this.onFeatureRemove(u);const f=u.objectId;return this._markedIds.delete(f),this._boundsStore.delete(f),this._featuresById.delete(f),u}}},92794:(ie,z,m)=>{m.d(z,{n:()=>j});var C=m(62208),K=m(77044),G=m(66385),Z=m(88071);const j={getObjectId:N=>N.objectId,getAttributes:N=>N.attributes,getAttribute:(N,R)=>N.attributes[R],cloneWithGeometry:(N,R)=>new G.u_(R,N.attributes,null,N.objectId),getGeometry:N=>N.geometry,getCentroid:(N,R)=>((0,C.Wi)(N.centroid)&&(N.centroid=(0,K.Y)(new Z.Z,N.geometry,R.hasZ,R.hasM)),N.centroid)}},39155:(ie,z,m)=>{m.r(z),m.d(z,{default:()=>pe});var C=m(15861),G=(m(29132),m(84792)),Z=m(59213),j=m(26584),N=m(63290),R=m(10699),V=m(21726),W=m(55915),r=m(15994),l=m(37053),y=m(46367),b=m(66385),u=m(88071),f=m(3579),E=m(82959),v=m(58175),T=m(75327),L=m(36630);const P=/^\s*"([\S\s]*)"\s*$/,$=/""/g,D=[","," ",";","|","\t"];function*A(p,a,t){let s=0;for(;s<=p.length;){const c=p.indexOf(a,s),_=p.substring(s,c>-1?c:void 0);s+=_.length+a.length,t&&!_.trim()||(yield _)}}function w(p){const a=p.includes("\r\n")?"\r\n":"\n";return A(p,a,!0)}function h(p,a){return A(p,a,!1)}function*n(p,a,t,s=(()=>Object.create(null))){const c=w(p);c.next();let _="",I="",F=0,O=s(),U=0;e:for(const se of c){const q=h(se,t);for(const H of q)if(_+=I+H,I="",F+=d(H),F%2==0){if(F>0){const ee=P.exec(_);if(!ee){O=s(),U=0,_="",F=0;continue e}O[a[U]]=ee[1].replace($,'"'),U++}else O[a[U]]=_,U++;_="",F=0}else I=t;0===F?(yield O,O=s(),U=0):I="\n"}}function i(p,a){const t=o(p,a).filter(c=>null!=c),s=t.map(c=>(0,L.q6)(c));for(let c=s.length-1;c>=0;c--)s[c]||(s.splice(c,1),t.splice(c,1));return{names:s,aliases:t}}function o(p,a){if(!p?.length)return[];const t=[];let s="",c="",_=0;const I=h(p,a);for(const F of I)if(s+=c+F,c="",_+=d(F),_%2==0){if(_>0){const O=P.exec(s);O&&t.push(O[1].replace($,'"'))}else t.push(s);s="",_=0}else c=a;return t}function d(p){let a=0,t=0;for(t=p.indexOf('"',t);t>=0;)a++,t=p.indexOf('"',t+1);return a}function g(p,a,t){a=(0,L.q6)(a)?.toLowerCase(),t=(0,L.q6)(t)?.toLowerCase();const s=p.map(I=>I.toLowerCase()),c=a?p[s.indexOf(a)]:null,_=t?p[s.indexOf(t)]:null;return{longitudeFieldName:c||p[s.indexOf(ue.find(I=>s.includes(I)))],latitudeFieldName:_||p[s.indexOf(ae.find(I=>s.includes(I)))]}}function M(p){if(!p.length)return"string";const a=/[^+-.,0-9]/;return p.map(t=>{let s=!1;if(""!==t){if(a.test(t))s=!0;else{let c=S(t);if(!isNaN(c))return/[.,]/.test(t)||!Number.isInteger(c)||c>214783647||c<-214783648?"double":"integer";if(t.includes("E")){if(c=Number(t),!isNaN(c))return"double";if(t.includes(",")){if(t=t.replace(",","."),c=Number(t),!isNaN(c))return"double";s=!0}else s=!0}else s=!0}return s?/^[-]?\d*[.,]?\d*$/.test(t)?"string":X(new Date(t),t)?"date":"string":"string"}}).reduce((t,s)=>void 0===t?s:void 0===s?t:t===s?s:"string"===t||"string"===s?"string":"double"===t||"double"===s?"double":void 0)}function X(p,a){if(!p||"[object Date]"!==Object.prototype.toString.call(p)||isNaN(p.getTime()))return!1;let t=!0;if(!ne&&/\d+\W*$/.test(a)){const s=a.match(/[a-zA-Z]{2,}/);if(s){let c=!1,_=0;for(;!c&&_<=s.length;)c=!Q.test(s[_]),_++;t=!c}}return t}const S=function(){const p=(0,T.lt)(),a=new RegExp("^"+p.regexp+"$"),t=new RegExp("["+p.group+"\\s\\xa0]","g"),s=p.factor;return c=>{const _=a.exec(c);if(p.factor=s,!_)return NaN;let I=_[1];if(!_[1]){if(!_[2])return NaN;I=_[2],p.factor*=-1}return I=I.replace(t,"").replace(p.decimal,"."),+I*p.factor}}(),Q=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,ne=Number.isNaN(new Date("technology 10").getTime()),ae=["lat","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],ue=["lon","lng","long","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"];var le=m(56554),de=m(60466),he=m(65234);const ce=(0,le.bU)("esriGeometryPoint"),fe=["csv"],me=[0,0];class _e{constructor(a,t){this.x=a,this.y=t}}class pe{constructor(){var a=this;this._queryEngine=null,this._snapshotFeatures=function(){var t=(0,C.Z)(function*(s){const c=yield a._fetch(s);return a._createFeatures(c)});return function(s){return t.apply(this,arguments)}}()}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}load(a,t={}){var s=this;return(0,C.Z)(function*(){s._loadOptions=a;const[c]=yield Promise.all([s._fetch(t.signal),s._checkProjection(a?.parsingOptions?.spatialReference)]),_=function ge(p,a){const t=a.parsingOptions||{},s={delimiter:t.delimiter,layerDefinition:null,locationInfo:{latitudeFieldName:t.latitudeField,longitudeFieldName:t.longitudeField}},c=s.layerDefinition={name:(0,V.vt)(a.url,fe)||"csv",drawingInfo:ce,geometryType:"esriGeometryPoint",objectIdField:null,fields:[],timeInfo:t.timeInfo,extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:t.spatialReference||{wkid:4326}}},_=w(p),I=_.next().value?.trim(),F=_.next().value?.trim();if(!I)throw new j.Z("csv-layer:empty-csv","CSV is empty",{csv:p});const{delimiter:O,locationInfo:U}=function e(p,a,t){p=p.trim(),a=a?.trim();const s=[],c=Array.from(new Set([t?.delimiter,...D])).filter(I=>null!=I);for(const I of c){const F=o(p,I).length,O=o(a,I).length??F;F>1&&s.push({weight:Math.min(F,O),delimiter:I})}const _=s.sort(({weight:I},{weight:F})=>F-I).map(({delimiter:I})=>I);for(const I of _){const F=g(i(p,I).names,t?.longitudeField,t?.latitudeField);if(F.longitudeFieldName&&F.latitudeFieldName)return{delimiter:I,locationInfo:F}}return{delimiter:_[0],locationInfo:null}}(I,F,t);if(!O)throw new j.Z("csv-layer:invalid-delimiter","Unable to detect the delimiter from CSV",{firstLine:I,secondLine:F,parsingOptions:t});if(!U)throw new j.Z("csv-layer:location-fields-not-found","Unable to identify latitude and longitude fields from the CSV file",{firstLine:I,secondLine:F,parsingOptions:t});s.locationInfo=U,s.delimiter=O;const{names:se,aliases:q}=i(I,O),H=function B(p,a,t,s,c){const _=[],I=n(p,t,a),F=[];for(const O of I){if(10===F.length)break;F.push(O)}for(let O=0;O<t.length;O++){const U=t[O],se=s[O];if(U===c.longitudeFieldName||U===c.latitudeFieldName)_.push({name:U,type:"esriFieldTypeDouble",alias:se});else{let q,H;switch(M(F.map(ee=>ee[U]))){case"integer":q="esriFieldTypeInteger";break;case"double":q="esriFieldTypeDouble";break;case"date":q="esriFieldTypeDate",H=36;break;default:q="esriFieldTypeString",H=255}_.push({name:U,type:q,alias:se,length:H})}}return _}(p,s.delimiter,se,q,s.locationInfo);if(t.fields?.length){const Y=new de.Z(t.fields);for(const x of H){const te=Y.get(x.name);te&&Object.assign(x,te)}}if(!H.some(Y=>"esriFieldTypeOID"===Y.type&&(c.objectIdField=Y.name,!0))){const Y={name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1};c.objectIdField=Y.name,H.unshift(Y)}c.fields=H;const ee=new de.Z(c.fields);if(s.locationInfo&&(s.locationInfo.latitudeFieldName=ee.get(s.locationInfo.latitudeFieldName).name,s.locationInfo.longitudeFieldName=ee.get(s.locationInfo.longitudeFieldName).name),c.timeInfo){const Y=c.timeInfo;if(Y.startTimeField){const x=ee.get(Y.startTimeField);x?(Y.startTimeField=x.name,x.type="esriFieldTypeDate"):Y.startTimeField=null}if(Y.endTimeField){const x=ee.get(Y.endTimeField);x?(Y.endTimeField=x.name,x.type="esriFieldTypeDate"):Y.endTimeField=null}if(Y.trackIdField){const x=ee.get(Y.trackIdField);Y.trackIdField=x?x.name:null}Y.startTimeField||Y.endTimeField||(c.timeInfo=null)}return s}(c,a);s._locationInfo=_.locationInfo,s._delimiter=_.delimiter,s._queryEngine=s._createQueryEngine(_);const I=yield s._createFeatures(c);s._queryEngine.featureStore.addMany(I);const{fullExtent:F,timeExtent:O}=yield s._queryEngine.fetchRecomputedExtents();if(_.layerDefinition.extent=F,O){const{start:U,end:se}=O;_.layerDefinition.timeInfo.timeExtent=[U,se]}return _})()}applyEdits(){return(0,C.Z)(function*(){throw new j.Z("csv-layer:editing-not-supported","applyEdits() is not supported on CSVLayer")})()}queryFeatures(a={},t={}){var s=this;return(0,C.Z)(function*(){return yield s._waitSnapshotComplete(),s._queryEngine.executeQuery(a,t.signal)})()}queryFeatureCount(a={},t={}){var s=this;return(0,C.Z)(function*(){return yield s._waitSnapshotComplete(),s._queryEngine.executeQueryForCount(a,t.signal)})()}queryObjectIds(a={},t={}){var s=this;return(0,C.Z)(function*(){return yield s._waitSnapshotComplete(),s._queryEngine.executeQueryForIds(a,t.signal)})()}queryExtent(a={},t={}){var s=this;return(0,C.Z)(function*(){return yield s._waitSnapshotComplete(),s._queryEngine.executeQueryForExtent(a,t.signal)})()}querySnapping(a,t={}){var s=this;return(0,C.Z)(function*(){return yield s._waitSnapshotComplete(),s._queryEngine.executeQueryForSnapping(a,t.signal)})()}refresh(a){var t=this;return(0,C.Z)(function*(){t._loadOptions.customParameters=a,t._snapshotTask?.abort(),t._snapshotTask=(0,Z.vr)(t._snapshotFeatures),t._snapshotTask.promise.then(_=>{t._queryEngine.featureStore.clear(),_&&t._queryEngine.featureStore.addMany(_)},_=>{t._queryEngine.featureStore.clear(),(0,R.D_)(_)||N.Z.getLogger("esri.layers.CSVLayer").error(new j.Z("csv-layer:refresh","An error occurred during refresh",{error:_}))}),yield t._waitSnapshotComplete();const{fullExtent:s,timeExtent:c}=yield t._queryEngine.fetchRecomputedExtents();return{extent:s,timeExtent:c}})()}_waitSnapshotComplete(){var a=this;return(0,C.Z)(function*(){if(a._snapshotTask&&!a._snapshotTask.finished){try{yield a._snapshotTask.promise}catch{}return a._waitSnapshotComplete()}})()}_fetch(a){var t=this;return(0,C.Z)(function*(){const{url:s,customParameters:c}=t._loadOptions;if(!s)throw new j.Z("csv-layer:invalid-source","url not defined");const _=(0,V.mN)(s);return(yield(0,G.default)(_.path,{query:{..._.query,...c},responseType:"text",signal:a})).data})()}_createQueryEngine(a){const{objectIdField:t,fields:s,extent:c,timeInfo:_}=a.layerDefinition,I=new f.Z({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1});return new v.q({fields:s,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,timeInfo:_,objectIdField:t,spatialReference:c.spatialReference||{wkid:4326},cacheSpatialQueries:!0,featureStore:I})}_createFeatures(a){var t=this;return(0,C.Z)(function*(){const{latitudeFieldName:s,longitudeFieldName:c}=t._locationInfo,{objectIdField:_,fieldsIndex:I,spatialReference:F}=t._queryEngine;let O=[];const U=[],se=I.fields.filter(x=>x.name!==_).map(x=>x.name);let q=0;const H={};for(const x of I.fields)if("esriFieldTypeOID"!==x.type&&"esriFieldTypeGlobalID"!==x.type){const te=(0,L.os)(x);void 0!==te&&(H[x.name]=te)}const ee=n(a,se,t._delimiter,(0,le.Dm)(H,_));for(const x of ee){const te=t._parseCoordinateValue(x[s]),re=t._parseCoordinateValue(x[c]);if(null!=re&&null!=te&&!isNaN(te)&&!isNaN(re)){x[s]=te,x[c]=re;for(const J in x)if(J!==s&&J!==c)if(I.isDateField(J)){const oe=new Date(x[J]);x[J]=X(oe,x[J])?oe.getTime():null}else if(I.isNumericField(J)){const oe=S(x[J]);x[J]=isNaN(oe)?null:oe}x[_]=q,q++,O.push(new _e(re,te)),U.push(x)}}if(!(0,l.fS)({wkid:4326},F))if((0,l.sS)(F))for(const x of O)[x.x,x.y]=(0,y.hG)(x.x,x.y,me);else O=(0,W.oj)(r.N,O,he.Z.WGS84,F,null,null);const Y=[];for(let x=0;x<O.length;x++){const{x:te,y:re}=O[x],J=U[x];J[_]=x+1,Y.push(new b.u_(new u.Z([],[te,re]),J,null,J[_]))}return Y})()}_parseCoordinateValue(a){if(null==a||""===a)return null;let t=S(a);return(isNaN(t)||Math.abs(t)>181)&&(t=parseFloat(a)),t}_checkProjection(a){return(0,C.Z)(function*(){try{yield(0,E._W)(l.Zn,a)}catch{throw new j.Z("csv-layer:projection-not-supported","Projection not supported")}})()}}},56554:(ie,z,m)=>{m.d(z,{Dm:()=>V,Hq:()=>W,MS:()=>r,bU:()=>j});var C=m(8314),K=m(58817),G=m(87757),Z=m(24837);function j(l){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===l||"esriGeometryMultipoint"===l?Z.I4:"esriGeometryPolyline"===l?Z.ET:Z.lF}}}const N=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let R=1;function V(l,y){if((0,C.Z)("esri-csp-restrictions"))return()=>({[y]:null,...l});try{let b=`this.${y} = null;`;for(const f in l)b+=`this${N.test(f)?`.${f}`:`["${f}"]`} = ${JSON.stringify(l[f])};`;const u=new Function(`\n      return class AttributesClass$${R++} {\n        constructor() {\n          ${b};\n        }\n      }\n    `)();return()=>new u}catch{return()=>({[y]:null,...l})}}function W(l={}){return[{name:"New Feature",description:"",prototype:{attributes:(0,K.d9)(l)}}]}function r(l,y){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:l},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:y,supportsDelete:y,supportsEditing:y,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:y,supportsExceedsLimitStatistics:!0},query:G.g,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsGeometryUpdate:y,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}}}}]);
"use strict";(self.webpackChunkparcel_app=self.webpackChunkparcel_app||[]).push([[7519],{41743:(ve,ee,d)=>{d.d(ee,{a:()=>V,c:()=>U,g:()=>H,h:()=>re,u:()=>f}),d(8314);var h=d(63290),b=d(21286),x=d(97535),C=d(28347),m=d(43703),u=d(84161),I=d(28093),g=d(78172),ie=d(10992),M=d(90014),G=d(70562),te=d(34054),w=d(26242);const Y=h.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function V(t=fe){return{plane:(0,M.Ue)(t.plane),origin:(0,I.a)(t.origin),basis1:(0,I.a)(t.basis1),basis2:(0,I.a)(t.basis2)}}function U(t,r=V()){return p(t.origin,t.basis1,t.basis2,r)}function p(t,r,s,l=V()){return(0,u.c)(l.origin,t),(0,u.c)(l.basis1,r),(0,u.c)(l.basis2,s),f(l),function me(t,r){Math.abs((0,u.e)(t.basis1,t.basis2)/((0,u.l)(t.basis1)*(0,u.l)(t.basis2)))>1e-6&&Y.warn(r,"Provided basis vectors are not perpendicular"),Math.abs((0,u.e)(t.basis1,N(t)))>1e-6&&Y.warn(r,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,u.e)(N(t),t.origin)-t.plane[3])>1e-6&&Y.warn(r,"Plane offset is not consistent with plane origin")}(l,"fromValues()"),l}function f(t){(0,M.my)(t.basis2,t.basis1,t.origin,t.plane)}function v(t,r,s){t!==s&&U(t,s);const l=(0,u.g)(w.WM.get(),N(t),r);return(0,u.a)(s.origin,s.origin,l),s.plane[3]-=r,s}function H(t,r=V()){const s=(t[2]-t[0])/2,l=(t[3]-t[1])/2;return(0,u.s)(r.origin,t[0]+s,t[1]+l,0),(0,u.s)(r.basis1,s,0,0),(0,u.s)(r.basis2,0,l,0),(0,M.al)(0,0,1,0,r.plane),r}function S(t,r,s){return!!(0,M.BR)(t.plane,r,s)&&he(t,s)}function A(t,r,s){const l=ae.get();pe(t,r,l,ae.get());let y=Number.POSITIVE_INFINITY;for(const _ of n){const R=D(t,_,k.get()),F=w.WM.get();if((0,M.rx)(l,R,F)){const W=(0,u.r)(w.WM.get(),r.origin,F),Z=Math.abs((0,b.ZF)((0,u.e)(r.direction,W)));Z<y&&(y=Z,(0,u.c)(s,F))}}return y===Number.POSITIVE_INFINITY?J(t,r,s):s}function J(t,r,s){if(S(t,r,s))return s;const l=ae.get(),y=ae.get();pe(t,r,l,y);let _=Number.POSITIVE_INFINITY;for(const R of n){const F=D(t,R,k.get()),W=w.WM.get();if((0,M.dZ)(l,F,W)){const Z=(0,G.Jk)(r,W);if(!(0,M.Ac)(y,W))continue;Z<_&&(_=Z,(0,u.c)(s,W))}}return O(t,r.origin)<_&&j(t,r.origin,s),s}function j(t,r,s){const l=(0,M.nF)(t.plane,r,w.WM.get()),y=(0,ie.ct)(ge(t,t.basis1),l,-1,1,w.WM.get()),_=(0,ie.ct)(ge(t,t.basis2),l,-1,1,w.WM.get());return(0,u.b)(s,(0,u.a)(w.WM.get(),y,_),t.origin),s}function E(t,r,s){const{origin:l,basis1:y,basis2:_}=t,R=(0,u.b)(w.WM.get(),r,l),F=(0,te.SR)(y,R),W=(0,te.SR)(_,R),Z=(0,te.SR)(N(t),R);return(0,u.s)(s,F,W,Z)}function O(t,r){const s=E(t,r,w.WM.get()),{basis1:l,basis2:y}=t,_=(0,u.l)(l),R=(0,u.l)(y),F=Math.max(Math.abs(s[0])-_,0),W=Math.max(Math.abs(s[1])-R,0),Z=s[2];return F*F+W*W+Z*Z}function re(t,r){return Math.sqrt(O(t,r))}function ne(t,r){const s=-t.plane[3];return(0,te.SR)(N(t),r)-s}function N(t){return(0,M.mJ)(t.plane)}function he(t,r){const s=(0,u.b)(w.WM.get(),r,t.origin),l=(0,u.p)(t.basis1),y=(0,u.p)(t.basis2),_=(0,u.e)(t.basis1,s),R=(0,u.e)(t.basis2,s);return-_-l<0&&_-l<0&&-R-y<0&&R-y<0}function ge(t,r){const s=k.get();return(0,u.c)(s.origin,t.origin),(0,u.c)(s.vector,r),s}function D(t,r,s){const{basis1:l,basis2:y,origin:_}=t,R=(0,u.g)(w.WM.get(),l,r.origin[0]),F=(0,u.g)(w.WM.get(),y,r.origin[1]);(0,u.a)(s.origin,R,F),(0,u.a)(s.origin,s.origin,_);const W=(0,u.g)(w.WM.get(),l,r.direction[0]),Z=(0,u.g)(w.WM.get(),y,r.direction[1]);return(0,u.g)(s.vector,(0,u.a)(W,W,Z),2),s}function pe(t,r,s,l){const y=N(t);(0,M.my)(y,r.direction,r.origin,s),(0,M.my)((0,M.mJ)(s),y,r.origin,l)}const fe={plane:(0,M.Ue)(),origin:(0,I.f)(0,0,0),basis1:(0,I.f)(1,0,0),basis2:(0,I.f)(0,1,0)},ae=new x.x(M.Ue),k=new x.x(ie.Ue),_e=(0,I.c)(),B=new x.x(()=>V()),n=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],o=(0,m.c)(),a=(0,m.c)();Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:class le{constructor(){this.plane=(0,M.Ue)(),this.origin=(0,I.c)(),this.basis1=(0,I.c)(),this.basis2=(0,I.c)()}},UP:fe,altitudeAt:ne,axisAt:function se(t,r,s,l){return function be(t,r,s){switch(r){case g.R.X:(0,u.c)(s,t.basis1),(0,u.n)(s,s);break;case g.R.Y:(0,u.c)(s,t.basis2),(0,u.n)(s,s);break;case g.R.Z:(0,u.c)(s,N(t))}return s}(t,s,l)},closestPoint:J,closestPointOnSilhouette:A,copy:U,copyWithoutVerify:function ce(t,r){(0,u.c)(r.origin,t.origin),(0,u.c)(r.basis1,t.basis1),(0,u.c)(r.basis2,t.basis2),(0,M.JG)(r.plane,t.plane)},create:V,distance:re,distance2:O,distanceToSilhouette:function Q(t,r){let s=Number.NEGATIVE_INFINITY;for(const l of n){const y=D(t,l,k.get()),_=(0,ie.Jk)(y,r);_>s&&(s=_)}return Math.sqrt(s)},elevate:v,equals:function X(t,r){return(0,u.k)(t.basis1,r.basis1)&&(0,u.k)(t.basis2,r.basis2)&&(0,u.k)(t.origin,r.origin)},extrusionContainsPoint:function oe(t,r){return(0,M.Ac)(t.plane,r)&&he(t,r)},fromAABoundingRect:H,fromValues:p,intersectRay:S,intersectRayClosestSilhouette:function z(t,r,s){if(S(t,r,s))return s;const l=A(t,r,w.WM.get());return(0,u.a)(s,r.origin,(0,u.g)(w.WM.get(),r.direction,(0,u.i)(r.origin,l)/(0,u.l)(r.direction))),s},normal:N,projectPoint:j,projectPointLocal:E,rotate:function L(t,r,s,l){return t!==l&&U(t,l),(0,C.d)(a,r,s),(0,u.m)(l.basis1,t.basis1,a),(0,u.m)(l.basis2,t.basis2,a),f(l),l},setAltitudeAt:function $(t,r,s,l){const y=ne(t,r),_=(0,u.g)(_e,N(t),s-y);return(0,u.a)(l,r,_),l},setExtent:function T(t,r,s){return H(r,s),v(s,ne(t,t.origin),s),s},transform:function q(t,r,s){return t!==s&&U(t,s),(0,C.a)(o,r),(0,C.t)(o,o),(0,u.m)(s.basis1,t.basis1,o),(0,u.m)(s.basis2,t.basis2,o),(0,u.m)((0,M.mJ)(s.plane),(0,M.mJ)(t.plane),o),(0,u.m)(s.origin,t.origin,r),(0,M.T5)(s.plane,s.plane,s.origin),s},updateUnboundedPlane:f,wrap:function K(t,r,s){const l=B.get();return l.origin=t,l.basis1=r,l.basis2=s,l.plane=(0,M.re)(0,0,0,0),f(l),l}},Symbol.toStringTag,{value:"Module"}))},10992:(ve,ee,d)=>{d.d(ee,{AR:()=>ue,Gr:()=>le,JG:()=>I,Jk:()=>M,KU:()=>w,Ue:()=>m,al:()=>g,ct:()=>Y,nF:()=>te,zk:()=>ie});var P=d(21286),h=d(97535),b=d(84161),x=d(28093),C=d(26242);function m(p){return p?{origin:(0,x.a)(p.origin),vector:(0,x.a)(p.vector)}:{origin:(0,x.c)(),vector:(0,x.c)()}}function I(p,f=m()){return g(p.origin,p.vector,f)}function g(p,f,v=m()){return(0,b.c)(v.origin,p),(0,b.c)(v.vector,f),v}function ie(p,f,v=m()){return(0,b.c)(v.origin,p),(0,b.b)(v.vector,f,p),v}function M(p,f){const v=(0,b.b)(C.WM.get(),f,p.origin),T=(0,b.e)(p.vector,v),H=(0,b.e)(p.vector,p.vector),S=(0,P.uZ)(T/H,0,1),z=(0,b.b)(C.WM.get(),(0,b.g)(C.WM.get(),p.vector,S),v);return(0,b.e)(z,z)}function te(p,f,v){return Y(p,f,0,1,v)}function w(p,f,v){return(0,b.a)(v,p.origin,(0,b.g)(v,p.vector,f))}function Y(p,f,v,T,H){const{vector:S,origin:z}=p,A=(0,b.b)(C.WM.get(),f,z),J=(0,b.e)(S,A)/(0,b.p)(S);return(0,b.g)(H,S,(0,P.uZ)(J,v,T)),(0,b.a)(H,H,p.origin)}function le(p,f){if(K(p,function u(p,f){const v=ce.get();return v.origin=p,v.vector=f,v}(f.origin,f.direction),!1,U)){const{tA:v,pB:T,distance2:H}=U;if(v>=0&&v<=1)return H;if(v<0)return(0,b.d)(p.origin,T);if(v>1)return(0,b.d)((0,b.a)(C.WM.get(),p.origin,p.vector),T)}return null}function ue(p,f,v){return!!K(p,f,!0,U)&&((0,b.c)(v,U.pA),!0)}function K(p,f,v,T){const S=p.origin,z=(0,b.a)(C.WM.get(),S,p.vector),A=f.origin,J=(0,b.a)(C.WM.get(),A,f.vector),j=C.WM.get(),E=C.WM.get();if(j[0]=S[0]-A[0],j[1]=S[1]-A[1],j[2]=S[2]-A[2],E[0]=J[0]-A[0],E[1]=J[1]-A[1],E[2]=J[2]-A[2],Math.abs(E[0])<1e-6&&Math.abs(E[1])<1e-6&&Math.abs(E[2])<1e-6)return!1;const O=C.WM.get();if(O[0]=z[0]-S[0],O[1]=z[1]-S[1],O[2]=z[2]-S[2],Math.abs(O[0])<1e-6&&Math.abs(O[1])<1e-6&&Math.abs(O[2])<1e-6)return!1;const re=j[0]*E[0]+j[1]*E[1]+j[2]*E[2],Q=E[0]*O[0]+E[1]*O[1]+E[2]*O[2],oe=j[0]*O[0]+j[1]*O[1]+j[2]*O[2],se=E[0]*E[0]+E[1]*E[1]+E[2]*E[2],ne=(O[0]*O[0]+O[1]*O[1]+O[2]*O[2])*se-Q*Q;if(Math.abs(ne)<1e-6)return!1;let $=(re*Q-oe*se)/ne,X=(re+Q*$)/se;v&&($=(0,P.uZ)($,0,1),X=(0,P.uZ)(X,0,1));const q=C.WM.get(),L=C.WM.get();return q[0]=S[0]+$*O[0],q[1]=S[1]+$*O[1],q[2]=S[2]+$*O[2],L[0]=A[0]+X*E[0],L[1]=A[1]+X*E[1],L[2]=A[2]+X*E[2],T.tA=$,T.tB=X,T.pA=q,T.pB=L,T.distance2=(0,b.d)(q,L),!0}const U={tA:0,tB:0,pA:(0,x.c)(),pB:(0,x.c)(),distance2:0},ce=new h.x(()=>m())},33683:(ve,ee,d)=>{d.r(ee),d.d(ee,{FeatureServiceSnappingSource:()=>B});var P=d(15861),h=d(17626),b=d(14517),x=d(80542),C=d(54024),m=d(62208),u=d(10699),I=d(32917),g=d(77712),G=(d(90912),d(85931),d(76898)),te=d(84395),w=d(60507),Y=d(68511),le=d(84161),ue=d(4794),V=d(41743);function K(n,o){return(0,V.g)(o.extent,U),(0,V.h)(U,(0,le.s)(ce,n.x,n.y,0))}const U=(0,V.a)(),ce=(0,ue.c)();var p=d(93579);let f=class extends b.Z{get tiles(){const n=this.tilesCoveringView,o=(0,m.pC)(this.pointOfInterest)?this.pointOfInterest:this.view.center;return n.sort((a,c)=>K(o,a)-K(o,c)),n}_scaleEnabled(){return(0,p.rs)(this.view.scale,this.layer.minScale||0,this.layer.maxScale||0)}get tilesCoveringView(){if(!this.view.ready||!this.view.featuresTilingScheme||!this.view.state||(0,m.Wi)(this.tileInfo))return[];if(!this._scaleEnabled)return[];const{spans:n,lodInfo:o}=this.view.featuresTilingScheme.getTileCoverage(this.view.state,0),{level:a}=o,c=[];for(const{row:t,colFrom:r,colTo:s}of n)for(let l=r;l<=s;l++){const y=o.normalizeCol(l),_=new Y.f(null,a,t,y);this.tileInfo.updateTileInfo(_),c.push(_)}return c}get tileInfo(){return this.view.featuresTilingScheme?.tileInfo??null}get tileSize(){return(0,m.pC)(this.tileInfo)?this.tileInfo.size[0]:256}constructor(n){super(n),this.pointOfInterest=null}initialize(){this.addHandles((0,I.YP)(()=>this.view?.state?.viewpoint,()=>this.notifyChange("tilesCoveringView"),I.Z_))}};(0,h._)([(0,g.Cb)({readOnly:!0})],f.prototype,"tiles",null),(0,h._)([(0,g.Cb)({readOnly:!0})],f.prototype,"_scaleEnabled",null),(0,h._)([(0,g.Cb)({readOnly:!0})],f.prototype,"tilesCoveringView",null),(0,h._)([(0,g.Cb)({readOnly:!0})],f.prototype,"tileInfo",null),(0,h._)([(0,g.Cb)({readOnly:!0})],f.prototype,"tileSize",null),(0,h._)([(0,g.Cb)({constructOnly:!0})],f.prototype,"view",void 0),(0,h._)([(0,g.Cb)({constructOnly:!0})],f.prototype,"layer",void 0),(0,h._)([(0,g.Cb)()],f.prototype,"pointOfInterest",void 0),f=(0,h._)([(0,G.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles2D")],f);var H,n,v=d(65401);(n=H||(H={}))[n.INVISIBLE=0]="INVISIBLE",n[n.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED",n[n.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE";let S=class extends x.r{get tiles(){const n=this.tilesCoveringView,o=this._effectivePointOfInterest;if((0,m.pC)(o)){const a=n.map(c=>K(o,c));for(let c=1;c<a.length;c++)if(a[c-1]>a[c])return n.sort((t,r)=>K(o,t)-K(o,r)),n.slice()}return n}get tilesCoveringView(){return this._filterTiles(this.view.featureTiles?.tiles?.toArray()).map(z)}get tileInfo(){return this.view.featureTiles?.tilingScheme.toTileInfo()??null}get tileSize(){return this.view.featureTiles?.tileSize??256}get _effectivePointOfInterest(){const n=this.pointOfInterest;return(0,m.pC)(n)?n:this.view.pointsOfInterest?.focus.location}constructor(n){super(n),this.pointOfInterest=null}initialize(){this.handles.add((0,I.YP)(()=>this.view.featureTiles,n=>{this.handles.remove(J),n&&this.handles.add(n.addClient(),J)},I.nn))}_filterTiles(n){return(0,m.Wi)(n)?[]:n.filter(o=>Math.abs(o.measures.screenRect[3]-o.measures.screenRect[1])>A&&o.measures.visibility===H.VISIBLE_ON_SURFACE)}};function z({lij:[n,o,a],extent:c}){return new Y.f(`${n}/${o}/${a}`,n,o,a,c)}(0,h._)([(0,g.Cb)({readOnly:!0})],S.prototype,"tiles",null),(0,h._)([(0,g.Cb)({readOnly:!0})],S.prototype,"tilesCoveringView",null),(0,h._)([(0,g.Cb)({readOnly:!0})],S.prototype,"tileInfo",null),(0,h._)([(0,g.Cb)({readOnly:!0})],S.prototype,"tileSize",null),(0,h._)([(0,g.Cb)({constructOnly:!0})],S.prototype,"view",void 0),(0,h._)([(0,g.Cb)()],S.prototype,"pointOfInterest",void 0),(0,h._)([(0,g.Cb)()],S.prototype,"_effectivePointOfInterest",null),S=(0,h._)([(0,G.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTiles3D")],S);const A=50,J="feature-tiles";var j=d(9218),E=d(72392),O=d(37118),re=d(91558),Q=d(88879),oe=d(21286),se=d(69852),ne=d(88493),$=d(35540),X=d(21716);const q=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let L=class extends b.Z{constructor(n){super(n),this.updating=!1,this.enablePolygons=!0,this.enableLabels=!0,this._polygons=new Map,this._labels=new Map,this._enabled=!0}initialize(){this._symbols=q.map(n=>new ne.Z({color:[n[0],n[1],n[2],.6],outline:{color:"black",width:1}})),this.update()}destroy(){this._enabled=!1,this.clear()}get enabled(){return this._enabled}set enabled(n){this._enabled!==n&&(this._enabled=n,this.update())}update(){if(!this._enabled)return void this.clear();const o=this.getTiles(),a=new Array,c=new Set(this._labels.keys());o.forEach((r,s)=>{const l=r.lij.toString();c.delete(l);const y=r.lij[0],_=r.geometry;if(this.enablePolygons&&!this._polygons.has(l)){const R=new Q.Z({geometry:_,symbol:this._symbols[y%this._symbols.length]});this._polygons.set(l,R),a.push(R)}if(this.enableLabels){const R=(r=>{if((0,m.pC)(r.label))return r.label;let s=r.lij.toString();return(0,m.pC)(r.loadPriority)&&(s+=` (${r.loadPriority})`),s})(r),F=s/(o.length-1),W=(0,oe.t7)(0,200,F),Z=(0,oe.t7)(20,6,F)/.75,Se=(0,m.pC)(r.loadPriority)&&r.loadPriority>=o.length,Ie=new re.Z([W,Se?0:W,Se?0:W]),Oe="3d"===this.view.type?()=>new se.Z({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new X.Z({text:R,halo:{color:"white",size:1/.75},material:{color:Ie},size:Z})]}):()=>new $.Z({text:R,haloColor:"white",haloSize:1/.75,color:Ie,size:Z}),ye=this._labels.get(l);if(ye){const de=Oe();((0,m.Wi)(ye.symbol)||JSON.stringify(de)!==JSON.stringify(ye.symbol))&&(ye.symbol=de)}else{const de=new Q.Z({geometry:_.extent.center,symbol:Oe()});this._labels.set(l,de),a.push(de)}}});const t=new Array;c.forEach(r=>{const s=this._polygons.get(r);null!=s&&(t.push(s),this._polygons.delete(r));const l=this._labels.get(r);null!=l&&(t.push(l),this._labels.delete(r))}),this.view.graphics.removeMany(t),this.view.graphics.addMany(a)}clear(){this.view.graphics.removeMany(Array.from(this._polygons.values())),this.view.graphics.removeMany(Array.from(this._labels.values())),this._polygons.clear(),this._labels.clear()}};(0,h._)([(0,g.Cb)({constructOnly:!0})],L.prototype,"view",void 0),(0,h._)([(0,g.Cb)({readOnly:!0})],L.prototype,"updating",void 0),(0,h._)([(0,g.Cb)()],L.prototype,"enabled",null),L=(0,h._)([(0,G.j)("esri.views.support.TileTreeDebugger")],L);let N=class extends L{constructor(n){super(n),this._handles=new E.Z}initialize(){const n=setInterval(()=>this._fetchDebugInfo(),2e3);this._handles.add((0,C.kB)(()=>clearInterval(n)))}destroy(){this._handles.destroy()}getTiles(){if(!this._debugInfo)return[];const n=new Map,o=new Map;this._debugInfo.storedTiles.forEach(t=>{n.set(t.data.id,t.featureCount)}),this._debugInfo.pendingTiles.forEach(t=>{n.set(t.data.id,t.featureCount),o.set(t.data.id,t.state)});const a=t=>{const r=o.get(t),s=n.get(t)??"?";return r?`${r}:${s}\n${t}`:`store:${s}\n${t}`},c=new Map;return this._debugInfo.storedTiles.forEach(t=>{c.set(t.data.id,t.data)}),this._debugInfo.pendingTiles.forEach(t=>{c.set(t.data.id,t.data)}),Array.from(c.values()).map(t=>({lij:[t.level,t.row,t.col],geometry:O.Z.fromExtent((0,v.HH)(t.extent,this.view.spatialReference)),label:a(t.id)}))}_fetchDebugInfo(){this.handle.getDebugInfo(null).then(n=>{this._debugInfo=n,this.update()})}};(0,h._)([(0,g.Cb)({constructOnly:!0})],N.prototype,"handle",void 0),N=(0,h._)([(0,G.j)("esri.views.interactive.snapping.featureSources.WorkerTileTreeDebugger")],N);var be=d(42930),he=d(71774),ge=d(38114);let D=class extends x.r{get updating(){return this.updatingHandles.updating||this._workerHandleUpdating}constructor(n){super(n),this.schedule=null,this.hasZ=!1,this.elevationAlignPointsInFeatures=function(){var o=(0,P.Z)(function*(a){const c=[];for(const{points:t}of a)for(const{z:r}of t)c.push(r);return{elevations:c,drapedObjectIds:new Set,failedObjectIds:new Set}});return function(a){return o.apply(this,arguments)}}(),this.queryForSymbologySnapping=(0,P.Z)(function*(){return{candidates:[],sourceCandidateIndices:[]}}),this.availability=0,this._workerHandleUpdating=!0,this._editId=0}destroy(){this._workerHandle.destroy()}initialize(){var o,n=this;this._workerHandle=new me(this.schedule,{alignElevation:(o=(0,P.Z)(function*(a,{signal:c}){return{result:yield n.elevationAlignPointsInFeatures(a.points,c)}}),function(c,t){return o.apply(this,arguments)}),getSymbologyCandidates:function(){var o=(0,P.Z)(function*(a,{signal:c}){return{result:yield n.queryForSymbologySnapping(a,c)}});return function(c,t){return o.apply(this,arguments)}}()}),this.handles.add([this._workerHandle.on("notify-updating",({updating:o})=>this._workerHandleUpdating=o),this._workerHandle.on("notify-availability",({availability:o})=>this._set("availability",o))])}setup(n,o){var a=this;return(0,P.Z)(function*(){const c=a._serviceInfoFromLayer(n.layer);if((0,m.Wi)(c))return;const t={configuration:a._convertConfiguration(n.configuration),serviceInfo:c,spatialReference:n.spatialReference.toJSON(),hasZ:a.hasZ,elevationInfo:n.layer.elevationInfo?.toJSON()};yield a.updatingHandles.addPromise(a._workerHandle.invokeMethod("setup",t,o)),a.updatingHandles.addPromise(a._workerHandle.invokeMethod("whenNotUpdating",{},o))})()}configure(n,o){var a=this;return(0,P.Z)(function*(){const c=a._convertConfiguration(n);yield a.updatingHandles.addPromise(a._workerHandle.invokeMethod("configure",c,o)),a.updatingHandles.addPromise(a._workerHandle.invokeMethod("whenNotUpdating",{},o))})()}refresh(n){var o=this;return(0,P.Z)(function*(){yield o.updatingHandles.addPromise(o._workerHandle.invokeMethod("refresh",{},n)),o.updatingHandles.addPromise(o._workerHandle.invokeMethod("whenNotUpdating",{},n))})()}fetchCandidates(n,o){var a=this;return(0,P.Z)(function*(){const c=n.point,t={distance:n.distance,mode:n.mode,point:(0,ge.Tx)(c[0],c[1],c[2],n.coordinateHelper.spatialReference.toJSON()),types:n.types,filter:(0,m.pC)(n.filter)?n.filter.toJSON():null};return a._workerHandle.invoke(t,o)})()}updateTiles(n,o){var a=this;return(0,P.Z)(function*(){const c={tiles:n.tiles,tileInfo:(0,m.pC)(n.tileInfo)?n.tileInfo.toJSON():null,tileSize:n.tileSize};yield a.updatingHandles.addPromise(a._workerHandle.invokeMethod("updateTiles",c,o)),a.updatingHandles.addPromise(a._workerHandle.invokeMethod("whenNotUpdating",{},o))})()}applyEdits(n,o){var a=this;return(0,P.Z)(function*(){const c=a._editId++,t={id:c};yield a.updatingHandles.addPromise(a._workerHandle.invokeMethod("beginApplyEdits",t,o));const r=yield a.updatingHandles.addPromise((0,u.Hl)(n.result,o)),s={id:c,edits:{addedFeatures:r.addedFeatures?.map(({objectId:l})=>l).filter(m.pC)??[],deletedFeatures:r.deletedFeatures?.map(({objectId:l,globalId:y})=>({objectId:l,globalId:y}))??[],updatedFeatures:r.updatedFeatures?.map(({objectId:l})=>l).filter(m.pC)??[]}};yield a.updatingHandles.addPromise(a._workerHandle.invokeMethod("endApplyEdits",s,o)),a.updatingHandles.addPromise(a._workerHandle.invokeMethod("whenNotUpdating",{},o))})()}getDebugInfo(n){return this._workerHandle.invokeMethod("getDebugInfo",{},n)}notifyElevationSourceChange(){var n=this;return(0,P.Z)(function*(){yield n._workerHandle.invokeMethod("notifyElevationSourceChange",{})})()}notifySymbologyChange(){var n=this;return(0,P.Z)(function*(){yield n._workerHandle.invokeMethod("notifySymbologyChange",{})})()}setSymbologySnappingSupported(n){var o=this;return(0,P.Z)(function*(){yield o._workerHandle.invokeMethod("setSymbologySnappingSupported",n)})()}_convertConfiguration(n){return{filter:(0,m.pC)(n.filter)?n.filter.toJSON():null,customParameters:n.customParameters,viewType:n.viewType}}_serviceInfoFromLayer(n){return"multipatch"===n.geometryType||"mesh"===n.geometryType?null:{url:n.parsedUrl?.path??"",fields:n.fields.map(o=>o.toJSON()),geometryType:he.M.toJSON(n.geometryType),capabilities:n.capabilities,objectIdField:n.objectIdField,globalIdField:n.globalIdField,spatialReference:n.spatialReference.toJSON(),timeInfo:n.timeInfo?.toJSON()}}};(0,h._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"schedule",void 0),(0,h._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"hasZ",void 0),(0,h._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"elevationAlignPointsInFeatures",void 0),(0,h._)([(0,g.Cb)({constructOnly:!0})],D.prototype,"queryForSymbologySnapping",void 0),(0,h._)([(0,g.Cb)({readOnly:!0})],D.prototype,"updating",null),(0,h._)([(0,g.Cb)({readOnly:!0})],D.prototype,"availability",void 0),(0,h._)([(0,g.Cb)()],D.prototype,"_workerHandleUpdating",void 0),D=(0,h._)([(0,G.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceSnappingSourceWorkerHandle")],D);class me extends be.q{constructor(o,a){super("FeatureServiceSnappingSourceWorker","fetchCandidates",{},o,{strategy:"dedicated",client:a})}}var pe=d(72642),fe=d(72258),ae=d(2584);let k=class extends b.Z{get tiles(){return[new Y.f("0/0/0",0,0,0,(0,v.al)(-1e8,-1e8,1e8,1e8))]}get tileInfo(){return new ae.Z({origin:new pe.Z({x:-1e8,y:1e8,spatialReference:this.layer.spatialReference}),size:[512,512],lods:[new fe.Z({level:0,scale:1,resolution:390625})],spatialReference:this.layer.spatialReference})}get tileSize(){return this.tileInfo.size[0]}constructor(n){super(n),this.pointOfInterest=null}};(0,h._)([(0,g.Cb)({readOnly:!0})],k.prototype,"tiles",null),(0,h._)([(0,g.Cb)({readOnly:!0})],k.prototype,"tileInfo",null),(0,h._)([(0,g.Cb)({readOnly:!0})],k.prototype,"tileSize",null),(0,h._)([(0,g.Cb)({constructOnly:!0})],k.prototype,"layer",void 0),(0,h._)([(0,g.Cb)()],k.prototype,"pointOfInterest",void 0),k=(0,h._)([(0,G.j)("esri.views.interactive.snapping.featureSources.featureServiceSource.FeatureServiceTilesSimple")],k);var _e=d(66463);let B=class extends((0,x.p)(b.Z)){get _updateTilesParameters(){return{tiles:this._tilesOfInterest.tiles,tileInfo:this._tilesOfInterest.tileInfo,tileSize:this._tilesOfInterest.tileSize}}get updating(){return this._workerHandle?.updating||this.updatingHandles.updating}get configuration(){const{view:n}=this,o=(0,m.pC)(n)?n.type:"2d";return{filter:this._layer.createQuery(),customParameters:this._layer.customParameters,viewType:o}}get availability(){return this._workerHandle?.availability??0}get _layer(){return this.layerSource.layer}constructor(n){super(n),this._workerHandle=null,this._debug=null}initialize(){let n;const o=this.view;if((0,m.pC)(o))switch(o.type){case"2d":this._tilesOfInterest=new f({view:o,layer:this._layer}),n=this._workerHandle=new D;break;case"3d":{const{resourceController:a}=o,c=this._layer,t=o.whenLayerView(c);this._tilesOfInterest=new S({view:o}),n=this._workerHandle=new D({schedule:s=>a.immediate.schedule(s),hasZ:this._layer.hasZ&&(this._layer.returnZ??!0),elevationAlignPointsInFeatures:(s=(0,P.Z)(function*(l,y){const _=yield t;return(0,u.k_)(y),_.elevationAlignPointsInFeatures(l,y)}),function(y,_){return s.apply(this,arguments)}),queryForSymbologySnapping:function(){var s=(0,P.Z)(function*(l,y){const _=yield t;return(0,u.k_)(y),_.queryForSymbologySnapping(l,y)});return function(y,_){return s.apply(this,arguments)}}()});const r=new te.f(null);t.then(s=>r.set(s)),this.addHandles([o.elevationProvider.on("elevation-change",({context:s})=>{const{elevationInfo:l}=c;(0,w.W_)(s,l)&&(0,u.R8)(n.notifyElevationSourceChange())}),(0,I.YP)(()=>c.elevationInfo,()=>(0,u.R8)(n.notifyElevationSourceChange()),I.nn),(0,I.YP)(()=>(0,m.yw)(r.get(),({processor:s})=>s?.renderer),()=>(0,u.R8)(n.notifySymbologyChange()),I.nn),(0,I.YP)(()=>(0,m.R2)(r.get(),!1,s=>s.symbologySnappingSupported),s=>(0,u.R8)(n.setSymbologySnappingSupported(s)),I.nn),(0,I.on)(()=>(0,m.WG)(r.get())?.layer,["edits","apply-edits","graphic-update"],()=>n.notifySymbologyChange())]);break}}else this._tilesOfInterest=new k({layer:this._layer}),n=this._workerHandle=new D;var s;this.handles.add([(0,C.ed)(n)]),(0,u.R8)(n.setup({layer:this._layer,spatialReference:this.spatialReference,configuration:this.configuration},null)),this.updatingHandles.add(()=>this._updateTilesParameters,()=>(0,u.R8)(n.updateTiles(this._updateTilesParameters,null)),I.nn),this.handles.add([(0,I.YP)(()=>this.configuration,a=>(0,u.R8)(n.configure(a,null)),I.Z_)]),(0,m.pC)(o)&&this.handles.add((0,I.YP)(()=>_e.Z.FEATURE_SERVICE_SNAPPING_SOURCE_TILE_TREE_SHOW_TILES,a=>{a&&!this._debug?(this._debug=new N({view:o,handle:n}),this.handles.add((0,C.ed)(this._debug),"debug")):!a&&this._debug&&this.handles.remove("debug")},I.nn)),this.handles.add(this.layerSource.layer.on("apply-edits",a=>{(0,u.R8)(n.applyEdits(a,null))}))}refresh(){this._workerHandle?.refresh(null)}fetchCandidates(n,o){var a=this;return(0,P.Z)(function*(){const{coordinateHelper:c,point:t}=n;a._tilesOfInterest.pointOfInterest=c.arrayToPoint(t);const r=a._getGroundElevation;return(yield a._workerHandle.fetchCandidates({...n},o)).candidates.map(s=>(0,j.X)(s,r))})()}getDebugInfo(n){return this._workerHandle.getDebugInfo(n)}get _getGroundElevation(){return(0,j.g)(this.view)}};(0,h._)([(0,g.Cb)({constructOnly:!0})],B.prototype,"spatialReference",void 0),(0,h._)([(0,g.Cb)({constructOnly:!0})],B.prototype,"layerSource",void 0),(0,h._)([(0,g.Cb)({constructOnly:!0})],B.prototype,"view",void 0),(0,h._)([(0,g.Cb)()],B.prototype,"_tilesOfInterest",void 0),(0,h._)([(0,g.Cb)({readOnly:!0})],B.prototype,"_updateTilesParameters",null),(0,h._)([(0,g.Cb)({readOnly:!0})],B.prototype,"updating",null),(0,h._)([(0,g.Cb)({readOnly:!0})],B.prototype,"configuration",null),(0,h._)([(0,g.Cb)({readOnly:!0})],B.prototype,"availability",null),(0,h._)([(0,g.Cb)()],B.prototype,"_getGroundElevation",null),B=(0,h._)([(0,G.j)("esri.views.interactive.snapping.featureSources.FeatureServiceSnappingSource")],B)},19038:(ve,ee,d)=>{d.d(ee,{n:()=>b});var P=d(84161),h=d(5286);class b extends h.r{constructor(C,m,u){super(m,u),this.point=C}equals(C){return C instanceof b&&(0,P.k)(this.point,C.point)}}}}]);
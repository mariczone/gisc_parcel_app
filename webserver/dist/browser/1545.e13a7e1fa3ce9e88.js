"use strict";(self.webpackChunkparcel_app=self.webpackChunkparcel_app||[]).push([[1545],{41743:(Nt,Ct,h)=>{h.d(Ct,{a:()=>ht,c:()=>V,g:()=>q,h:()=>pt,u:()=>O}),h(8314);var Dt=h(63290),$=h(21286),ot=h(97535),m=h(28347),R=h(43703),g=h(84161),N=h(28093),st=h(78172),lt=h(10992),L=h(90014),Gt=h(70562),ct=h(34054),I=h(26242);const gt=Dt.Z.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");function ht(i=u){return{plane:(0,L.Ue)(i.plane),origin:(0,N.a)(i.origin),basis1:(0,N.a)(i.basis1),basis2:(0,N.a)(i.basis2)}}function V(i,s=ht()){return d(i.origin,i.basis1,i.basis2,s)}function d(i,s,l,_=ht()){return(0,g.c)(_.origin,i),(0,g.c)(_.basis1,s),(0,g.c)(_.basis2,l),O(_),function v(i,s){Math.abs((0,g.e)(i.basis1,i.basis2)/((0,g.l)(i.basis1)*(0,g.l)(i.basis2)))>1e-6&&gt.warn(s,"Provided basis vectors are not perpendicular"),Math.abs((0,g.e)(i.basis1,it(i)))>1e-6&&gt.warn(s,"Basis vectors and plane normal are not perpendicular"),Math.abs(-(0,g.e)(it(i),i.origin)-i.plane[3])>1e-6&&gt.warn(s,"Plane offset is not consistent with plane origin")}(_,"fromValues()"),_}function O(i){(0,L.my)(i.basis2,i.basis1,i.origin,i.plane)}function G(i,s,l){i!==l&&V(i,l);const _=(0,g.g)(I.WM.get(),it(i),s);return(0,g.a)(l.origin,l.origin,_),l.plane[3]-=s,l}function q(i,s=ht()){const l=(i[2]-i[0])/2,_=(i[3]-i[1])/2;return(0,g.s)(s.origin,i[0]+l,i[1]+_,0),(0,g.s)(s.basis1,l,0,0),(0,g.s)(s.basis2,0,_,0),(0,L.al)(0,0,1,0,s.plane),s}function B(i,s,l){return!!(0,L.BR)(i.plane,s,l)&&Vt(i,l)}function H(i,s,l){const _=M.get();p(i,s,_,M.get());let w=Number.POSITIVE_INFINITY;for(const Z of k){const Y=c(i,Z,E.get()),at=I.WM.get();if((0,L.rx)(_,Y,at)){const z=(0,g.r)(I.WM.get(),s.origin,at),J=Math.abs((0,$.ZF)((0,g.e)(s.direction,z)));J<w&&(w=J,(0,g.c)(l,at))}}return w===Number.POSITIVE_INFINITY?tt(i,s,l):l}function tt(i,s,l){if(B(i,s,l))return l;const _=M.get(),w=M.get();p(i,s,_,w);let Z=Number.POSITIVE_INFINITY;for(const Y of k){const at=c(i,Y,E.get()),z=I.WM.get();if((0,L.dZ)(_,at,z)){const J=(0,Gt.Jk)(s,z);if(!(0,L.Ac)(w,z))continue;J<Z&&(Z=J,(0,g.c)(l,z))}}return Et(i,s.origin)<Z&&Pt(i,s.origin,l),l}function Pt(i,s,l){const _=(0,L.nF)(i.plane,s,I.WM.get()),w=(0,lt.ct)(n(i,i.basis1),_,-1,1,I.WM.get()),Z=(0,lt.ct)(n(i,i.basis2),_,-1,1,I.WM.get());return(0,g.b)(l,(0,g.a)(I.WM.get(),w,Z),i.origin),l}function Ot(i,s,l){const{origin:_,basis1:w,basis2:Z}=i,Y=(0,g.b)(I.WM.get(),s,_),at=(0,ct.SR)(w,Y),z=(0,ct.SR)(Z,Y),J=(0,ct.SR)(it(i),Y);return(0,g.s)(l,at,z,J)}function Et(i,s){const l=Ot(i,s,I.WM.get()),{basis1:_,basis2:w}=i,Z=(0,g.l)(_),Y=(0,g.l)(w),at=Math.max(Math.abs(l[0])-Z,0),z=Math.max(Math.abs(l[1])-Y,0),J=l[2];return at*at+z*z+J*J}function pt(i,s){return Math.sqrt(Et(i,s))}function xt(i,s){const l=-i.plane[3];return(0,ct.SR)(it(i),s)-l}function it(i){return(0,L.mJ)(i.plane)}function Vt(i,s){const l=(0,g.b)(I.WM.get(),s,i.origin),_=(0,g.p)(i.basis1),w=(0,g.p)(i.basis2),Z=(0,g.e)(i.basis1,l),Y=(0,g.e)(i.basis2,l);return-Z-_<0&&Z-_<0&&-Y-w<0&&Y-w<0}function n(i,s){const l=E.get();return(0,g.c)(l.origin,i.origin),(0,g.c)(l.vector,s),l}function c(i,s,l){const{basis1:_,basis2:w,origin:Z}=i,Y=(0,g.g)(I.WM.get(),_,s.origin[0]),at=(0,g.g)(I.WM.get(),w,s.origin[1]);(0,g.a)(l.origin,Y,at),(0,g.a)(l.origin,l.origin,Z);const z=(0,g.g)(I.WM.get(),_,s.direction[0]),J=(0,g.g)(I.WM.get(),w,s.direction[1]);return(0,g.g)(l.vector,(0,g.a)(z,z,J),2),l}function p(i,s,l,_){const w=it(i);(0,L.my)(w,s.direction,s.origin,l),(0,L.my)((0,L.mJ)(l),w,s.origin,_)}const u={plane:(0,L.Ue)(),origin:(0,N.f)(0,0,0),basis1:(0,N.f)(1,0,0),basis2:(0,N.f)(0,1,0)},M=new ot.x(L.Ue),E=new ot.x(lt.Ue),C=(0,N.c)(),b=new ot.x(()=>ht()),k=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],U=(0,R.c)(),nt=(0,R.c)();Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:class At{constructor(){this.plane=(0,L.Ue)(),this.origin=(0,N.c)(),this.basis1=(0,N.c)(),this.basis2=(0,N.c)()}},UP:u,altitudeAt:xt,axisAt:function et(i,s,l,_){return function ut(i,s,l){switch(s){case st.R.X:(0,g.c)(l,i.basis1),(0,g.n)(l,l);break;case st.R.Y:(0,g.c)(l,i.basis2),(0,g.n)(l,l);break;case st.R.Z:(0,g.c)(l,it(i))}return l}(i,l,_)},closestPoint:tt,closestPointOnSilhouette:H,copy:V,copyWithoutVerify:function Lt(i,s){(0,g.c)(s.origin,i.origin),(0,g.c)(s.basis1,i.basis1),(0,g.c)(s.basis2,i.basis2),(0,L.JG)(s.plane,i.plane)},create:ht,distance:pt,distance2:Et,distanceToSilhouette:function mt(i,s){let l=Number.NEGATIVE_INFINITY;for(const _ of k){const w=c(i,_,E.get()),Z=(0,lt.Jk)(w,s);Z>l&&(l=Z)}return Math.sqrt(l)},elevate:G,equals:function Wt(i,s){return(0,g.k)(i.basis1,s.basis1)&&(0,g.k)(i.basis2,s.basis2)&&(0,g.k)(i.origin,s.origin)},extrusionContainsPoint:function bt(i,s){return(0,L.Ac)(i.plane,s)&&Vt(i,s)},fromAABoundingRect:q,fromValues:d,intersectRay:B,intersectRayClosestSilhouette:function F(i,s,l){if(B(i,s,l))return l;const _=H(i,s,I.WM.get());return(0,g.a)(l,s.origin,(0,g.g)(I.WM.get(),s.direction,(0,g.i)(s.origin,_)/(0,g.l)(s.direction))),l},normal:it,projectPoint:Pt,projectPointLocal:Ot,rotate:function dt(i,s,l,_){return i!==_&&V(i,_),(0,m.d)(nt,s,l),(0,g.m)(_.basis1,i.basis1,nt),(0,g.m)(_.basis2,i.basis2,nt),O(_),_},setAltitudeAt:function Ut(i,s,l,_){const w=xt(i,s),Z=(0,g.g)(C,it(i),l-w);return(0,g.a)(_,s,Z),_},setExtent:function _t(i,s,l){return q(s,l),G(l,xt(i,i.origin),l),l},transform:function Tt(i,s,l){return i!==l&&V(i,l),(0,m.a)(U,s),(0,m.t)(U,U),(0,g.m)(l.basis1,i.basis1,U),(0,g.m)(l.basis2,i.basis2,U),(0,g.m)((0,L.mJ)(l.plane),(0,L.mJ)(i.plane),U),(0,g.m)(l.origin,i.origin,s),(0,L.T5)(l.plane,l.plane,l.origin),l},updateUnboundedPlane:O,wrap:function St(i,s,l){const _=b.get();return _.origin=i,_.basis1=s,_.basis2=l,_.plane=(0,L.re)(0,0,0,0),O(_),_}},Symbol.toStringTag,{value:"Module"}))},48977:(Nt,Ct,h)=>{h.d(Ct,{c:()=>ht,g:()=>st,i:()=>Mt,j:()=>pt,k:()=>V,m:()=>lt,r:()=>bt,s:()=>N});var x=h(550),Dt=h(78451),$=h(28093),ot=h(39863),m=h(84161),R=h(993);function N(n,c,v){v*=.5;const p=Math.sin(v);return n[0]=p*c[0],n[1]=p*c[1],n[2]=p*c[2],n[3]=Math.cos(v),n}function st(n,c){const v=2*Math.acos(c[3]),p=Math.sin(v/2);return p>(0,ot.g)()?(n[0]=c[0]/p,n[1]=c[1]/p,n[2]=c[2]/p):(n[0]=1,n[1]=0,n[2]=0),v}function lt(n,c,v){const p=c[0],u=c[1],M=c[2],E=c[3],C=v[0],b=v[1],k=v[2],U=v[3];return n[0]=p*U+E*C+u*k-M*b,n[1]=u*U+E*b+M*C-p*k,n[2]=M*U+E*k+p*b-u*C,n[3]=E*U-p*C-u*b-M*k,n}function gt(n,c,v,p){const u=c[0],M=c[1],E=c[2],C=c[3];let b,k,U,nt,P,i=v[0],s=v[1],l=v[2],_=v[3];return k=u*i+M*s+E*l+C*_,k<0&&(k=-k,i=-i,s=-s,l=-l,_=-_),1-k>(0,ot.g)()?(b=Math.acos(k),U=Math.sin(b),nt=Math.sin((1-p)*b)/U,P=Math.sin(p*b)/U):(nt=1-p,P=p),n[0]=nt*u+P*i,n[1]=nt*M+P*s,n[2]=nt*E+P*l,n[3]=nt*C+P*_,n}function Mt(n,c){const v=c[0],p=c[1],u=c[2],M=c[3],E=v*v+p*p+u*u+M*M,C=E?1/E:0;return n[0]=-v*C,n[1]=-p*C,n[2]=-u*C,n[3]=M*C,n}function ht(n,c){return n[0]=-c[0],n[1]=-c[1],n[2]=-c[2],n[3]=c[3],n}function St(n,c){const v=c[0]+c[4]+c[8];let p;if(v>0)p=Math.sqrt(v+1),n[3]=.5*p,p=.5/p,n[0]=(c[5]-c[7])*p,n[1]=(c[6]-c[2])*p,n[2]=(c[1]-c[3])*p;else{let u=0;c[4]>c[0]&&(u=1),c[8]>c[3*u+u]&&(u=2);const M=(u+1)%3,E=(u+2)%3;p=Math.sqrt(c[3*u+u]-c[3*M+M]-c[3*E+E]+1),n[u]=.5*p,p=.5/p,n[3]=(c[3*M+E]-c[3*E+M])*p,n[M]=(c[3*M+u]+c[3*u+M])*p,n[E]=(c[3*E+u]+c[3*u+E])*p}return n}function V(n,c,v,p){const u=.5*Math.PI/180;c*=u,v*=u,p*=u;const M=Math.sin(c),E=Math.cos(c),C=Math.sin(v),b=Math.cos(v),k=Math.sin(p),U=Math.cos(p);return n[0]=M*b*U-E*C*k,n[1]=E*C*U+M*b*k,n[2]=E*b*k-M*C*U,n[3]=E*b*U+M*C*k,n}const d=R.c,O=R.s,G=R.a,_t=lt,q=R.b,B=R.d,F=R.l,H=R.e,tt=H,Pt=R.f,Ot=Pt,Et=R.n,pt=R.g,mt=R.h;function bt(n,c,v){const p=(0,m.e)(c,v);return p<-.999999?((0,m.f)(et,xt,c),(0,m.u)(et)<1e-6&&(0,m.f)(et,Ut,c),(0,m.n)(et,et),N(n,et,Math.PI),n):p>.999999?(n[0]=0,n[1]=0,n[2]=0,n[3]=1,n):((0,m.f)(et,c,v),n[0]=et[0],n[1]=et[1],n[2]=et[2],n[3]=1+p,Et(n,n))}const et=(0,$.c)(),xt=(0,$.f)(1,0,0),Ut=(0,$.f)(0,1,0),Tt=(0,Dt.a)(),dt=(0,Dt.a)(),ut=(0,x.c)();Object.freeze(Object.defineProperty({__proto__:null,add:G,calculateW:function I(n,c){const v=c[0],p=c[1],u=c[2];return n[0]=v,n[1]=p,n[2]=u,n[3]=Math.sqrt(Math.abs(1-v*v-p*p-u*u)),n},conjugate:ht,copy:d,dot:B,equals:mt,exactEquals:pt,fromEuler:V,fromMat3:St,getAxisAngle:st,identity:function g(n){return n[0]=0,n[1]=0,n[2]=0,n[3]=1,n},invert:Mt,len:tt,length:H,lerp:F,mul:_t,multiply:lt,normalize:Et,random:function At(n){const c=ot.R,v=c(),p=c(),u=c(),M=Math.sqrt(1-v),E=Math.sqrt(v);return n[0]=M*Math.sin(2*Math.PI*p),n[1]=M*Math.cos(2*Math.PI*p),n[2]=E*Math.sin(2*Math.PI*u),n[3]=E*Math.cos(2*Math.PI*u),n},rotateX:function L(n,c,v){v*=.5;const p=c[0],u=c[1],M=c[2],E=c[3],C=Math.sin(v),b=Math.cos(v);return n[0]=p*b+E*C,n[1]=u*b+M*C,n[2]=M*b-u*C,n[3]=E*b-p*C,n},rotateY:function Gt(n,c,v){v*=.5;const p=c[0],u=c[1],M=c[2],E=c[3],C=Math.sin(v),b=Math.cos(v);return n[0]=p*b-M*C,n[1]=u*b+E*C,n[2]=M*b+p*C,n[3]=E*b-u*C,n},rotateZ:function ct(n,c,v){v*=.5;const p=c[0],u=c[1],M=c[2],E=c[3],C=Math.sin(v),b=Math.cos(v);return n[0]=p*b+u*C,n[1]=u*b-p*C,n[2]=M*b+E*C,n[3]=E*b-M*C,n},rotationTo:bt,scale:q,set:O,setAxes:function it(n,c,v,p){const u=ut;return u[0]=v[0],u[3]=v[1],u[6]=v[2],u[1]=p[0],u[4]=p[1],u[7]=p[2],u[2]=-c[0],u[5]=-c[1],u[8]=-c[2],Et(n,St(n,u))},setAxisAngle:N,slerp:gt,sqlerp:function Wt(n,c,v,p,u,M){return gt(Tt,c,u,M),gt(dt,v,p,M),gt(n,Tt,dt,2*M*(1-M)),n},sqrLen:Ot,squaredLength:Pt,str:function Lt(n){return"quat("+n[0]+", "+n[1]+", "+n[2]+", "+n[3]+")"}},Symbol.toStringTag,{value:"Module"}))},84786:(Nt,Ct,h)=>{h.d(Ct,{D:()=>Lt,Ou:()=>lt,WG:()=>V,kB:()=>I,mW:()=>ct}),h(29132);var Dt=h(88879),ot=(h(8314),h(58817)),m=h(62208),R=h(55713),g=h(91179),N=h(38114),st=h(65234);function lt(d){return"declaredClass"in d}function L(d){return"declaredClass"in d}function ct(d,O){return d?function Gt(d){return"declaredClass"in d}(d)?d:new Dt.Z({layer:O,sourceLayer:O,visible:d.visible,symbol:(0,ot.d9)(d.symbol),attributes:(0,ot.d9)(d.attributes),geometry:I(d.geometry)}):null}function I(d){return(0,m.Wi)(d)?null:lt(d)?d:(0,g.im)(function gt(d){const{wkid:O,wkt:G,latestWkid:_t}=d.spatialReference,q={wkid:O,wkt:G,latestWkid:_t};switch(d.type){case"point":{const{x:B,y:F,z:H,m:tt}=d;return{x:B,y:F,z:H,m:tt,spatialReference:q}}case"polygon":{const{rings:B,hasZ:F,hasM:H}=d;return{rings:At(B),hasZ:F,hasM:H,spatialReference:q}}case"polyline":{const{paths:B,hasZ:F,hasM:H}=d;return{paths:At(B),hasZ:F,hasM:H,spatialReference:q}}case"extent":{const{xmin:B,xmax:F,ymin:H,ymax:tt,zmin:Pt,zmax:Ot,mmin:Et,mmax:pt,hasZ:mt,hasM:bt}=d;return{xmin:B,xmax:F,ymin:H,ymax:tt,zmin:Pt,zmax:Ot,mmin:Et,mmax:pt,hasZ:mt,hasM:bt,spatialReference:q}}case"multipoint":{const{points:B,hasZ:F,hasM:H}=d;return{points:St(B)?Mt(B):B,hasZ:F,hasM:H,spatialReference:q}}default:return}}(d))}function At(d){return function ht(d){for(const O of d)if(0!==O.length)return St(O);return!1}(d)?d.map(O=>Mt(O)):d}function Mt(d){return d.map(O=>Array.from(O))}function St(d){return d.length>0&&((0,R.xZ)(d[0])||(0,R.fS)(d[0]))}function V(d,O){if(!d)return null;let G;if(L(d)){if(null==O)return d.clone();if(L(O))return O.copy(d)}return null!=O?(G=O,G.x=d.x,G.y=d.y,G.spatialReference=d.spatialReference,d.hasZ?(G.z=d.z,G.hasZ=d.hasZ):(G.z=void 0,G.hasZ=!1),d.hasM?(G.m=d.m,G.hasM=!0):(G.m=void 0,G.hasM=!1)):(G=(0,N.Tx)(d.x,d.y,d.z,d.spatialReference),d.hasM&&(G.m=d.m,G.hasM=!0)),G}function Lt(d){const{wkid:O,wkt:G,latestWkid:_t}=d;return st.Z.fromJSON({wkid:O,wkt:G,latestWkid:_t})}},13066:(Nt,Ct,h)=>{h.r(Ct),h.d(Ct,{ControlPointsTransformTool:()=>b,DrawGraphicTool2D:()=>d,MediaTransformToolsWrapper:()=>Rt,TransformTool:()=>vt});var x=h(17626),$=(h(29132),h(88879)),ot=h(54024),m=h(62208),R=h(77712),st=(h(90912),h(85931),h(76898)),lt=h(7959),Gt=(h(20383),h(94398)),ct=h(57213);const I=new Gt.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),gt=new ct.Z({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),At=new ct.Z({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var Mt=h(47916),ht=h(50566),St=h(52181),V=h(72642),Lt=h(72854);let d=class extends Mt.T{constructor(t){super(t),this._visualElementGraphics={outline:null,regularVertices:null,activeVertex:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:(0,m.Pt)(t.activeLineSymbol,I),regularVertices:(0,m.Pt)(t.regularVerticesSymbol,gt),activeVertex:(0,m.Pt)(t.activeVertexSymbol,At),fill:(0,m.Wg)(t.activeFillSymbol)}}normalizeCtorArgs(t){const e={...t};return delete e.activeFillSymbol,delete e.activeVertexSymbol,delete e.regularVerticesSymbol,delete e.activeLineSymbol,e}initializeGraphic(t){return(0,m.pC)(this._visualElementSymbols.fill)&&(t.symbol=this._visualElementSymbols.fill),null}makeDrawOperation(){const{defaultZ:t,hasZ:e,view:r}=this;return new ht.w({view:r,manipulators:this.manipulators,geometryType:(0,Mt.I)(this.geometryType),drawingMode:this.mode,hasZ:e,defaultZ:t,snapToSceneEnabled:this.snapToScene,drawSurface:new St.hP(r,e,t),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new lt.r(this.internalGraphicsLayer),tooltipOptions:this.tooltipOptions})}onActiveVertexChanged(t){if("point"===this.geometryType)return null;const[e,r]=t,f=new V.Z({x:e,y:r,spatialReference:this.view.spatialReference});return(0,m.pC)(this._visualElementGraphics.activeVertex)?(this._visualElementGraphics.activeVertex.geometry=f,null):(this._visualElementGraphics.activeVertex=new $.Z({geometry:f,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(O),(0,ot.kB)(()=>{(0,m.pC)(this._visualElementGraphics.activeVertex)&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=(0,m.SC)(this._visualElementGraphics.activeVertex))}))}onOutlineChanged(t){const e=t.clone();if("polyline"===e.type){const r=e.paths[e.paths.length-1];r.splice(0,r.length-2)}return(0,m.pC)(this._visualElementGraphics.outline)?(this._visualElementGraphics.outline.geometry=e,null):(this._visualElementGraphics.outline=new $.Z({geometry:e,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.outline),this.internalGraphicsLayer.graphics.sort(O),(0,ot.kB)(()=>{(0,m.pC)(this._visualElementGraphics.outline)&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.outline),this._visualElementGraphics.outline=(0,m.SC)(this._visualElementGraphics.outline))}))}onRegularVerticesChanged(t){const e=new Lt.Z({points:t,spatialReference:this.view.spatialReference});return(0,m.pC)(this._visualElementGraphics.regularVertices)?(this._visualElementGraphics.regularVertices.geometry=e,null):(this._visualElementGraphics.regularVertices=new $.Z({geometry:e,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(O),(0,ot.kB)(()=>{(0,m.pC)(this._visualElementGraphics.regularVertices)&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=(0,m.SC)(this._visualElementGraphics.regularVertices))}))}};function O(t,e){return(t.attributes?.displayOrder??-1/0)-(e.attributes?.displayOrder??-1/0)}(0,x._)([(0,R.Cb)()],d.prototype,"activeFillSymbol",void 0),(0,x._)([(0,R.Cb)({readOnly:!0})],d.prototype,"type",void 0),(0,x._)([(0,R.Cb)({constructOnly:!0,nonNullable:!0})],d.prototype,"view",void 0),d=(0,x._)([(0,st.j)("esri.views.2d.interactive.draw.DrawGraphicTool2D")],d);var G=h(15861),_t=h(91558),q=h(59318),B=h(85453);function tt(t=1){return function H(t,e){const r=new _t.Z(t);return r.a*=e,r}(q.Z.analysisTheme.accentColor,t)}function Pt(t=1){return function F(t,e){const r=t.a*e;return(0,B.EX)(t)>225?new _t.Z([0,0,0,r]):new _t.Z([255,255,255,r])}(tt(),t)}var Tt,t,pt=h(32917),mt=h(55915),bt=h(37053),et=h(51470),xt=h(56445),Ut=h(59617);class Wt{get hovering(){return this.someManipulator(e=>e.hovering)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}hasManipulator(e){return this.someManipulator(r=>r===e)}someManipulator(e){let r=!1;return this.forEachManipulator(f=>{!r&&e(f)&&(r=!0)}),r}}(t=Tt||(Tt={}))[t.TRANSLATE_XY=0]="TRANSLATE_XY",t[t.SCALE=1]="SCALE",t[t.ROTATE=2]="ROTATE";var dt=h(75079),it=h(90585),ut=h(96926),Vt=h(22964);class n extends Wt{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator(r=>this._tool.manipulators.add(r))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(e){e(this._manipulator,Tt.TRANSLATE_XY)}createDragPipeline(e,r){let f=null,a=null,y=0,A=0,T=0;const{offsetX:S,offsetY:W,size:j}=(0,Vt.i)((0,m.Wg)(this._graphic.symbol));return(0,dt.Xd)(this._manipulator,(X,wt)=>{wt.next(Q=>{if("start"===Q.action){const D=e();f=D.editGeometryOperations,a=D.constraints}return Q}).next((0,dt.Cf)(this._view)).next(Q=>{const{x:D,y:K,z:rt}=Q.mapEnd;if(a&&(D+S<a.xmin||K+W-j<a.ymin||D+S>a.xmax||K+W-j>a.ymax))return Q;"start"===Q.action&&(y=Q.mapStart.x,A=Q.mapStart.y,T=Q.mapStart.z);const yt=D-y,jt=K-A,It=rt-T;y=D,A=K,T=rt;const Zt=[];for(const Jt of f.data.components)Zt.push(...Jt.vertices);const Yt=f.moveVertices(Zt,yt,jt,It,"start"===Q.action?ut.O.NEW_STEP:ut.O.ACCUMULATE_STEPS);return r(Q,Yt),Q})})}_createManipulator(){return new it.L({view:this._view,graphic:this._graphic,selectable:!0,cursor:"move"})}}var c=h(25441),v=h(22944),p=h(26777);const u_primaryKey=c.CK,C=new _t.Z("#009AF2");let b=class extends v.m{constructor(t){super(t),this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this._initialControlPoints=null,this._graphicsLayer=new et.Z({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),this._undoStack=[],this._redoStack=[],this._sharedUndoStack=[],this._sharedRedoStack=[],this._highlightHandle=null,this.activeHandle=0}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._controlPointManipulations.forEach(e=>e.destroy()),this._controlPointEditGeometryOperations.forEach(e=>e.destroy()),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,m.SC)(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _hasValidSpatialReference(){return(0,bt.JY)(this.view.spatialReference)}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){const t=this._undoStack[this._undoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canUndo}canRedo(){const t=this._redoStack[this._redoStack.length-1];return null!=t&&this._controlPointEditGeometryOperations[t].canRedo}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();this._controlPointEditGeometryOperations[t].undo(),this.updateGraphics(),this._redoStack.push(t)}}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();this._controlPointEditGeometryOperations[t].redo(),this.updateGraphics(),this._undoStack.push(t)}}refresh(){const{mediaElement:t}=this;if((0,m.Wi)(t.georeference))return;const e=t.georeference;"control-points"!==e.type||(0,m.Wi)(e.coords)||(this._georeference=e,(0,m.Wg)(this._georeference.controlPoints).forEach(({mapPoint:r},f)=>{const a=this._controlPointEditGeometryOperations[f];a.setVertexPosition(a.data.components[0].vertices[0],a.data.coordinateHelper.pointToVector(r))}),this.updateGraphics())}reset(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._georeference,e=(0,m.Wg)(t.controlPoints),r=(0,m.Wg)(e[0].mapPoint).spatialReference,f=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map((a,y)=>{const A=a.data.geometry;return this._controlPointGraphics[y].geometry=A,{mapPoint:(0,mt.iV)(A,r),sourcePoint:f?(0,m.Wg)(e[y]).sourcePoint:t.toSource(A)}})}updateActiveHandle(t){if(this.activeHandle===t)return;const e=(0,m.Wg)(this._controlPointGraphics[this.activeHandle].symbol).clone();(0,xt.ZB)(e,tt()),this._controlPointGraphics[this.activeHandle].symbol=e;const r=(0,m.Wg)(this._controlPointGraphics[t].symbol).clone();(0,xt.ZB)(r,C),this._controlPointGraphics[t].symbol=r,this.activeHandle=t,this.view.surface===document.activeElement&&this.highlightActiveHandle()}highlightActiveHandle(){var t=this;return(0,G.Z)(function*(){t.removeHighlightActiveHandle();const e=yield t.view.whenLayerView(t._graphicsLayer);t._highlightHandle=e.highlight(t._controlPointGraphics[t.activeHandle])})()}removeHighlightActiveHandle(){this._highlightHandle&&this._highlightHandle.remove()}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}_initialize(){var t=this;return(0,G.Z)(function*(){const{view:e,mediaElement:r}=t;if((0,m.Wi)(r.georeference))return;const f=r.georeference;"control-points"!==f.type||(0,m.Wi)(f.coords)||(t._georeference=f,t._initialControlPoints=(0,m.Wg)(t._georeference.controlPoints),e.map.addMany([t._graphicsLayer]),e.focus(),t.visible=!1,t.finishToolCreation(),yield t._loadProjectionEngine(),t._controlPointEditGeometryOperations=(0,m.Wg)(t._georeference.controlPoints).map(({mapPoint:a})=>p.c.fromGeometry((0,mt.iV)(a,e.spatialReference),Ut.JY.Local)),t._controlPointGraphics=t._controlPointEditGeometryOperations.map((a,y)=>new $.Z({symbol:new Gt.Z({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:y===t.activeHandle?C.toArray():tt().toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:a.data.geometry})),t._graphicsLayer.graphics.addMany([...t._controlPointGraphics]),t._controlPointManipulations=t._controlPointGraphics.map(a=>new n({tool:t,view:e,graphic:a})),t.addHandles([...t._controlPointManipulations.map((a,y)=>a.createDragPipeline(t._getInfo.bind(t,y),(A,T)=>{"start"===A.action&&(t._undoStack.push(y),t._redoStack=[],t._sharedUndoStack.push({tool:t,operation:T}),t._sharedRedoStack.length=0),t.updateGraphics()})),(0,pt.YP)(()=>t.view.scale,()=>t.active?t.updateGraphics():null)]),t._controlPointManipulations.forEach((a,y)=>{a.forEachManipulator(T=>{t.addHandles([T.events.on(["click","grab-changed"],S=>t.updateActiveHandle(y))])})}),t.addHandles([e.on("key-down",a=>{e.activeTool===t&&("Shift"!==a.key||a.repeat||(t._isModifierActive=!0,a.stopPropagation()),"t"!==a.key||a.repeat||(r.opacity*=t._isOpacityToggled?2:.5,t._isOpacityToggled=!t._isOpacityToggled,a.stopPropagation()),a.key!==u_primaryKey||a.repeat||(t._factor=10,a.stopPropagation()),t._isModifierActive&&("ArrowUp"===a.key&&(t._move(0,t._factor),a.stopPropagation()),"ArrowDown"===a.key&&(t._move(0,-t._factor),a.stopPropagation()),"ArrowLeft"===a.key&&(t._move(-t._factor,0),a.stopPropagation()),"ArrowRight"===a.key&&(t._move(t._factor,0),a.stopPropagation())))}),e.on("key-up",a=>{e.activeTool===t&&("Shift"===a.key&&(t._isModifierActive=!1,a.stopPropagation()),a.key===u_primaryKey&&(t._factor=1,a.stopPropagation()))})]))})()}_loadProjectionEngine(){var t=this;return(0,G.Z)(function*(){const e=(0,m.Wg)((0,m.Wg)(t._georeference.controlPoints)[0].mapPoint);return(0,mt.iQ)(e.spatialReference,t.view.spatialReference)})()}_getInfo(t){return{editGeometryOperations:this._controlPointEditGeometryOperations[t],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}_move(t,e){const r=this._controlPointEditGeometryOperations[this.activeHandle],f=[];for(const y of r.data.components)f.push(...y.vertices);const a=r.moveVertices(f,t*this.view.resolution,e*this.view.resolution,0,ut.O.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:a}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,x._)([(0,R.Cb)()],b.prototype,"_hasValidSpatialReference",null),(0,x._)([(0,R.Cb)()],b.prototype,"activeHandle",void 0),(0,x._)([(0,R.Cb)({constructOnly:!0,nonNullable:!0})],b.prototype,"mediaElement",void 0),(0,x._)([(0,R.Cb)({constructOnly:!0})],b.prototype,"view",void 0),b=(0,x._)([(0,st.j)("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],b);var k=h(16730),U=h(67831),nt=h(99770),P=h(84161),i=h(28093),s=h(41743),l=h(72392),_=h(21286);function w(t,e){e.cursor="start"===t.action?"grabbing":"grab"}class Z{constructor(){this._lastDragEvent=null,this.next=new dt.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&(0,m.pC)(this._lastDragEvent)){const r={...this._lastDragEvent,action:"update"};e&&this._adjustScaleFactors(r),this.next.execute(r)}this._enabled=e}createDragEventPipelineStep(){return this._lastDragEvent=null,e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustScaleFactors(e),e)}_adjustScaleFactors(e){const r=0!==e.direction[0]&&0!==e.direction[1]?Math.max(Math.abs(e.factor1),Math.abs(e.factor2)):0===e.direction[0]?Math.abs(e.factor2):Math.abs(e.factor1);e.factor1=e.factor1<0?-r:r,e.factor2=e.factor2<0?-r:r}}class Y{constructor(){this._lastDragEvent=null,this.next=new dt.hM,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&(0,m.pC)(this._lastDragEvent)){const r={...this._lastDragEvent,action:"update"};e&&this._adjustRotateAngle(r),this.next.execute(r)}this._enabled=e}createDragEventPipelineStep(){return this._lastDragEvent=null,e=>(this._lastDragEvent="end"!==e.action?{...e}:null,this._enabled&&this._adjustRotateAngle(e),e)}_adjustRotateAngle(e){const r=(0,_.BV)(e.rotateAngle);e.rotateAngle=(0,_.Vl)(5*Math.round(r/5))}}var at=h(36073),z=h(15708),J=h(96792);class te extends Wt{constructor(e){super(),this._handles=new l.Z,this._originCache=(0,i.c)(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._snapRotation=e.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",r=>w(r,this._manipulator))]),this.forEachManipulator(r=>this._tool.manipulators.add(r))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(e){e(this._manipulator,Tt.ROTATE)}createDragPipeline(e,r){let f=null,a=null;return(0,dt.Xd)(this._manipulator,(y,A)=>{A.next(T=>{if("start"===T.action){y.cursor="grabbing";const S=e();f=S.plane,a=S.editGeometryOperations}return T}).next((0,dt.Cf)(this._view)).next(T=>({...T,rotateAngle:(0,at.cM)(T.mapStart,T.mapEnd,{x:f.origin[0],y:f.origin[1]},!0)})).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next(T=>{const S=(0,P.c)(this._originCache,f.origin),W=[];for(const wt of a.data.components)W.push(...wt.vertices);const X=a.rotateVertices(W,S,T.rotateAngle,"start"===T.action?ut.O.NEW_STEP:ut.O.ACCUMULATE_STEPS,z.w.REPLACE);return(0,J.nn)(X,f),r(T,X),T}).next(T=>("end"===T.action&&(y.cursor="grab"),T))})}_createManipulator(){return new it.L({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}function qt(t){const e=(0,P.l)(t.basis1),r=(0,P.l)(t.basis2);return.3*Math.min(e,r)}class ie extends Wt{constructor(e){super(),this._handles=new l.Z,this._planeStart=(0,s.a)(),this._displayPlaneStart=(0,s.a)(),this._originCache=(0,i.c)(),this._axisCache=(0,nt.a)(),this._renderStartCache=(0,i.c)(),this._renderEndCache=(0,i.c)(),this._resizeOriginCache=(0,i.c)(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._direction=e.direction,this._preserveAspectRatio=e.preserveAspectRatio,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",r=>w(r,this._manipulator))]),this.forEachManipulator(r=>this._tool.manipulators.add(r))}destroy(){this._handles.destroy(),this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}forEachManipulator(e){e(this._manipulator,Tt.SCALE)}createDragPipeline(e,r){let f=null,a=null,y=null,A=0,T=null,S=null;const W=this._planeStart,j=this._displayPlaneStart,X=this._direction;return(0,dt.Xd)(this._manipulator,(wt,Q)=>{Q.next(D=>{if("start"===D.action){wt.cursor="grabbing";const K=e();f=K.plane,a=K.displayPlane,y=K.editGeometryOperations,A=10*this._view.resolution,(0,s.c)(f,W),(0,s.c)(a,j);const rt=(0,bt.C5)(y.data.spatialReference);T=rt?rt.valid[1]-rt.valid[0]-30*this._view.resolution:null}return D}).next((0,dt.Cf)(this._view)).next(D=>{const K=(0,P.c)(this._renderStartCache,[D.mapStart.x,D.mapStart.y,0]),rt=(0,P.c)(this._renderEndCache,[D.mapEnd.x,D.mapEnd.y,0]),yt=(0,P.c)(this._resizeOriginCache,j.origin);(0,P.z)(yt,yt,j.basis1,-X[0]),(0,P.z)(yt,yt,j.basis2,-X[1]),(0,P.b)(rt,rt,yt),(0,P.b)(K,K,yt);const jt=0!==X[0]&&0!==X[1],It=qt(j),Zt=qt(a)/It,Ht=(Xt,Qt)=>{if(0===Xt)return 1;let kt=(0,P.l)(Qt),zt=.5*Xt*(0,P.e)(Qt,rt)/kt;const Kt=zt<0?-1:1;jt&&(zt+=(kt-.5*Xt*(0,P.e)(Qt,K)/kt)*Kt*Zt);const _e=kt<1.5*A?1:1e-6;return kt=Math.max(kt-A,1e-6),Kt>0&&(zt-=10*this._view.resolution),Kt*Math.max(Kt*(zt/kt),_e)},Yt=Ht(X[0],j.basis1),Jt=Ht(X[1],j.basis2);return{...D,direction:X,factor1:Yt,factor2:Jt}}).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(D=>{const K=(0,P.c)(this._originCache,W.origin);(0,P.z)(K,K,W.basis1,-X[0]),(0,P.z)(K,K,W.basis2,-X[1]);const rt=(0,U.s)(this._axisCache,W.basis1[0],W.basis1[1]);(0,U.f)(rt,rt);const yt=[];for(const Zt of y.data.components)yt.push(...Zt.vertices);const It=y.scaleVertices(yt,K,rt,D.factor1,D.factor2,"start"===D.action?ut.O.NEW_STEP:ut.O.ACCUMULATE_STEPS,z.w.REPLACE);return T&&T<y.data.geometry.extent.width&&S?y.updateVertices(yt,S):((0,s.c)(W,f),(0,J.nn)(It,f),S=It.operation,r(D,It)),D}).next(D=>("end"===D.action&&(wt.cursor="grab"),D))})}_createManipulator(){return new it.L({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}var oe=h(466),ne=h(69001),ae=h(41900),re=h(37118),se=h(88493);const ft_primaryKey=c.CK,pe=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]];let vt=class extends v.m{constructor(t){super(t),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._planeCache=(0,s.a)(),this._displayPlaneCache=(0,s.a)(),this._mainAxisCache=(0,nt.a)(),this._rotationHandleCache=(0,i.c)(),this._cornerA=(0,i.c)(),this._cornerB=(0,i.c)(),this._cornerC=(0,i.c)(),this._cornerD=(0,i.c)(),this._avgAB=(0,i.c)(),this._avgBC=(0,i.c)(),this._avgCD=(0,i.c)(),this._avgDA=(0,i.c)(),this._preserveAspectRatio=new Z,this._snapRotation=new Y,this._graphicsLayer=new et.Z({internal:!0,listMode:"hide",visible:!1}),this._sharedUndoStack=[],this._sharedRedoStack=[],this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this.preserveAspectRatio=null,this.snapRotation=null}initialize(){this._initialize()}destroy(){const{map:t}=this.view;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach(e=>e.destroy()),this._editGeometryOperations.destroy(),t.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=(0,m.SC)(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _plane(){const t=this._graphic.geometry;if(!(0,m.pC)(t))return null;const e=this._editGeometryOperations.data,r=e.components[0].edges[0],f=(0,U.a)(this._mainAxisCache,r.leftVertex.pos,r.rightVertex.pos);(0,U.f)(f,f);let a=80*this.view.resolution;const y=this.view.spatialReference;return(0,bt.fS)(y,t.spatialReference)&&(a*=(0,k.c9)(y)/(0,k.c9)(t.spatialReference)),(0,J.lv)(f,e,a,this._planeCache)}get _displayPlane(){const t=this._plane;if(!t)return null;const e=this._displayPlaneCache;(0,s.c)(t,e);const r=10*this.view.resolution;return(0,P.g)(e.basis1,e.basis1,1+r/(0,P.l)(e.basis1)),(0,P.g)(e.basis2,e.basis2,1+r/(0,P.l)(e.basis2)),e}get _backgroundGraphicGeometry(){const t=this._displayPlane;if(!t)return null;const e=this.view.spatialReference;return this._updateDisplayPlaneConrers(t),new re.Z({spatialReference:e,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}get _rotateGraphicGeometry(){const t=this._plane;if(!t)return null;const e=this._rotationHandleCache;return(0,P.n)(e,t.basis1),(0,P.g)(e,e,30*this.view.resolution),(0,P.a)(e,e,t.origin),(0,P.a)(e,e,t.basis1),new V.Z({x:e[0],y:e[1],spatialReference:this.view.spatialReference})}get _scaleGraphicGeometries(){const t=this._displayPlane;if(!t)return[];const e=this.view.spatialReference;this._updateDisplayPlaneConrers(t);const{_cornerA:r,_cornerB:f,_cornerC:a,_cornerD:y}=this,A=(0,P.h)(this._avgAB,r,f,.5),T=(0,P.h)(this._avgBC,f,a,.5),S=(0,P.h)(this._avgCD,a,y,.5),W=(0,P.h)(this._avgDA,y,r,.5);return[new V.Z({x:r[0],y:r[1],spatialReference:e}),new V.Z({x:f[0],y:f[1],spatialReference:e}),new V.Z({x:a[0],y:a[1],spatialReference:e}),new V.Z({x:y[0],y:y[1],spatialReference:e}),new V.Z({x:A[0],y:A[1],spatialReference:e}),new V.Z({x:T[0],y:T[1],spatialReference:e}),new V.Z({x:S[0],y:S[1],spatialReference:e}),new V.Z({x:W[0],y:W[1],spatialReference:e})]}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this._editGeometryOperations.undo(),this.updateGraphics()}redo(){this._editGeometryOperations.redo(),this.updateGraphics()}refresh(){const{view:t,target:e}=this,r="georeference"in e?(0,m.Wg)((0,m.Wg)(e.georeference).coords):e.geometry,f=this._editGeometryOperations,a=f.data.components[0].vertices,y=oe.XE.fromGeometry((0,mt.iV)(r,t.spatialReference),Ut.JY.Local).components[0].vertices;a.forEach((A,T)=>{f.setVertexPosition(A,y[T].pos)}),this.updateGraphics()}reset(){const{target:t}=this;if("georeference"in t){const e=(0,m.Wg)(t.georeference);"control-points"===e.type&&(e.controlPoints=this._initialControlPoints)}else t.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const t=this._editGeometryOperations.data.geometry;"georeference"in this.target&&((0,m.Wg)(this.target.georeference).coords=t),this._graphic.geometry=t,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach((e,r)=>{this._scaleGraphics[r].geometry=e})}setSharedUndoStack(t){this._sharedUndoStack=t}setSharedRedoStack(t){this._sharedRedoStack=t}_initialize(){var t=this;return(0,G.Z)(function*(){const{view:e,target:r}=t;if("georeference"in r){const a=(0,m.Wg)(r.georeference);t._graphic=new $.Z({geometry:(0,m.Wg)(a.coords)}),t._initialControlPoints="control-points"===a.type?a.controlPoints:null}else t._graphic=r,t._initialGeometry=(0,m.Wg)(r.geometry);e.map.addMany([t._graphicsLayer]),e.focus(),t.visible=!1,t.finishToolCreation(),yield t._loadProjectionEngine(),t._editGeometryOperations=p.c.fromGeometry((0,mt.iV)(t._graphic.geometry,e.spatialReference),Ut.JY.Local),t._backgroundGraphic=new $.Z({symbol:new se.Z({color:"transparent",outline:{type:"simple-line",color:tt(),width:2}}),geometry:t._backgroundGraphicGeometry}),t._rotateGraphic=new $.Z({symbol:new ct.Z({color:Pt(),outline:{type:"simple-line",color:tt(),width:1}}),geometry:t._rotateGraphicGeometry}),t._scaleGraphics=t._scaleGraphicGeometries.map(a=>new $.Z({symbol:new ct.Z({size:6,style:"square",color:Pt(),outline:{type:"simple-line",color:tt(),width:1}}),geometry:a})),t._graphicsLayer.graphics.addMany([t._backgroundGraphic,t._rotateGraphic,...t._scaleGraphics]),t._dragManipulation=new n({tool:t,view:e,graphic:t._graphic}),t._rotateManipulation=new te({tool:t,view:e,graphic:t._rotateGraphic,snapRotation:t._snapRotation}),t._scaleManipulations=t._scaleGraphics.map((a,y)=>new ie({tool:t,view:e,graphic:a,direction:pe[y],preserveAspectRatio:t._preserveAspectRatio})),t.addHandles([t._dragManipulation.createDragPipeline(t._getInfo.bind(t),t._updateGraphics.bind(t)),t._rotateManipulation.createDragPipeline(t._getInfo.bind(t),t._updateGraphics.bind(t)),...t._scaleManipulations.map(a=>a.createDragPipeline(t._getInfo.bind(t),t._updateGraphics.bind(t))),(0,pt.YP)(()=>t.view.scale,()=>t.active?t.updateGraphics():null),e.on("click",function(){var a=(0,G.Z)(function*(y){if(null!=e.activeTool&&e.activeTool!==t)return;const A=(0,ae.vT)(y),T=[];e.map.allLayers.forEach(j=>{"vector-tile"!==j.type&&"imagery"!==j.type||T.push(j)});const S=yield t.view.hitTest(A,{exclude:T}),W=S.results;if(0===W.length)e.activeTool=null;else{const j=(0,ne.qm)(S.results),X="georeference"in r,wt=W.map(D=>"media"===D.type?D.element:null).filter(Boolean),Q=[...t._graphicsLayer.graphics,X?null:r].filter(Boolean);X&&wt.includes(r)||(0,m.pC)(j)&&Q.includes(j.graphic)?null==e.activeTool&&(e.activeTool=t):e.activeTool=null}});return function(y){return a.apply(this,arguments)}}())]);const f=a=>{t.addHandles(a.events.on("grab-changed",y=>{"georeference"in r&&("start"===y.action?r.opacity*=.5:"end"===y.action&&(r.opacity*=2))}))};t._dragManipulation.forEachManipulator(f),t._rotateManipulation.forEachManipulator(f),t._scaleManipulations.forEach(a=>a.forEachManipulator(f)),t.addHandles([e.on("key-down",a=>{e.activeTool===t&&("Shift"!==a.key||a.repeat||(null==t.preserveAspectRatio&&(t._preserveAspectRatio.enabled=!t._preserveAspectRatio.enabled),null==t.snapRotation&&(t._snapRotation.enabled=!t._snapRotation.enabled),t._isModifierActive=!0,a.stopPropagation()),"t"!==a.key||a.repeat||("georeference"in r&&(r.opacity*=t._isOpacityToggled?2:.5,t._isOpacityToggled=!t._isOpacityToggled),a.stopPropagation()),a.key!==ft_primaryKey||a.repeat||(t._factor=10,a.stopPropagation()),t._isModifierActive&&("+"===a.key&&(t._scale(t._factor),a.stopPropagation()),"-"===a.key&&(t._scale(-t._factor),a.stopPropagation()),"ArrowUp"===a.key&&(t._move(0,t._factor),a.stopPropagation()),"ArrowDown"===a.key&&(t._move(0,-t._factor),a.stopPropagation()),"ArrowLeft"===a.key&&(t._move(-t._factor,0),a.stopPropagation()),"ArrowRight"===a.key&&(t._move(t._factor,0),a.stopPropagation())))}),e.on("key-up",a=>{e.activeTool===t&&("Shift"===a.key&&(null==t.preserveAspectRatio&&(t._preserveAspectRatio.enabled=!t._preserveAspectRatio.enabled),null==t.snapRotation&&(t._snapRotation.enabled=!t._snapRotation.enabled),t._isModifierActive=!1,a.stopPropagation()),a.key===ft_primaryKey&&(t._factor=1,a.stopPropagation()))})])})()}_loadProjectionEngine(){var t=this;return(0,G.Z)(function*(){const e=(0,m.Wg)(t._graphic.geometry);return(0,mt.iQ)(e.spatialReference,t.view.spatialReference)})()}_updateDisplayPlaneConrers(t){const{basis1:e,basis2:r,origin:f}=t,a=this._cornerA;(0,P.a)(a,f,e),(0,P.a)(a,a,r);const y=this._cornerB;(0,P.a)(y,f,e),(0,P.b)(y,y,r);const A=this._cornerC;(0,P.b)(A,f,e),(0,P.b)(A,A,r);const T=this._cornerD;(0,P.b)(T,f,e),(0,P.a)(T,T,r)}_getInfo(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}_updateGraphics(t,e){"start"===t.action&&(this._sharedUndoStack.push({tool:this,operation:e}),this._sharedRedoStack.length=0),this.updateGraphics()}_scale(t){const e=this._editGeometryOperations,r=[];for(const A of e.data.components)r.push(...A.vertices);const f=e.data.geometry.extent?.width,a=(f+t*this.view.resolution)/f,y=e.scaleVertices(r,this._plane.origin,nt.U,a,a,ut.O.NEW_STEP,z.w.REPLACE);this._sharedUndoStack.push({tool:this,operation:y}),this._sharedRedoStack.length=0,this.updateGraphics()}_move(t,e){const r=this._editGeometryOperations,f=[];for(const y of r.data.components)f.push(...y.vertices);const a=r.moveVertices(f,t*this.view.resolution,e*this.view.resolution,0,ut.O.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:a}),this._sharedRedoStack.length=0,this.updateGraphics()}};(0,x._)([(0,R.Cb)()],vt.prototype,"_plane",null),(0,x._)([(0,R.Cb)()],vt.prototype,"_backgroundGraphicGeometry",null),(0,x._)([(0,R.Cb)()],vt.prototype,"_rotateGraphicGeometry",null),(0,x._)([(0,R.Cb)()],vt.prototype,"_scaleGraphicGeometries",null),(0,x._)([(0,R.Cb)()],vt.prototype,"preserveAspectRatio",void 0),(0,x._)([(0,R.Cb)()],vt.prototype,"snapRotation",void 0),(0,x._)([(0,R.Cb)({constructOnly:!0,nonNullable:!0})],vt.prototype,"target",void 0),(0,x._)([(0,R.Cb)({constructOnly:!0})],vt.prototype,"view",void 0),vt=(0,x._)([(0,st.j)("esri.views.2d.interactive.editingTools.TransformTool")],vt);var ge=h(14517);let Rt=class extends ge.Z{constructor(t){super(t),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=[],this._sharedRedoStack=[],this._originalOpacity=null,this.activeHandle=0}initialize(){var t=this;const{view:e,mediaElement:r,preserveAspectRatio:f,snapRotation:a,advancedMode:y}=this;this._originalOpacity=r.opacity,this._transformTool=new vt({target:r,view:e,preserveAspectRatio:f,snapRotation:a}),this._controlPointsTransformTool=new b({mediaElement:r,view:e}),this._advancedModeTransformTool=new b({mediaElement:y.mediaElement,view:y.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const A=(0,m.Wg)(r.georeference),T=(0,m.Wg)(y.mediaElement.georeference);y.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in T&&"controlPoints"in A&&this.addHandles([y.view.on("key-down",S=>{"z"===S.key&&this.canUndo()&&(this.undo(),S.stopPropagation()),"r"===S.key&&this.canRedo()&&(this.redo(),S.stopPropagation())}),y.view.on("focus",function(){var S=(0,G.Z)(function*(W){t._controlPointsTransformTool.removeHighlightActiveHandle(),t._advancedModeTransformTool.highlightActiveHandle()});return function(W){return S.apply(this,arguments)}}()),(0,pt.YP)(()=>T.controlPoints,S=>{A.controlPoints=(0,m.Wg)(S).map(({sourcePoint:W},j)=>({sourcePoint:W,mapPoint:(0,m.Wg)(A.controlPoints)[j].mapPoint})),this._activeTool?.refresh()}),(0,pt.YP)(()=>this._controlPointsTransformTool.activeHandle,S=>{this._advancedModeTransformTool.updateActiveHandle(S),this.activeHandle=S}),(0,pt.YP)(()=>this._advancedModeTransformTool.activeHandle,S=>{this._controlPointsTransformTool.updateActiveHandle(S),this.activeHandle=S})]),this.addHandles([e.on("key-down",S=>{"z"===S.key&&this.canUndo()&&(this.undo(),S.stopPropagation()),"r"===S.key&&this.canRedo()&&(this.redo(),S.stopPropagation())}),e.on("focus",function(){var S=(0,G.Z)(function*(W){t._advancedModeTransformTool.removeHighlightActiveHandle(),t._controlPointsTransformTool.highlightActiveHandle()});return function(W){return S.apply(this,arguments)}}())]),e.tools.addMany([this._transformTool,this._controlPointsTransformTool]),e.activeTool=this._transformTool,this._activeTool=this._transformTool,e.focus()}destroy(){this._transformTool?.destroy(),this._controlPointsTransformTool?.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}canUndo(){return this._sharedUndoStack.length>0}canRedo(){return this._sharedRedoStack.length>0}undo(){if(this._sharedUndoStack.length>0){const{tool:t,operation:e}=this._sharedUndoStack.pop();t!==this._activeTool&&t.refresh(),e.undo(),t.updateGraphics(),this._sharedRedoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}redo(){if(this._sharedRedoStack.length>0){const{tool:t,operation:e}=this._sharedRedoStack.pop();t!==this._activeTool&&t.refresh(),e.apply(),t.updateGraphics(),this._sharedUndoStack.push({tool:t,operation:e}),this._activeTool!==t&&this._activeTool?.refresh()}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}enableAdvancedMode(){var t=this;return(0,G.Z)(function*(){t.view.activeTool=t._controlPointsTransformTool,t._activeTool=t._controlPointsTransformTool,t._activeTool.refresh(),yield t.advancedMode.view.when(),t.advancedMode.view.activeTool=t._advancedModeTransformTool,t._originalOpacity=t._controlPointsTransformTool.mediaElement.opacity,t._controlPointsTransformTool.mediaElement.opacity=.25*t._originalOpacity})()}disableAdvancedMode(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};(0,x._)([(0,R.Cb)()],Rt.prototype,"activeHandle",void 0),(0,x._)([(0,R.Cb)({constructOnly:!0})],Rt.prototype,"advancedMode",void 0),(0,x._)([(0,R.Cb)()],Rt.prototype,"preserveAspectRatio",void 0),(0,x._)([(0,R.Cb)()],Rt.prototype,"snapRotation",void 0),(0,x._)([(0,R.Cb)({constructOnly:!0,nonNullable:!0})],Rt.prototype,"mediaElement",void 0),(0,x._)([(0,R.Cb)({constructOnly:!0})],Rt.prototype,"view",void 0),Rt=(0,x._)([(0,st.j)("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],Rt)}}]);
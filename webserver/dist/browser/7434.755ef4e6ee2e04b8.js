"use strict";(self.webpackChunkparcel_app=self.webpackChunkparcel_app||[]).push([[7434],{67434:(v,E,r)=>{r.r(E),r.d(E,{default:()=>B});var h=r(15861),p=r(17626),c=(r(8314),r(62208)),u=(r(63290),r(90912),r(85931),r(26584),r(76898)),C=r(84682),I=r(36859),R=r(39351),j=r(13112),i=r(55376);class l{constructor(t,o){this.offset=t,this.extent=o}}let O=class extends j.Z{constructor(){super(...arguments),this.type="heatmap",this._tileKeyToFeatureSets=new Map}initialize(){this.handles.add([this.tileStore.on("update",this.onTileUpdate.bind(this))])}update(_,t){var o=this;return(0,h.Z)(function*(){const s=t.schema.processors[0];"heatmap"===s.type&&(0,C.Hg)(o._schema,s)&&(_.mesh=!0,o._schema=s)})()}onTileUpdate(_){for(const t of _.removed)this._tileKeyToFeatureSets.delete(t.key.id)}onTileClear(_){return this._tileKeyToFeatureSets.delete(_.key.id),this.remoteClient.invoke("tileRenderer.onTileData",{tileKey:_.id,data:{clear:!0}})}onTileMessage(_,t,o){var s=this;return(0,h.Z)(function*(){s._tileKeyToFeatureSets.has(_.key.id)||s._tileKeyToFeatureSets.set(_.key.id,new Map);const e=s._tileKeyToFeatureSets.get(_.key.id);if(e&&(0,c.pC)(t.addOrUpdate)&&t.addOrUpdate.hasFeatures&&e.set(t.addOrUpdate.instance,t),t.end){const a=[],U=function L(_){const t=_.key,o=new Map,s=256,e=R.I_,a=_.tileInfoView.tileInfo.isWrappable;return o.set((0,i.M)(t,-1,-1,a).id,new l([-e,-e],[e-s,e-s,e,e])),o.set((0,i.M)(t,0,-1,a).id,new l([0,-e],[0,e-s,e,e])),o.set((0,i.M)(t,1,-1,a).id,new l([e,-e],[0,e-s,s,e])),o.set((0,i.M)(t,-1,0,a).id,new l([-e,0],[e-s,0,e,e])),o.set((0,i.M)(t,1,0,a).id,new l([e,0],[0,0,s,e])),o.set((0,i.M)(t,-1,1,a).id,new l([-e,e],[e-s,0,e,s])),o.set((0,i.M)(t,0,1,a).id,new l([0,e],[0,0,e,s])),o.set((0,i.M)(t,1,1,a).id,new l([e,e],[0,0,s,s])),o}(_);s._tileKeyToFeatureSets.forEach((m,P)=>{if(P===_.key.id)m.forEach(T=>(0,c.yw)(T.addOrUpdate,D=>a.push(D)));else if(U.has(P)){const T=U.get(P),[D,w]=T.offset;m.forEach(S=>(0,c.yw)(S.addOrUpdate,g=>{const F=g.transform(D,w,1,1);a.push(F)}))}});const K=(0,I.QM)(a,s._schema.mesh,512,512);return s.remoteClient.invoke("tileRenderer.onTileData",{tileKey:_.key.id,intensityInfo:K},{...o,transferList:[K.matrix]})}})()}onTileError(_,t,o){return this.remoteClient.invoke("tileRenderer.onTileError",{tileKey:_.id,error:t},o)}};O=(0,p._)([(0,u.j)("esri.views.2d.layers.features.processors.HeatmapProcessor")],O);const B=O},55376:(v,E,r)=>{function h(p,f,c,y){const n=p.clone(),M=1<<n.level,d=n.col+f,u=n.row+c;return y&&d<0?(n.col=d+M,n.world-=1):d>=M?(n.col=d-M,n.world+=1):n.col=d,n.row=u,n}r.d(E,{M:()=>h})}}]);
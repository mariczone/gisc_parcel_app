"use strict";(self.webpackChunkparcel_app=self.webpackChunkparcel_app||[]).push([[3705],{17196:(D,f,s)=>{s.d(f,{V:()=>m});var i=s(15861),y=s(45205);function m(_,h){return c.apply(this,arguments)}function c(){return(c=(0,i.Z)(function*(_,h){const g=yield(0,y.T)(_,h);g.layers=g.layers.filter(u);const E={serviceJSON:g};if((g.currentVersion??0)<10.5)return E;const P=yield(0,y.T)(_+"/layers",h);return E.layersJSON={layers:P.layers.filter(u),tables:P.tables},E})).apply(this,arguments)}function u(_){return!_.type||"Feature Layer"===_.type}},88755:(D,f,s)=>{s.d(f,{Y:()=>c,h:()=>m});var i=s(21726),y=s(84687);function m(u){return{origin:"portal-item",url:(0,i.mN)(u.itemUrl),portal:u.portal||y.Z.getDefault(),portalItem:u,readResourcePaths:[]}}function c(u){return{origin:"portal-item",messages:[],writtenProperties:[],url:u.itemUrl?(0,i.mN)(u.itemUrl):null,portal:u.portal||y.Z.getDefault(),portalItem:u}}},83705:(D,f,s)=>{s.r(f),s.d(f,{getFirstLayerOrTableId:()=>W,getNumLayersAndTables:()=>I,getSubtypeGroupLayerIds:()=>U,load:()=>Z,preprocessFSItemData:()=>K});var i=s(15861),y=s(26584),m=s(44917),c=s(38305),u=s(17196),_=s(84687),h=s(55463),g=s(88755),E=s(37281),P=s(39683),R=s(45205);function Z(e,r){return L.apply(this,arguments)}function L(){return(L=(0,i.Z)(function*(e,r){const t=e.instance.portalItem;if(t&&t.id)return yield t.load(r),F(e),w(e,r)})).apply(this,arguments)}function F(e){const r=e.instance.portalItem;if(!r?.type||!e.supportedTypes.includes(r.type))throw new y.Z("portal:invalid-layer-item-type","Invalid layer item type '${type}', expected '${expectedType}'",{type:r?.type,expectedType:e.supportedTypes.join(", ")})}function w(e,r){return O.apply(this,arguments)}function O(){return(O=(0,i.Z)(function*(e,r){const t=e.instance,a=t.portalItem;if(!a)return;const{url:l,title:o}=a,n=(0,g.h)(a);if("group"===t.type)return t.read({title:o},n),G(t,e);l&&t.read({url:l},n);const p=yield B(e,r);return p&&t.read(p,n),t.resourceReferences={portalItem:a,paths:n.readResourcePaths??[]},"subtype-group"!==t.type&&t.read({title:o},n),(0,P.y)(t,n)})).apply(this,arguments)}function G(e,r){return M.apply(this,arguments)}function M(){return(M=(0,i.Z)(function*(e,r){let t;const{portalItem:a}=e;if(!a)return;const l=a.type,o=r.layerModuleTypeMap,n=(0,E._$)(a,"Oriented Imagery Layer")??!1;switch(l){case"Feature Service":t=n?o.OrientedImageryLayer:o.FeatureLayer;break;case"Stream Service":t=o.StreamLayer;break;case"Scene Service":t=o.SceneLayer;break;case"Feature Collection":t=o.FeatureLayer;break;default:throw new y.Z("portal:unsupported-item-type-as-group",`The item type '${l}' is not supported as a 'IGroupLayer'`)}let[p,d]=yield Promise.all([t(),B(r)]),T=()=>p;if("Feature Service"===l){if(d=a.url?yield K(d,a.url):{},U(d).length){const H=o.SubtypeGroupLayer,Q=yield H();T=X=>"SubtypeGroupLayer"===X.layerType?Q:p}return b(e,T,d,yield z(a.url))}return I(d)>0?b(e,T,d):N(e,T)})).apply(this,arguments)}function N(e,r){return v.apply(this,arguments)}function v(){return(v=(0,i.Z)(function*(e,r){const{portalItem:t}=e;if(!t?.url)return;const a=yield(0,R.T)(t.url);a&&b(e,r,{layers:a.layers?.map(x),tables:a.tables?.map(x)})})).apply(this,arguments)}function x(e){return{id:e.id,name:e.name}}function b(e,r,t,a){let l=t.layers||[];const o=t.tables||[];if("Feature Collection"===e.portalItem?.type&&(l.forEach(n=>{"Table"===n?.layerDefinition?.type&&o.push(n)}),l=l.filter(n=>"Table"!==n?.layerDefinition?.type)),"coverage"in t){const n=function V(e){const{coverage:r}=e;if(!r)return null;const t=new URL(r);if(r.toLowerCase().includes("item.html")){const a=t.searchParams.get("id");return m.Z.fromPortalItem({portalItem:new h.default({id:a,url:t.origin})})}if((0,c.B5)(r))return m.Z.fromArcGISServerUrl({url:r});throw new y.Z("portal:oriented-imagery-layer-coverage","the provided coverage url couldn't be loaded as a layer")}(t);n&&e.add(n)}l.reverse().forEach(n=>{const p=A(e,r(n),t,n,a?.(n));e.add(p)}),o.reverse().forEach(n=>{const p=A(e,r(n),t,n,a?.(n));e.tables.add(p)})}function A(e,r,t,a,l){const o=e.portalItem,n=new r({portalItem:o.clone(),layerId:a.id});if("sourceJSON"in n&&(n.sourceJSON=l),"subtype-group"!==n.type&&(n.sublayerTitleMode="service-name"),"Feature Collection"===o.type){const p={origin:"portal-item",portal:o.portal||_.Z.getDefault()};n.read(a,p);const d=t.showLegend;null!=d&&n.read({showLegend:d},p)}return n}function B(e,r){return C.apply(this,arguments)}function C(){return(C=(0,i.Z)(function*(e,r){if(!1===e.supportsData)return;const t=e.instance,a=t.portalItem;if(!a)return;let l=null;try{l=yield a.fetchData("json",r)}catch{}if($(t)){let o=null,n=!0;if(l&&I(l)>0){if(null==t.layerId){const p=U(l);t.layerId="subtype-group"===t.type?p?.[0]:W(l)}o=J(l,t),o&&(1===I(l)&&(n=!1),null!=l.showLegend&&(o.showLegend=l.showLegend))}return n&&"service-name"!==t.sublayerTitleMode&&(t.sublayerTitleMode="item-title-and-service-name"),o}return l})).apply(this,arguments)}function K(e,r){return j.apply(this,arguments)}function j(){return(j=(0,i.Z)(function*(e,r){if(null==e?.layers||null==e?.tables){const t=yield(0,R.T)(r);(e=e||{}).layers=e.layers||t?.layers,e.tables=e.tables||t?.tables}return e})).apply(this,arguments)}function W(e){const r=e.layers;if(r&&r.length)return r[0].id;const t=e.tables;return t&&t.length?t[0].id:null}function J(e,r){const{layerId:t}=r,a=e.layers?.find(l=>l.id===t)||e.tables?.find(l=>l.id===t);return a&&function Y(e,r){return!("feature"===r.type&&"layerType"in e&&"SubtypeGroupLayer"===e.layerType||"subtype-group"===r.type&&!("layerType"in e))}(a,r)?a:null}function I(e){return(e?.layers?.length??0)+(e?.tables?.length??0)}function $(e){return"stream"!==e.type&&"oriented-imagery"!==e.type&&"layerId"in e}function U(e){const r=[];return e?.layers?.forEach(t=>{"SubtypeGroupLayer"===t.layerType&&r.push(t.id)}),r}function z(e){return S.apply(this,arguments)}function S(){return(S=(0,i.Z)(function*(e){const{layersJSON:r}=yield(0,u.V)(e);if(!r)return null;const t=[...r.layers,...r.tables];return a=>t.find(l=>l.id===a.id)})).apply(this,arguments)}},45205:(D,f,s)=>{s.d(f,{T:()=>m});var i=s(15861),y=s(84792);function m(u,_){return c.apply(this,arguments)}function c(){return(c=(0,i.Z)(function*(u,_){const{data:h}=yield(0,y.default)(u,{responseType:"json",query:{f:"json",..._?.customParameters,token:_?.apiKey}});return h})).apply(this,arguments)}}}]);
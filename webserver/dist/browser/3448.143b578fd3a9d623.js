"use strict";(self.webpackChunkparcel_app=self.webpackChunkparcel_app||[]).push([[3448],{34013:(hi,vt,oe)=>{oe.d(vt,{I:()=>et,b:()=>$e});var ce=oe(62208),we=oe(99770),ae=oe(13934),ve=oe(78925),ue=oe(24255),ht=oe(10109),rt=oe(67022),Ze=oe(33726),de=oe(99198),me=oe(95285),Ge=oe(65787),Be=oe(17625),Te=oe(22355),ct=oe(35387),ut=oe(44835),St=oe(16396);function $e(tt){const Ae=new Te.kG,{vertex:Ee,fragment:xe}=Ae;return(0,de.Sv)(Ee,tt),Ae.include(ue.w,tt),Ae.attributes.add(St.T.POSITION,"vec3"),Ae.attributes.add(St.T.UV0,"vec2"),Ae.varyings.add("vpos","vec3"),tt.hasMultipassTerrain&&Ae.varyings.add("depth","float"),Ee.uniforms.add(new me.A("textureCoordinateScaleFactor",We=>(0,ce.pC)(We.texture)&&(0,ce.pC)(We.texture.descriptor.textureCoordinateScaleFactor)?We.texture.descriptor.textureCoordinateScaleFactor:we.O)),Ee.code.add(Be.H`
    void main(void) {
      vpos = position;
      ${tt.hasMultipassTerrain?"depth = (view * vec4(vpos, 1.0)).z;":""}
      vTexCoord = uv0 * textureCoordinateScaleFactor;
      gl_Position = transformPosition(proj, view, vpos);
    }
  `),Ae.include(ve.f5,tt),Ae.include(ht.l,tt),xe.uniforms.add([new ct.A("tex",We=>We.texture),new Ge.p("opacity",We=>We.opacity)]),Ae.varyings.add("vTexCoord","vec2"),tt.output===ae.H.Alpha?xe.code.add(Be.H`
    void main() {
      discardBySlice(vpos);
      ${tt.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

      float alpha = texture2D(tex, vTexCoord).a * opacity;
      if (alpha  < ${Be.H.float(rt.F)}) {
        discard;
      }

      gl_FragColor = vec4(alpha);
    }
    `):(xe.include(Ze.Y),xe.code.add(Be.H`
    void main() {
      discardBySlice(vpos);
      ${tt.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
      gl_FragColor = texture2D(tex, vTexCoord) * opacity;

      if (gl_FragColor.a < ${Be.H.float(rt.F)}) {
        discard;
      }

      gl_FragColor = highlightSlice(gl_FragColor, vpos);
      ${tt.transparencyPassType===ut.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}
    }
    `)),Ae}const et=Object.freeze(Object.defineProperty({__proto__:null,build:$e},Symbol.toStringTag,{value:"Module"}))},9088:(hi,vt,oe)=>{oe.d(vt,{L:()=>ut,b:()=>Be});var ce=oe(28347),we=oe(43703),ae=oe(67831),ve=oe(99770),ue=oe(47634),ht=oe(95285),rt=oe(65787),Ze=oe(17625),de=oe(63123),me=oe(22355),Ge=oe(16396);function Be(St){const $e=new me.kG;$e.include(ue.j,St);const{vertex:et,fragment:tt}=$e;return et.uniforms.add([new de.g("modelView",(Ae,Ee)=>(0,ce.w)(ct,Ee.camera.viewMatrix,Ae.origin)),new de.g("proj",(Ae,Ee)=>Ee.camera.projectionMatrix),new rt.p("glowWidth",(Ae,Ee)=>Ae.glowWidth*Ee.camera.pixelRatio),new ht.A("pixelToNDC",(Ae,Ee)=>(0,ae.s)(Te,2/Ee.camera.fullViewport[2],2/Ee.camera.fullViewport[3]))]),$e.attributes.add(Ge.T.START,"vec3"),$e.attributes.add(Ge.T.END,"vec3"),$e.attributes.add(Ge.T.UP,"vec3"),$e.attributes.add(Ge.T.EXTRUDE,"vec2"),$e.varyings.add("uv","vec2"),$e.varyings.add("vViewStart","vec3"),$e.varyings.add("vViewEnd","vec3"),$e.varyings.add("vViewPlane","vec4"),et.code.add(Ze.H`void main() {
vec3 pos = mix(start, end, extrude.x);
vec4 viewPos = modelView * vec4(pos, 1);
vec4 projPos = proj * viewPos;
vec2 ndcPos = projPos.xy / projPos.w;
vec3 viewUp = (modelView * vec4(extrude.y * up, 0)).xyz;
vec4 projPosUp = proj * vec4(viewPos.xyz + viewUp, 1);
vec2 projExtrudeDir = normalize(projPosUp.xy / projPosUp.w - ndcPos);
vec2 lxy = abs(sign(projExtrudeDir) - ndcPos);
ndcPos += length(lxy) * projExtrudeDir;
vec3 worldPlaneNormal = normalize(cross(up, normalize(end - start)));
vec3 viewPlaneNormal = (modelView * vec4(worldPlaneNormal, 0)).xyz;
vViewStart = (modelView * vec4(start, 1)).xyz;
vViewEnd = (modelView * vec4(end, 1)).xyz;
vViewPlane = vec4(viewPlaneNormal, -dot(viewPlaneNormal, vViewStart));
float xPaddingPixels = sign(dot(viewPlaneNormal, viewPos.xyz)) * (extrude.x * 2.0 - 1.0) * glowWidth;
ndcPos.x += xPaddingPixels * pixelToNDC.x;
uv = ndcPos * 0.5 + 0.5;
gl_Position = vec4(ndcPos, 0, 1);
}`),tt.uniforms.add(new rt.p("perScreenPixelRatio",(Ae,Ee)=>Ee.camera.perScreenPixelRatio)),tt.code.add(Ze.H`float planeDistancePixels(vec4 plane, vec3 pos, vec3 start, vec3 end) {
vec3 origin = mix(start, end, 0.5);
vec3 basis = end - origin;
vec3 posAtOrigin = pos - origin;
float x = dot(normalize(basis), posAtOrigin);
float y = dot(plane.xyz, posAtOrigin);
float dx = max(abs(x) - length(basis), 0.0);
float dy = y;
float dist = length(vec2(dx, dy));
float width = fwidth(y);
float maxPixelDistance = length(pos) * perScreenPixelRatio * 2.0;
float pixelDist = dist / min(width, maxPixelDistance);
return abs(pixelDist);
}
void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
float distance = planeDistancePixels(vViewPlane, pos, vViewStart, vViewEnd);
vec4 color = laserlineProfile(distance);
float alpha = 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, vViewPlane.xyz)));
gl_FragColor = laserlineOutput(color * alpha * depthDiscontinuityAlpha);
}`),$e}const Te=(0,ve.a)(),ct=(0,we.c)(),ut=Object.freeze(Object.defineProperty({__proto__:null,build:Be},Symbol.toStringTag,{value:"Module"}))},66501:(hi,vt,oe)=>{oe.d(vt,{L:()=>Ra,b:()=>Ae,d:()=>tt});var ce=oe(21286),we=oe(67831),ae=oe(99770),ve=oe(84161),ue=oe(28093),ht=oe(993),rt=oe(4794),Ze=oe(10992),de=oe(90014),me=oe(97126),Ge=oe(47634),Be=oe(39523),Te=oe(95285),ct=oe(97139),ut=oe(69960),St=oe(65787),$e=oe(17625),et=oe(22355);const tt=(0,ce.Vl)(6);function Ae(Ke){const Rt=new et.kG;Rt.extensions.add("GL_OES_standard_derivatives"),Rt.include(Be.k),Rt.include(Ge.j,Ke);const He=Rt.fragment;if(Ke.lineVerticalPlaneEnabled||Ke.heightManifoldEnabled)if(He.uniforms.add(new St.p("maxPixelDistance",(ke,it)=>Ke.heightManifoldEnabled?2*it.camera.computeScreenPixelSizeAt(ke.heightManifoldTarget):2*it.camera.computeScreenPixelSizeAt(ke.lineVerticalPlaneSegment.origin))),He.code.add($e.H`float planeDistancePixels(vec4 plane, vec3 pos) {
float dist = dot(plane.xyz, pos) + plane.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`),Ke.spherical){const ke=(pt,_t,Ni)=>(0,ve.m)(pt,_t.heightManifoldTarget,Ni.camera.viewMatrix),it=(pt,_t)=>(0,ve.m)(pt,[0,0,0],_t.camera.viewMatrix);He.uniforms.add([new ut.N("heightManifoldOrigin",(pt,_t)=>(ke(ii,pt,_t),it(Ti,_t),(0,ve.b)(Ti,Ti,ii),(0,ve.n)(jt,Ti),jt[3]=(0,ve.l)(Ti),jt)),new ct.J("globalOrigin",(pt,_t)=>it(ii,_t)),new St.p("cosSphericalAngleThreshold",(pt,_t)=>1-Math.max(2,(0,ve.i)(_t.camera.eye,pt.heightManifoldTarget)*_t.camera.perRenderPixelRatio)/(0,ve.l)(pt.heightManifoldTarget))]),He.code.add($e.H`float globeDistancePixels(float posInGlobalOriginLength) {
float dist = abs(posInGlobalOriginLength - heightManifoldOrigin.w);
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}
float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
vec3 posInGlobalOriginNorm = normalize(globalOrigin - pos);
float cosAngle = dot(posInGlobalOriginNorm, heightManifoldOrigin.xyz);
vec3 posInGlobalOrigin = globalOrigin - pos;
float posInGlobalOriginLength = length(posInGlobalOrigin);
float sphericalDistance = globeDistancePixels(posInGlobalOriginLength);
float planarDistance = planeDistancePixels(heightPlane, pos);
return cosAngle < cosSphericalAngleThreshold ? sphericalDistance : planarDistance;
}`)}else He.code.add($e.H`float heightManifoldDistancePixels(vec4 heightPlane, vec3 pos) {
return planeDistancePixels(heightPlane, pos);
}`);if(Ke.pointDistanceEnabled&&(He.uniforms.add(new St.p("maxPixelDistance",(ke,it)=>2*it.camera.computeScreenPixelSizeAt(ke.pointDistanceTarget))),He.code.add($e.H`float sphereDistancePixels(vec4 sphere, vec3 pos) {
float dist = distance(sphere.xyz, pos) - sphere.w;
float width = fwidth(dist);
dist /= min(width, maxPixelDistance);
return abs(dist);
}`)),Ke.intersectsLineEnabled&&(He.uniforms.add(new St.p("perScreenPixelRatio",(ke,it)=>it.camera.perScreenPixelRatio)),He.code.add($e.H`float lineDistancePixels(vec3 start, vec3 dir, float radius, vec3 pos) {
float dist = length(cross(dir, pos - start)) / (length(pos) * perScreenPixelRatio);
return abs(dist) - radius;
}`)),(Ke.lineVerticalPlaneEnabled||Ke.intersectsLineEnabled)&&He.code.add($e.H`bool pointIsWithinLine(vec3 pos, vec3 start, vec3 end) {
vec3 dir = end - start;
float t2 = dot(dir, pos - start);
float l2 = dot(dir, dir);
return t2 >= 0.0 && t2 <= l2;
}`),He.code.add($e.H`void main() {
vec3 pos;
vec3 normal;
float depthDiscontinuityAlpha;
if (!laserlineReconstructFromDepth(pos, normal, depthDiscontinuityAlpha)) {
discard;
}
vec4 color = vec4(0, 0, 0, 0);`),Ke.heightManifoldEnabled){He.uniforms.add([new Te.A("angleCutoff",it=>Ee(it)),new ut.N("heightPlane",(it,pt)=>Yn(it.heightManifoldTarget,it.renderCoordsHelper.worldUpAtPosition(it.heightManifoldTarget,ii),pt.camera.viewMatrix))]);const ke=Ke.spherical?$e.H`normalize(globalOrigin - pos)`:$e.H`heightPlane.xyz`;He.code.add($e.H`
    {
      float heightManifoldAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, ${ke})));
      vec4 heightManifoldColor = laserlineProfile(heightManifoldDistancePixels(heightPlane, pos));
      color = max(color, heightManifoldColor * heightManifoldAlpha);
    }
    `)}return Ke.pointDistanceEnabled&&(He.uniforms.add([new Te.A("angleCutoff",ke=>Ee(ke)),new ut.N("pointDistanceSphere",(ke,it)=>function xe(Ke,Rt){return(0,ve.m)(bt,Ke.pointDistanceOrigin,Rt.camera.viewMatrix),bt[3]=(0,ve.i)(Ke.pointDistanceOrigin,Ke.pointDistanceTarget),bt}(ke,it))]),He.code.add($e.H`{
float pointDistanceSphereDistance = sphereDistancePixels(pointDistanceSphere, pos);
vec4 pointDistanceSphereColor = laserlineProfile(pointDistanceSphereDistance);
float pointDistanceSphereAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, normalize(pos - pointDistanceSphere.xyz))));
color = max(color, pointDistanceSphereColor * pointDistanceSphereAlpha);
}`)),Ke.lineVerticalPlaneEnabled&&(He.uniforms.add([new Te.A("angleCutoff",ke=>Ee(ke)),new ut.N("lineVerticalPlane",(ke,it)=>function We(Ke,Rt){const He=(0,Ze.KU)(Ke.lineVerticalPlaneSegment,.5,ii),ke=Ke.renderCoordsHelper.worldUpAtPosition(He,Xn),it=(0,ve.n)(Ti,Ke.lineVerticalPlaneSegment.vector),pt=(0,ve.f)(jt,ke,it);return(0,ve.n)(pt,pt),Yn(Ke.lineVerticalPlaneSegment.origin,pt,Rt.camera.viewMatrix)}(ke,it)),new ct.J("lineVerticalStart",(ke,it)=>function At(Ke,Rt){const He=(0,ve.c)(ii,Ke.lineVerticalPlaneSegment.origin);return Ke.renderCoordsHelper.setAltitude(He,0),(0,ve.m)(He,He,Rt.camera.viewMatrix)}(ke,it)),new ct.J("lineVerticalEnd",(ke,it)=>function Vt(Ke,Rt){const He=(0,ve.a)(ii,Ke.lineVerticalPlaneSegment.origin,Ke.lineVerticalPlaneSegment.vector);return Ke.renderCoordsHelper.setAltitude(He,0),(0,ve.m)(He,He,Rt.camera.viewMatrix)}(ke,it))]),He.code.add($e.H`{
if (pointIsWithinLine(pos, lineVerticalStart, lineVerticalEnd)) {
float lineVerticalDistance = planeDistancePixels(lineVerticalPlane, pos);
vec4 lineVerticalColor = laserlineProfile(lineVerticalDistance);
float lineVerticalAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, abs(dot(normal, lineVerticalPlane.xyz)));
color = max(color, lineVerticalColor * lineVerticalAlpha);
}
}`)),Ke.intersectsLineEnabled&&(He.uniforms.add([new Te.A("angleCutoff",ke=>Ee(ke)),new ct.J("intersectsLineStart",(ke,it)=>(0,ve.m)(ii,ke.lineStartWorld,it.camera.viewMatrix)),new ct.J("intersectsLineEnd",(ke,it)=>(0,ve.m)(ii,ke.lineEndWorld,it.camera.viewMatrix)),new ct.J("intersectsLineDirection",(ke,it)=>((0,ve.c)(jt,ke.intersectsLineSegment.vector),jt[3]=0,(0,ve.n)(ii,(0,ht.t)(jt,jt,it.camera.viewMatrix)))),new St.p("intersectsLineRadius",ke=>ke.intersectsLineRadius)]),He.code.add($e.H`{
if (pointIsWithinLine(pos, intersectsLineStart, intersectsLineEnd)) {
float intersectsLineDistance = lineDistancePixels(intersectsLineStart, intersectsLineDirection, intersectsLineRadius, pos);
vec4 intersectsLineColor = laserlineProfile(intersectsLineDistance);
float intersectsLineAlpha = 1.0 - smoothstep(angleCutoff.x, angleCutoff.y, 1.0 - abs(dot(normal, intersectsLineDirection)));
color = max(color, intersectsLineColor * intersectsLineAlpha);
}
}`)),He.code.add($e.H`gl_FragColor = laserlineOutput(color * depthDiscontinuityAlpha);
}`),Rt}function Ee(Ke){return(0,we.s)(Mt,Math.cos(Ke.angleCutoff),Math.cos(Math.max(0,Ke.angleCutoff-(0,ce.Vl)(2))))}function Yn(Ke,Rt,He){return(0,ve.m)(Aa,Ke,He),(0,ve.c)(jt,Rt),jt[3]=0,(0,ht.t)(jt,jt,He),(0,de.Yq)(Aa,jt,Kn)}const Mt=(0,ae.a)(),ii=(0,ue.c)(),jt=(0,rt.c)(),Xn=(0,ue.c)(),Ti=(0,ue.c)(),Aa=(0,ue.c)(),Kn=(0,de.Ue)(),bt=(0,me.c)(),Ra=Object.freeze(Object.defineProperty({__proto__:null,build:Ae,defaultAngleCutoff:tt},Symbol.toStringTag,{value:"Module"}))},93310:(hi,vt,oe)=>{oe.d(vt,{S:()=>tt,b:()=>St});var ce=oe(4794),we=oe(81801),ae=oe(13934),ve=oe(78925),ue=oe(24255),ht=oe(10109),rt=oe(67022),Ze=oe(33726),de=oe(99198),me=oe(97139),Ge=oe(69960),Be=oe(17625),Te=oe(22355),ct=oe(44835),ut=oe(16396);function St(Ae){const Ee=new Te.kG,xe=Ae.hasMultipassTerrain&&(Ae.output===ae.H.Color||Ae.output===ae.H.Alpha);Ee.include(ue.w,Ae),Ee.include(we.A,Ae),Ee.include(ve.f5,Ae);const{vertex:We,fragment:At}=Ee;return At.include(Ze.Y),(0,de.Sv)(We,Ae),At.uniforms.add(new Ge.N("uColor",Vt=>Vt.color)),Ee.attributes.add(ut.T.POSITION,"vec3"),Ee.varyings.add("vWorldPosition","vec3"),xe&&Ee.varyings.add("depth","float"),Ae.screenSizeEnabled&&Ee.attributes.add(ut.T.OFFSET,"vec3"),Ae.shadingEnabled&&((0,de._8)(We),Ee.attributes.add(ut.T.NORMAL,"vec3"),Ee.varyings.add("vViewNormal","vec3")),We.code.add(Be.H`
    void main(void) {
      vWorldPosition = ${Ae.screenSizeEnabled?"screenSizeScaling(offset, position)":"position"};
  `),Ae.shadingEnabled&&We.code.add(Be.H`vec3 worldNormal = normal;
vViewNormal = (viewNormal * vec4(worldNormal, 1)).xyz;`),We.code.add(Be.H`
    ${xe?"depth = (view * vec4(vWorldPosition, 1.0)).z;":""}
    gl_Position = transformPosition(proj, view, vWorldPosition);
  }
  `),xe&&Ee.include(ht.l,Ae),At.code.add(Be.H`
    void main() {
      discardBySlice(vWorldPosition);
      ${xe?"terrainDepthTest(gl_FragCoord, depth);":""}
    `),Ae.shadingEnabled?(At.uniforms.add(new me.J("shadingDirection",Vt=>Vt.shadingDirection)),At.uniforms.add(new Ge.N("shadedColor",Vt=>function $e(Ae,Ee){const xe=1-Ae[3],We=Ae[3]+Ee[3]*xe;return 0===We?(et[3]=We,et):(et[0]=(Ae[0]*Ae[3]+Ee[0]*Ee[3]*xe)/We,et[1]=(Ae[1]*Ae[3]+Ee[1]*Ee[3]*xe)/We,et[2]=(Ae[2]*Ae[3]+Ee[2]*Ee[3]*xe)/We,et[3]=Ee[3],et)}(Vt.shadingTint,Vt.color))),At.code.add(Be.H`vec3 viewNormalNorm = normalize(vViewNormal);
float shadingFactor = 1.0 - clamp(-dot(viewNormalNorm, shadingDirection), 0.0, 1.0);
vec4 finalColor = mix(uColor, shadedColor, shadingFactor);`)):At.code.add(Be.H`vec4 finalColor = uColor;`),At.code.add(Be.H`
      ${Ae.output===ae.H.ObjectAndLayerIdColor?Be.H`finalColor.a = 1.0;`:""}
      if (finalColor.a < ${Be.H.float(rt.b)}) {
        discard;
      }
      ${Ae.output===ae.H.Alpha?Be.H`gl_FragColor = vec4(finalColor.a);`:""}

      ${Ae.output===ae.H.Color?Be.H`gl_FragColor = highlightSlice(finalColor, vWorldPosition); ${Ae.transparencyPassType===ct.A.Color?"gl_FragColor = premultiplyAlpha(gl_FragColor);":""}`:""}
    }
    `),Ee}const et=(0,ce.c)(),tt=Object.freeze(Object.defineProperty({__proto__:null,build:St},Symbol.toStringTag,{value:"Module"}))},30750:(hi,vt,oe)=>{oe.d(vt,{S:()=>Ze,b:()=>rt});var ce=oe(99198),we=oe(69960),ae=oe(65787),ve=oe(17625),ue=oe(22355),ht=oe(16396);function rt(de){const me=new ue.kG;me.extensions.add("GL_OES_standard_derivatives");const{vertex:Ge,fragment:Be,attributes:Te,varyings:ct}=me;return(0,ce.Sv)(Ge,de),Te.add(ht.T.POSITION,"vec3"),Te.add(ht.T.UV0,"vec2"),ct.add("vUV","vec2"),Ge.code.add(ve.H`void main(void) {
vUV = uv0;
gl_Position = proj * view * vec4(position, 1.0);
}`),Be.uniforms.add([new we.N("backgroundColor",ut=>ut.backgroundColor),new we.N("gridColor",ut=>ut.gridColor),new ae.p("gridWidth",ut=>ut.gridWidth)]),Be.code.add(ve.H`void main() {
const float LINE_WIDTH = 1.0;
vec2 uvScaled = vUV * gridWidth;
vec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));
vec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);
grid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);
grid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);
float gridFade = max(grid.x, grid.y);
float gridAlpha = gridColor.a * gridFade;
gl_FragColor =
vec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +
vec4(gridColor.rgb, 1.0) * gridAlpha;
}`),me}const Ze=Object.freeze(Object.defineProperty({__proto__:null,build:rt},Symbol.toStringTag,{value:"Module"}))},67709:(hi,vt,oe)=>{function ce(){return new Float32Array(4)}function we(et){const tt=new Float32Array(4);return tt[0]=et[0],tt[1]=et[1],tt[2]=et[2],tt[3]=et[3],tt}function ae(et,tt,Ae,Ee){const xe=new Float32Array(4);return xe[0]=et,xe[1]=tt,xe[2]=Ae,xe[3]=Ee,xe}function ue(){return ce()}function ht(){return ae(1,1,1,1)}function rt(){return ae(1,0,0,0)}function Ze(){return ae(0,1,0,0)}function de(){return ae(0,0,1,0)}function me(){return ae(0,0,0,1)}oe.d(vt,{c:()=>we,f:()=>ae});const Ge=ue(),Be=ht(),Te=rt(),ct=Ze(),ut=de(),St=me();Object.freeze(Object.defineProperty({__proto__:null,ONES:Be,UNIT_W:St,UNIT_X:Te,UNIT_Y:ct,UNIT_Z:ut,ZEROS:Ge,clone:we,create:ce,createView:function ve(et,tt){return new Float32Array(et,tt,4)},fromValues:ae,ones:ht,unitW:me,unitX:rt,unitY:Ze,unitZ:de,zeros:ue},Symbol.toStringTag,{value:"Module"}))},22558:(hi,vt,oe)=>{function ce(we){return we&&"getAtOrigin"in we&&"originOf"in we}oe.d(vt,{l:()=>ce})},89586:(hi,vt,oe)=>{oe.d(vt,{EU:()=>ct,Ue:()=>ue,WH:()=>ut,ZZ:()=>Te,qC:()=>Be,uT:()=>me});var ce=oe(21286),we=oe(48977),ae=oe(78451),ve=oe(84161);function ue(Ee=$e){return[Ee[0],Ee[1],Ee[2],Ee[3]]}function me(Ee,xe,We=ue()){return(0,ve.c)(We,Ee),We[3]=xe,We}function Be(Ee,xe,We=ue()){return(0,we.s)(et,Ee,ut(Ee)),(0,we.s)(tt,xe,ut(xe)),(0,we.m)(et,tt,et),function St(Ee,xe){return Ee[3]=xe,Ee}(We,(0,ce.BV)((0,we.g)(We,et)))}function Te(Ee){return Ee}function ct(Ee){return Ee[3]}function ut(Ee){return(0,ce.Vl)(Ee[3])}const $e=[0,0,1,0],et=(0,ae.a)(),tt=(0,ae.a)();ue()},77418:(hi,vt,oe)=>{oe.r(vt),oe.d(vt,{DrawGraphicTool3D:()=>Qi,ExtentTransformTool:()=>Yt,GraphicMoveTool:()=>mi,GraphicReshapeTool:()=>Gt,GraphicTransformTool:()=>Zt});var ce=oe(17626),we=oe(54024),ae=oe(62208),ve=oe(32917),ue=oe(77712),ht=oe(90912),rt=oe(85931),Ze=oe(76898),de=oe(84161),me=oe(28093),Ge=oe(60507),Be=oe(82706),Te=oe(23841),St=(oe(63290),oe(26584),oe(8314)),$e=oe(15861),et=oe(14517),tt=oe(59213),Ae=oe(10699),Ee=oe(84600),xe=oe(67831),We=oe(99770),At=oe(25748),Vt=oe(41840),Yn=oe(75775),Mt=oe(91558);oe(50645);let jt=G=>({vnodeSelector:"",properties:void 0,children:void 0,text:G.toString(),domNode:null}),Xn=(G,D,N)=>{for(let Z=0,K=D.length;Z<K;Z++){let Q=D[Z];Array.isArray(Q)?Xn(G,Q,N):null!=Q&&!1!==Q&&("string"==typeof Q&&(Q=jt(Q)),N.push(Q))}};oe(62996);const Kn={bottom:"esri-text-overlay-item-anchor-bottom","bottom-right":"esri-text-overlay-item-anchor-bottom-right","bottom-left":"esri-text-overlay-item-anchor-bottom-left",top:"esri-text-overlay-item-anchor-top","top-right":"esri-text-overlay-item-anchor-top-right","top-left":"esri-text-overlay-item-anchor-top-left",center:"esri-text-overlay-item-anchor-center",right:"esri-text-overlay-item-anchor-right",left:"esri-text-overlay-item-anchor-left"};let bt=class extends et.Z{get position(){return[this.x,this.y]}set position(G){this._set("x",G[0]),this._set("y",G[1])}get _textShadowColor(){return this.backgroundColor}get _textShadow(){const G=this._textShadowColor.toCss(!1);return`0 0 ${this._textShadowSize}px ${G}`}get _padding(){return.5*this.fontSize}get _borderRadius(){return this._padding}constructor(G){super(G),this.x=0,this.y=0,this.text="-",this.fontSize=14,this.anchor="center",this.visible=!0,this.backgroundColor=new Mt.Z([0,0,0,.6]),this.textColor=new Mt.Z([255,255,255]),this._textShadowSize=1}render(){return function Ti(G,D,N){if(Array.isArray(D))N=D,D=void 0;else if(D&&("string"==typeof D||D.hasOwnProperty("vnodeSelector"))||N&&("string"==typeof N||N.hasOwnProperty("vnodeSelector")))throw new Error("h called with invalid arguments");let Z,K;return N&&1===N.length&&"string"==typeof N[0]?Z=N[0]:N&&(K=[],Xn(G,N,K),0===K.length&&(K=void 0)),{vnodeSelector:G,properties:D,children:K,text:""===Z?void 0:Z,domNode:null}}("div",{classes:this._cssClasses(),styles:{left:Math.floor(this.x)+"px",top:Math.floor(this.y)+"px",visibility:this.visible?"visible":"hidden",fontSize:this.fontSize+"px",lineHeight:this.fontSize+"px",backgroundColor:this.backgroundColor.toCss(!0),color:this.textColor.toCss(!0),padding:this._padding+"px",borderRadius:this._borderRadius+"px",textShadow:this._textShadow}},[this.text])}renderCanvas(G){if(!this.visible)return;const D=G.font.replace(/^(.*?)px/,"");G.font=`${this.fontSize}px ${D}`;const N=this._padding,Z=this._borderRadius,K=G.measureText(this.text).width,Q=this.fontSize,J=Ra[this.anchor];G.textAlign="center",G.textBaseline="middle";const se=K+2*N,re=Q+2*N;this._roundedRect(G,this.x+J.x*se,this.y+J.y*re,se,re,Z),G.fillStyle=this.backgroundColor.toCss(!0),G.fill();const pe=this.x+(J.x+.5)*se,ge=this.y+(J.y+.5)*re;this._renderTextShadow(G,this.text,pe,ge),G.fillStyle=this.textColor.toCss(!0),G.fillText(this.text,pe,ge)}_renderTextShadow(G,D,N,Z){G.lineJoin="miter",G.fillStyle=`rgba(${this._textShadowColor.r}, ${this._textShadowColor.g}, ${this._textShadowColor.b}, ${1/Ke.length})`;const K=this._textShadowSize;for(const[Q,J]of Ke)G.fillText(D,N+K*Q,Z+K*J)}_roundedRect(G,D,N,Z,K,Q){G.beginPath(),G.moveTo(D,N+Q),G.arcTo(D,N,D+Q,N,Q),G.lineTo(D+Z-Q,N),G.arcTo(D+Z,N,D+Z,N+Q,Q),G.lineTo(D+Z,N+K-Q),G.arcTo(D+Z,N+K,D+Z-Q,N+K,Q),G.lineTo(D+Q,N+K),G.arcTo(D,N+K,D,N+K-Q,Q),G.closePath()}_cssClasses(){const G={"esri-text-overlay-item":!0};for(const D in Kn)G[Kn[D]]=this.anchor===D;return G}};(0,ce._)([(0,ue.Cb)()],bt.prototype,"x",void 0),(0,ce._)([(0,ue.Cb)()],bt.prototype,"y",void 0),(0,ce._)([(0,ue.Cb)()],bt.prototype,"position",null),(0,ce._)([(0,ue.Cb)()],bt.prototype,"text",void 0),(0,ce._)([(0,ue.Cb)()],bt.prototype,"fontSize",void 0),(0,ce._)([(0,ue.Cb)()],bt.prototype,"anchor",void 0),(0,ce._)([(0,ue.Cb)()],bt.prototype,"visible",void 0),(0,ce._)([(0,ue.Cb)()],bt.prototype,"backgroundColor",void 0),(0,ce._)([(0,ue.Cb)()],bt.prototype,"textColor",void 0),(0,ce._)([(0,ue.Cb)()],bt.prototype,"_textShadowSize",void 0),(0,ce._)([(0,ue.Cb)()],bt.prototype,"_textShadowColor",null),(0,ce._)([(0,ue.Cb)()],bt.prototype,"_textShadow",null),(0,ce._)([(0,ue.Cb)()],bt.prototype,"_padding",null),(0,ce._)([(0,ue.Cb)()],bt.prototype,"_borderRadius",null),bt=(0,ce._)([(0,Ze.j)("esri.views.overlay.TextOverlayItem")],bt);const Ra={bottom:{x:-.5,y:-1,textAlign:"center",textBaseline:"bottom"},"bottom-left":{x:0,y:-1,textAlign:"left",textBaseline:"bottom"},"bottom-right":{x:-1,y:-1,textAlign:"right",textBaseline:"bottom"},center:{x:-.5,y:-.5,textAlign:"center",textBaseline:"middle"},left:{x:0,y:-.5,textAlign:"left",textBaseline:"middle"},right:{x:-1,y:-.5,textAlign:"right",textBaseline:"middle"},top:{x:-.5,y:0,textAlign:"center",textBaseline:"top"},"top-left":{x:0,y:0,textAlign:"left",textBaseline:"top"},"top-right":{x:-1,y:0,textAlign:"right",textBaseline:"top"}},Ke=[];for(let D=0;D<360;D+=22.5)Ke.push([Math.cos(Math.PI*D/180),Math.sin(Math.PI*D/180)]);const Rt=bt;var He=oe(22463);const it={default:15,far:25};let pt=class extends et.Z{constructor(G){super(G),this.context=null,this.stagedVertex=null,this.visible=!0,this.edgeDistance="default",this._messagesUnits=null,this._labelInfos=[],this._nextLabelIndex=0}initialize(){var G=this;const D=(0,tt.vr)(function(){var Z=(0,$e.Z)(function*(K){const Q=yield(0,Vt.ME)("esri/core/t9n/Units");(0,Ae.k_)(K),G._messagesUnits=Q});return function(K){return Z.apply(this,arguments)}}()),N=()=>(0,ae.yw)(this.context,Z=>Z.editGeometryOperations);this.addHandles([(0,ve.YP)(()=>[(0,ae.pC)(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(Z=>(0,ve.on)(N,Z,()=>this._update())),(0,we.kB)(()=>D.abort())])}destroy(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())}get updating(){return(0,ae.Wi)(this._messagesUnits)}get test(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map(G=>G.label.text)}}get _edgeDistancePixels(){return it[this.edgeDistance]}_update(){this._nextLabelIndex=0;const G=this.context;if((0,ae.Wi)(G))return void this._destroyUnusedLabels();const{components:D,geometry:N,coordinateHelper:Z}=G.editGeometryOperations.data;if(!N)return void this._destroyUnusedLabels();const K=D.length;for(let Q=0;Q<K;++Q){const J=[];if(D[Q].iterateVertices(ge=>{J.push(Z.toXYZ(ge.pos))}),0===Q&&(0,ae.pC)(this.stagedVertex)&&J.push(Z.toXYZ(this.stagedVertex)),J.length<2)continue;const se=J[0];"polygon"===N.type&&J.length>2&&!(0,de.F)(se,J[J.length-1])&&J.push(se);const le=1===K&&!(0,At.bu)(J,!1,!1);let he=so,pe=ro;this.toScreenPointArray(G,se,he);for(let ge=1;ge<J.length;++ge){const ye=J[ge-1],fe=J[ge];this.toScreenPointArray(G,fe,pe),this._addLabel(G,ye,he,fe,pe,le),[he,pe]=[pe,he]}}this._destroyUnusedLabels()}_addLabel(G,D,N,Z,K,Q){const{label:J}=this._getOrCreateLabel(G);if(!this.visible||(0,xe.k)(N,K)<3025)return void(J.visible=!1);const se=(0,ae.pC)(G.graphicState)?G.graphicState.isDraped?"on-the-ground":"absolute-height":(0,Ge.VW)(G.editGeometryOperations.data.geometry,G.elevationInfo),{spatialReference:re}=G.editGeometryOperations.data,le=(0,He.MU)(D,Z,re,se),he=this._messagesUnits,pe=(0,Yn.R)(G.view);J.text=(0,ae.pC)(he)&&(0,ae.pC)(le)?(0,Ee.N9)(he,le,pe):"",J.visible=!0;const ge=K[0]-N[0],ye=K[1]-N[1];Q?(0,xe.s)(_t,-ye,ge):(0,xe.s)(_t,ye,-ge),(0,xe.f)(_t,_t),(0,xe.b)(_t,_t,this._edgeDistancePixels),(0,xe.l)(Ni,N,K,.5),(0,xe.j)(Ni,Ni,_t),J.position=[Ni[0],Ni[1]],J.anchor=Math.abs(_t[0])>Math.abs(_t[1])?_t[0]>0?"left":"right":-_t[1]<0?"top":"bottom"}_getOrCreateLabel(G){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];const D=new Rt({fontSize:10,anchor:"center"});G.view.overlay?.items.add(D);const N={label:D};return this._labelInfos.push(N),this._nextLabelIndex=this._labelInfos.length,N}_destroyUnusedLabels(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())}_destroyLabel({label:G}){(0,ae.yw)(this.context,D=>D.view.overlay?.items.remove(G)),G.destroy()}};(0,ce._)([(0,ue.Cb)()],pt.prototype,"context",void 0),(0,ce._)([(0,ue.Cb)()],pt.prototype,"stagedVertex",void 0),(0,ce._)([(0,ue.Cb)()],pt.prototype,"visible",void 0),(0,ce._)([(0,ue.Cb)()],pt.prototype,"edgeDistance",void 0),(0,ce._)([(0,ue.Cb)()],pt.prototype,"updating",null),(0,ce._)([(0,ue.Cb)()],pt.prototype,"_messagesUnits",void 0),(0,ce._)([(0,ue.Cb)()],pt.prototype,"_edgeDistancePixels",null),pt=(0,ce._)([(0,Ze.j)("esri.views.interactive")],pt);const _t=(0,We.a)(),Ni=(0,We.a)(),so=(0,Te.s1)(),ro=(0,Te.s1)();var _s=oe(25858);let Qn=class extends pt{getCameraOrExtent({view:G}){return G.state.camera}toScreenPointArray({view:G,elevationInfo:D,editGeometryOperations:N},Z,K=(0,Te.s1)()){const{spatialReference:Q}=N.data.coordinateHelper;return(0,_s.RS)(Z,Q,D,G,ms),G.state.camera.projectToScreen(ms,K),K}};Qn=(0,ce._)([(0,Ze.j)("esri.views.3d.interactive.SegmentLabels3D")],Qn);const ms=(0,me.c)();var Xt=oe(55915),mt=oe(993),Hi=oe(67709),Di=oe(85072),fs=oe(8834),yt=oe(10992),Kt=oe(70562),oo=oe(61996),tn=oe(62600),vs=oe(54840),Jn=oe(23147);class lo{constructor(D){this._resourceFactory=D,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=tn.eZ.Outline}destroy(){this._destroyResources()}get resources(){return(0,ae.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(D){D!==this._visible&&(this._visible=D,this._syncGeometriesToRenderer())}get attached(){return this._attached}set attached(D){D!==this._attached&&(this._attached=D,this._createOrDestroyResources())}get renderGroup(){return this._renderGroup}set renderGroup(D){this._renderGroup=D;const N=(0,ae.WG)(this._resources)?.layerView;N&&(N.renderGroup=D)}recreate(){this.attached&&this._createResources()}recreateGeometry(){this._resourceFactory.recreateGeometry?(0,ae.Wi)(this._resources)||(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}_createOrDestroyResources(){this._attached?(0,ae.Wi)(this._resources)&&this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const D=this._resourceFactory.createResources(),N=new Bi({view:this._resourceFactory.view,renderGroup:this._renderGroup}),Z=this._resourceFactory.view.basemapTerrain?.overlayManager;this._resources={layerView:new Bi({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:D,geometriesAdded:!1},Z&&(this._resources.drapeSourceRenderer=Z.registerGeometryDrapeSource(N)),this._syncGeometriesToRenderer()}_destroyResources(){if((0,ae.Wi)(this._resources))return;this._ensureRenderGeometriesRemoved();const D=this._resourceFactory.view.basemapTerrain?.overlayManager;D&&D.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncGeometriesToRenderer(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}_ensureRenderGeometriesRemoved(){(0,ae.Wi)(this._resources)||(0,ae.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,vs.T.UPDATE),this._resources.geometriesAdded=!1)}_ensureRenderGeometriesAdded(){(0,ae.Wi)(this._resources)||(0,ae.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,vs.T.UPDATE),this._resources.geometriesAdded=!0)}}let Bi=class extends((0,oo.IG)(et.Z)){constructor(G){super(G),this.drapeSourceType=tn.Lw.Features,this.updatePolicy=Jn.j.SYNC,this.renderGroup=tn.eZ.Outline}};(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Bi.prototype,"view",void 0),(0,ce._)([(0,ue.Cb)({readOnly:!0})],Bi.prototype,"drapeSourceType",void 0),(0,ce._)([(0,ue.Cb)()],Bi.prototype,"renderGroup",void 0),Bi=(0,ce._)([(0,Ze.j)("DrapedVisualElementLayerView")],Bi);class La{constructor(D){this._attached=!1,this._resourcesCreated=!1,this._visible=!0,this.view=D,this._handle=(0,ve.YP)(()=>this.view.ready,N=>{this._resourcesCreated&&(N?this._createResources():this._destroyResources())})}applyProps(D){let N=!1;for(const Z in D)Z in this?"attached"===Z?N=D[Z]:this[Z]=D[Z]:console.error("Cannot set unknown property",Z);this.attached=N}destroy(){this.attached=!1,this._handle.remove()}get attached(){return this._attached}set attached(D){D!==this._attached&&this.view._stage&&(this._attached=D,this._attached&&!this._resourcesCreated?this._createResources():!this._attached&&this._resourcesCreated&&this._destroyResources(),this.onAttachedChange(D))}onAttachedChange(D){}get visible(){return this._visible}set visible(D){D!==this._visible&&(this._visible=D,this.attached&&this.updateVisibility(D))}_createResources(){this.createResources(),this._resourcesCreated=!0,this.updateVisibility(this.visible)}_destroyResources(){this.destroyResources(),this._resourcesCreated=!1}}var nn=oe(24425),Ia=oe(97272),ys=oe(9983),Ga=oe(34103);class Ms{constructor(D){this._resourceFactory=D,this._resources=null,this._visible=!0,this._attached=!1}destroy(){this._destroyResources()}get object(){return(0,ae.pC)(this._resources)?this._resources.object:null}get resources(){return(0,ae.pC)(this._resources)?this._resources.external:null}get visible(){return this._visible}set visible(D){D!==this._visible&&(this._visible=D,this._syncVisible())}get attached(){return this._attached}set attached(D){D!==this._attached&&(this._attached=D,this._createOrDestroyResources())}recreate(){this.attached&&this._createResources()}recreateGeometry(){if(!this._resourceFactory.recreateGeometry)return void this.recreate();const D=this._resourceFactory.view._stage;if((0,ae.Wi)(this._resources)||!D)return;const N=this._resources.object;this._resources.external.forEach(Z=>{Z.type!==nn.U.Mesh&&Z.type!==nn.U.Line&&Z.type!==nn.U.Point||D.remove(Z)}),N.removeAllGeometries(),this._resourceFactory.recreateGeometry(this._resources.external,N,this._resources.layer),this._resources.external.forEach(Z=>{Z.type!==nn.U.Mesh&&Z.type!==nn.U.Line&&Z.type!==nn.U.Point||D.add(Z)})}_createOrDestroyResources(){this._attached?this._resources||this._createResources():this._destroyResources()}_createResources(){this._destroyResources();const D=this._resourceFactory,N=D.view,Z=N._stage;if(!Z)return;const K=new Ga.F({pickable:!1,updatePolicy:Jn.j.SYNC});Z.add(K);const Q=new Ia.T({castShadow:!1}),J=D.createResources(Q,K);J.forEach(le=>{Z.add(le),le instanceof ys.x&&Z.loadImmediate(le)}),Z.add(Q),K.add(Q);const se=D.cameraChanged,re=se?(0,ve.YP)(()=>N.state.camera,le=>se(le),ve.nn):null;this._resources={layer:K,object:Q,external:J,cameraHandle:re},this._syncVisible()}_destroyResources(){if((0,ae.Wi)(this._resources))return;const D=this._resourceFactory.view._stage;D&&(D.remove(this._resources.object),D.remove(this._resources.layer),this._resources.external.forEach(N=>D.remove(N))),this._resources.object.dispose(),this._resources.cameraHandle?.remove(),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}_syncVisible(){(0,ae.Wi)(this._resources)||(this._resources.object.visible=this._visible)}}class $n extends La{constructor({view:D,isDraped:N}){super(D),this._isDraped=!1,this.object3dResources=new Ms(this.createObject3DResourceFactory(D)),this.drapedResources=new lo(this.createDrapedResourceFactory(D)),this.isDraped=N??!1}get isDraped(){return this._isDraped}set isDraped(D){D!==this._isDraped&&(this._isDraped=D,this.object3dResources.attached=this.attached&&!D,this.drapedResources.attached=this.attached&&D)}get renderGroup(){return this.drapedResources.renderGroup}set renderGroup(D){this.drapedResources.renderGroup=D}createResources(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}destroyResources(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}recreate(){this.object3dResources.recreate(),this.drapedResources.recreate()}recreateGeometry(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}destroy(){this.object3dResources.destroy(),this.drapedResources.destroy(),super.destroy()}updateVisibility(D){this.object3dResources.visible=D,this.drapedResources.visible=D}}var Mn=oe(59617),co=oe(4511),bs=oe(19625),kn=oe(6040),ho=oe(76438),qe=oe(16396),bn=oe(651),Sn=oe(91056),En=oe(12407),po=oe(9088),Lt=oe(67969),xt=oe(2078);class qn extends Sn.A{initializeProgram(D){return new En.$(D.rctx,qn.shader.get().build(this.configuration),Ss)}initializePipeline(){return(0,xt.sm)({blending:(0,xt.if)(Lt.zi.ONE,Lt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:xt.BK})}}qn.shader=new bn.J(po.L,()=>oe.e(9689).then(oe.bind(oe,79689)));const Ss=new Map([[qe.T.START,0],[qe.T.END,1],[qe.T.UP,2],[qe.T.EXTRUDE,3]]);var uo=oe(83994);class Es{constructor(D){this._renderCoordsHelper=D,this._buffers=null,this._origin=(0,me.c)(),this._dirty=!1,this._count=0,this._vao=null}set vertices(D){const N=(0,kn.bg)(3*D.length);let Z=0;for(const K of D)N[Z++]=K[0],N[Z++]=K[1],N[Z++]=K[2];this.buffers=[N]}set buffers(D){if(this._buffers=D,this._buffers.length>0){const N=this._buffers[0],Z=3*Math.floor(N.length/3/2);(0,de.s)(this._origin,N[Z+0],N[Z+1],N[Z+2])}else(0,de.s)(this._origin,0,0,0);this._dirty=!0}get origin(){return this._origin}draw(D){const N=this._ensureVAO(D);(0,ae.pC)(N)&&(D.bindVAO(N),D.drawArrays(Lt.MX.TRIANGLES,0,this._count))}dispose(){(0,ae.pC)(this._vao)&&this._vao.dispose()}_ensureVAO(D){return(0,ae.Wi)(this._buffers)?null:((0,ae.Wi)(this._vao)&&(this._vao=this._createVAO(D,this._buffers)),this._ensureVertexData(this._vao,this._buffers),this._vao)}_createVAO(D,N){const Z=this._createDataBuffer(N);return this._dirty=!1,new ho.U(D,Ss,{data:(0,co.K)(Cs)},{data:uo.f.createVertex(D,Lt.l1.STATIC_DRAW,Z)})}_ensureVertexData(D,N){if(!this._dirty)return;const Z=this._createDataBuffer(N);D.vertexBuffers.data?.setData(Z),this._dirty=!1}_numberOfRenderVertices(D){return 2*(D.length/3-1)*3}_createDataBuffer(D){const N=D.reduce((se,re)=>se+this._numberOfRenderVertices(re),0);this._count=N;const Z=Cs.createBuffer(N),K=this._origin;let Q=0,J=0;for(const se of D){for(let re=0;re<se.length;re+=3){const le=(0,de.s)(Os,se[re+0],se[re+1],se[re+2]);0===re?J=this._renderCoordsHelper.getAltitude(le):this._renderCoordsHelper.setAltitude(le,J);const he=this._renderCoordsHelper.worldUpAtPosition(le,go),pe=Q+2*re,ge=(0,de.b)(Os,le,K);if(re<se.length-3){Z.up.setVec(pe,he),Z.up.setVec(pe+3,he),Z.up.setVec(pe+5,he);for(let ye=0;ye<6;ye++)Z.start.setVec(pe+ye,ge);Z.extrude.setValues(pe+0,0,-1),Z.extrude.setValues(pe+1,1,-1),Z.extrude.setValues(pe+2,1,1),Z.extrude.setValues(pe+3,0,-1),Z.extrude.setValues(pe+4,1,1),Z.extrude.setValues(pe+5,0,1)}if(re>0){Z.up.setVec(pe-2,he),Z.up.setVec(pe-4,he),Z.up.setVec(pe-5,he);for(let ye=-6;ye<0;ye++)Z.end.setVec(pe+ye,ge)}}Q+=this._numberOfRenderVertices(se)}return Z.buffer}}const go=(0,me.c)(),Os=(0,me.c)(),Cs=(0,bs.U$)().vec3f(qe.T.START).vec3f(qe.T.END).vec3f(qe.T.UP).vec2f(qe.T.EXTRUDE);var _o=oe(77172),kt=oe(5894),ea=oe(57623),dt=oe(87601);class Va extends dt.m{constructor(){super(...arguments),this.contrastControlEnabled=!1}}(0,ce._)([(0,dt.o)()],Va.prototype,"contrastControlEnabled",void 0);var Ct=oe(21286),mo=oe(17625),Wa=oe(39114),Ps=oe(66501);class fo extends mo.K{constructor(){super(...arguments),this.innerColor=(0,me.f)(1,1,1),this.innerWidth=1,this.glowColor=(0,me.f)(1,.5,0),this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.75,this.globalAlphaContrastBoost=2,this.angleCutoff=(0,Ct.Vl)(6),this.pointDistanceOrigin=(0,me.c)(),this.pointDistanceTarget=(0,me.c)(),this.lineVerticalPlaneSegment=(0,yt.Ue)(),this.intersectsLineSegment=(0,yt.Ue)(),this.intersectsLineRadius=3,this.heightManifoldTarget=(0,me.c)(),this.lineStartWorld=(0,me.c)(),this.lineEndWorld=(0,me.c)()}}class ta extends Sn.A{initializeProgram(D){return new En.$(D.rctx,ta.shader.get().build(this.configuration),Wa.i)}initializePipeline(){return(0,xt.sm)({blending:(0,xt.if)(Lt.zi.ONE,Lt.zi.ONE_MINUS_SRC_ALPHA),colorWrite:xt.BK})}}ta.shader=new bn.J(Ps.L,()=>oe.e(7794).then(oe.bind(oe,17794)));class an extends Va{constructor(){super(...arguments),this.heightManifoldEnabled=!1,this.pointDistanceEnabled=!1,this.lineVerticalPlaneEnabled=!1,this.intersectsLineEnabled=!1,this.spherical=!1}}(0,ce._)([(0,dt.o)()],an.prototype,"heightManifoldEnabled",void 0),(0,ce._)([(0,dt.o)()],an.prototype,"pointDistanceEnabled",void 0),(0,ce._)([(0,dt.o)()],an.prototype,"lineVerticalPlaneEnabled",void 0),(0,ce._)([(0,dt.o)()],an.prototype,"intersectsLineEnabled",void 0),(0,ce._)([(0,dt.o)()],an.prototype,"spherical",void 0);class vo{constructor(D,N={contrastControlEnabled:!1}){this._config=N,this._technique=null,this._heightManifoldEnabled=!1,this._pointDistanceEnabled=!1,this._lineVerticalPlaneEnabled=!1,this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._viewingMode=Mn.JY.Local,this._pathVerticalPlaneEnabled=!1,this._pathVerticalPlaneData=null,this._pathTechnique=null,this.canRender=!0,this._passParameters=(0,ea.Uf)(D,new fo)}get renderSlots(){return[this._config.contrastControlEnabled?kt.r.LASERLINES_CONTRAST_CONTROL:kt.r.LASERLINES]}get needsLinearDepth(){return!0}get heightManifoldEnabled(){return this._heightManifoldEnabled}set heightManifoldEnabled(D){this._heightManifoldEnabled!==D&&(this._heightManifoldEnabled=D,this._requestRender())}get heightManifoldTarget(){return this._passParameters.heightManifoldTarget}set heightManifoldTarget(D){(0,de.c)(this._passParameters.heightManifoldTarget,D),this._requestRender()}get pointDistanceEnabled(){return this._pointDistanceEnabled}set pointDistanceEnabled(D){D!==this._pointDistanceEnabled&&(this._pointDistanceEnabled=D,this._requestRender())}get pointDistanceTarget(){return this._passParameters.pointDistanceTarget}set pointDistanceTarget(D){(0,de.c)(this._passParameters.pointDistanceTarget,D),this._requestRender()}get pointDistanceOrigin(){return this._passParameters.pointDistanceOrigin}set pointDistanceOrigin(D){(0,de.c)(this._passParameters.pointDistanceOrigin,D),this._requestRender()}get lineVerticalPlaneEnabled(){return this._lineVerticalPlaneEnabled}set lineVerticalPlaneEnabled(D){D!==this._lineVerticalPlaneEnabled&&(this._lineVerticalPlaneEnabled=D,this._requestRender())}get lineVerticalPlaneSegment(){return this._passParameters.lineVerticalPlaneSegment}set lineVerticalPlaneSegment(D){(0,yt.JG)(D,this._passParameters.lineVerticalPlaneSegment),this._requestRender()}get intersectsLineEnabled(){return this._intersectsLineEnabled}set intersectsLineEnabled(D){D!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=D,this._requestRender())}get intersectsLineSegment(){return this._passParameters.intersectsLineSegment}set intersectsLineSegment(D){(0,yt.JG)(D,this._passParameters.intersectsLineSegment),this._requestRender()}get intersectsLineRadius(){return this._passParameters.intersectsLineRadius}set intersectsLineRadius(D){D!==this._passParameters.intersectsLineRadius&&(this._passParameters.intersectsLineRadius=D,this._requestRender())}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(D){D!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=D,this._requestRender())}get viewingMode(){return this._viewingMode}set viewingMode(D){D!==this._viewingMode&&(this._viewingMode=D,this._requestRender())}get pathVerticalPlaneEnabled(){return this._pathVerticalPlaneEnabled}set pathVerticalPlaneEnabled(D){D!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=D,(0,ae.pC)(this._pathVerticalPlaneData)&&this._requestRender())}set pathVerticalPlaneVertices(D){(0,ae.Wi)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new Es(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.vertices=D,this.pathVerticalPlaneEnabled&&this._requestRender()}set pathVerticalPlaneBuffers(D){(0,ae.Wi)(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new Es(this._passParameters.renderCoordsHelper)),this._pathVerticalPlaneData.buffers=D,this.pathVerticalPlaneEnabled&&this._requestRender()}setParameters(D){(0,ea.LO)(this._passParameters,D)&&this._requestRender()}initializeRenderContext(D){this._context=D,this._quadVAO=(0,_o.ow)(D.renderContext.rctx),this._techniqueRepository=D.techniqueRepository,this._techniqueConfig=new an;const Z=new Va;Z.contrastControlEnabled=this._config.contrastControlEnabled,this._pathTechnique=this._techniqueRepository.acquire(qn,Z)}uninitializeRenderContext(){this._quadVAO=(0,ae.M2)(this._quadVAO),this._technique=(0,ae.RY)(this._technique),this._pathVerticalPlaneData=(0,ae.M2)(this._pathVerticalPlaneData),this._pathTechnique=(0,ae.RY)(this._pathTechnique)}prepareTechnique(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,this._techniqueConfig.spherical=this._viewingMode===Mn.JY.Global,this._technique=this._techniqueRepository.releaseAndAcquire(ta,this._techniqueConfig,this._technique),this._technique):this._pathTechnique}render(D,N){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(D,N),this.pathVerticalPlaneEnabled&&this._renderPath(D)}_renderUnified(D,N){const Z=D.rctx;this._updatePassParameters(D),Z.bindTechnique(N,this._passParameters,D.bindParameters),Z.bindVAO(this._quadVAO),Z.drawArrays(Lt.MX.TRIANGLE_STRIP,0,4)}_renderPath(D){(0,ae.Wi)(this._pathVerticalPlaneData)||(0,ae.Wi)(this._pathTechnique)||(D.rctx.bindTechnique(this._pathTechnique,{...this._passParameters,origin:this._pathVerticalPlaneData.origin},D.bindParameters),this._pathVerticalPlaneData.draw(D.rctx))}_updatePassParameters(D){if(!this._intersectsLineEnabled)return;const N=D.bindParameters.camera;if(this._intersectsLineInfinite){if((0,Di.iL)((0,Kt.re)(this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector),On),On.c0=-Number.MAX_VALUE,!(0,fs.zq)(N.frustum,On))return;(0,Di.Ws)(On,this._passParameters.lineStartWorld),(0,Di.S$)(On,this._passParameters.lineEndWorld)}else(0,de.c)(this._passParameters.lineStartWorld,this._passParameters.intersectsLineSegment.origin),(0,de.a)(this._passParameters.lineEndWorld,this._passParameters.intersectsLineSegment.origin,this._passParameters.intersectsLineSegment.vector)}_requestRender(){this._context&&this._context.requestRender()}}const On=(0,Di.Ue)();class Cn extends La{constructor(D){super(D.view),this._angleCutoff=Ps.d,this._style={},this._heightManifoldTarget=(0,me.c)(),this._heightManifoldEnabled=!1,this._intersectsLine=(0,yt.Ue)(),this._intersectsLineEnabled=!1,this._intersectsLineInfinite=!1,this._lineVerticalPlaneSegment=null,this._pathVerticalPlaneBuffers=null,this._pointDistanceLine=null,this.applyProps(D)}get testData(){return this._renderer}createResources(){this._ensureRenderer()}destroyResources(){this._disposeRenderer()}updateVisibility(){this._syncRenderer(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance()}get angleCutoff(){return this._angleCutoff}set angleCutoff(D){this._angleCutoff!==D&&(this._angleCutoff=D,this._syncAngleCutoff())}get style(){return this._style}set style(D){this._style=D,this._syncStyle()}get heightManifoldTarget(){return this._heightManifoldEnabled?this._heightManifoldTarget:null}set heightManifoldTarget(D){(0,ae.pC)(D)?((0,de.c)(this._heightManifoldTarget,D),this._heightManifoldEnabled=!0):this._heightManifoldEnabled=!1,this._syncRenderer(),this._syncHeightManifold()}set intersectsWorldUpAtLocation(D){if((0,ae.Wi)(D))return void(this.intersectsLine=null);const N=this.view.renderCoordsHelper.worldUpAtPosition(D,yo);this.intersectsLine=(0,yt.al)(D,N),this.intersectsLineInfinite=!0}get intersectsLine(){return this._intersectsLineEnabled?this._intersectsLine:null}set intersectsLine(D){(0,ae.pC)(D)?((0,yt.JG)(D,this._intersectsLine),this._intersectsLineEnabled=!0):this._intersectsLineEnabled=!1,this._syncIntersectsLine(),this._syncRenderer()}get intersectsLineInfinite(){return this._intersectsLineInfinite}set intersectsLineInfinite(D){this._intersectsLineInfinite=D,this._syncIntersectsLineInfinite()}get lineVerticalPlaneSegment(){return this._lineVerticalPlaneSegment}set lineVerticalPlaneSegment(D){this._lineVerticalPlaneSegment=(0,ae.pC)(D)?(0,yt.JG)(D):null,this._syncLineVerticalPlane(),this._syncRenderer()}get pathVerticalPlane(){return this._pathVerticalPlaneBuffers}set pathVerticalPlane(D){this._pathVerticalPlaneBuffers=D,this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncRenderer()}get pointDistanceLine(){return this._pointDistanceLine}set pointDistanceLine(D){this._pointDistanceLine=(0,ae.pC)(D)?{origin:(0,me.a)(D.origin),target:D.target?(0,me.a)(D.target):null}:null,this._syncPointDistance(),this._syncRenderer()}_syncRenderer(){this.attached&&this.visible&&(this._intersectsLineEnabled||this._heightManifoldEnabled||(0,ae.pC)(this._pointDistanceLine)||(0,ae.pC)(this._pathVerticalPlaneBuffers))?this._ensureRenderer():this._disposeRenderer()}_ensureRenderer(){(0,ae.pC)(this._renderer)||(this._renderer=new vo({renderCoordsHelper:this.view.renderCoordsHelper},{contrastControlEnabled:!0}),this._renderer.viewingMode=this.view.state.viewingMode,this._syncStyle(),this._syncHeightManifold(),this._syncIntersectsLine(),this._syncIntersectsLineInfinite(),this._syncPathVerticalPlane(),this._syncLineVerticalPlane(),this._syncPointDistance(),this._syncAngleCutoff(),this.view._stage&&this.view._stage.addRenderPlugin(this._renderer.renderSlots,this._renderer))}_syncStyle(){(0,ae.Wi)(this._renderer)||(this._renderer.setParameters(this._style),null!=this._style.intersectsLineRadius&&(this._renderer.intersectsLineRadius=this._style.intersectsLineRadius))}_syncAngleCutoff(){(0,ae.Wi)(this._renderer)||this._renderer.setParameters({angleCutoff:this._angleCutoff})}_syncHeightManifold(){(0,ae.Wi)(this._renderer)||(this._renderer.heightManifoldEnabled=this._heightManifoldEnabled&&this.visible,this._heightManifoldEnabled&&(this._renderer.heightManifoldTarget=this._heightManifoldTarget))}_syncIntersectsLine(){(0,ae.Wi)(this._renderer)||(this._renderer.intersectsLineEnabled=this._intersectsLineEnabled&&this.visible,this._intersectsLineEnabled&&(this._renderer.intersectsLineSegment=this._intersectsLine))}_syncIntersectsLineInfinite(){(0,ae.Wi)(this._renderer)||(this._renderer.intersectsLineInfinite=this._intersectsLineInfinite)}_syncPathVerticalPlane(){(0,ae.Wi)(this._renderer)||(this._renderer.pathVerticalPlaneEnabled=(0,ae.pC)(this._pathVerticalPlaneBuffers)&&this.visible,(0,ae.pC)(this._pathVerticalPlaneBuffers)&&(this._renderer.pathVerticalPlaneBuffers=this._pathVerticalPlaneBuffers))}_syncLineVerticalPlane(){(0,ae.Wi)(this._renderer)||(this._renderer.lineVerticalPlaneEnabled=(0,ae.pC)(this._lineVerticalPlaneSegment)&&this.visible,(0,ae.pC)(this._lineVerticalPlaneSegment)&&(this._renderer.lineVerticalPlaneSegment=this._lineVerticalPlaneSegment))}_syncPointDistance(){if((0,ae.Wi)(this._renderer))return;const D=this._pointDistanceLine,N=(0,ae.pC)(D);this._renderer.pointDistanceEnabled=N&&null!=D.target&&this.visible,N&&(this._renderer.pointDistanceOrigin=D.origin,null!=D.target&&(this._renderer.pointDistanceTarget=D.target))}_disposeRenderer(){(0,ae.pC)(this._renderer)&&this.view._stage&&(this.view._stage.removeRenderPlugin(this._renderer),this._renderer=null)}}const yo=(0,me.c)();var ia=oe(46021),ot=oe(57521),ze=oe(40723),na=oe(64232),di=oe(92222);class aa extends $n{constructor(D){super(D),this._ray=(0,Kt.Ue)(),this._isWorldDown=!1,this._start=(0,me.c)(),this._end=(0,me.f)(1,0,0),this._width=1,this._color=(0,Hi.f)(1,0,1,1),this._polygonOffset=!1,this._writeDepthEnabled=!0,this._innerWidth=0,this._innerColor=(0,Hi.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._stipplePreferContinuous=!0,this._falloff=0,this._extensionType=Qt.LINE,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=ze.yD.OccludeAndTransparent,this._fadedExtensions=Ts,this._laserline=new Cn({view:this.view}),this.applyProps(D)}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(D){return{view:D,createResources:N=>this._createObject3DResources(N),destroyResources:N=>this._destroyExternalResources(N),recreateGeometry:(N,Z)=>this._recreateObject3DGeometry(N,Z),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(D){return{view:D,createResources:()=>this._createDrapedResources(),destroyResources:N=>this._destroyExternalResources(N),recreateGeometry:N=>this._recreateDrapedGeometry(N)}}updateVisibility(D){super.updateVisibility(D),this._laserline.visible=D}onAttachedChange(){this._laserline.attached=this._laserlineAttached}setStartEndFromWorldDownAtLocation(D){this._isWorldDown=!0,(0,de.c)(this._start,D),this.view.renderCoordsHelper.worldUpAtPosition(D,this._end),(0,de.b)(this._end,D,this._end),(0,Kt.zk)(this._start,this._end,this._ray),this._updateGeometry()}get start(){return this._start}set start(D){this._isWorldDown=!1,(0,de.k)(this._start,D)||((0,de.c)(this._start,D),(0,Kt.zk)(this._start,this._end,this._ray),this._updateGeometry())}get end(){return this._end}set end(D){this._isWorldDown=!1,(0,de.k)(this._end,D)||((0,de.c)(this._end,D),(0,Kt.zk)(this._start,this._end,this._ray),this._updateGeometry())}get width(){return this._width}set width(D){D!==this._width&&(this._width=D,this._updateMaterial())}get color(){return this._color}set color(D){(0,mt.g)(D,this._color)||((0,mt.c)(this._color,D),this._updateMaterial())}get polygonOffset(){return this._polygonOffset}set polygonOffset(D){D!==this._polygonOffset&&(this._polygonOffset=D,this._updateMaterial())}get writeDepthEnabled(){return this._writeDepthEnabled}set writeDepthEnabled(D){this._writeDepthEnabled!==D&&(this._writeDepthEnabled=D,this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(D){D!==this._innerWidth&&(this._innerWidth=D,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(D){(0,mt.g)(D,this._innerColor)||((0,mt.c)(this._innerColor,D),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(D){const N=(0,ae.pC)(D)!==(0,ae.pC)(this._stipplePattern);this._stipplePattern=D,N?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(D){((0,ae.Wi)(D)||(0,ae.Wi)(this._stippleOffColor)||!(0,mt.g)(D,this._stippleOffColor))&&(this._stippleOffColor=(0,ae.pC)(D)?(0,Hi.c)(D):null,this._updateMaterial())}get stipplePreferContinuous(){return this._stipplePreferContinuous}set stipplePreferContinuous(D){D!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=D,this._updateMaterial())}get falloff(){return this._falloff}set falloff(D){D!==this._falloff&&(this._falloff=D,this._updateMaterial())}get extensionType(){return this._extensionType}set extensionType(D){D!==this._extensionType&&(this._extensionType=D,this.recreateGeometry())}get _laserlineAttached(){return this._laserlineEnabled&&(0,ae.pC)(this._laserlineStyle)&&this.attached&&!this.isDraped}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(D){this._laserlineStyle=D,this._laserline.attached=this._laserlineAttached,(0,ae.pC)(D)&&(this._laserline.style=D)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(D){this._laserlineEnabled!==D&&(this._laserlineEnabled=D,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(D){D!==this._renderOccluded&&(this._renderOccluded=D,this._updateMaterial())}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===ze.yD.OccludeAndTransparentStencil?ze.yD.OccludeAndTransparent:this._renderOccluded}get fadedExtensions(){return this._fadedExtensions}set fadedExtensions(D){this._fadedExtensions=(0,ae.Pt)(D,Ts),this.recreateGeometry()}_updateMaterial(){const{materialParameters:D}=this;(0,ae.WG)(this.object3dResources.resources)?.material.setParameters(D),(0,ae.WG)(this.drapedResources.resources)?.material.setParameters(D)}get materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,writeDepth:this._writeDepthEnabled}}_createObject3DResources(D){const N=new di.U(this.materialParameters),Z=new Array;return this._createObject3DGeometry(N,D,Z),{material:N,geometries:Z,forEach:K=>{K(N),Z.forEach(K)}}}_destroyExternalResources(D){D.geometries=[],D.material.dispose()}_recreateObject3DGeometry(D,N){D.geometries.length=0,this._createObject3DGeometry(D.material,N,D.geometries)}_createObject3DGeometry(D,N,Z){const K=this._createGeometry(D);Z.push(K),N.addGeometry(K),this._updateVerticesObject3D(N)}_createDrapedResources(){const D=new di.U(this.materialParameters);return{material:D,geometries:[this._createDrapedGeometry(D)]}}_recreateDrapedGeometry(D){D.geometries=[this._createDrapedGeometry(D.material)]}_createDrapedGeometry(D){const N=this._createGeometry(D);this._updateVerticesDraped(N);const Z=new na.z(N,{boundingInfo:N.boundingInfo});return Z.computeBoundingSphere(Z.transformation,Z.boundingSphere),Z}_createGeometry(D){const N=this.extensionType===Qt.FADED,Z=N?[(0,me.c)(),(0,me.c)(),(0,me.c)(),(0,me.c)()]:[(0,me.c)(),(0,me.c)()];return(0,ot.rh)(D,Z,null,N?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const D=(0,ae.WG)(this.object3dResources.object);D&&this._updateVerticesObject3D(D)}}_updateVerticesObject3D(D){const N=this._lineSegment;this._updateVertexAttributesObject3D(D,N),this._laserline.intersectsLine=N}_updateVerticesDraped(D){this._updateVertexAttributesDraped(D,this._lineSegment)}get _lineSegment(){return this._extensionType===Qt.FADED?this._updateLineSegmentFinite(xs):this._updateLineSegmentInfinite(this._extensionType,xs)}_updateLineSegmentFinite(D){return(0,yt.zk)(this._start,this._end,D)}_updateLineSegmentInfinite(D,N){const Z=this.view.state.camera;switch((0,Di.iL)(this._ray,Ai),D){case Qt.LINE:Ai.c0=-Number.MAX_VALUE;break;case Qt.RAY:case Qt.GROUND_RAY:{const J=this._ray.origin,se=(0,ae.Pt)(this.view.elevationProvider.getElevation(J[0],J[1],J[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),re=this.view.renderCoordsHelper.getAltitude(J);this._isWorldDown&&re<se&&(0,de.o)(Ai.ray.direction,Ai.ray.direction),this._extensionType===Qt.GROUND_RAY&&null!=se&&(Ai.c1=Math.abs(re-se));break}}if(!(0,fs.zq)(Z.frustum,Ai))return this._updateLineSegmentFinite(N);const K=(0,Di.Ws)(Ai,Zi),Q=(0,Di.S$)(Ai,Mo);return(0,yt.zk)(K,Q,N)}_updateVertexAttributesObject3D(D,N){const Z=D.geometries[0].getMutableAttribute(qe.T.POSITION)?.data;if(!Z)return;let K=0;for(const Q of this._lineVertices(N))Z[K++]=Q[0],Z[K++]=Q[1],Z[K++]=Q[2];D.geometryVertexAttrsUpdated(D.geometries[0])}_updateVertexAttributesDraped(D,N){const Z=D.getMutableAttribute(qe.T.POSITION)?.data;if(!Z)return;let K=0;for(const Q of this._lineVertices(N))Z[K++]=Q[0],Z[K++]=Q[1],Z[K++]=ia.Rn;D.invalidateBoundingInfo()}*_lineVertices(D){this.extensionType===Qt.FADED?(yield(0,yt.KU)(D,-this.fadedExtensions.start,Zi),yield(0,yt.KU)(D,0,Zi),yield(0,yt.KU)(D,1,Zi),yield(0,yt.KU)(D,1+this.fadedExtensions.end,Zi)):(yield(0,yt.KU)(D,0,Zi),yield(0,yt.KU)(D,1,Zi))}}const Ai=(0,Di.Ue)(),Zi=(0,me.c)(),Mo=(0,me.c)(),xs=(0,yt.Ue)();var Qt,G;(G=Qt||(Qt={}))[G.LINE=0]="LINE",G[G.RAY=1]="RAY",G[G.GROUND_RAY=2]="GROUND_RAY",G[G.FADED=3]="FADED";const ws=1/3,Ts={start:ws,end:ws};var Yi=oe(38114);class bo extends $n{constructor(D){super(D),this._location=(0,me.c)(),this._direction=(0,me.f)(1,0,0),this._width=1,this._offset=1,this._length=18,this._color=(0,Hi.f)(1,0,1,1),this._renderOccluded=ze.yD.OccludeAndTransparent,this.applyProps(D)}createObject3DResourceFactory(D){return{view:D,createResources:N=>this._createObject3DResources(N),destroyResources:N=>this._destroyObject3DResources(N),recreateGeometry:(N,Z)=>this._recreateObject3DGeometry(N,Z),cameraChanged:()=>this._updateGeometry()}}createDrapedResourceFactory(D){return{view:D,createResources:()=>this._createDrapedResources(),destroyResources:N=>this._destroyDrapedResources(N),recreateGeometry:N=>this._recreateDrapedGeometry(N)}}get location(){return this._location}set location(D){(0,de.k)(this._location,D)||((0,de.c)(this._location,D),this._updateGeometry())}get direction(){return this._direction}set direction(D){(0,de.k)(this._direction,D)||((0,de.c)(this._direction,D),this._updateGeometry())}setDirectionFromPoints(D,N){(0,de.n)(this._direction,(0,de.b)(this._direction,N,D)),this._updateGeometry()}get width(){return this._width}set width(D){D!==this._width&&(this._width=D,this._updateMaterial())}get offset(){return this._offset}set offset(D){D!==this._offset&&(this._offset=D,this._updateGeometry())}get length(){return this._length}set length(D){D!==this._length&&(this._length=D,this._updateGeometry())}get color(){return this._color}set color(D){(0,mt.g)(D,this._color)||((0,mt.c)(this._color,D),this._updateMaterial())}get renderOccluded(){return this._renderOccluded}set renderOccluded(D){D!==this._renderOccluded&&(this._renderOccluded=D,this._updateMaterial())}_createObject3DResources(D){const N=new di.U(this.materialParameters),Z=new Array;return this._createObject3DGeometry(N,D,Z),{material:N,geometries:Z,forEach:K=>{K(N),Z.forEach(K)}}}_destroyObject3DResources(D){D.geometries.length=0,D.material.dispose()}_recreateObject3DGeometry(D,N){D.geometries.length=0,this._createObject3DGeometry(D.material,N,D.geometries)}_createObject3DGeometry(D,N,Z){const[K,Q]=this._createGeometries(D);N.addGeometry(K),N.addGeometry(Q),Z.push(K),Z.push(Q),this._updateVerticesObject3D(N)}_createDrapedResources(){const D=new di.U(this.materialParameters),N=(0,ve.YP)(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()});return{material:D,geometries:this._createDrapedGeometry(D),pixelRatioHandle:N}}_destroyDrapedResources(D){D.pixelRatioHandle.remove(),D.geometries=[],D.material.dispose()}_recreateDrapedGeometry(D){D.geometries=this._createDrapedGeometry(D.material)}_createDrapedGeometry(D){const N=this._createGeometries(D);this._updateVerticesDraped(N);const Z=N.map(K=>new na.z(K,{boundingInfo:K.boundingInfo}));for(const K of Z)K.computeBoundingSphere(K.transformation,K.boundingSphere);return Z}_createGeometries(D){return[(0,ot.rh)(D,[(0,me.c)(),(0,me.c)()]),(0,ot.rh)(D,[(0,me.c)(),(0,me.c)()])]}_updateMaterial(){const{materialParameters:D}=this;(0,ae.WG)(this.object3dResources.resources)?.material.setParameters(D),(0,ae.WG)(this.drapedResources.resources)?.material.setParameters(D)}get materialParameters(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}_updateGeometry(){if(this.isDraped)this.drapedResources.recreateGeometry();else{const D=(0,ae.WG)(this.object3dResources.object);D&&this._updateVerticesObject3D(D)}}_updateVerticesObject3D(D){const N=this.view.state.camera;N.projectToScreen(this.location,ra),(0,de.a)(pi,this.location,this.direction),N.projectToScreen(pi,sn),(0,xe.f)(sn,(0,xe.a)(sn,sn,ra)),this._updateVertexAttributesObject3D(N,D,0,ra,sn,1),this._updateVertexAttributesObject3D(N,D,1,ra,sn,-1)}_updateVertexAttributesObject3D(D,N,Z,K,Q,J){const se=N.geometries[Z],re=se.getMutableAttribute(qe.T.POSITION)?.data;if(!re)return;const{start:le,end:he}=this._computeStartEnd(Q,K,J,this.offset,this.width,this.length);D.unprojectFromScreen((0,Te.c$)(le),pi),re[0]=pi[0],re[1]=pi[1],re[2]=pi[2],D.unprojectFromScreen((0,Te.c$)(he),pi),re[3]=pi[0],re[4]=pi[1],re[5]=pi[2],N.geometryVertexAttrsUpdated(se)}_updateVerticesDraped(D){const{view:{basemapTerrain:{overlayManager:N},state:{contentPixelRatio:Z}}}=this,{location:K,width:Q,length:J,offset:se}=this,re=So;re.spatialReference=(0,ae.Wg)(N.renderer.spatialReference),re.x=K[0],re.y=K[1];const le=N.overlayPixelSizeInMapUnits(re)*Z,he=Q*le,pe=J*le,ge=se*le;this._updateVertexAttributesDraped(D[0],he,pe,ge,-1),this._updateVertexAttributesDraped(D[1],he,pe,ge,1)}_updateVertexAttributesDraped(D,N,Z,K,Q){const J=D.getMutableAttribute(qe.T.POSITION)?.data;if(!J)return;const{location:se,direction:re}=this,{start:le,end:he}=this._computeStartEnd(re,se,Q,K,N,Z);J[0]=le[0],J[1]=le[1],J[2]=ia.Rn,J[3]=he[0],J[4]=he[1],J[5]=ia.Rn,D.invalidateBoundingInfo()}_computeStartEnd(D,N,Z,K,Q,J){const se=(0,xe.b)(Ds,(0,xe.s)(Ds,D[1]*Z,D[0]*-Z),K+Q/2),re=(0,xe.j)(sa,(0,xe.j)(sa,(0,xe.j)(sa,N,(0,xe.b)(sa,D,J/2)),se),se);return{start:re,end:(0,xe.j)(As,re,(0,xe.b)(As,D,-J))}}}const pi=(0,me.c)(),Ds=(0,We.a)(),sa=(0,We.a)(),As=(0,We.a)(),ra=(0,Te.s1)(),sn=(0,Te.s1)(),So=(0,Yi.Tx)(0,0,void 0,null);var Pt=oe(4794),ui=oe(5548),Se=oe(26242),Pn=oe(81468),rn=oe(79112),Rs=oe(8782),Eo=oe(10285);class Ua{constructor(D){this.view=null,this._geometry=null,this._size=3,this._color=(0,Pt.f)(1,0,1,1),this._pixelSnappingEnabled=!0,this._primitive="square",this._outlineSize=1,this._outlineColor=(0,Pt.f)(1,1,1,1),this._elevationInfo=null,this._resources=new Ms({view:D.view,createResources:Z=>this._createResources(Z),destroyResources:Z=>this._destroyResources(Z),recreateGeometry:(Z,K)=>{Z.geometry=this._recreateGeometry(K,Z.material)}});let N=!0;for(const Z in D)Z in this?"attached"===Z?N=D[Z]??!1:this[Z]=D[Z]:console.error("Cannot set unknown property",Z);this.attached=N}destroy(){this._resources.destroy()}get visible(){return this._resources.visible}set visible(D){this._resources.visible=D}get attached(){return this._resources.attached}set attached(D){this._resources.attached=D}get geometry(){return this._geometry}set geometry(D){this._geometry=D,this._resources.recreateGeometry()}get size(){return this._size}set size(D){if(D!==this._size){const N=this._preferredTextureSize;this._size=D,N<this._preferredTextureSize?(0,ae.pC)(this._resources)&&this._resources.recreate():this._updateSizeAttribute()}}get color(){return this._color}set color(D){(0,mt.g)(D,this._color)||((0,mt.c)(this._color,D),this._updateMaterial())}get pixelSnappingEnabled(){return this._pixelSnappingEnabled}set pixelSnappingEnabled(D){this._pixelSnappingEnabled!==D&&(this._pixelSnappingEnabled=D,this._updateMaterial())}get primitive(){return this._primitive}set primitive(D){this._primitive!==D&&(this._primitive=D,(0,ae.pC)(this._resources)&&this._resources.recreate())}get outlineSize(){return this._outlineSize}set outlineSize(D){D!==this._outlineSize&&(this._outlineSize=D,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(D){(0,mt.g)(D,this._outlineColor)||((0,mt.c)(this._outlineColor,D),this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(D){this._elevationInfo=D,this._resources&&this._resources.recreateGeometry()}_updateMaterial(){const D=this._resources.resources;(0,ae.Wi)(D)||D.material.setParameters(this._materialParameters(D.texture.id))}_updateSizeAttribute(){const D=this._resources.resources,N=this._resources.object;if((0,ae.Wi)(D)||(0,ae.Wi)(N))return;const Z=D.geometry;if((0,ae.Wi)(Z))return;const K=Z.getMutableAttribute(qe.T.SIZE).data,Q=this._geometrySize;K[0]=Q,K[1]=Q,N.geometryVertexAttrsUpdated(N.geometries[0])}_materialParameters(D){return{color:this._color,textureIsSignedDistanceField:!0,distanceFieldBoundingBox:Oo,occlusionTest:!1,outlineColor:this._outlineColor,outlineSize:this._outlineSize,textureId:D,polygonOffset:!1,shaderPolygonOffset:0,drawInSecondSlot:!0,depthEnabled:!1,pixelSnappingEnabled:this.pixelSnappingEnabled}}get _geometrySize(){return this._size/xn}_recreateGeometry(D,N){const Z=this._createRenderGeometry(N);return(0,ae.pC)(Z)&&D.addGeometry(Z),Z}_createResources(D){const N=(0,Rs.cU)(this._primitive,this._preferredTextureSize),Z=new Eo.A(this._materialParameters(N.id)),K=this._recreateGeometry(D,Z);return{material:Z,texture:N,geometry:K,forEach(Q){Q(N),Q(Z),(0,ae.pC)(this.geometry)&&Q(this.geometry)}}}_destroyResources(D){D.geometry=null,D.material.dispose(),D.texture.dispose()}get _preferredTextureSize(){return(0,Ct.uZ)((0,Ct.Sf)(2*this._geometrySize),16,128)}calculateMapBounds(D){if((0,ae.Wi)(this._resources.resources)||(0,ae.Wi)(this._resources.resources.geometry))return!1;const N=this._resources.resources.geometry.vertexAttributes.get(qe.T.POSITION);return(0,Xt.SH)(N.data,this.view.renderCoordsHelper.spatialReference,Ls,this.view.spatialReference),(0,ui.G1)(D,Ls),!0}_createRenderGeometry(D){const N=this.geometry;if((0,ae.Wi)(N))return null;const{renderCoordsHelper:Z,elevationProvider:K}=this.view,Q=(0,Pn.w7)(N,K,rn.o.fromElevationInfo(this.elevationInfo),Z),J=(0,de.s)(Se.WM.get(),N.x,N.y,Q),se=Se.WM.get();(0,Xt.SH)(J,N.spatialReference,se,Z.spatialReference);const re=this._geometrySize;return(0,ot.dV)(D,null,se,null,[re,re],[0,0,0,1])}}const xn=Rs.Ns,Oo=[xn/2,xn/2,1-xn/2,1-xn/2],Ls=(0,me.c)();var je=oe(28347),Wt=oe(43703),za=oe(94255),Is=oe(44968),ni=oe(92972);class Co extends $n{constructor(D){super(D),this._maxSize=0,this._position=(0,me.c)(),this._up=(0,me.c)(),this._right=(0,me.c)(),this._renderOccluded=ze.yD.OccludeAndTransparent,this._color=(0,Pt.f)(1,0,0,1),this._outlineColor=(0,Pt.f)(0,0,0,1),this._outlineSize=0,this._size=32,this._outlineRenderOccluded=ze.yD.Opaque,this.applyProps(D)}createObject3DResourceFactory(D){return{view:D,createResources:N=>this._createObject3DResources(N),destroyResources:N=>this._destroyObject3DResources(N),cameraChanged:()=>this._updateTransformObject3D()}}createDrapedResourceFactory(D){return{view:D,createResources:()=>this._createDrapedResources(),destroyResources:N=>this._destroyDrapedResources(N)}}get renderOccluded(){return this._renderOccluded}set renderOccluded(D){D!==this._renderOccluded&&(this._renderOccluded=D,this._updateQuadMaterial())}get color(){return this._color}set color(D){(0,mt.c)(this._color,D),this._updateQuadMaterial()}get outlineColor(){return this._outlineColor}set outlineColor(D){(0,mt.c)(this._outlineColor,D),this._updateOutlineMaterial()}get outlineSize(){return this._outlineSize}set outlineSize(D){const N=0===this._outlineSize!=(0===D);this._outlineSize=D,N?this.recreateGeometry():this._updateOutlineMaterial()}get size(){return this._size}set size(D){D!==this._size&&(this._size=D,this._updateTransform())}get outlineRenderOccluded(){return this._outlineRenderOccluded}set outlineRenderOccluded(D){this._outlineRenderOccluded=D,this._updateOutlineMaterial()}set geometry({previous:D,center:N,next:Z}){this._maxSize=Math.min((0,de.i)(N,D),(0,de.i)(N,Z))/3,(0,de.n)(this._up,(0,de.b)(this._up,D,N)),(0,de.n)(this._right,(0,de.b)(this._right,Z,N)),(0,de.c)(this._position,N),this.recreateGeometry()}_createObject3DResources(D){const N=new ni.E(this._quadMaterialParameters),Z=0===this._outlineSize?void 0:new di.U(this._outlineMaterialParameters);return this._createObject3DGeometries(D,N,Z),{quadMaterial:N,outlineMaterial:Z,forEach:K=>{K(N),Z&&K(Z)}}}_destroyObject3DResources(D){D.quadMaterial.dispose(),D.outlineMaterial?.dispose()}_createObject3DGeometries(D,N,Z){if((0,de.k)(this._up,me.Z)&&(0,de.k)(this._right,me.Z))return;const K=this._createGeometries(N,Z);for(const Q of K)D.addGeometry(Q);this._updateTransformObject3D(D)}_createDrapedResources(){const D=new ni.E(this._quadMaterialParameters),N=0===this._outlineSize?void 0:new di.U(this._outlineMaterialParameters),Z=this._createGeometries(D,N).map(K=>new na.z(K,{boundingInfo:K.boundingInfo}));return this._setTransformDraped(Z),{quadMaterial:D,outlineMaterial:N,geometries:Z,pixelRatioHandle:(0,ve.YP)(()=>this.view.state.contentPixelRatio,()=>{this.drapedResources.recreateGeometry()})}}_destroyDrapedResources(D){D.pixelRatioHandle.remove(),D.geometries=[],D.outlineMaterial?.dispose(),D.quadMaterial.dispose()}_createGeometries(D,N){const{up:Z,right:K,corner:Q}=this._getVertices(),J=this._quadGeometryData(Z,K,Q,D);return N?[J,(0,ot.rh)(N,[Z,Q,K])]:[J]}_getVertices(){let D=this._up,N=this._right;const Z=(0,de.a)(Se.WM.get(),D,N);return this.isDraped&&(D=(0,de.c)(Se.WM.get(),D),N=(0,de.c)(Se.WM.get(),N),D[2]=0,N[2]=0,Z[2]=0),{up:D,right:N,corner:Z}}_updateTransform(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}_updateTransformObject3D(D=(0,ae.WG)(this.object3dResources.object)){if(!D)return;const Z=this._size*this.view.state.camera.computeScreenPixelSizeAt(this._position),K=Math.min(this._maxSize,Z);(0,je.f)(Ri,this._position),(0,je.k)(Ri,Ri,[K,K,K]),D.transformation=Ri}_setTransformDraped(D){if(0===D.length)return;const{view:{basemapTerrain:{overlayManager:N},state:{contentPixelRatio:Z}}}=this,{_position:K,_size:Q}=this,J=(0,de.c)(Se.WM.get(),K);J[2]=ia.Rn;const se=Po;se.spatialReference=(0,ae.Wg)(N.renderer.spatialReference),se.x=J[0],se.y=J[1];const re=Q*(N.overlayPixelSizeInMapUnits(se)*Z),le=Math.min(this._maxSize,re);(0,je.f)(Ri,J),(0,je.k)(Ri,Ri,[le,le,1]);for(const he of D)he.updateTransformation(pe=>{(0,je.c)(pe,Ri)})}_quadGeometryData(D,N,Z,K){return new Is.Z(K,[[qe.T.POSITION,new za.a([0,0,0,...N,...D,...Z],3,!0)]],[[qe.T.POSITION,[0,1,2,1,2,3]]])}get _quadMaterialParameters(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}_updateQuadMaterial(){(0,ae.WG)(this.object3dResources.resources)?.quadMaterial.setParameters(this._quadMaterialParameters),(0,ae.WG)(this.drapedResources.resources)?.quadMaterial.setParameters(this._quadMaterialParameters)}get _outlineMaterialParameters(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}_updateOutlineMaterial(){(0,ae.WG)(this.object3dResources.resources)?.outlineMaterial?.setParameters(this._outlineMaterialParameters),(0,ae.WG)(this.drapedResources.resources)?.outlineMaterial?.setParameters(this._outlineMaterialParameters)}}const Ri=(0,Wt.c)(),Po=(0,Yi.Tx)(0,0,void 0,null);var wt=oe(36460),xo=oe(26352),ja=oe(59550),Fa=oe(44725),wo=oe(13459),Gs=oe(62160);class wn extends wo.a{sortUniqueHints(D){return D.sort((N,Z)=>(Z instanceof Gs.w?Z.length:0)-(N instanceof Gs.w?N.length:0))}visualizeIntersectionPoint(D,N){const{spatialReference:Z,view:K}=N;return(0,we.ed)(new Ua({view:K,primitive:"circle",geometry:(0,ja.SH)(D.intersectionPoint,Z),elevationInfo:D.isDraped?Ge.tR:Ge.jG,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:Mt.Z.toUnitRGBA(wt.c.orange),pixelSnappingEnabled:!1}))}visualizePoint(D,N){const{view:Z,spatialReference:K}=N,Q=this._alignPoint(D.point,D.domain,N);return(0,we.ed)(new Ua({view:Z,primitive:"circle",geometry:(0,ja.SH)(Q,K),elevationInfo:this._hintElevationInfo(D,N),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:Mt.Z.toUnitRGBA(wt.c.orange),pixelSnappingEnabled:!1}))}visualizeLine(D,N){const{view:Z,spatialReference:K}=N,Q=this._alignPoint(D.lineStart,D.domain,N),J=this._alignPoint(D.lineEnd,D.domain,N);return(0,we.ed)(this._createLineSegmentHint(D.type,Q,J,K,this._hintElevationInfo(D,N),Z,D.isDraped,D.fadeLeft,D.fadeRight))}visualizeParallelSign(D,N){const{view:Z,spatialReference:K}=N,{isDraped:Q}=D,J=this._hintElevationInfo(D,N),se=this._alignPoint(D.lineStart,D.domain,N),re=this._alignPoint(D.lineEnd,D.domain,N),le=Xi(se,K,J,Z,Q),he=Xi(re,K,J,Z,Q),pe=(0,de.h)(he,le,he,.5),ge=new bo({view:Z,attached:!1,offset:wt.c.parallelLineHintOffset,length:wt.c.parallelLineHintLength,width:wt.c.parallelLineHintWidth,color:Mt.Z.toUnitRGBA(wt.c.orange),location:pe,renderOccluded:Q?ze.yD.OccludeAndTransparent:ze.yD.Opaque,isDraped:Q,renderGroup:tn.eZ.SnappingHint});return ge.setDirectionFromPoints(le,pe),ge.attached=!0,(0,we.ed)(ge)}visualizeRightAngleQuad(D,N){const{view:Z,spatialReference:K}=N,Q=this._hintElevationInfo(D,N),{isDraped:J}=D,se=this._alignPoint(D.previousVertex,D.domain,N),re=this._alignPoint(D.centerVertex,D.domain,N),le=this._alignPoint(D.nextVertex,D.domain,N),he=Xi(se,K,Q,Z,J),pe=Xi(re,K,Q,Z,J),ge=Xi(le,K,Q,Z,J);return(0,we.ed)(new Co({view:Z,attached:!0,color:Mt.Z.toUnitRGBA(J?wt.c.orangeTransparent:wt.c.orange),renderOccluded:J?ze.yD.OccludeAndTransparent:ze.yD.Transparent,outlineRenderOccluded:J?ze.yD.OccludeAndTransparent:ze.yD.Opaque,outlineColor:Mt.Z.toUnitRGBA(wt.c.orange),outlineSize:wt.c.rightAngleHintOutlineSize,size:wt.c.rightAngleHintSize,isDraped:J,geometry:{previous:he,center:pe,next:ge},renderGroup:tn.eZ.SnappingHint}))}_createLineSegmentHint(D,N,Z,K,Q,J,se=!1,re=!0,le=!0){const he=Xi(N,K,Q,J,se),pe=Xi(Z,K,Q,J,se),ge=new aa({view:J,extensionType:Qt.FADED,start:he,end:pe,isDraped:se,color:Mt.Z.toUnitRGBA(wt.c.orange),renderOccluded:se?ze.yD.OccludeAndTransparent:ze.yD.Opaque,renderGroup:tn.eZ.SnappingHint});switch(D){case Fa.ze.TARGET:ge.width=wt.c.lineHintWidthTarget,ge.fadedExtensions={start:0,end:wt.c.lineHintFadedExtensions};break;case Fa.ze.REFERENCE_EXTENSION:ge.width=wt.c.lineHintWidthReference,ge.fadedExtensions={start:0,end:0};break;case Fa.ze.REFERENCE:ge.width=wt.c.lineHintWidthReference,ge.fadedExtensions={start:re?wt.c.lineHintFadedExtensions:0,end:le?wt.c.lineHintFadedExtensions:0}}return ge.attached=!0,ge}_alignPoint(D,N,Z){const K=this._getSelfSnappingZ(N,Z);return(0,ae.Wi)(K)?D:(0,ja.$G)(D[0],D[1],K)}_hintElevationInfo(D,N){return(0,ae.pC)(this._getSelfSnappingZ(D.domain,N))?(0,ae.Wg)(N.selfSnappingZ).elevationInfo:D.isDraped?Ge.tR:Ge.jG}_getSelfSnappingZ(D,{selfSnappingZ:N}){return D===xo.B.SELF&&(0,ae.pC)(N)?N.value:null}}function Xi(G,D,N,Z,K,Q=(0,me.c)()){return K?(0,Xt.SH)(G,D,Q,Z.basemapTerrain.overlayManager.renderer.spatialReference):(0,_s.RS)(G,D,N,Z,Q),Q}var Na=oe(78260),Ha=oe(54889);const Ye={main:new Mt.Z([255,127,0]),selected:new Mt.Z([255,255,255]),staged:new Mt.Z([12,207,255]),outline:new Mt.Z([0,0,0,.5]),selectedOutline:new Mt.Z([255,255,255])};function Tn(G,D){const N=G.clone();return N.a*=D,N}function To(G,D){const N=G.clone(),Z=(0,Na._Y)(N);Z.s*=D;const K=(0,Na.xr)(Z);return N.r=K.r,N.g=K.g,N.b=K.b,N}function qt(G,D){if(D)for(const N in D)G[N]=D[N]}class Do{constructor(D){this.color=Ye.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=ze.yD.Opaque,qt(this,D)}}class Ba{constructor(D){this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=Ye.main,this.outlineColor=Ye.outline,this.renderOccluded=ze.yD.Opaque,this.hoverOutlineColor=Ye.selectedOutline,qt(this,D)}apply(D,N){const Z=this[D];N.setParameters({color:Li(Z),transparent:"color"!==D||Z.a<1,renderOccluded:this.renderOccluded})}}class Ao{constructor(D){this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=Tn(Ye.main,.5),this.hoverColor=Ye.main,this.renderOccluded=ze.yD.Transparent,this.minSquaredEdgeLength=900,qt(this,D)}apply(D,N){const Z=this[D];N.setParameters({color:Li(Z),transparent:Z.a<1,renderOccluded:this.renderOccluded})}}class Ro{constructor(D){this.vertex=new Ba({color:Ye.main,outlineColor:Ye.outline}),this.edge=new Ba({color:To(Tn(Ye.main,2/3),.5),outlineColor:Tn(Ye.outline,.5),size:8,collisionPadding:8}),this.selected=new Ba({color:Ye.selected,outlineColor:Ye.outline}),this.edgeOffset=new Ao,qt(this,D)}}class Za{constructor(D){this.color=Ye.selected,this.width=1.5,this.stipplePattern=(0,Ha.z5)(5),this.stippleOffColor=Ye.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=Ye.selected,this.renderOccluded=ze.yD.OccludeAndTransparent,qt(this,D)}apply(D){D.color=Li(this.color),D.width=this.width,D.stipplePattern=this.stipplePattern,D.stippleOffColor=Li(this.stippleOffColor),D.falloff=this.falloff,D.innerWidth=this.innerWidth,D.innerColor=Li(this.innerColor),D.renderOccluded=this.renderOccluded}}class Lo{constructor(D){this.color=Ye.selected,this.size=4,this.outlineSize=1,this.outlineColor=Ye.outline,this.shape="square",qt(this,D)}apply(D){D.color=Li(this.color),D.size=this.size,D.outlineSize=this.outlineSize,D.outlineColor=Li(this.outlineColor),D.primitive=this.shape}}class oa{constructor(D){this.innerColor=Ye.selected,this.innerWidth=1,this.glowColor=Ye.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=.3,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=Ye.main,qt(this,D)}apply(D,N=1){const Z={glowColor:Mt.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:Mt.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*N,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in D?D.style=Z:D.laserlineStyle=Z}}class Io{constructor(D){this.outline=new Za({color:Ye.outline,renderOccluded:ze.yD.OccludeAndTransparentStencil,stippleOffColor:Ye.selected,stipplePattern:(0,Ha.z5)(5),width:1.5,innerWidth:0}),this.staged=new Za({color:Ye.selected,renderOccluded:ze.yD.OccludeAndTransparentStencil,innerColor:Ye.staged,stippleOffColor:Ye.outline,stipplePattern:(0,Ha.z5)(5),width:1.5}),this.shadowStyle=new oa({globalAlpha:.3,glowColor:Ye.main,glowFalloff:8,glowWidth:8,innerColor:Ye.selected,innerWidth:1}),qt(this,D)}}class Go{constructor(D){this.outline=new Lo({color:Ye.selected,outlineColor:Ye.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new oa({globalAlpha:.3,glowColor:Ye.main,glowFalloff:1.5,glowWidth:6,innerColor:Ye.selected,innerWidth:1,radius:2}),qt(this,D)}}class Vo extends Za{constructor(D){super(),this.extensionType=Qt.GROUND_RAY,qt(this,D)}}class Wo{constructor(D){this.lineGraphics=new Io,this.pointGraphics=new Go,this.heightPlane=new oa({globalAlpha:.3,glowColor:Ye.main,glowFalloff:8,glowWidth:8,innerColor:Ye.selected,innerWidth:1}),this.heightBox=new oa({globalAlpha:.3,glowColor:Ye.main,glowFalloff:8,glowWidth:8,innerColor:Ye.selected,innerWidth:0,heightFillColor:Ye.main}),this.zVerticalLine=new Vo({color:Tn(Ye.main,.5),falloff:2,innerColor:Tn(Ye.selected,0),renderOccluded:ze.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:Qt.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,qt(this,D)}}function Li(G){return(0,Pt.b)(Mt.Z.toUnitRGBA(G))}const be=new class Uo{constructor(D){this.visualElements=new Wo,this.reshapeManipulators=new Ro,this.zManipulator=new Do,qt(this,D)}colorToVec4(D){return Li(D)}};var ai=oe(61885),Vs=oe(79020),Ws=oe(27632);class Ki extends $n{constructor(D){super(D),this._attachmentOrigin=(0,Yi.Tx)(0,0,0,null),this._attachmentOriginDirty=!0,this.events=new ai.Z,this._geometry=null,this._width=1,this._color=(0,Hi.f)(1,0,1,1),this._innerWidth=0,this._innerColor=(0,Hi.f)(1,1,1,1),this._stipplePattern=null,this._stippleOffColor=null,this._falloff=0,this._elevationInfo=null,this._laserlineStyle=null,this._laserlineEnabled=!1,this._renderOccluded=ze.yD.OccludeAndTransparentStencil,this._attachmentOrigin.spatialReference=D.view.spatialReference,this._laserline=new Cn({view:D.view}),this.applyProps(D),this.attached=D.attached??!0}destroy(){this._laserline.destroy(),super.destroy()}createObject3DResourceFactory(D){return{view:D,createResources:N=>this._createObject3DResources(N),destroyResources:N=>this._destroyExternalResources(N),recreateGeometry:(N,Z)=>{N.geometries.length=0,this._recreateGeometry(Z,N.material,N.geometries)}}}createDrapedResourceFactory(D){return{view:D,createResources:()=>this._createDrapedResources(),destroyResources:N=>this._destroyExternalResources(N),recreateGeometry:N=>{N.geometries=this._createRenderGeometriesDraped(N.material),this._attachmentOriginChanged()}}}get _laserlineAttached(){return this.attached&&this.visible&&(0,ae.pC)(this._laserlineStyle)&&!this.isDraped&&this.laserlineEnabled}onAttachedChange(D){this._laserline.attached=this._laserlineAttached,D&&this._attachmentOriginChanged()}get geometry(){return this._geometry}set geometry(D){this._geometry=D,this.recreateGeometry()}get width(){return this._width}set width(D){D!==this._width&&(this._width=D,this._updateMaterial())}get color(){return this._color}set color(D){(0,mt.g)(D,this._color)||((0,mt.c)(this._color,D),this._updateMaterial())}get innerWidth(){return this._innerWidth}set innerWidth(D){D!==this._innerWidth&&(this._innerWidth=D,this._updateMaterial())}get innerColor(){return this._innerColor}set innerColor(D){(0,mt.g)(D,this._innerColor)||((0,mt.c)(this._innerColor,D),this._updateMaterial())}get stipplePattern(){return this._stipplePattern}set stipplePattern(D){const N=(0,ae.pC)(D)!==(0,ae.pC)(this._stipplePattern);this._stipplePattern=D,N?this.recreate():this._updateMaterial()}get stippleOffColor(){return this._stippleOffColor}set stippleOffColor(D){D&&this._stippleOffColor&&(0,mt.g)(D,this._stippleOffColor)||(this._stippleOffColor=D?(0,Hi.c)(D):null,this._updateMaterial())}get falloff(){return this._falloff}set falloff(D){D!==this._falloff&&(this._falloff=D,this._updateMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(D){this._elevationInfo=D,this.recreateGeometry()}get laserlineStyle(){return this._laserlineStyle}set laserlineStyle(D){this._laserlineStyle=D,this._laserline.attached=this._laserlineAttached,(0,ae.pC)(D)&&(this._laserline.style=D)}get laserlineEnabled(){return this._laserlineEnabled}set laserlineEnabled(D){this._laserlineEnabled!==D&&(this._laserlineEnabled=D,this._laserline.attached=this._laserlineAttached)}get renderOccluded(){return this._renderOccluded}set renderOccluded(D){D!==this._renderOccluded&&(this._renderOccluded=D,this._updateMaterial())}get attachmentOrigin(){if(!this._attachmentOriginDirty)return this._attachmentOrigin;const D=(0,ae.WG)(this.object3dResources.resources)?.geometries;if(!D||0===D.length)return null;(0,de.s)(ln,0,0,0);let N=0;for(const Z of D)Z.computeAttachmentOrigin(Us)&&((0,de.a)(ln,ln,Us),N++);return 0===N?null:((0,de.g)(ln,ln,1/N),this.view.renderCoordsHelper.fromRenderCoords(ln,this._attachmentOrigin),this._attachmentOriginDirty=!1,this._attachmentOrigin)}_updateMaterial(){(0,ae.pC)(this.object3dResources.resources)&&this.object3dResources.resources.material.setParameters(this._materialParameters),(0,ae.pC)(this.drapedResources.resources)&&this.drapedResources.resources.material.setParameters(this._materialParameters)}get _isClosed(){return(0,ae.pC)(this.geometry)&&"polygon"===this.geometry.type}get _materialParameters(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:!1,isClosed:this._isClosed,falloff:this._falloff,innerColor:this._innerColor,innerWidth:this._innerWidth,join:"round",hasPolygonOffset:!0,renderOccluded:this._normalizedRenderOccluded}}get _normalizedRenderOccluded(){return this.isDraped&&this._renderOccluded===ze.yD.OccludeAndTransparentStencil?ze.yD.OccludeAndTransparent:this._renderOccluded}_recreateGeometry(D,N,Z){this._createRenderGeometries(N,Z);for(const K of Z)D.addGeometry(K);this._attachmentOriginChanged()}_attachmentOriginChanged(){this._attachmentOriginDirty=!0,this.events.emit("attachment-origin-changed")}_destroyExternalResources(D){D.geometries=[],D.material.dispose()}_createObject3DResources(D){const N=new di.U(this._materialParameters),Z=new Array;return this._recreateGeometry(D,N,Z),{material:N,geometries:Z,forEach:K=>{K(N),Z.forEach(K)}}}_createDrapedResources(){const D=new di.U(this._materialParameters);return{material:D,geometries:this._createRenderGeometriesDraped(D)}}_createRenderGeometriesDraped(D){const N=this.geometry;if((0,ae.Wi)(N)||(0,ae.Wi)(this.view.basemapTerrain.spatialReference))return[];const Z=(0,Ws.r)(N,this.view.basemapTerrain.spatialReference),K=[];for(const{position:Q}of Z.lines){const se=new na.z((0,Vs.Y)(D,{overlayInfo:{spatialReference:this.view.basemapTerrain.spatialReference,renderCoordsHelper:this.view.renderCoordsHelper},attributeData:{position:Q},removeDuplicateStartEnd:this._isClosed})),re=(0,ui.cS)(zo);(0,ui.G1)(re,Q),(0,mt.s)(se.boundingSphere,.5*(re[0]+re[3]),.5*(re[1]+re[4]),0,.5*Math.sqrt((re[3]-re[0])*(re[3]-re[0])+(re[4]-re[1])*(re[4]-re[1]))),K.push(se)}return K}calculateMapBounds(D){if((0,ae.Wi)(this.object3dResources.resources))return!1;const N=this.view.renderCoordsHelper;for(const Z of this.object3dResources.resources.geometries){const K=Z.vertexAttributes.get(qe.T.POSITION),Q=(0,kn.bg)(K.data.length);(0,Xt.CM)(K.data,N.spatialReference,0,Q,this.view.spatialReference,0,K.data.length/3),(0,ui.G1)(D,Q)}return!0}_createRenderGeometries(D,N){const Z=this.geometry;if((0,ae.Wi)(Z))return;const K=(0,Ws.V)(Z,this.view.elevationProvider,this.view.renderCoordsHelper,rn.o.fromElevationInfo(this.elevationInfo??new Be.Z({mode:(0,Ge.VW)(Z,null)}))),Q=new Array;for(const{position:J,mapPositions:se}of K.lines)N.push((0,Vs.Y)(D,{mapPositions:se,attributeData:{position:J},removeDuplicateStartEnd:this._isClosed})),Q.push(J);this._laserline.pathVerticalPlane=Q}}const zo=(0,ui.Ue)(),Us=(0,me.c)(),ln=(0,me.c)();class jo extends La{constructor(D){super(D.view),this._resources=null,this._transform=(0,Wt.c)()}get object(){return(0,ae.pC)(this._resources)?this._resources.object:null}get transform(){return this._transform}set transform(D){(0,je.c)(this._transform,D),(0,ae.pC)(this._resources)&&(this._resources.object.transformation=this._transform)}recreate(){this.attached&&this.createResources()}recreateGeometry(){if((0,ae.Wi)(this._resources))return;const D=this._resources.object,N=this.view._stage;N.removeMany(D.geometries),D.removeAllGeometries(),this.createGeometries(D),D.visible=this.visible,N.addMany(D.geometries)}createResources(){this.destroyResources();const D=this.view._stage;if(!D)return;const N=new Ga.F({pickable:!1,updatePolicy:Jn.j.SYNC});D.add(N);const Z=new Ia.T({castShadow:!1});Z.transformation=this._transform,this.createExternalResources(),this.createGeometries(Z),D.addMany(Z.geometries),this.forEachExternalMaterial(K=>D.add(K)),D.add(Z),N.add(Z),Z.visible=this.visible,this._resources={layer:N,object:Z}}destroyResources(){const D=this.view._stage;!(0,ae.Wi)(this._resources)&&D&&(D.remove(this._resources.object),D.remove(this._resources.layer),this.forEachExternalMaterial(N=>{D.remove(N),N.dispose()}),D.removeMany(this._resources.object.geometries),this._resources.object.dispose(),this.destroyExternalResources(),this._resources=null)}updateVisibility(D){(0,ae.Wi)(this._resources)||(this._resources.object.visible=D)}}var Tt=oe(42743),No=oe(60479),Dt=oe(13934),Ho=oe(60881),Bo=oe(2282),zs=oe(42037),Mi=oe(88569),Ii=oe(44835),js=oe(41528),Zo=oe(93310);class la extends Sn.A{initializeProgram(D){return new En.$(D.rctx,la.shader.get().build(this.configuration),Fs)}_setPipelineState(D){const N=this.configuration,Z=D===Ii.A.NONE,K=D===Ii.A.FrontFace;return(0,xt.sm)({blending:N.output!==Dt.H.Color&&N.output!==Dt.H.Alpha||!N.transparent?null:Z?Mi.wu:(0,Mi.j7)(D),culling:(0,xt.zp)(N.cullFace),depthTest:{func:K?Lt.wb.LESS:N.shadingEnabled?Lt.wb.LEQUAL:Lt.wb.LESS},depthWrite:Z?N.writeDepth?xt.LZ:null:(0,Mi.K5)(D),colorWrite:xt.BK,polygonOffset:Z||K?null:Mi.E0})}initializePipeline(){return this._setPipelineState(this.configuration.transparencyPassType)}}la.shader=new bn.J(Zo.S,()=>oe.e(8271).then(oe.bind(oe,88271)));class si extends js.W{constructor(){super(...arguments),this.output=Dt.H.Color,this.cullFace=Tt.Vr.None,this.transparencyPassType=Ii.A.NONE,this.hasSlicePlane=!1,this.transparent=!1,this.writeDepth=!0,this.screenSizeEnabled=!0,this.shadingEnabled=!0,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,ce._)([(0,dt.o)({count:Dt.H.COUNT})],si.prototype,"output",void 0),(0,ce._)([(0,dt.o)({count:Tt.Vr.COUNT})],si.prototype,"cullFace",void 0),(0,ce._)([(0,dt.o)({count:Ii.A.COUNT})],si.prototype,"transparencyPassType",void 0),(0,ce._)([(0,dt.o)()],si.prototype,"hasSlicePlane",void 0),(0,ce._)([(0,dt.o)()],si.prototype,"transparent",void 0),(0,ce._)([(0,dt.o)()],si.prototype,"writeDepth",void 0),(0,ce._)([(0,dt.o)()],si.prototype,"screenSizeEnabled",void 0),(0,ce._)([(0,dt.o)()],si.prototype,"shadingEnabled",void 0),(0,ce._)([(0,dt.o)()],si.prototype,"hasMultipassTerrain",void 0),(0,ce._)([(0,dt.o)()],si.prototype,"cullAboveGround",void 0);const Fs=new Map([[qe.T.POSITION,0],[qe.T.NORMAL,1],[qe.T.OFFSET,2]]);class Ya extends ze.F5{constructor(D){super(D,new Xo),this.supportsEdges=!0,this._configuration=new si,this._vertexAttributeLocations=Fs}getConfiguration(D,N){return this._configuration.output=D,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.screenSizeEnabled=this.parameters.screenSizeEnabled,this._configuration.shadingEnabled=this.parameters.shadingEnabled,this._configuration.transparencyPassType=N.transparencyPassType,this._configuration.hasMultipassTerrain=N.multipassTerrain.enabled,this._configuration.cullAboveGround=N.multipassTerrain.cullAboveGround,this._configuration}intersect(D,N,Z,K,Q,J){if(this.parameters.screenSizeEnabled){const se=D.vertexAttributes.get(qe.T.OFFSET),re={applyToVertex:(le,he,pe,ge)=>{const ye=(0,de.s)(Ns,se.data[3*ge+0],se.data[3*ge+1],se.data[3*ge+2]),fe=(0,de.s)(Qo,le,he,pe);return(0,de.g)(ye,ye,this.parameters.screenSizeScale*Z.camera.computeRenderPixelSizeAt(ye)),(0,de.a)(fe,fe,ye),[fe[0],fe[1],fe[2]]},applyToAabb:le=>{const he=(0,ui.be)(le,Ns);return(0,ui.bA)(le,this.parameters.screenSizeScale*Z.camera.computeRenderPixelSizeAt(he))}};(0,ea.Bw)(D,Z,K,Q,re,J)}else(0,ea.Bw)(D,Z,K,Q,void 0,J)}requiresSlot(D,N){if(N===Dt.H.Highlight)return D===kt.r.OPAQUE_MATERIAL;if(N===Dt.H.Color||N===Dt.H.Alpha||N===Dt.H.ObjectAndLayerIdColor){let Z=kt.r.OPAQUE_MATERIAL;return this.parameters.transparent&&(Z=this.parameters.writeDepth?kt.r.TRANSPARENT_MATERIAL:kt.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL),D===Z||D===kt.r.DRAPED_MATERIAL}return!1}createGLMaterial(D){return new Yo(D)}createBufferWriter(){return new Ko(this.parameters.screenSizeEnabled)}}class Yo extends Ho.Z{beginSlot(D){return this.ensureTechnique(la,D)}}class Xo extends ze.Mt{constructor(){super(...arguments),this.color=(0,Pt.f)(1,1,1,1),this.shadingTint=(0,Pt.f)(0,0,0,.25),this.shadingDirection=(0,de.n)((0,me.c)(),[.5,-.5,-.5]),this.screenSizeScale=14,this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=Tt.Vr.None,this.screenSizeEnabled=!1,this.shadingEnabled=!0}}class Ko{constructor(D){this.screenSizeEnabled=D;const N=(0,bs.U$)().vec3f(qe.T.POSITION).vec3f(qe.T.NORMAL);this.screenSizeEnabled&&N.vec3f(qe.T.OFFSET),this.vertexBufferLayout=N}allocate(D){return this.vertexBufferLayout.createBuffer(D)}elementCount(D){return D.indices.get(qe.T.POSITION).length}write(D,N,Z,K,Q){if((0,zs.NK)(Z,this.vertexBufferLayout,D,N,K,Q),this.screenSizeEnabled){if(!Z.vertexAttributes.has(qe.T.OFFSET))throw new Error(`${qe.T.OFFSET} vertex attribute required for screenSizeEnabled ShadedColorMaterial`);{const J=Z.vertexAttributes.get(qe.T.OFFSET),se=Z.indices.get(qe.T.OFFSET);(0,Bo.hu)(3===J.size);const re=K.getField(qe.T.OFFSET,No.ct);if(!re)throw new Error("unable to acquire view for "+qe.T.OFFSET);(0,zs.ho)(se,J.data,N,re,Q)}}}}const Ns=(0,me.c)(),Qo=(0,me.c)();class Hs extends jo{constructor(D){super(D),this.view=null,this._renderOccluded=ze.yD.OccludeAndTransparent,this._vertices=null,this._spatialReference=null,this._color=be.colorToVec4(be.reshapeManipulators.vertex.color),this._size=be.reshapeManipulators.vertex.size,this._outlineColor=be.colorToVec4(be.reshapeManipulators.vertex.outlineColor),this._outlineSize=be.reshapeManipulators.vertex.outlineSize,this._elevationInfo=null,this.applyProps(D)}get renderOccluded(){return this._renderOccluded}set renderOccluded(D){D!==this._renderOccluded&&(this._renderOccluded=D,this._updateMaterial(),this._updateOutlineMaterial())}get vertices(){return this._vertices}set vertices(D){this._vertices=D,this.recreateGeometry()}get spatialReference(){return this._spatialReference}set spatialReference(D){this._spatialReference=D,this.recreateGeometry()}get color(){return this._color}set color(D){(0,mt.g)(D,this._color)||((0,mt.c)(this._color,D),this._updateMaterial())}get size(){return this._size}set size(D){D!==this._size&&(this._size=D,this._updateMaterial())}get outlineColor(){return this._outlineColor}set outlineColor(D){(0,mt.g)(D,this._outlineColor)||((0,mt.c)(this._outlineColor,D),this._updateOutlineMaterial())}get outlineSize(){return this._outlineSize}set outlineSize(D){D!==this._outlineSize&&(this._outlineSize=D,this._updateOutlineMaterial())}get elevationInfo(){return this._elevationInfo}set elevationInfo(D){this._elevationInfo=D,this.recreateGeometry()}get _vertexMaterialParameters(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}get _vertexOutlineMaterialParameters(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}_updateMaterial(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}_updateOutlineMaterial(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}_createRenderGeometries(){const D=this.vertices;if((0,ae.Wi)(D)||0===D.length)return[];const K=function Fo(G,D,N,Z,K){const Q=(0,kn.bg)(3*G.length),J=(0,kn.bg)(Q.length);G.forEach((le,he)=>{Q[3*he+0]=le[0],Q[3*he+1]=le[1],Q[3*he+2]=le.length>2?le[2]:0});const se=(0,Pn.rR)(Q,D,0,J,0,Q,0,Q.length/3,N,Z,K);return{numVertices:G.length,position:Q,mapPositions:J,projectionSuccess:null!=se,sampledElevation:se}}(D,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,rn.o.fromElevationInfo(this.elevationInfo)),Q=[],J=K.numVertices,se=K.position;for(let re=0;re<J;++re){const le=(0,de.s)(Jo,se[3*re+0],se[3*re+1],se[3*re+2]),he=Bs(this._vertexMaterial,.5,le),pe=Bs(this._vertexOutlineMaterial,.5,le);Q.push({vertexGeometry:he,vertexOutlineGeometry:pe})}return Q}createGeometries(D){const N=this._createRenderGeometries();for(const{vertexGeometry:Z,vertexOutlineGeometry:K}of N)D.addGeometry(Z),D.addGeometry(K)}createExternalResources(){this._vertexMaterial=new Ya({...this._vertexMaterialParameters,writeDepth:!0,cullFace:Tt.Vr.Back,screenSizeEnabled:!0}),this._vertexOutlineMaterial=new Ya({...this._vertexOutlineMaterialParameters,transparent:!0,writeDepth:!0,cullFace:Tt.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1})}destroyExternalResources(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}forEachExternalMaterial(D){D(this._vertexMaterial),D(this._vertexOutlineMaterial)}}const Jo=(0,me.c)();function Bs(G,D,N){return(0,ot.PI)(G,D,16,16,{offset:N})}let Jt=class extends ai.Z.EventedAccessor{constructor(G){super(G),this.tracking=!1,this.displaying=!1,this.isDraped=!1}};(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Jt.prototype,"graphic",void 0),(0,ce._)([(0,ue.Cb)()],Jt.prototype,"tracking",void 0),(0,ce._)([(0,ue.Cb)()],Jt.prototype,"displaying",void 0),(0,ce._)([(0,ue.Cb)()],Jt.prototype,"isDraped",void 0),Jt=(0,ce._)([(0,Ze.j)("esri.views.3d.layers.graphics.GraphicState")],Jt);var Zs=oe(47916),$o=oe(50566),Ys=oe(52181);let Qi=class extends Zs.T{constructor(G){super(G),this._activeVertexVisualElement=null,this._createGraphicState=null,this._outlineVisualElement=null,this._verticesVisualElement=null,this._verticalLineVisualElement=null,this.geometryType=null,this.type="draw-3d"}initialize(){const{mode:G,offset:D}=this.elevationInfo;this.internalGraphicsLayer.elevationInfo=new Be.Z({mode:G,offset:D})}normalizeCtorArgs(G){if(!G.elevationInfo){const D=G.hasZ??!0;return{...G,elevationInfo:(0,Ge.mF)(D)}}return G}initializeGraphic(G){const D=this._createGraphicState=new Jt({graphic:G});return(0,we.AL)([this.view.maskOccludee(G),this.view.trackGraphicState(D),(0,ve.YP)(()=>({element:this._outlineVisualElement,isDraped:D.isDraped}),({element:N,isDraped:Z})=>{(0,ae.yw)(N,K=>K.isDraped=Z)},ve.nn)])}makeDrawOperation(){const{geometryType:G}=this,D="circle"!==G&&"rectangle"!==G;return new $o.w({view:this.view,manipulators:this.manipulators,geometryType:(0,Zs.I)(G),drawingMode:this.mode,hasZ:this.hasZ,defaultZ:this.defaultZ,snapToSceneEnabled:this.snapToScene,drawSurface:new Ys.iW(this.view,this.elevationInfo,[this.internalGraphicsLayer]),elevationDrawSurface:new Ys.aL(this.elevationInfo,this.defaultZ,this.view,this.internalGraphicsLayer),hasM:!1,elevationInfo:this.elevationInfo,snappingManager:this.snappingManager,snappingVisualizer:new wn,segmentLabels:D?new Qn:null,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions,isDraped:(0,ae.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,Ge.Zz)(this.hasZ,this.elevationInfo)})}onActiveVertexChanged(G){const{view:D}=this;return(0,ae.pC)(this._activeVertexVisualElement)?(this._activeVertexVisualElement.vertices=[G],this._updateVerticalLineVisualElement(G),null):(this._activeVertexVisualElement=new Hs({view:D,spatialReference:D.spatialReference,vertices:[G],elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:be.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._activeVertexVisualElement.color=be.colorToVec4(be.reshapeManipulators.selected.color),this._activeVertexVisualElement.attached=!0,this._verticalLineVisualElement=new aa({view:D,extensionType:be.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:ze.yD.OccludeAndTransparent}),be.visualElements.zVerticalLine.apply(this._verticalLineVisualElement),(0,we.kB)(()=>{this._activeVertexVisualElement=(0,ae.SC)(this._activeVertexVisualElement),this._verticalLineVisualElement=(0,ae.SC)(this._verticalLineVisualElement)}))}_updateVerticalLineVisualElement(G){const D=this._verticalLineVisualElement;if((0,ae.Wi)(D))return;const{renderCoordsHelper:N,elevationProvider:Z}=this.view;(0,de.s)(cn,G[0],G[1],G[2]),Xs.setFromElevationInfo(this.elevationInfo),cn[2]=(0,Pn.w7)(cn,Z,Xs,N),N.toRenderCoords(cn,this.view.spatialReference,cn)?(D.setStartEndFromWorldDownAtLocation(cn),D.attached=!0):D.attached=!1}onOutlineChanged(G){if((0,ae.pC)(this._outlineVisualElement))return this._outlineVisualElement.geometry=G,null;const D=this.internalGraphicsLayer.elevationInfo;return this._outlineVisualElement=new Ki({view:this.view,geometry:G,elevationInfo:D,isDraped:(0,ae.pC)(this._createGraphicState)?this._createGraphicState.isDraped:"on-the-ground"===(0,Ge.Zz)(this.hasZ,D),attached:!1}),be.visualElements.lineGraphics.outline.apply(this._outlineVisualElement),be.visualElements.lineGraphics.shadowStyle.apply(this._outlineVisualElement),this._outlineVisualElement.attached=!0,this._outlineVisualElement.laserlineEnabled=!0,(0,we.kB)(()=>{this._outlineVisualElement=(0,ae.SC)(this._outlineVisualElement)})}onRegularVerticesChanged(G){return(0,ae.pC)(this._verticesVisualElement)?(this._verticesVisualElement.vertices=G,null):(this._verticesVisualElement=new Hs({view:this.view,spatialReference:this.view.spatialReference,vertices:G,elevationInfo:this.internalGraphicsLayer.elevationInfo,renderOccluded:be.reshapeManipulators.vertex.renderOccluded,attached:!1}),this._verticesVisualElement.attached=!0,(0,we.kB)(()=>{this._verticesVisualElement=(0,ae.SC)(this._verticesVisualElement)}))}};(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Qi.prototype,"elevationInfo",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Qi.prototype,"geometryType",void 0),(0,ce._)([(0,ue.Cb)()],Qi.prototype,"type",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Qi.prototype,"view",void 0),Qi=(0,ce._)([(0,Ze.j)("esri.views.3d.interactive.editingTools.draw.DrawGraphicTool3D")],Qi);const Xs=new rn.o,cn=(0,me.c)();var ko=oe(74333),Dn=oe(80542),It=oe(15572),ca=oe(84786),qo=(oe(29132),oe(94573)),el=oe(52323),Ks=oe(30217),tl=oe(550),il=oe(92383),Xa=oe(65401),ft=oe(90014),Ka=oe(53929);function hn(G,D,N){return function nl(G,D,N){const Z=(0,Te.Wv)((0,xe.c)(Se.WM.get(),D));if(Z[2]=0,!G.unprojectFromRenderScreen(Z,N.origin))return null;const K=(0,Te.Wv)((0,xe.c)(Se.WM.get(),D));K[2]=1;const Q=G.unprojectFromRenderScreen(K,Se.WM.get());return(0,ae.Wi)(Q)?null:((0,de.b)(N.direction,Q,N.origin),N)}(G,G.screenToRender(D,(0,Te.Wv)(Se.WM.get())),N)}var sl=oe(59598),Pe=oe(33786),dn=oe(72642);class Ft{constructor(D){this.metadata=void 0,this._camera=new sl.V,this._elevation={offset:0,override:null},this.collisionType={type:"point"},this.collisionPriority=0,this._renderObjects=new Array,this.autoScaleRenderObjects=!0,this._available=!0,this._noDisplayCount=0,this._radius=10,this._worldSized=!1,this.focusMultiplier=2,this.touchMultiplier=2.5,this.worldOriented=!1,this._modelTransform=(0,Wt.c)(),this._worldFrame=null,this._renderLocation=(0,me.c)(),this._renderLocationDirty=!0,this._location=new dn.Z({x:0,y:0,z:0}),this._elevationAlignedLocation=new dn.Z,this._elevationAlignedLocationDirty=!0,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.cursor=null,this.grabCursor=null,this._grabbing=!1,this.dragging=!1,this._hovering=!1,this._selected=!1,this._state=Pe.jg.None,this._focused=!1,this.events=new ai.Z.EventEmitter,this._screenLocation={screenPointArray:(0,Te.s1)(),renderScreenPointArray:(0,Te.J$)(),pixelSize:0},this._screenLocationDirty=!0,this._engineResourcesAddedToStage=!1,this._attached=!1,this._location.spatialReference=D.view.spatialReference;for(const Z in D)this[Z]=D[Z];const N=this.view.state?.camera;N&&this._camera.copyFrom(N)}destroy(){this._removeResourcesFromStage(),this._engineResources=null,this.view=null,this._camera=null}get _stage(){return this.view?._stage}get elevationInfo(){return this._elevationInfo}set elevationInfo(D){this._elevationInfo=D,this._elevationAlignedLocationDirty=!0,this._renderLocationDirty=!0,this._updateEngineObject()}get renderObjects(){return this._renderObjects}set renderObjects(D){this._removeResourcesFromStage(),this._engineResources=null,this._renderObjects=D.slice(),this._updateEngineObject()}set available(D){D!==this._available&&(this._available=D,this._updateEngineObject())}get available(){return this._available}disableDisplay(){return this._noDisplayCount++,1===this._noDisplayCount&&this._updateEngineObject(),{remove:(0,el.IH)(()=>{this._noDisplayCount--,0===this._noDisplayCount&&this._updateEngineObject()})}}set radius(D){D!==this._radius&&(this._radius=D,this._updateEngineObject())}get radius(){return this._radius}set worldSized(D){D!==this._worldSized&&(this._worldSized=D,this._updateEngineObject())}get worldSized(){return this._worldSized}get modelTransform(){return this._modelTransform}set modelTransform(D){Qs(D)&&(this._screenLocationDirty=!0),(0,je.c)(this._modelTransform,D),this._updateEngineObject()}get renderLocation(){return this._renderLocationDirty&&(this._renderLocationDirty=!1,this.view.renderCoordsHelper.toRenderCoords(this.elevationAlignedLocation,this._renderLocation),this.worldOriented?(this._worldFrame||(this._worldFrame=(0,Wt.c)()),function rl(G,D,N){switch(G.viewingMode){case"local":return(0,je.i)(N),!0;case"global":{const Z=(0,il.Iu)(G.renderCoordsHelper.spatialReference);(0,Xt.PR)(D,0,An,0,Z.radius),(0,Xt.yH)((0,Ct.Vl)(An[0]),(0,Ct.Vl)(An[1]),N)}}}(this.view,this._renderLocation,this._worldFrame)):this._worldFrame&&(this._worldFrame=null)),this._renderLocation}set renderLocation(D){this.view.renderCoordsHelper.fromRenderCoords(D,this._location),this.elevationAlignedLocation=this._location}get location(){return this._location}set location(D){(0,ca.WG)(D,this._location),this._notifyLocationChanged()}_notifyLocationChanged(){this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!0,this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}get elevationAlignedLocation(){return this._elevationAlignedLocationDirty?(this._evaluateElevationAlignment(),this._updateElevationAlignedLocation(),this._elevationAlignedLocation):this._elevationAlignedLocation}set elevationAlignedLocation(D){(0,ca.WG)(D,this._location),this._evaluateElevationAlignment(),this._location.z-=this._elevation.offset,this._updateElevationAlignedLocation(),this._updateEngineObject(),this.events.emit("location-update",{location:this._location})}_updateElevationAlignedLocation(){const D=(0,ae.pC)(this._elevation.override)?this._elevation.override:this.location.z||0;this._elevationAlignedLocation.x=this.location.x,this._elevationAlignedLocation.y=this.location.y,this._elevationAlignedLocation.z=D+this._elevation.offset,this._elevationAlignedLocation.spatialReference=(0,ca.D)(this.location.spatialReference),this._renderLocationDirty=!0,this._screenLocationDirty=!0,this._elevationAlignedLocationDirty=!1}grabbableForEvent(){return!0}get grabbing(){return this._grabbing}set grabbing(D){D!==this._grabbing&&(this._grabbing=D,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get hovering(){return this._hovering}set hovering(D){D!==this._hovering&&(this._hovering=D,this._setFocused(this._hovering||this._grabbing),this._updateEngineObject())}get selected(){return this._selected}set selected(D){D!==this._selected&&(this._selected=D,this._updateEngineObject(),this.events.emit("select-changed",{action:D?"select":"deselect"}))}get state(){return this._state}set state(D){D!==this._state&&(this._state=D,this._updateEngineObject())}updateStateEnabled(D,N){N?this.state|=D:this.state&=~D}_setFocused(D){D!==this._focused&&(this._focused=D,this.events.emit("focus-changed",{action:!0===D?"focus":"unfocus"}))}get focused(){return this._focused}get screenLocation(){return this._ensureScreenLocation(),this._screenLocation}_ensureScreenLocation(){if(!this._screenLocationDirty)return;let D;if(this._screenLocation.pixelSize=this._camera.computeScreenPixelSizeAt(this.renderLocation),this._screenLocationDirty=!1,Qs(this._modelTransform)){const N=this._calculateModelTransformOffset(cl);D=(0,de.a)(N,N,this.renderLocation)}else D=this.renderLocation;this._camera.projectToRenderScreen(D,this._screenLocation.renderScreenPointArray),this._camera.renderToScreen(this._screenLocation.renderScreenPointArray,this._screenLocation.screenPointArray)}get applyObjectTransform(){return this._applyObjectTransform}set applyObjectTransform(D){this._applyObjectTransform=D,this._screenLocationDirty=!0,this._updateEngineObject()}get attached(){return this._attached}intersectionDistance(D,N){if(!this.available)return null;const Z=(0,Te.md)(D,ol),K=this._getCollisionRadius(N),Q=-1*this.collisionPriority;switch(this.collisionType.type){case"point":if((0,xe.k)(this.screenLocation.screenPointArray,Z)<K*K)return this.screenLocation.renderScreenPointArray[2]+Q;break;case"line":{const J=this.collisionType.paths,se=this._getWorldToScreenObjectScale(),re=this._calculateObjectTransform(se,ha),le=K*this.screenLocation.pixelSize,he=hn(this._camera,Z,Qa);if((0,ae.Wi)(he))return null;for(const pe of J){if(0===pe.length)continue;const ge=(0,de.m)(An,pe[0],re);for(let ye=1;ye<pe.length;ye++){const fe=(0,de.m)(ks,pe[ye],re),Me=(0,yt.Gr)((0,yt.zk)(ge,fe,Js),he);if(null!=Me&&Me<le*le){const Ie=(0,de.a)(Se.WM.get(),ge,fe);(0,de.g)(Ie,Ie,.5);const De=(0,Te.So)(Se.WM.get());return this._camera.projectToRenderScreen(Ie,De),De[2]+Q}(0,de.c)(ge,fe)}}break}case"disc":{const J=this.collisionType.direction,se=this.collisionType.offset??me.Z,re=this._getWorldToScreenObjectScale(),le=this._calculateObjectTransform(re,ha),he=K*this.screenLocation.pixelSize,pe=hn(this._camera,Z,Qa);if((0,ae.Wi)(pe))return null;const ge=(0,Ks.f)($s,le),ye=(0,de.t)(er,J,ge),fe=(0,de.m)(tr,se,le);(0,ft.Yq)(fe,ye,da);const Me=qs;if((0,ft.BR)(da,pe,Me)&&(0,de.d)(Me,fe)<he*he)return this.screenLocation.renderScreenPointArray[2]+Q;break}case"ribbon":{const{paths:J,direction:se}=this.collisionType,re=this._getWorldToScreenObjectScale(),le=this._calculateObjectTransform(re,ha),he=K*this._camera.computeScreenPixelSizeAt(this.renderLocation),pe=hn(this._camera,Z,Qa);if((0,ae.Wi)(pe))return null;const ge=(0,Ks.f)($s,le),ye=(0,de.t)(er,se,ge),fe=this._calculateModelTransformPosition(tr);(0,ft.Yq)(fe,ye,da);const Me=qs;if(!(0,ft.BR)(da,pe,Me))break;for(const Ie of J){if(0===Ie.length)continue;const De=(0,de.m)(An,Ie[0],le);for(let st=1;st<Ie.length;st++){const at=(0,de.m)(ks,Ie[st],le),Ht=(0,yt.Jk)((0,yt.zk)(De,at,Js),Me);if(null!=Ht&&Ht<he*he){const ti=(0,de.a)(Se.WM.get(),De,at);(0,de.g)(ti,ti,.5);const Ot=(0,Te.So)(Se.WM.get());return this._camera.projectToRenderScreen(ti,Ot),Ot[2]+Q}(0,de.c)(De,at)}}break}default:(0,qo.Bg)(this.collisionType)}return null}attach(D={manipulator3D:{}}){const N=this._stage;if(!N)return;const Z=D.manipulator3D;if((0,ae.Wi)(Z.engineLayerId)){const K=new Ga.F({pickable:!1,updatePolicy:Jn.j.SYNC});N.add(K),Z.engineLayerId=K.id,this._engineLayer=K}else N?.getObject&&(this._engineLayer=N.getObject(Z.engineLayerId));Z.engineLayerReferences=(Z.engineLayerReferences||0)+1,this._materialIdReferences=Z.materialIdReferences,(0,ae.Wi)(this._materialIdReferences)&&(this._materialIdReferences=new Map,Z.materialIdReferences=this._materialIdReferences),this._camera.copyFrom(this.view.state.camera),this._attached=!0,this._updateEngineObject(),(0,Xt.Up)(this._location.spatialReference,this.view.spatialReference)||(this.location=new dn.Z({x:0,y:0,z:0,spatialReference:this.view.spatialReference}))}detach(D={manipulator3D:{}}){const N=D.manipulator3D;N.engineLayerReferences--;const Z=0===N.engineLayerReferences;Z&&(N.engineLayerId=null),this._removeResourcesFromStage(Z),this._engineResources=null,this._engineLayer=null,this._materialIdReferences=null,this._attached=!1}onViewChange(){this._camera.copyFrom(this.view.state.camera),this._screenLocationDirty=!0,this._updateEngineObject()}onElevationChange(D){(0,Xt.nF)(this.location,ir,D.spatialReference)&&(0,Xa.Qn)(D.extent,ir)&&this._notifyLocationChanged()}_evaluateElevationAlignment(){if((0,ae.Wi)(this.elevationInfo))return;let D=null,N=0;const Z=(0,ae.Pt)(this.elevationInfo.offset,0);switch(this.elevationInfo.mode){case"on-the-ground":D=(0,ae.Pt)((0,Ka.KO)(this.view.elevationProvider,this.location,"ground"),0);break;case"relative-to-ground":N=(0,ae.Pt)((0,Ka.KO)(this.view.elevationProvider,this.location,"ground"),0)+Z;break;case"relative-to-scene":N=(0,ae.Pt)((0,Ka.KO)(this.view.elevationProvider,this.location,"scene"),0)+Z;break;case"absolute-height":N=Z}return N!==this._elevation.offset||D!==this._elevation.override?(this._elevation.offset=N,void(this._elevation.override=D)):void 0}_updateEngineObject(){if(!this._attached)return;if(!this.available)return void this._removeResourcesFromStage();const D=this._getWorldToScreenObjectScale(),N=ha;if(!0===this.autoScaleRenderObjects){const J=this._getFocusedSize(this._radius,this.focused)*D;this._calculateObjectTransform(J,N)}else this._calculateObjectTransform(D,N);const{objectsByState:Z}=this._ensureEngineResources(),K=(this.focused?Pe.Q9.Focused:Pe.Q9.Unfocused)|(this.selected?Pe.Q9.Selected:Pe.Q9.Unselected),Q=this._noDisplayCount>0;for(const{stateMask:J,objects:se}of Z)if(Q)for(const ge of se)ge.visible=!1;else if((J&Pe.Q9.All)!==Pe.Q9.None&&(K&J)!=(J&Pe.Q9.All)||(J&Pe.jg.All)!==Pe.jg.None&&(this.state&J)!=(J&Pe.jg.All))for(const ge of se)ge.visible=!1;else for(const ge of se)ge.visible=!0,ge.transformation=N}_ensureEngineResources(){if((0,ae.Wi)(this._engineResources)){const D=(0,ae.Wg)(this._engineLayer),N=[],Z=new Set;this.renderObjects.forEach(({geometry:{material:J}})=>{Z.has(J)||(N.push(J),Z.add(J))});const K=new Map;this._renderObjects.forEach(J=>{const se=new Ia.T({castShadow:!1,geometries:[J.geometry]}),re=K.get(J.stateMask)||[];re.push(se),K.set(J.stateMask,re)});const Q=[];K.forEach((J,se)=>Q.push({stateMask:se,objects:J})),this._engineResources={objectsByState:Q,layer:D,materials:N}}return this._addResourcesToStage(),this._engineResources}_addResourcesToStage(){const D=this._stage;if(this._engineResourcesAddedToStage||(0,ae.Wi)(this._engineResources)||!D)return;const{objectsByState:N,layer:Z,materials:K}=this._engineResources;K.forEach(Q=>{const J=(0,ae.Wg)(this._materialIdReferences),se=J.get(Q.id)||0;0===se&&D.add(Q),J.set(Q.id,se+1)}),N.forEach(({objects:Q})=>{Z.addMany(Q),D.addMany(Q)}),this._engineResourcesAddedToStage=!0}_removeResourcesFromStage(D=!1){const N=this._stage;if(!this._engineResourcesAddedToStage||(0,ae.Wi)(this._engineResources)||!N)return;const{objectsByState:Z,layer:K,materials:Q}=this._engineResources;Z.forEach(({objects:J})=>{K.removeMany(J),N.removeMany(J)}),Q.forEach(J=>{const se=(0,ae.Wg)(this._materialIdReferences),re=se.get(J.id);1===re?(N.remove(J),se.delete(J.id)):se.set(J.id,re-1)}),D&&N.remove(K),this._engineResourcesAddedToStage=!1}_getCollisionRadius(D){return this._getFocusedSize(this.radius,!0)*("touch"===D?this.touchMultiplier:1)}_getFocusedSize(D,N){return D*(N?this.focusMultiplier:1)}_getWorldToScreenObjectScale(){return this._worldSized?1:this.screenLocation.pixelSize}_calculateModelTransformPosition(D){const N=this._getWorldToScreenObjectScale(),Z=this._calculateObjectTransform(N,ll);return(0,de.s)(D,Z[12],Z[13],Z[14])}_calculateModelTransformOffset(D){const N=this._calculateModelTransformPosition(D);return(0,de.b)(D,N,this.renderLocation)}_calculateObjectTransform(D,N){return(0,je.s)(N,D,0,0,0,0,D,0,0,0,0,D,0,0,0,0,1),this._worldFrame&&(0,je.m)(N,N,this._worldFrame),(0,je.m)(N,N,this._modelTransform),N[12]+=this.renderLocation[0],N[13]+=this.renderLocation[1],N[14]+=this.renderLocation[2],N[15]=1,(0,ae.pC)(this._applyObjectTransform)&&this._applyObjectTransform(N),N}get test(){let D=!1;if((0,ae.pC)(this._engineResources))for(const N in this._engineResources.objectsByState){const Z=this._engineResources.objectsByState[N];for(const K of Z.objects)if(K.visible){D=!0;break}if(D)break}return{areAnyResourcesVisible:D}}}function Qs(G){return 0!==G[12]||0!==G[13]||0!==G[14]}const ol=(0,Te.s1)(),Js=(0,yt.Ue)(),Qa=(0,Kt.Ue)(),$s=(0,tl.c)(),ll=(0,Wt.c)(),ha=(0,Wt.c)(),da=(0,ft.Ue)(),An=(0,me.c)(),ks=(0,me.c)(),qs=(0,me.c)(),er=(0,me.c)(),tr=(0,me.c)(),cl=(0,me.c)(),ir=new dn.Z({x:0,y:0,z:0,spatialReference:null});class Ve{constructor(D,N=Pe.Q9.None){this.geometry=D,this.stateMask=N}}var hl=oe(67225),dl=oe(33470),pl=oe(2770),ul=oe(66131),gl=oe(15842),Ja=oe(64127),_l=oe(34013);class pa extends Sn.A{initializeProgram(D){return new En.$(D.rctx,pa.shader.get().build(this.configuration),Wa.i)}_setPipelineState(D,N){const Z=this.configuration,K=D===Ii.A.NONE,Q=D===Ii.A.FrontFace;return(0,xt.sm)({blending:Z.output!==Dt.H.Color&&Z.output!==Dt.H.Alpha||!Z.transparent?null:K?ml:(0,Mi.j7)(D),culling:(0,xt.zp)(Z.cullFace),depthTest:{func:(0,Mi.Bh)(D)},depthWrite:K?Z.writeDepth?xt.LZ:null:(0,Mi.K5)(D),colorWrite:xt.BK,stencilWrite:Z.hasOccludees?Ja.s3:null,stencilTest:Z.hasOccludees?N?Ja.eD:Ja.RY:null,polygonOffset:K||Q?null:(0,Mi.je)(Z.enableOffset)})}initializePipeline(){return this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0),this._setPipelineState(this.configuration.transparencyPassType,!1)}getPipelineState(D,N){return N?this._occludeePipelineState:super.getPipelineState(D,N)}}pa.shader=new bn.J(_l.I,()=>oe.e(8586).then(oe.bind(oe,18586)));const ml=(0,xt.if)(Lt.zi.ONE,Lt.zi.ONE_MINUS_SRC_ALPHA);class ri extends js.W{constructor(){super(...arguments),this.output=Dt.H.Color,this.cullFace=Tt.Vr.None,this.hasSlicePlane=!1,this.transparent=!1,this.enableOffset=!0,this.writeDepth=!0,this.hasOccludees=!1,this.transparencyPassType=Ii.A.NONE,this.hasMultipassTerrain=!1,this.cullAboveGround=!1}}(0,ce._)([(0,dt.o)({count:Dt.H.COUNT})],ri.prototype,"output",void 0),(0,ce._)([(0,dt.o)({count:Tt.Vr.COUNT})],ri.prototype,"cullFace",void 0),(0,ce._)([(0,dt.o)()],ri.prototype,"hasSlicePlane",void 0),(0,ce._)([(0,dt.o)()],ri.prototype,"transparent",void 0),(0,ce._)([(0,dt.o)()],ri.prototype,"enableOffset",void 0),(0,ce._)([(0,dt.o)()],ri.prototype,"writeDepth",void 0),(0,ce._)([(0,dt.o)()],ri.prototype,"hasOccludees",void 0),(0,ce._)([(0,dt.o)({count:Ii.A.COUNT})],ri.prototype,"transparencyPassType",void 0),(0,ce._)([(0,dt.o)()],ri.prototype,"hasMultipassTerrain",void 0),(0,ce._)([(0,dt.o)()],ri.prototype,"cullAboveGround",void 0);class fl extends gl.c{constructor(D){super(D,new yl),this.supportsEdges=!0,this._configuration=new ri}getConfiguration(D,N){return this._configuration.output=D,this._configuration.cullFace=this.parameters.cullFace,this._configuration.hasSlicePlane=this.parameters.hasSlicePlane,this._configuration.transparent=this.parameters.transparent,this._configuration.writeDepth=this.parameters.writeDepth,this._configuration.hasOccludees=this.parameters.hasOccludees,this._configuration.transparencyPassType=N.transparencyPassType,this._configuration.enableOffset=N.camera.relativeElevation<Mi.ve,this._configuration.hasMultipassTerrain=N.multipassTerrain.enabled,this._configuration.cullAboveGround=N.multipassTerrain.cullAboveGround,this._configuration}requiresSlot(D,N){return!(N!==Dt.H.Color&&N!==Dt.H.Alpha&&N!==Dt.H.Highlight||D!==kt.r.DRAPED_MATERIAL&&(N===Dt.H.Highlight?D!==kt.r.OPAQUE_MATERIAL:D!==(this.parameters.transparent?this.parameters.writeDepth?kt.r.TRANSPARENT_MATERIAL:kt.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:kt.r.OPAQUE_MATERIAL)))}createGLMaterial(D){return new vl(D)}createBufferWriter(){return new pl.G(ul.W1)}}class vl extends dl.F{constructor(D){super({...D,...D.material.parameters})}_updateParameters(D){return this.updateTexture(this._material.parameters.textureId),this._material.setParameters(this.textureBindParameters),this.ensureTechnique(pa,D)}_updateOccludeeState(D){D.hasOccludees!==this._material.parameters.hasOccludees&&(this._material.setParameters({hasOccludees:D.hasOccludees}),this._updateParameters(D))}beginSlot(D){return this._output!==Dt.H.Color&&this._output!==Dt.H.Alpha||this._updateOccludeeState(D),this._updateParameters(D)}}class yl extends ze.Mt{constructor(){super(...arguments),this.transparent=!1,this.writeDepth=!0,this.hasSlicePlane=!1,this.cullFace=Tt.Vr.None,this.hasOccludees=!1,this.opacity=1,this.textureId=null,this.initTextureTransparent=!0}}var $a=oe(49580);function gi(G,D=ze.yD.OccludeAndTransparent,N=!0){const Z=(0,Pt.f)(G[0],G[1],G[2],G.length>3?G[3]:1),K=G[3]<1;return N?new Ya({color:Z,transparent:K,writeDepth:!0,cullFace:Tt.Vr.Back,renderOccluded:D}):new ni.E({color:Z,transparent:K,writeDepth:!0,cullFace:Tt.Vr.Back,renderOccluded:D})}function Rn(G,D=ze.yD.OccludeAndTransparent){const N=(0,Pt.f)(G[0],G[1],G[2],4===G.length?G[3]:1);return new ni.E({color:N,transparent:!0,writeDepth:!0,cullFace:Tt.Vr.Front,renderOccluded:D})}const Ln=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1,calloutColor:(0,me.f)(1,.5,0)});const Sl=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});function nr(G,D,N,Z){const K=(0,de.b)(Se.WM.get(),G,N),Q=ar(K,(0,de.f)(Se.WM.get(),Z,K),N,Se.MP.get());(0,je.a)(Q,Q);const J=(0,de.m)(Se.WM.get(),D,Q);return Math.atan2(J[1],J[0])}function ar(G,D,N,Z){const K=(0,de.n)(Se.WM.get(),G),Q=(0,de.n)(Se.WM.get(),D),J=(0,de.f)(Se.WM.get(),K,Q);return Z[0]=K[0],Z[1]=K[1],Z[2]=K[2],Z[3]=0,Z[4]=Q[0],Z[5]=Q[1],Z[6]=Q[2],Z[7]=0,Z[8]=J[0],Z[9]=J[1],Z[10]=J[2],Z[11]=0,Z[12]=N[0],Z[13]=N[1],Z[14]=N[2],Z[15]=1,Z}function ua(G,D){const N=G.getViewForGraphic(D);return(0,ae.pC)(N)&&"computeAttachmentOrigin"in N?N.computeAttachmentOrigin(D,G.spatialReference):null}function sr(G,D,N){const Z=ua(G,N);(0,ae.pC)(Z)?D.elevationAlignedLocation=Z:function El(G,D){if((0,ae.Wi)(D))return;const N="mesh"===D.type?D.anchor:(0,hl.zE)(D);(0,ae.Wi)(N)||(G.location=(0,ca.kB)(N))}(D,N.geometry)}var oi,lt,rr=oe(69648);function Ji(G,D=(0,Ge.RL)(G)){return"on-the-ground"!==D.mode&&!((0,ae.Wi)(G.geometry)||!G.geometry.hasZ)}!function(G){G[G.NONE=0]="NONE",G[G.ANY=1]="ANY",G[G.Z=2]="Z",G[G.XY=4]="XY"}(oi||(oi={})),function(G){G[G.TRANSLATE_Z=0]="TRANSLATE_Z",G[G.TRANSLATE_XY=1]="TRANSLATE_XY",G[G.SCALE=2]="SCALE",G[G.ROTATE=3]="ROTATE",G[G.SCALE_ROTATE=4]="SCALE_ROTATE"}(lt||(lt={}));class or{constructor(){this.grabbingState=oi.NONE,this.zManipulator=null,this.firstSelected=null,this.numSelected=0,this.firstGrabbedXY=null}update(D){this.grabbingState=oi.NONE,this.zManipulator=null,this.numSelected=0,this.firstSelected=null,this.firstGrabbedXY=null,D.forEachManipulator((N,Z)=>{if(Z===lt.TRANSLATE_Z&&(this.zManipulator=N),N instanceof Ft&&(N.selected&&(0===this.numSelected&&(this.firstSelected=N),this.numSelected++),(0,ae.Wi)(this.firstGrabbedXY)&&N.grabbing&&Z===lt.TRANSLATE_XY&&(this.firstGrabbedXY=N)),N.grabbing)switch(this.grabbingState|=oi.ANY,Z){case lt.TRANSLATE_Z:this.grabbingState|=oi.Z;break;case lt.TRANSLATE_XY:this.grabbingState|=oi.XY}})}}function Pl(G,D,N){const{graphic:Z,view:K}=G,Q=[],J=(0,Ge.RL)(Z),se="on-the-ground"===J.mode||!J.offset&&"absolute-height"!==J.mode,re=new or,le=new aa({view:K,extensionType:be.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:ze.yD.OccludeAndTransparent});be.visualElements.pointGraphics.shadowStyle.apply(le);const he=(0,Ct.Vl)(be.visualElements.heightPlaneAngleCutoff),pe=new Cn({view:K,attached:!1,angleCutoff:he});be.visualElements.heightPlane.apply(pe);let ge=1,ye=1;const fe=()=>{if(re.update(G),!N.displaying||se&&(N.isDraped||!ka(Z)||!Z.geometry.hasZ))return D.laserlineEnabled=!1,le.attached=!1,void(pe.attached=!1);D.laserlineEnabled=!0;const De=re.grabbingState&oi.XY?be.visualElements.laserlineAlphaMultiplier:1;De!==ge&&(ge=De,be.visualElements.lineGraphics.shadowStyle.apply(D,De),be.visualElements.pointGraphics.shadowStyle.apply(le,De));const st=re.grabbingState&oi.Z?be.visualElements.laserlineAlphaMultiplier:1;st!==ye&&(ye=st,be.visualElements.heightPlane.apply(pe,st)),function xl(G,D){const N=1===D.numSelected?D.firstSelected:D.numSelected>1&&(0,ae.pC)(D.firstGrabbedXY)?D.firstGrabbedXY:null;(0,ae.pC)(N)?(G.setStartEndFromWorldDownAtLocation(N.renderLocation),G.attached=!0):G.attached=!1}(le,re),function wl(G,D,N,Z){if(Z.numSelected>0){(0,de.s)($i,0,0,0);let K=0;G.forEachManipulator((Q,J)=>{J===lt.TRANSLATE_XY&&Q.selected&&Q instanceof Ft&&((0,de.a)($i,$i,Q.renderLocation),K++)}),K>0?(N.heightManifoldTarget=(0,de.g)($i,$i,1/K),N.attached=!0):N.attached=!1}else{const K=D.attachmentOrigin;(0,ae.pC)(K)&&G.view.renderCoordsHelper.toRenderCoords(K,$i)?(N.heightManifoldTarget=$i,N.attached=!0):N.attached=!1}}(G,D,pe,re)};be.visualElements.zVerticalLine.apply(le),Q.push(N.on("changed",fe),(0,ve.YP)(()=>N.displaying,fe),D.events.on("attachment-origin-changed",fe),(0,we.ed)(le),(0,we.ed)(pe));const Me=[],Ie=()=>{(0,we.AL)(Me).remove(),Me.length=0,G.forEachManipulator(De=>Me.push(De.events.on("grab-changed",fe))),G.forEachManipulator(De=>Me.push(De.events.on("select-changed",fe))),fe()};return Ie(),Q.push(G.onManipulatorsChanged(Ie),(0,we.iU)(()=>(0,we.AL)(Me))),(0,we.AL)(Q)}function ka(G){return(0,ae.pC)(G.geometry)&&("polygon"===G.geometry.type||"polyline"===G.geometry.type)}const $i=(0,me.c)();function Tl(G){const{view:D,graphic:N}=G,Z=new Jt({graphic:N}),K=[],Q=function Al(G,D,N){const{view:Z,graphic:K}=G,Q=new Ua({view:Z,geometry:qa(K),elevationInfo:(0,Ge.RL)(K),attached:!1});return function Rl(G,D,N,Z){(function Ll(G,D,N,Z){const{view:K,graphic:Q}=G;let J=null;const re=()=>{const le=qa(Q);(le=>{(0,ae.pC)(J)&&(J.remove(),J=null),N.isDraped&&(0,ae.pC)(le)&&(J=function Il(G,D,N){(0,Xt.KC)(D,li,G.elevationProvider.spatialReference);const K=li[0],Q=li[1];return G.elevationProvider.on("elevation-change",J=>{(0,Xa.jE)(J.extent,K,Q)&&N()})}(K,le,()=>{D.geometry=le}))})(le),D.geometry=le};Z.push(N.on("changed",re),(0,we.iU)(()=>J)),re()})(G,D,N,Z),be.visualElements.pointGraphics.outline.apply(D),Z.push((0,ve.YP)(()=>N.displaying,()=>D.attached=N.displaying,ve.nn))}(G,Q,D,N),N.push((0,we.ed)(Q)),Q}(G,Z,K);return function Dl(G,D,N,Z){const{view:K,graphic:Q}=G,J=new aa({view:K,extensionType:be.visualElements.zVerticalLine.extensionType,innerWidth:1,attached:!1,writeDepthEnabled:!1,renderOccluded:ze.yD.OccludeAndTransparent});be.visualElements.zVerticalLine.apply(J);const se=new Cn({view:K,intersectsLineInfinite:!0,attached:!1});be.visualElements.pointGraphics.shadowStyle.apply(se);const re=(0,Ct.Vl)(be.visualElements.heightPlaneAngleCutoff),le=new Cn({view:K,attached:!1,angleCutoff:re});be.visualElements.heightPlane.apply(le);const he=(0,Ge.RL)(G.graphic),pe=rn.o.fromElevationInfo(he),ge="on-the-ground"===he.mode||!he.offset&&"absolute-height"!==he.mode,ye=new or;let fe=1,Me=1;const Ie=()=>{ye.update(G);const De=qa(Q),st=ge&&(D.isDraped||(0,ae.Wi)(De)||!De.hasZ);let at=!0;if(!st&&(0,ae.pC)(De)){const Je=(0,Pn.w7)(De,K.elevationProvider,pe,K.renderCoordsHelper);(0,de.s)(li,De.x,De.y,Je),(0,Xt.SH)(li,De.spatialReference,li,K.renderCoordsHelper.spatialReference),J.setStartEndFromWorldDownAtLocation(li),se.intersectsWorldUpAtLocation=li}else at=!1;const Ht=ye.grabbingState&oi.Z?be.visualElements.laserlineAlphaMultiplier:1;Ht!==fe&&(fe=Ht,be.visualElements.heightPlane.apply(le,Ht));const ti=(0,ui.cS)(Gl);!st&&D.displaying&&Z.calculateMapBounds(ti)&&(0,Xt.SH)((0,ui.KE)(ti,li),K.spatialReference,li,K.renderCoordsHelper.spatialReference)?(le.heightManifoldTarget=li,le.attached=!0):le.attached=!1;const Ot=ye.grabbingState&oi.XY?be.visualElements.laserlineAlphaMultiplier:1;Ot!==Me&&(Me=Ot,be.visualElements.pointGraphics.shadowStyle.apply(se,Ot));const vi=at&&D.displaying&&!st;se.attached=vi,J.attached=vi};N.push((0,ve.YP)(()=>[D.displaying,D.isDraped],Ie),D.on("changed",Ie)),G.forEachManipulator(De=>{N.push(De.events.on("grab-changed",Ie))}),N.push((0,we.ed)(se)),N.push((0,we.ed)(J)),N.push((0,we.ed)(le)),Ie()}(G,Z,K,Q),K.push(D.trackGraphicState(Z)),{visualElement:Q,remove(){(0,we.AL)(K).remove()}}}function qa(G){const D=G.geometry;return(0,ae.Wi)(D)?null:"point"===D.type?D:"mesh"===D.type?D.anchor.clone():null}const li=(0,me.c)(),Gl=(0,ui.Ue)();function ga(G){switch((0,ae.Wg)(G.graphic.geometry).type){case"point":case"mesh":return Tl(G);case"polygon":case"polyline":return function Ol(G){const{view:D,graphic:N}=G,Z=new Jt({graphic:N}),K=function Cl(G,D){const{view:N,graphic:Z}=G,K=new Ki({view:N,geometry:ka(Z)?Z.geometry:null,elevationInfo:(0,Ge.RL)(Z),attached:!1});be.visualElements.lineGraphics.shadowStyle.apply(K);const Q=()=>{K.attached=D.displaying};be.visualElements.lineGraphics.outline.apply(K);const J=[(0,ve.YP)(()=>D.displaying,Q),(0,ve.YP)(()=>D.isDraped,se=>{K.isDraped=se}),D.on("changed",()=>K.geometry=ka(Z)?Z.geometry:null),(0,we.ed)(K)];return Q(),{visualElement:K,remove:()=>(0,we.AL)(J).remove()}}(G,Z),Q=[K,Pl(G,K.visualElement,Z),D.maskOccludee(N),D.trackGraphicState(Z)];return{visualElement:K.visualElement,remove:()=>(0,we.AL)(Q).remove()}}(G);default:return null}}const Vl=[1,.5,0],hr=Math.ceil(70/3*2),Hl=5*Math.PI/12,Bl=1*Math.PI/3;var un=oe(72392);class In{constructor(){this._available=!0}set location(D){this._forEachManipulator3D(N=>N.location=D)}set elevationAlignedLocation(D){this._forEachManipulator3D(N=>N.elevationAlignedLocation=D)}set elevationInfo(D){this._forEachManipulator3D(N=>N.elevationInfo=D)}get renderLocation(){let D;return this._forEachManipulator3D(N=>{D||(D=N.renderLocation)}),D}get available(){return this._available}set available(D){this._available=D,this._forEachManipulator3D(N=>N.available=D)}get hovering(){return this.someManipulator(D=>D.hovering)}get grabbing(){return this.someManipulator(D=>D.grabbing)}get dragging(){return this.someManipulator(D=>D.dragging)}hasManipulator(D){return this.someManipulator(N=>N===D)}someManipulator(D){let N=!1;return this.forEachManipulator(Z=>{!N&&D(Z)&&(N=!0)}),N}_forEachManipulator3D(D){this.forEachManipulator((N,Z)=>{N instanceof Ft&&D(N,Z)})}}var Gn,vr=oe(34054),Qe=(oe(62483),oe(67857),oe(40841),oe(75079));function _a(G,D){return yr(G,()=>D)}function yr(G,D){const N=(0,me.c)(),Z=(0,me.c)();let K=!1;return Q=>{const J=D(Q);if("start"===Q.action){const le=(0,Te.md)(Q.screenStart,(0,Te.c$)(Se.qW.get())),he=hn(G.state.camera,le,Er);(0,ae.pC)(he)&&(K=(0,ft.BR)(J,he,N))}if(!K)return null;const se=(0,Te.md)(Q.screenEnd,(0,Te.c$)(Se.qW.get())),re=hn(G.state.camera,se,Er);return(0,ae.Wi)(re)?null:(0,ft.BR)(J,re,Z)?{...Q,renderStart:N,renderEnd:Z,plane:J,ray:re}:null}}function ma(G,D,N,Z=null,K=null){return function Ql(G,D,N=0,Z=null,K=null){let Q=null;return J=>{if("start"===J.action&&(Q=G.sceneIntersectionHelper.intersectElevationFromScreen((0,Te.s1)(J.screenStart.x,J.screenStart.y),D,N,K),(0,ae.pC)(Q)&&(0,ae.pC)(Z)&&!(0,Xt.nF)(Q,Q,Z))||(0,ae.Wi)(Q))return null;const se=G.sceneIntersectionHelper.intersectElevationFromScreen((0,Te.s1)(J.screenEnd.x,J.screenEnd.y),D,N,K);return(0,ae.pC)(se)?(0,ae.pC)(Z)&&!(0,Xt.nF)(se,se,Z)?null:{...J,mapStart:Q,mapEnd:se}:null}}(G,N,(0,Ge.Ou)(D,G,N),Z,K)}function Mr(G,D,N,Z=null,K=null){return ma(G,N,(0,Ge.RL)(D),Z,K)}function br(G,D,N){let Z=null;const K=new Qe.hM;return K.next(_a(G,function $l(G,D){const N=ql,Z=ec,K=(0,ft.Ue)();G.renderCoordsHelper.worldUpAtPosition(D,N);const Q=(0,de.f)(K,N,(0,de.b)(Z,D,G.state.camera.eye));return(0,de.f)(Q,Q,N),(0,ft.Yq)(D,Q,K)}(G,D))).next(function kl(G,D){const N=(0,me.c)(),Z=(0,de.l)(D);G.renderCoordsHelper.worldUpAtPosition(D,N);const K=(0,me.c)(),Q=(0,me.c)(),J=se=>((0,de.b)(se,se,D),(0,vr.nF)(N,se,se),"global"===G.viewingMode&&(0,de.l)(se)*Math.sign((0,de.e)(N,se))<.001-Z&&(0,de.b)(se,(0,de.g)(se,N,.001),D),(0,de.a)(se,se,D),se);return se=>(se.renderStart=J((0,de.c)(K,se.renderStart)),se.renderEnd=J((0,de.c)(Q,se.renderEnd)),se)}(G,D)).next(Sr(G,N)).next(Q=>{Q.mapEnd.x=Q.mapStart.x,Q.mapEnd.y=Q.mapStart.y,Z=Q}),Q=>(Z=null,K.execute(Q),Z)}function Sr(G,D){const N=G.renderCoordsHelper;return Z=>{const K=N.fromRenderCoords(Z.renderStart,D),Q=N.fromRenderCoords(Z.renderEnd,D);return(0,ae.pC)(K)&&(0,ae.pC)(Q)?{...Z,mapStart:K,mapEnd:Q}:null}}!function(G){G[G.GROUND=0]="GROUND",G[G.OTHER=1]="OTHER"}(Gn||(Gn={}));const ql=(0,me.c)(),ec=(0,me.c)(),Er=(0,Kt.Ue)();function fa(G,D,N,Z){const K=G.graphic,Q=(J,se)=>D({action:J,graphic:K,dxScreen:se.screenDeltaX,dyScreen:se.screenDeltaY});return N((J,se,re)=>(se.next(le=>("start"===le.action&&Q("start",le),le)).next((0,Qe.a9)(K,Z)).next(le=>{switch(le.action){case"start":case"update":(le.translationX||le.translationY||le.translationZ)&&Q("update",le);break;case"end":Q("end",le)}return le}),{steps:se,cancel:re=re.next((0,Qe.bD)(K)).next(le=>(Q("end",{screenDeltaX:0,screenDeltaY:0}),le))}))}function Or(G){if((0,ae.Wi)(G)||"polyline"!==G.type&&"polygon"!==G.type)return 0;const D=("polyline"===G.type?G.paths:G.rings)[0];if(!D||D.length<2)return 0;const N=D[0],Z=D[1];return Math.atan2(Z[1]-N[1],Z[0]-N[0])}function va(G){if((0,ae.Wi)(G)||(0,ae.Wi)(G.axis))return 1;const{mapStart:D,mapEnd:N,axis:Z}=G,K=[N.x-D.x,N.y-D.y];return K[0]*Z[0]+K[1]*Z[1]>0?1:-1}class tc extends In{constructor(D){super(),this._handles=new un.Z,this._arrowManipulatorInfos=new Array,this._opaqueMaterial=this._createMaterial(),this._transparentMaterial=this._createMaterial(.5),this._angle=0,this._scale=1,this._radius=70,this._updateAfterDrag=!1,this.events=new ai.Z,this._tool=D.tool,this._view=D.view,null!=D.radius&&(this._radius=D.radius),this._createManipulators(),this.forEachManipulator(N=>this._tool.manipulators.add(N))}set orthogonalAvailable(D){this._arrowManipulatorInfos[1].manipulator.available=D,this._arrowManipulatorInfos[3].manipulator.available=D}destroy(){this._handles=(0,ae.SC)(this._handles),this.forEachManipulator(D=>{this._tool.manipulators.remove(D),D.destroy()}),this._tool=null,this._view=null,this._arrowManipulatorInfos.length=0}forEachManipulator(D){for(const{manipulator:N}of this._arrowManipulatorInfos)D(N,lt.TRANSLATE_XY)}createGraphicDragPipeline(D,N,Z){const K=N.graphic,Q=(0,Ge.RL)(K),J=(0,ae.Wg)(K.geometry).spatialReference;return fa(N,Z,se=>this.createDragPipeline((re,le,he,pe,ge)=>(({steps:le,cancel:he}=D(re,le,he,pe,ge)),se(re,le,he)),Q,J,K),this._view.state.viewingMode)}createDragPipeline(D,N,Z,K){return(0,we.AL)(this._arrowManipulatorInfos.map(({manipulator:Q},J)=>(0,Qe.Xd)(Q,(se,re,le,he,pe)=>{const ge=re.next(ye=>({...ye,manipulatorType:lt.TRANSLATE_XY})).next((0,Qe.kY)(this._view,se.elevationAlignedLocation)).next(ma(this._view,se.elevationAlignedLocation,N,Z,K)).next((0,Qe.M2)(se.location,this.angle+(J+1)*Math.PI*.5)).next((0,Qe.zh)());D(se,ge,le,he,pe)})))}get angle(){return this._angle}set angle(D){this._angle=D,this.dragging?this._updateAfterDrag=!0:this._updateManipulatorTransform()}get displayScale(){return this._scale}set displayScale(D){this._scale=D,this._updateManipulatorTransform()}get radius(){return this._radius}set radius(D){this._radius!==D&&(this._radius=D,this._updateManipulators())}_updateManipulators(){for(let D=0;D<this._arrowManipulatorInfos.length;D++)this._updateArrowManipulator(this._arrowManipulatorInfos[D],D);this._updateManipulatorTransform()}_updateArrowManipulator({manipulator:D,transform:N},Z){const K=this._radius/70,Q=54*K,J=Q*Math.sqrt(3)/2,se=(0,ot.DA)(this._opaqueMaterial,J,Q/2,Q/2,.02);(0,ot.mx)(se,(0,je.f)(Se.MP.get(),(0,de.s)(Se.WM.get(),0,-J/3,0))),D.renderObjects=[new Ve(se,Pe.Q9.Focused),new Ve(se.instantiate({material:this._transparentMaterial}),Pe.Q9.Unfocused)],D.radius=J/3*2*1.2;const re=(0,je.b)(Se.MP.get(),Z*Math.PI/2),le=(0,je.f)(Se.MP.get(),(0,de.s)(Se.WM.get(),0,100*K,0));(0,je.m)(N,re,le)}_createManipulators(){for(let D=0;D<4;D++){const N=this._createArrowManipulator(D);this._arrowManipulatorInfos.push(N)}this._updateManipulatorTransform()}_updateManipulatorTransform(){const D=this.angle,N=(0,je.d)(Se.MP.get(),D,(0,me.f)(0,0,1));if((0,ae.Wi)(N))return;const Z=(0,je.E)(Se.MP.get(),(0,de.s)(Se.WM.get(),this.displayScale,this.displayScale,this.displayScale)),K=(0,je.m)(Se.MP.get(),Z,N);for(const Q of this._arrowManipulatorInfos){const J=(0,je.m)(Se.MP.get(),K,Q.transform);Q.manipulator.modelTransform=J}}_createArrowManipulator(D){const N=new Ft({view:this._view,autoScaleRenderObjects:!1,worldOriented:!0,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,me.f)(0,0,1)}}),Z={manipulator:N,transform:(0,Wt.c)()};return this._updateArrowManipulator(Z,D),this._handles.add(N.events.on("drag",K=>{this._updateAfterDrag&&"end"===K.action&&!this.dragging&&(this._updateManipulatorTransform(),this._updateAfterDrag=!1)})),Z}_createMaterial(D=1){const N=Mt.Z.toUnitRGBA(Ye.main);return N[3]*=D,new ni.E({color:N,transparent:1!==D,cullFace:Tt.Vr.Back,renderOccluded:ze.yD.Transparent})}get test(){return{arrowManipulators:this._arrowManipulatorInfos.map(({manipulator:D})=>D)}}}class ic{constructor(){this._view=null,this._elevationInfo=null,this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(D){if(this._enabled!==D&&(0,ae.pC)(this._lastDragEvent)&&(0,ae.pC)(this._next)){const N=this._lastDragEvent.mapEnd,Z=this._snap(this._lastDragEvent.screenEnd);(0,ae.pC)(Z)&&this._next.execute({action:"update",mapStart:this._lastDragEvent.mapStart,mapEnd:!0===D?Z:N,screenStart:this._lastDragEvent.screenEnd,screenEnd:this._lastDragEvent.screenEnd})}this._enabled=D}_snap(D){const N=(0,ae.pC)(this._view)?this._view.toMap(D,{exclude:[]}):null;return(0,ae.pC)(N)&&(0,ae.pC)(this._view)&&(N.z=(0,Ge.Ou)(N,this._view,this._elevationInfo)),N}createDragEventPipelineStep(D,N){this._view=D,this._elevationInfo=N,this._lastDragEvent=null;const Z=new Qe.hM;return this._next=Z,[K=>{if(this._lastDragEvent="end"!==K.action?{...K}:null,this._enabled){const Q=this._snap(K.screenEnd);return(0,ae.pC)(Q)?{action:K.action,mapStart:K.mapStart,mapEnd:Q,screenStart:K.screenStart,screenEnd:K.screenEnd}:null}return{action:K.action,mapStart:K.mapStart,mapEnd:K.mapEnd,screenStart:K.screenStart,screenEnd:K.screenEnd}},Z]}}class nc extends In{constructor(D){super(),this._snapToScene=new ic,this._discMaterial=this._createMaterial(),this._discMaterialTransparent=this._createMaterial(.5),this._scale=1,this._radius=70,this._view=D.view,this._tool=D.tool,null!=D.snapToScene&&(this.snapToScene=D.snapToScene),null!=D.radius&&(this._radius=D.radius),this._createManipulator(),this.forEachManipulator(N=>this._tool.manipulators.add(N))}destroy(){this.forEachManipulator(D=>{this._tool.manipulators.remove(D),D.destroy()}),this._tool=null,this._view=null,this._manipulator=null}forEachManipulator(D){D(this._manipulator,lt.TRANSLATE_XY)}get displayScale(){return this._scale}set displayScale(D){this._scale=D,this._updateManipulatorTransform()}get snapToScene(){return this._snapToScene.enabled}set snapToScene(D){this._snapToScene.enabled=D}get radius(){return this._radius}set radius(D){D!==this._radius&&(this._radius=D,this._updateManipulator())}createGraphicDragPipeline(D,N,Z){const K=N.graphic,Q=(0,Ge.RL)(K),J=(0,ae.Wg)(K.geometry).spatialReference;return fa(N,Z,se=>this.createDragPipeline((re,le,he,pe,ge)=>(({steps:le,cancel:he}=D(re,le,he,pe,ge)),se(re,le,he)),Q,J,K),this._view.state.viewingMode)}createDragPipeline(D,N,Z,K){const Q=this._view;return(0,Qe.Xd)(this._manipulator,(J,se,re,le,he)=>{const pe=se.next((0,Qe.kY)(Q,J.elevationAlignedLocation)).next(ma(Q,J.elevationAlignedLocation,N,Z,K)).next(...this._snapToScene.createDragEventPipelineStep(Q,N)).next(ge=>({...ge,manipulatorType:lt.TRANSLATE_XY})).next((0,Qe.zh)());D(J,pe,re,le,he)})}_updateManipulatorTransform(){const D=(0,je.E)(Se.MP.get(),(0,de.s)(Se.WM.get(),this.displayScale,this.displayScale,this.displayScale));this._manipulator.modelTransform=D}_createManipulator(){this._manipulator=new Ft({view:this._view,worldSized:!1,autoScaleRenderObjects:!1,focusMultiplier:1,touchMultiplier:1,collisionType:{type:"disc",direction:(0,me.f)(0,0,1)},worldOriented:!0}),this._updateManipulator()}_updateManipulator(){const D=(0,ot.nb)(this._discMaterial,.02,1,128,(0,me.f)(0,0,1),(0,me.f)(0,0,0));D.transformation=(0,je.E)((0,Wt.c)(),(0,me.f)(this._radius,this._radius,this._radius)),this._manipulator.renderObjects=[new Ve(D,Pe.Q9.Focused),new Ve(D.instantiate({material:this._discMaterialTransparent}),Pe.Q9.Unfocused)],this._manipulator.radius=this._radius/70*80}_createMaterial(D=1){const N=Mt.Z.toUnitRGBA(Ye.main);return N[3]*=D,new ni.E({color:N,transparent:1!==D,cullFace:Tt.Vr.Back,renderOccluded:ze.yD.Transparent})}get test(){return{discManipulator:this._manipulator}}}class ac extends In{constructor(D){super(),this._radius=70,this.events=new ai.Z,this._tool=D.tool,this._view=D.view,null!=D.radius&&(this._radius=D.radius),this._createManipulator(),this.forEachManipulator(N=>this._tool.manipulators.add(N))}destroy(){this.forEachManipulator(D=>{this._tool.manipulators.remove(D),D.destroy()})}forEachManipulator(D){D(this._manipulator,lt.TRANSLATE_Z)}createGraphicDragPipeline(D,N,Z){const K=(0,ae.Wg)(N.graphic.geometry).spatialReference;return fa(N,Z,Q=>this.createDragPipeline((J,se,re,le,he)=>(({steps:se,cancel:re}=D(J,se,re,le,he)),Q(J,se,re)),K),this._view.state.viewingMode)}createDragPipeline(D,N){const Z=this._view;return(0,Qe.Xd)(this._manipulator,(K,Q,J,se,re)=>{const le=Q.next(he=>({...he,manipulatorType:lt.TRANSLATE_Z})).next(br(Z,K.renderLocation,N)).next((0,Qe.zh)());D(K,le,J,se,re)})}get radius(){return this._radius}set radius(D){D!==this._radius&&(this._radius=D,this._updateManipulator())}_updateManipulator(){const D=this._radius/70,N=be.zManipulator.height*D,Z=be.zManipulator.coneHeight*D,K=be.zManipulator.coneWidth*D,Q=be.zManipulator.width*D,J=[(0,me.f)(0,0,0),(0,me.f)(0,0,N)],se=[(0,me.f)(0,0,0),(0,me.f)(0,0,N+Z)],le=(De=>{const st=(0,Wt.c)();return(0,je.w)(st,st,[0,0,N]),(0,je.r)(st,st,Math.PI/2),st})(),he=(De,st)=>{const at=(0,Na._j)(be.zManipulator.color,st);return[at.r/255,at.g/255,at.b/255,be.zManipulator.color.a*De]},pe=gi(he(1,.25),ze.yD.Occlude),ge=gi(he(1,0),ze.yD.Occlude),ye=gi(he(.7,0),be.zManipulator.renderOccluded),fe=gi(he(.85,0),be.zManipulator.renderOccluded),Me=(0,ot.PD)(pe,J,Q/2,16,!1),Ie=(0,ot.QL)(pe,Z,K/2,16,!1);Ie.transformation=le,this._manipulator.renderObjects=[new Ve(Ie,Pe.Q9.Unfocused),new Ve(Me,Pe.Q9.Unfocused),new Ve(Ie.instantiate({material:ge}),Pe.Q9.Focused),new Ve(Me.instantiate({material:ge}),Pe.Q9.Focused),new Ve(Ie.instantiate({material:ye}),Pe.Q9.Unfocused),new Ve(Me.instantiate({material:ye}),Pe.Q9.Unfocused),new Ve(Ie.instantiate({material:fe}),Pe.Q9.Focused),new Ve(Me.instantiate({material:fe}),Pe.Q9.Focused)],this._manipulator.radius=Q/2+2,this._manipulator.collisionType={type:"line",paths:[se]}}_createManipulator(){const D=new Ft({view:this._view,autoScaleRenderObjects:!1,worldSized:!1,selectable:!1,cursor:"ns-resize",elevationInfo:this.elevationInfo,worldOriented:!0,collisionPriority:1.6});D.applyObjectTransform=N=>{const Z=this._view.state.camera,K=Cr;this._view.renderCoordsHelper.toRenderCoords(this._manipulator.elevationAlignedLocation,K);const Q=(0,de.j)(Z.eye,K),J=Z.computeRenderPixelSizeAtDist(Q),se=(0,de.b)(gn,K,Z.eye);(0,de.n)(se,se);const re=sc;this._view.renderCoordsHelper.worldUpAtPosition(Cr,re);const le=Math.abs((0,de.e)(se,re)),he=(0,de.f)(gn,se,re),pe=(0,de.f)(gn,he,re),ge=(0,Ct.uZ)(le,.01,1),ye=1-Math.sqrt(1-ge*ge)/ge/Z.fullWidth,Me=be.zManipulator.width*(this._radius/70);(0,de.g)(pe,(0,de.n)(pe,pe),(1/ye-1)*Q+J*Me),N[12]-=gn[0],N[13]-=gn[1],N[14]-=gn[2]},this._manipulator=D,this._updateManipulator()}get test(){return{manipulator:this._manipulator}}}const Cr=(0,me.c)(),gn=(0,me.c)(),sc=(0,me.c)();class qi extends In{constructor(D){super(),this._handles=new un.Z,this._interactive=!0;const{tool:N,view:Z,snapToScene:K,radius:Q}=D;this._view=Z,this.xyManipulation=new nc({tool:N,view:Z,snapToScene:K,radius:Q}),this.xyAxisManipulation=new tc({tool:N,view:Z,radius:Q}),this.zManipulation=new ac({tool:N,view:Z,radius:Q}),this.xyManipulation.available=D.xyAvailable,this.xyAxisManipulation.available=D.xyAxisAvailable,this.zManipulation.available=D.zAvailable,this._autoHideXYAxis(),this.forEachManipulator(J=>this._handles.add(J.events.on("grab-changed",()=>this._updateManipulatorInteractivity())))}destroy(){this._handles.destroy(),this.xyManipulation.destroy(),this.xyAxisManipulation.destroy(),this.zManipulation.destroy()}createGraphicDragPipeline(D,N,Z){return(0,we.AL)([this.xyManipulation.createGraphicDragPipeline((K,Q,J,se,re)=>D(Xe.XY,K,Q,J,se,re),N,Z),this.xyAxisManipulation.createGraphicDragPipeline((K,Q,J,se,re)=>D(Xe.XY_AXIS,K,Q,J,se,re),N,Z),this.zManipulation.createGraphicDragPipeline((K,Q,J,se,re)=>D(Xe.Z,K,Q,J,se,re),N,Z)])}createDragPipeline(D,N,Z,K){return(0,we.AL)([this.xyManipulation.createDragPipeline((Q,J,se,re,le)=>D(Xe.XY,Q,J,se,re,le),N,Z,K),this.xyAxisManipulation.createDragPipeline((Q,J,se,re,le)=>D(Xe.XY_AXIS,Q,J,se,re,le),N,Z,K),this.zManipulation.createDragPipeline((Q,J,se,re,le)=>D(Xe.Z,Q,J,se,re,le),Z)])}set snapToScene(D){this.xyManipulation.snapToScene=D}set angle(D){this.xyAxisManipulation.angle=D}set interactive(D){this._interactive!==D&&(this._interactive=D,this._updateManipulatorInteractivity())}set radius(D){this.xyAxisManipulation.radius=D,this.xyManipulation.radius=D,this.zManipulation.radius=D}set displayScale(D){this.xyManipulation.displayScale=D,this.xyAxisManipulation.displayScale=D}forEachManipulator(D){this.xyManipulation.forEachManipulator(N=>D(N,lt.TRANSLATE_XY)),this.xyAxisManipulation.forEachManipulator(N=>D(N,lt.TRANSLATE_XY)),this.zManipulation.forEachManipulator(N=>D(N,lt.TRANSLATE_Z))}get _xyAxisVisible(){const D=this.xyManipulation.someManipulator(N=>N.focused)||this.xyAxisManipulation.someManipulator(N=>N.focused);return this._view.inputManager&&"touch"===this._view.inputManager.latestPointerType||D}_autoHideXYAxis(){const D=this.xyAxisManipulation,N=this.xyManipulation;if((0,St.Z)("esri-mobile"))return;const Z=[];N.forEachManipulator(Q=>Z.push(Q)),D.forEachManipulator(Q=>Z.push(Q));const K=()=>{const Q=[];this._xyAxisVisible||D.forEachManipulator(J=>Q.push(J.disableDisplay())),this._handles.remove(Pr),this._handles.add(Q,Pr)};for(const Q of Z)this._handles.add(Q.events.on("focus-changed",K));this._view.inputManager&&this._handles.add((0,ve.gx)(()=>this._view.inputManager?.latestPointerType,K)),K()}_updateManipulatorInteractivity(){const D=this.grabbing;this.forEachManipulator(N=>{N.interactive=!D&&this._interactive||N.grabbing})}static radiusForSymbol(D){const N=(0,ae.pC)(D)&&"point-3d"===D.type&&D.symbolLayers;return N&&N.length>0&&N.some(Z=>"icon"===Z.type)?hr:70}}const Pr="disable-xy-axis-display";var Xe;!function(G){G[G.XY=0]="XY",G[G.XY_AXIS=1]="XY_AXIS",G[G.Z=2]="Z"}(Xe||(Xe={}));var rc=oe(90585);class is extends In{constructor(D){super(),this._view=D.view,this._tool=D.tool,this._graphicState=D.graphicState,this._createManipulator(),this.forEachManipulator(N=>this._tool.manipulators.add(N))}destroy(){this.forEachManipulator(D=>{this._tool.manipulators.remove(D),D.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphicState=null}forEachManipulator(D){D(this._manipulator,lt.TRANSLATE_XY)}createGraphicDragPipeline(D){return fa(this._graphicState,D,N=>this.createDragPipeline(N),this._view.state.viewingMode)}createDragPipeline(D){const N=this._view,Z=this._graphicState.graphic,K=(0,ae.pC)(Z.geometry)?Z.geometry.spatialReference:null;return(0,Qe.Xd)(this._manipulator,(Q,J,se,re,le)=>{const he=J.next(function Jl(G,D,N,Z){const K=D.toMap(G.screenStart,{include:[N]});return(0,ae.pC)(K)?Mr(D,N,K,Z):null}(le,N,Z,K)).next((0,Qe.AN)()).next((0,Qe.zh)());D(Q,he,se,re,le)})}_createManipulator(){this._manipulator=new rc.L({graphic:this._graphicState.graphic,view:this._view,selectable:!0,cursor:"move"})}}var oc=oe(96064),ya=oe(22944),Ma=oe(26777),Gi=oe(9997),ba=oe(9773),Sa=oe(94009),Vn=oe(60358),Nt=oe(31712),_n=oe(71572);class lc{constructor(D){this.allGraphics=D,this.type="graphic-move-start"}}class cc{constructor(D,N,Z){this.dx=D,this.dy=N,this.allGraphics=Z,this.type="graphic-move"}}class xr{constructor(D){this.allGraphics=D,this.type="graphic-move-stop"}}let mi=class extends((0,Dn.p)(ai.Z.EventedMixin(ya.m))){constructor(G){super(G),this.graphics=new ko.Z,this.enableZ=!0,this.tooltipOptions=new Gi.Z,this.type="move-3d",this._tooltip=null}initialize(){const{graphics:G,view:D}=this;this.addHandles([G.on("change",()=>this._refreshManipulators()),(0,ve.YP)(()=>this.tooltipOptions.enabled,N=>{this._tooltip=N?new Vn.u({view:D}):(0,ae.SC)(this._tooltip)},ve.tX)]),this._refreshManipulators(),this.finishToolCreation()}destroy(){this._tooltip=(0,ae.SC)(this._tooltip),this._moveManipulation=(0,ae.SC)(this._moveManipulation),this.graphics.removeAll(),this._set("view",null)}get updating(){return this.updatingHandles.updating}reset(){}_refreshManipulators(){this.handles.removeAll(),this._moveManipulation?.destroy(),this.manipulators.removeAll();const G=this.graphics.toArray().filter(D=>(0,oc.P)(D)===rr.e.SUPPORTED).map(D=>new hc(D));G.length&&(this._createManipulators(G),this._createVisualElements(G),this.handles.add(G.map(D=>this.view.trackGraphicState(D.state))),this._updateMoveManipulation(G))}_createManipulators(G){for(const D of G){const N=D.state;D.manipulationXY=new is({tool:this,view:this.view,graphicState:N}),D.manipulationXY.forEachManipulator(Z=>this.handles.add([Z.events.on("immediate-click",K=>{this.emit("immediate-click",{...K,graphic:N.graphic}),K.stopPropagation()}),Z.events.on("grab-changed",({action:K})=>{const{tooltipOptions:Q,_tooltip:J}=this;(0,ae.Wi)(J)||("start"===K?J.info=new Nt.$E({tooltipOptions:Q}):J.clear())})])),this.handles.add(D.manipulationXY.createDragPipeline((Z,K,Q,J)=>this._buildDragEventPipeline(G,Xe.XY,Z,K,Q,J)))}this._createMoveManipulation(G)}_createMoveManipulation(G){const D=new qi({tool:this,view:this.view,snapToScene:!1,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:!0,radius:1===G.length?qi.radiusForSymbol(G[0].graphic.symbol):70});this._moveManipulation=D,D.elevationInfo={mode:"absolute-height",offset:0},D.forEachManipulator(Q=>{this.handles.add(Q.events.on("immediate-click",J=>{D.zManipulation.hasManipulator(Q)||1!==this.graphics.length||this.emit("immediate-click",{...J,graphic:this.graphics.getItemAt(0)}),J.stopPropagation()}))});const N=Q=>J=>{this.handles.add(J.events.on("focus-changed",({action:se})=>{const re=this._tooltip;(0,ae.Wi)(re)||("focus"===se?this._updateMoveTooltip(G,Q):re.clear())}))};this._moveManipulation.xyManipulation.forEachManipulator(N(Xe.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(N(Xe.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(N(Xe.Z));const Z=()=>this._updateMoveManipulation(G);for(const Q of G)this.handles.add([Q.state.on("changed",Z),(0,ve.YP)(()=>Q.state.displaying,Z)]);const K=G[G.length-1];this.handles.add(K.state.on("changed",()=>this._updateMoveManipulationAngle(K))),this.handles.add(D.createDragPipeline((Q,J,se,re,le)=>this._buildDragEventPipeline(G,Q,J,se,re,le),(0,Ge.RL)(K.graphic),(0,ae.Wg)(K.graphic.geometry).spatialReference,K.graphic)),this._updateMoveManipulationAngle(K)}_createVisualElements(G){for(const D of G){const Z=ga({view:this.view,graphic:D.graphic,forEachManipulator:K=>{D.manipulationXY?.forEachManipulator(K),this._moveManipulation.forEachManipulator(K)},onManipulatorsChanged:()=>(0,we.kB)()});(0,ae.Wi)(Z)||(D.geometryRepresentation=Z.visualElement,D.geometryRepresentation instanceof Ki&&this.handles.add([D.geometryRepresentation.events.on("attachment-origin-changed",()=>{D.state.isDraped||this._updateMoveManipulation(G)}),(0,ve.YP)(()=>D.state.isDraped,()=>this._updateMoveManipulation(G))]),this.handles.add(Z))}}_updateMoveManipulationAngle(G){this._moveManipulation.angle=Or(G.graphic.geometry)}_updateMoveManipulation(G){const D=(0,Yi.Tx)(0,0,0,this.view.spatialReference);let N=0,Z=!1;const K=this._moveManipulation;for(const Q of G){if(!Q.state.displaying)continue;const J=Q.state.graphic;this.enableZ&&Ji(J)&&(Z=!0);const se=Q.geometryRepresentation instanceof Ki&&!Q.state.isDraped?Q.geometryRepresentation.attachmentOrigin:ua(this.view,J);if((0,ae.pC)(se)){const{x:re,y:le,z:he}=se;D.x+=re,D.y+=le,he&&(D.z??(D.z=0),D.z+=he),N++}}N>0?(D.x/=N,D.y/=N,D.z??(D.z=0),D.z/=N,K.location=D,K.xyManipulation.available=!0,K.xyAxisManipulation.available=!0,K.zManipulation.available=Z):K.available=!1}_buildDragEventPipeline(G,D,N,Z,K,Q){const J=[],se=[];let re=null,le=null;const he=()=>{for(const pe of J)pe.dragging=!1;J.length=0,se.length=0,re=null,le=null,this._moveManipulation.interactive=!0};if(1===G.length&&D===Xe.XY){const pe=G[0].graphic;({steps:Z,cancel:K}=this._buildSnappingPipelineSteps(pe,(0,Ge.RL)(pe),Z,K,Q))}return K=K.next(pe=>le?.(pe)).next(()=>(this.emit("graphic-move-stop",new xr(se)),this.destroyed||he(),null)),{steps:Z=Z.next(pe=>{if("start"===pe.action){J.length=0,se.length=0;for(const ge of G)ge.dragging||!ge.manipulationXY?.hasManipulator(N)&&ge.manipulationXY?.grabbing||(J.push(ge),se.push(ge.graphic),ge.dragging=!0);if(0!==se.length&&(this._moveManipulation.interactive=!1,re=(0,Qe.oq)(se,this.view.state.viewingMode),le=(0,Qe.QY)(se),this.emit("graphic-move-start",new lc(se)),this.destroyed))return null}return 0!==se.length?pe:null}).next(pe=>re?.(pe)).next(pe=>(this._updateMoveTooltip(G,D,pe),pe)).next(pe=>{switch(pe.action){case"start":case"update":if(pe.translationX||pe.translationY||pe.translationZ){const ge=this.view.toScreen(pe.mapStart),ye=this.view.toScreen(pe.mapEnd);if(this.emit("graphic-move",new cc(ye.x-ge.x,ye.y-ge.y,se)),this.destroyed)return null}break;case"end":if(this.emit("graphic-move-stop",new xr(se)),this.destroyed)return null;he()}return null}),cancel:K}}_updateMoveTooltip(G,D,N){const{tooltipOptions:Z,_tooltip:K}=this;if((0,ae.Wi)(K))return;K.clear();const Q=0===G.length?"absolute-height":G[0].state.isDraped?"on-the-ground":"absolute-height";switch(D){case Xe.XY:K.info=new Nt.$E({tooltipOptions:Z}),this._updateMoveTooltipDistance(K.info,N,(J,se)=>(0,He.GQ)(J,se,Q));break;case Xe.XY_AXIS:K.info=new Nt.in({tooltipOptions:Z}),this._updateMoveTooltipDistance(K.info,N,(J,se)=>{const re=(0,He.GQ)(J,se,Q);return(0,It.bA)(re,va(N))});break;case Xe.Z:K.info=new Nt.QW({tooltipOptions:Z}),this._updateMoveTooltipDistance(K.info,N,_n._e)}}_updateMoveTooltipDistance(G,D,N){if((0,ae.pC)(D)&&"end"!==D.action){const{mapStart:Z,mapEnd:K}=D,Q=N(Z,K);G.distance=(0,ae.pC)(Q)?Q:It.yP}}_buildSnappingPipelineSteps(G,D,N,Z,K){const Q=G.geometry;if((0,ae.Wi)(Q)||"point"!==Q.type&&"mesh"!==Q.type)return{steps:N,cancel:Z};const J=("point"===Q.type?Q:Q.anchor).clone(),se=new ba.N({elevationInfo:D,pointer:K,editGeometryOperations:Ma.c.fromGeometry(J,this.view.state.viewingMode),visualizer:new wn,excludeFeature:G}),re=this.snappingManager,{snappingStep:le,cancelSnapping:he}=(0,Sa.W)({snappingContext:se,snappingManager:re,updatingHandles:this.updatingHandles});return Z=Z.next(he),{steps:N=N.next(pe=>(J.z=(0,Ge.vQ)(this.view,J,(0,Ge.RL)(G),{mode:"absolute-height",offset:0}),{...pe,snapOrigin:se.coordinateHelper.pointToVector(J)})).next(...le),cancel:Z}}get test(){return{tooltip:this._tooltip}}};(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],mi.prototype,"view",void 0),(0,ce._)([(0,ue.Cb)()],mi.prototype,"graphics",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],mi.prototype,"enableZ",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,type:Gi.Z})],mi.prototype,"tooltipOptions",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0})],mi.prototype,"snappingManager",void 0),(0,ce._)([(0,ue.Cb)()],mi.prototype,"type",void 0),(0,ce._)([(0,ue.Cb)()],mi.prototype,"updating",null),mi=(0,ce._)([(0,Ze.j)("esri.views.3d.interactive.editingTools.graphicMove3D.GraphicMoveTool")],mi);class hc{constructor(D){this.geometryRepresentation=null,this.manipulationXY=null,this.dragging=!1,this.state=new Jt({graphic:D})}get graphic(){return this.state.graphic}}var wr=oe(89557),Ea=oe(16730),dc=oe(55214),Tr=oe(86606),ns=oe(86190);function Dr(G,D,N){return new ns.A(G,"on-the-ground"===N.mode?ns.v.XY:ns.v.XYZ,D,0)}function Ar(G,D,N){const Z=(0,me.c)();if(!G.renderCoordsHelper.toRenderCoords(D,Z))return null;const K=Rr(G,D,(0,ft.mJ)(N.plane)),Q=Rr(G,D,N.edgeDirection);if((0,ae.Wi)(K)||(0,ae.Wi)(Q))return null;const J=(0,de.f)((0,me.c)(),K,Q);return(0,ft.Yq)(Z,J,(0,ft.Ue)())}function Rr(G,D,N){const Z=(0,Yi.Tx)(D.x+N[0],D.y+N[1],D.z+N[2],D.spatialReference),K=(0,me.c)(),Q=(0,me.c)();return G.renderCoordsHelper.toRenderCoords(D,K)&&G.renderCoordsHelper.toRenderCoords(Z,Q)?(0,de.r)(Q,K,Q):null}var Lr=oe(85112),bi=oe(96926),Oa=oe(62980);let Vi=class extends Oa.h{constructor(G){super(G),this.type="reshape-edge-offset",this.distance=It.yP,this.area=null,this.totalLength=null}};(0,ce._)([(0,ue.Cb)()],Vi.prototype,"type",void 0),(0,ce._)([(0,ue.Cb)()],Vi.prototype,"distance",void 0),(0,ce._)([(0,ue.Cb)()],Vi.prototype,"area",void 0),(0,ce._)([(0,ue.Cb)()],Vi.prototype,"totalLength",void 0),Vi=(0,ce._)([(0,Ze.j)("esri.views.interactive.tooltip.ReshapeEdgeOffsetTooltipInfo")],Vi);var gc=oe(65242),_c=oe(63656),mc=oe(65234);let Et=class extends(ai.Z.EventedMixin(Dn.r)){constructor(G){super(G),this._vertexManipulatorMaterial=gi(be.colorToVec4(be.reshapeManipulators.vertex.color),be.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorOutlineMaterial=Rn(be.colorToVec4(be.reshapeManipulators.vertex.outlineColor),be.reshapeManipulators.vertex.renderOccluded),this._vertexManipulatorHoverOutlineMaterial=Rn(be.colorToVec4(be.reshapeManipulators.vertex.hoverOutlineColor),be.reshapeManipulators.vertex.renderOccluded),this._edgeManipulatorMaterial=gi(be.colorToVec4(be.reshapeManipulators.edge.color),be.reshapeManipulators.edge.renderOccluded),this._edgeManipulatorOutlineMaterial=Rn(be.colorToVec4(be.reshapeManipulators.edge.outlineColor),be.reshapeManipulators.edge.renderOccluded),this._edgeOffsetManipulatorMaterial=gi(be.colorToVec4(be.reshapeManipulators.edgeOffset.color),be.reshapeManipulators.edgeOffset.renderOccluded,!1),this._edgeOffsetManipulatorHoverMaterial=gi(be.colorToVec4(be.reshapeManipulators.edgeOffset.hoverColor),be.reshapeManipulators.edgeOffset.renderOccluded,!1),this._selectedManipulatorMaterial=gi(be.colorToVec4(be.reshapeManipulators.selected.color),be.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorOutlineMaterial=Rn(be.colorToVec4(be.reshapeManipulators.selected.outlineColor),be.reshapeManipulators.selected.renderOccluded),this._selectedManipulatorHoverOutlineMaterial=Rn(be.colorToVec4(be.reshapeManipulators.selected.hoverOutlineColor),be.reshapeManipulators.selected.renderOccluded),this._selectedIndex=0,this._manipulatorHandles=new un.Z,this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0,this._reshapeEventState=gt.NONE,this._recreatingManipulators=!1,this.outputGeometry=null,this._vertexLaserLineVisualElement=null}initialize(){const{graphic:G,view:D}=this,N=this._graphicState=new Jt({graphic:G});this._tooltip=new Vn.u({view:D}),this.addHandles([(0,ve.YP)(()=>N.displaying,Z=>{for(const K of this._manipulatorInfos)K.manipulator.available=Z}),(0,ve.YP)(()=>({labels:this._segmentLabels,enabled:this._labelOptions.enabled,edgeOffsetEnabled:this.enableEdgeOffset}),({labels:Z,enabled:K,edgeOffsetEnabled:Q})=>{(0,ae.pC)(Z)&&(Z.visible=K,Z.edgeDistance=Q?"far":"default")},ve.nn),(0,ve.gx)(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),ve.nn),this.view.trackGraphicState(N)])}destroy(){this._segmentLabels=(0,ae.SC)(this._segmentLabels),this._tooltip=(0,ae.SC)(this._tooltip),this._removeManipulators()}get inputGeometry(){return(0,ae.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null}set inputGeometry(G){this._recreateEditGeometryAndManipulators(G)}get updating(){return this.updatingHandles.updating}get manipulators(){return this.tool.manipulators}get view(){return this.tool.view}get graphic(){return this.tool.graphic}get enableZShape(){return this.tool.enableZShape}get enableZVertex(){return this.tool.enableZVertex}get enableMoveGraphic(){return this.tool.enableMoveGraphic}get enableMidpoints(){return this.tool.enableMidpoints}get enableEdgeOffset(){return this.tool.enableEdgeOffset}get _labelOptions(){return this.tool.labelOptions}get _tooltipOptions(){return this.tool.tooltipOptions}removeSelectedVertices(){const G=this._manipulatorInfos.filter(D=>D.manipulator.selected&&"vertex"===D.type);this._removeVertices(G)}onManipulatorSelectionChanged(){this.emit("manipulators-changed")}_removeManipulators(){this._manipulatorHandles.removeAll(),this._moveManipulation=(0,ae.SC)(this._moveManipulation),this._graphicMoveManipulation=(0,ae.SC)(this._graphicMoveManipulation),this.manipulators.removeAll(),this._manipulatorInfos=[],this._numGrabbing=0,this._numDragging=0}_createManipulators(G){if((0,ae.Wi)(this._editGeometryOperations))return;const D=(0,Ge.RL)(this.graphic);for(const N of this._editGeometryOperations.data.components){const Z=G?.byComponentIndex.get(N.index);for(const K of N.vertices){const Q=Z?.has(K.index);this._createVertexOrEdgeManipulator(K,D,Q)}for(const K of N.edges)this._createVertexOrEdgeManipulator(K,D)}this._createGraphicMoveManipulation(),this._createMoveManipulation(D),this._createVisualElements()}get canRedo(){return(0,ae.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canRedo}get canUndo(){return(0,ae.pC)(this._editGeometryOperations)&&this._editGeometryOperations.canUndo}redo(){if((0,ae.Wi)(this._editGeometryOperations))return null;const G=this._editGeometryOperations.redo();return(0,ae.pC)(G)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),G}undo(){if((0,ae.Wi)(this._editGeometryOperations))return null;this.emit("undo");const G=this._editGeometryOperations.undo();return(0,ae.pC)(G)&&(this.outputGeometry=this._editGeometryOperations.data.geometry,this._recreateManipulators()),G}_recreateManipulators(){this._recreatingManipulators||(this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._createManipulators(),this._recreatingManipulators=!1)}_recreateEditGeometryAndManipulators(G){const D={byComponentIndex:new Map};if((0,ae.pC)(G)&&(0,ae.pC)(this.inputGeometry)&&(0,At.Pt)(G,this.inputGeometry))for(const N of this._manipulatorInfos)if("vertex"===N.type&&N.manipulator.selected){const{index:Z,component:{index:K}}=N.handle,{byComponentIndex:Q}=D,J=Q.get(K)||new Set;J.add(Z),Q.set(K,J)}this._recreatingManipulators=!0,this._removeManipulators(),this._tooltip.clear(),this._editGeometryOperations=(0,ae.SC)(this._editGeometryOperations),this._segmentLabels=(0,ae.SC)(this._segmentLabels),(0,ae.Wi)(G)||(this._editGeometryOperations=Ma.c.fromGeometry(G,this.view.state.viewingMode),this._createManipulators(D),this._segmentLabels=new Qn({context:{view:this.view,editGeometryOperations:this._editGeometryOperations,elevationInfo:(0,Ge.RL)(this.graphic),labelOptions:this._labelOptions,graphic:this.graphic,graphicState:this._graphicState},visible:this._labelOptions.enabled})),this._recreatingManipulators=!1}_perGraphicManipulatorDragAction(G,D){if("end"===D.action)return D;let N=0;const Z=[],K=this._manipulatorInfos.some(J=>"vertex"===J.type&&J.manipulator.selected),Q=G===mn.SELECTED_OR_ALL&&K;for(const J of this._manipulatorInfos)"vertex"===J.type&&(J.manipulator.grabbing||Q&&!J.manipulator.selected||Z.push(J),N++);if(0===Z.length)return D;if(this._moveVertices(Z,D),Z.length===N){if(this._updateEventState(gt.MOVING),this.destroyed)return D;this.emit("move",{type:"move",dx:D.screenDeltaX,dy:D.screenDeltaY,mover:this.graphic})}else{if(this._updateEventState(gt.RESHAPING),this.destroyed)return D;this.emit("reshape",{type:"reshape",mover:this.graphic})}return D}_isMultiVertexSelection(){return this._manipulatorInfos.reduce((G,D)=>"vertex"===D.type&&D.manipulator.selected?G+1:G,0)>1}_perVertexManipulatorDragAction(G){if(this._updateEventState(gt.RESHAPING),this.destroyed)return;const{mapDeltaX:D,mapDeltaY:N,mapDeltaZ:Z}=G;if(!D&&!N&&!Z)return;const K=[];for(const Q of this._manipulatorInfos)"vertex"===Q.type&&(Q.manipulator.selected&&!Q.manipulator.grabbing||Q===G.info)&&K.push(Q);this._moveVertices(K,G,bi.O.ACCUMULATE_STEPS),this.emit("reshape",{type:"reshape",mover:this.graphic})}_updateEventState(G){if(G===this._reshapeEventState)return!1;switch(G){case gt.NONE:if(0!==this._numGrabbing||0!==this._numDragging)return!1;switch(this._reshapeEventState){case gt.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic});break;case gt.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic})}break;case gt.MOVING:switch(this._reshapeEventState){case gt.NONE:this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic});break;case gt.RESHAPING:this.emit("reshape",{type:"reshape-stop",mover:this.graphic}),this.destroyed||this.emit("move",{type:"move-start",dx:0,dy:0,mover:this.graphic})}break;case gt.RESHAPING:switch(this._reshapeEventState){case gt.NONE:this.emit("reshape",{type:"reshape-start",mover:this.graphic});break;case gt.MOVING:this.emit("move",{type:"move-stop",dx:0,dy:0,mover:this.graphic}),this.destroyed||this.emit("reshape",{type:"reshape-start",mover:this.graphic})}}if(this.destroyed)return!1;const D=this._reshapeEventState!==G;return this._reshapeEventState=G,D}_createGraphicMoveManipulation(){const{tool:G,view:D}=this;if(this._graphicMoveManipulation=new is({tool:G,view:D,graphicState:this._graphicState}),this.enableMoveGraphic){let Z=null;this._manipulatorHandles.add(this._graphicMoveManipulation.createDragPipeline((K,Q,J)=>{Q.next(se=>this._trackNumDragging(se)).next(se=>("start"===se.action&&(Z=(0,ae.Wg)(this._editGeometryOperations).createUndoGroup()),se)).next(se=>this._perGraphicManipulatorDragAction(mn.ALL,se)).next(se=>(this._updateTranslateGraphicTooltip(Xe.XY,se),se)).next(se=>{"end"===se.action&&(this._tooltip.clear(),Z=(0,ae.hw)(Z))}),J.next(()=>this._onDragCancel(!0,()=>Z=(0,ae.hw)(Z)))})),this._graphicMoveManipulation.forEachManipulator(K=>this._manipulatorHandles.add(this._watchAndUpdateGrabState(K,!1)))}else this._graphicMoveManipulation.forEachManipulator(Z=>{Z.grabbable=!1,Z.cursor=null});this._graphicMoveManipulation.forEachManipulator(Z=>this._manipulatorHandles.add(Z.events.on("immediate-click",K=>{this._manipulatorInfos.some(Q=>Q.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...K,graphic:this.graphic}),K.stopPropagation()})))}_createMoveManipulation(G){const{graphic:D,handles:N,tool:Z,view:K}=this,Q=this._graphicState;this._moveManipulation=new qi({tool:Z,view:K,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZShape&&Ji(D),snapToScene:!1,radius:qi.radiusForSymbol(D.symbol)}),this._moveManipulation.forEachManipulator(re=>N.add([re.events.on("immediate-click",le=>{this._moveManipulation.zManipulation.hasManipulator(re)||this._manipulatorInfos.some(he=>he.manipulator.selected)||this.emit("immediate-click",{...le,graphic:D}),le.stopPropagation()}),this._watchAndUpdateGrabState(re,!1)]));const J=re=>le=>{N.add(le.events.on("focus-changed",({action:he})=>{"focus"===he&&this._tooltipOptions.enabled?this._updateTranslateTooltip(re):this._tooltip.clear()}))};this._moveManipulation.xyManipulation.forEachManipulator(J(Xe.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(J(Xe.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(J(Xe.Z)),this._moveManipulation.elevationInfo={mode:"absolute-height",offset:0};const se=(0,ae.Wg)(D.geometry).spatialReference;N.add([this._moveManipulation.createDragPipeline((re,le,he,pe,ge)=>{const{snappingStep:ye,cancelSnapping:fe}=(0,Sa.W)({predicate:Me=>!!Me.info,snappingManager:Z.snappingManager,snappingContext:new ba.N({editGeometryOperations:(0,ae.Wg)(this._editGeometryOperations),elevationInfo:G,pointer:ge,excludeFeature:D,visualizer:new wn}),updatingHandles:this.updatingHandles,useZ:!1});return pe=pe.next(Me=>(this._onDragCancel(),Me)).next(fe),{steps:he=he.next(Me=>this._trackNumDragging(Me)).next(Me=>{const Ie=this._manipulatorInfos.filter(De=>"vertex"===De.type&&De.manipulator.selected);return Me.manipulatorType===lt.TRANSLATE_XY&&1===Ie.length?{...Me,info:Ie[0],snapOrigin:Ie[0].handle.pos}:Me}).next((0,Qe.BS)(this.view,G,D)).next(...ye).next((0,Qe.AN)()).next(Me=>this._perGraphicManipulatorDragAction(mn.SELECTED_OR_ALL,Me)).next(Me=>(this._updateTranslateTooltip(re,Me),Me)),cancel:pe}},G,se,D),(0,ve.YP)(()=>Q.displaying,()=>this._updateMoveManipulationPosition(),ve.nn),Q.on("changed",()=>{this._recreatingManipulators||this._updateMoveManipulationPosition()}),(0,ve.YP)(()=>Q.isDraped,re=>{this._updateMoveManipulationPosition();const le="align-move-manipulation";re?N.add(this.view.elevationProvider.on("elevation-change",()=>this._updateMoveManipulationPosition()),le):N.remove(le)},ve.nn)])}_createVisualElements(){const{graphic:G,view:D}=this,N=ga({view:D,graphic:G,forEachManipulator:Z=>{if(!this.destroyed&&!this._recreatingManipulators){this._graphicMoveManipulation.forEachManipulator(Z),this._moveManipulation.forEachManipulator(Z);for(const K of this._manipulatorInfos)Z(K.manipulator,lt.TRANSLATE_XY)}},onManipulatorsChanged:Z=>this.on("manipulators-changed",Z)});(0,ae.pC)(N)&&(this._outlineVisualElement=N.visualElement instanceof Ki?N.visualElement:null),(0,ae.pC)(this._outlineVisualElement)&&this._manipulatorHandles.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>{this._graphicState.isDraped||this._updateMoveManipulationPosition()})),this._manipulatorHandles.add(N)}_createEdgeOffsetManipulator(G,D=(0,Ge.RL)(this.graphic)){const N=be.reshapeManipulators.edgeOffset,Z=N.size/2,K=Z+N.collisionPadding,Q=Z/K,J=Q*Math.sqrt(3)/2;(0,ae.Wi)(this._edgeOffsetManipulatorGeometryInside)&&(this._edgeOffsetManipulatorGeometryInside=(0,ot.DA)(this._edgeOffsetManipulatorMaterial,J,Q/2,Q/2,N.height,N.offset)),(0,ae.Wi)(this._edgeOffsetManipulatorGeometryOutside)&&(this._edgeOffsetManipulatorGeometryOutside=(0,ot.DA)(this._edgeOffsetManipulatorMaterial,-J,Q/2,Q/2,N.height,-N.offset));const se=[new Ve(this._edgeOffsetManipulatorGeometryInside.instantiate(),Pe.Q9.Unfocused),new Ve(this._edgeOffsetManipulatorGeometryInside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Pe.Q9.Focused),new Ve(this._edgeOffsetManipulatorGeometryOutside.instantiate(),Pe.Q9.Unfocused),new Ve(this._edgeOffsetManipulatorGeometryOutside.instantiate({material:this._edgeOffsetManipulatorHoverMaterial}),Pe.Q9.Focused)],re=new Ft({view:this.view,renderObjects:se,elevationInfo:"on-the-ground"!==D.mode||(0,Tr.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:D,worldOriented:!1,focusMultiplier:1,radius:K,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionType:{type:"disc",direction:(0,me.f)(0,0,1)},collisionPriority:1,metadata:{deleting:!1}}),le=new Ft({view:this.view,worldSized:!0,worldOriented:!1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),collisionPriority:-10,cursor:this.enableMoveGraphic?"move":"default",metadata:{deleting:!1}}),he={manipulator:re,handle:G,locationUpdateHandle:null,type:"edge",selectedIndex:0,edgeManipulator:le,elevationInfo:D,visibilityHandle:null};this._autoHideEdgeOffsetManipulator(he,N.minSquaredEdgeLength),this._updateEdgeOffsetManipulator(he);const pe=[];for(const ye of[he.handle.leftVertex,he.handle.rightVertex]){const fe=this._getManipulatorInfoFromHandle(ye);(0,ae.pC)(fe)&&pe.push(fe.manipulator.events.on("location-update",()=>this._updateEdgeOffsetManipulator(he)))}he.locationUpdateHandle=(0,we.AL)(pe),this._manipulatorHandles.add(he.locationUpdateHandle,re),this._manipulatorHandles.add([this._watchAndUpdateGrabState(re,!0),this._watchAndUpdateGrabState(le,!0)],re),this._manipulatorHandles.add((0,Qe.Xd)(re,this._createEdgeOffsetPipeline(he,D)),re),this._manipulatorHandles.add((0,Qe.Xd)(le,(ye,fe,Me,Ie)=>{if("touch"===Ie)this._createEdgeOffsetPipeline(he,D)(ye,fe,Me);else if(this.enableMoveGraphic){const De=this.graphic,st=(0,ae.pC)(De.geometry)?De.geometry.spatialReference:null;fe.next(at=>this._trackNumDragging(at)).next((0,Qe.kY)(this.view,ye.elevationAlignedLocation)).next(ma(this.view,ye.elevationAlignedLocation,D,st,De)).next((0,Qe.zh)()).next((0,Qe.AN)()).next(at=>this._perGraphicManipulatorDragAction(mn.ALL,at)).next(at=>(this._updateTranslateGraphicTooltip(Xe.XY,at),at)).next(at=>{"end"===at.action&&this._tooltip.clear()}),Me.next(()=>this._onDragCancel(!ye.metadata.deleting))}}),re);const ge=ye=>{this._manipulatorInfos.some(fe=>fe.manipulator.selected)?this._clearSelection():this.emit("immediate-click",{...ye,graphic:this.graphic}),ye.stopPropagation()};return this._manipulatorHandles.add([re.events.on("immediate-click",ge),le.events.on("immediate-click",ge),re.events.on("focus-changed",({action:ye})=>{const fe=this._tooltipOptions;if("focus"===ye&&fe.enabled){const Me=this._tooltip.info=new Vi({tooltipOptions:fe});this._updateTooltipAreaOrTotalLength(Me)}else this._tooltip.clear()})],re),this._manipulatorInfos.push(he),this.manipulators.add(re),this.manipulators.add(le),this.emit("manipulators-changed"),he}_autoHideEdgeOffsetManipulator(G,D){const N=G.manipulator,Z=G.edgeManipulator,K=()=>{G.visibilityHandle=(0,ae.hw)(G.visibilityHandle);const Q=this._getManipulatorInfoFromHandle(G.handle.leftVertex),J=this._getManipulatorInfoFromHandle(G.handle.rightVertex),se=(0,ae.pC)(Q)&&(0,ae.pC)(J)&&function uc(G,D,N){const Z=N.projectToRenderScreen(G,(0,Te.J$)()),K=N.projectToRenderScreen(D,(0,Te.J$)());return(0,ae.pC)(Z)&&(0,ae.pC)(K)?(0,de.p)((0,de.b)(Z,Z,K)):0}(Q.manipulator.renderLocation,J.manipulator.renderLocation,this.view.state.camera)<D;(!N.focused&&!Z.focused||se)&&(N.grabbable=!se,Z.grabbable=!se,G.visibilityHandle=(0,we.AL)([N.disableDisplay(),{remove:()=>{N.grabbable=!0,Z.grabbable=this.enableMoveGraphic}}]))};this._manipulatorHandles.add([N.events.on("focus-changed",K),Z.events.on("focus-changed",K),{remove:()=>{(0,ae.hw)(G.visibilityHandle),Z.metadata.deleting=!0,this.manipulators.remove(Z)}}],N),K()}_updateEdgeOffsetManipulator(G){this._updateManipulatorPosition(G);const{coordinateHelper:D}=(0,ae.Wg)(this._editGeometryOperations).data,N=Ar(this.view,G.manipulator.elevationAlignedLocation,Dr(D,G.handle,(0,ae.Wg)(G.manipulator.elevationInfo))),Z=this._getManipulatorInfoFromHandle(G.handle.leftVertex),K=this._getManipulatorInfoFromHandle(G.handle.rightVertex);if((0,ae.Wi)(Z)||(0,ae.Wi)(K))return;const Q=Z.manipulator.renderLocation,J=K.manipulator.renderLocation,se=(0,ae.pC)(N)?function pc(G,D,N){const Z=(0,ft.mJ)(G),K=(0,de.r)((0,me.c)(),D,N),Q=(0,de.f)((0,me.c)(),K,Z),J=(0,de.f)((0,me.c)(),K,Q);return(0,Wt.f)(K[0],K[1],K[2],0,Q[0],Q[1],Q[2],0,J[0],J[1],J[2],0,0,0,0,1)}(N,Q,J):Wt.I;G.manipulator.modelTransform=se,G.edgeManipulator.elevationAlignedLocation=G.manipulator.elevationAlignedLocation,G.edgeManipulator.modelTransform=se;const re=(0,de.l)((0,de.b)(Ca,Q,J))/2;G.edgeManipulator.collisionType={type:"line",paths:[[[-re,0,0],[re,0,0]]]}}_createEdgeOffsetPipeline(G,D){return(N,Z,K)=>{this._clearSelection();const{step:Q,cleanup:J}=this._initializeEdgeOffset(G,D);Z.next(se=>this._trackNumDragging(se)).next((0,Qe.kY)(this.view,N.elevationAlignedLocation)).next(Q).next(function Kl(G){return yr(G,D=>D.plane)}(this.view)).next(Sr(this.view,(0,ae.Wg)(this._editGeometryOperations).data.spatialReference)).next((0,Qe.AN)()).next(this._applyComputeEdgeOffsetDistanceStep()).next(this._applyEdgeOffsetStep(G)).next(this._showEdgeOffsetTooltip()).next(se=>{"end"===se.action&&J()}),K.next(()=>{N.metadata.deleting||(J(),this._onDragCancel())})}}_initializeEdgeOffset(G,D){const N=(0,ae.Wg)(this._editGeometryOperations),Z=Dr(N.data.coordinateHelper,G.handle,D),K=N.createUndoGroup(),Q=Ar(this.view,G.manipulator.elevationAlignedLocation,Z);if(Z.requiresSplitEdgeLeft){const pe=this._getManipulatorInfoFromHandle(G.handle.leftVertex.leftEdge);(0,ae.pC)(pe)&&this._splitEdgeManipulator(pe,1)}if(Z.requiresSplitEdgeRight){const pe=this._getManipulatorInfoFromHandle(G.handle.rightVertex.rightEdge);(0,ae.pC)(pe)&&this._splitEdgeManipulator(pe,0)}const J=()=>new dc.Z({paths:[[G.handle.leftVertex.pos,G.handle.rightVertex.pos]],spatialReference:N.data.spatialReference}),se=new Ki({view:this.view,isDraped:this._graphicState.isDraped,geometry:J(),elevationInfo:G.elevationInfo,width:be.visualElements.lineGraphics.outline.width,color:be.colorToVec4(Ye.main),attached:!0});let re;const le=()=>{this._cleanEdgeOffsetCollapsedEdges(G),re=(0,ae.hw)(re)},he=this.on("undo",le);return re=(0,we.AL)([(0,we.ed)(se),(0,ve.YP)(()=>this._graphicState.isDraped,pe=>se.isDraped=pe),this._graphicState.on("changed",()=>se.geometry=J()),K,he]),{step:pe=>(0,ae.Wi)(Z)||(0,ae.Wi)(Q)?(le(),null):{...pe,operation:Z,plane:Q},cleanup:le}}_applyEdgeOffsetStep(G){return D=>{if(this.destroyed||(0,ae.Wi)(D.operation))return D;this._updateEventState(gt.RESHAPING);const{mapDeltaX:N,mapDeltaY:Z,mapDeltaZ:K}=D;return(N||Z||K)&&(this._offsetEdge(G,D),this.emit("reshape",{type:"reshape",mover:this.graphic})),D}}_applyComputeEdgeOffsetDistanceStep(){return G=>{const{operation:D,mapEnd:N}=G;return(0,ae.Wi)(D)||(0,ae.Wi)(N)?G:("start"===G.action&&D.selectArrowFromStartPoint(N),{...G,signedDistance:D.signedDistanceToPoint(N)})}}_showEdgeOffsetTooltip(){return G=>{const{mapEnd:D,signedDistance:N,operation:Z}=G,K=this._tooltip,Q=this._tooltipOptions;if(!Q.enabled||(0,ae.Wi)(N))return K.clear(),G;let J=K.info;((0,ae.Wi)(J)||"reshape-edge-offset"!==J.type)&&(J=K.info=new Vi({tooltipOptions:Q}));const{coordinateHelper:se}=(0,ae.Wg)(this._editGeometryOperations).data;return J.distance="end"===G.action?It.yP:function fc(G,D,N,Z,K){if(G){const Q=K.toXYZ(K.pointToVector(N)),J=(0,ft.nF)(Z,Q,Se.WM.get()),se=(0,_c.FB)(J,Q,K.spatialReference);if((0,ae.pC)(se))return(0,It.yG)(se.value*Math.sign(D),se.unit)}return(0,It.yG)(D*(0,Ea.c9)(N.spatialReference),"meters")}(this._graphicState.isDraped,N*Z.selectedArrow,D,Z.plane,se),this._updateTooltipAreaOrTotalLength(J),G}}_cleanEdgeOffsetCollapsedEdges(G){const D=G.handle.leftVertex.leftEdge?.leftVertex,N=G.handle.leftVertex,Z=G.handle.rightVertex.rightEdge?.rightVertex,K=G.handle.rightVertex,Q=(0,ae.Wg)(this._editGeometryOperations).data.coordinateHelper,J=[];if(D&&Q.distance(D.pos,N.pos)<as){const se=this._getManipulatorInfoFromHandle(N);(0,ae.pC)(se)&&J.push(se)}if(Q.distance(N.pos,K.pos)<as||Z&&Q.distance(Z.pos,K.pos)<as){const se=this._getManipulatorInfoFromHandle(K);(0,ae.pC)(se)&&J.push(se)}J.length&&this._removeVertices(J)}_computeVertexManipulatorSizeAndOutline(G){const D=G.size/2,N=D+G.collisionPadding;return{size:D/N,outlineSize:(D+G.outlineSize)/N}}_createVertexOrEdgeManipulator(G,D=(0,Ge.RL)(this.graphic),N=!1){if("edge"===G.type){if(this.enableEdgeOffset)return this._createEdgeOffsetManipulator(G,D);if(!this.enableMidpoints)return null}if((0,ae.Wi)(this._vertexManipulatorGeometry)||(0,ae.Wi)(this._vertexManipulatorOutlineGeometry)){const{size:se,outlineSize:re}=this._computeVertexManipulatorSizeAndOutline(be.reshapeManipulators.vertex);this._vertexManipulatorGeometry=(0,ot.PI)(this._vertexManipulatorMaterial,se,16,16),this._vertexManipulatorOutlineGeometry=(0,ot.PI)(this._vertexManipulatorOutlineMaterial,re,16,16)}if((0,ae.Wi)(this._edgeManipulatorGeometry)||(0,ae.Wi)(this._edgeManipulatorOutlineGeometry)){const{size:se,outlineSize:re}=this._computeVertexManipulatorSizeAndOutline(be.reshapeManipulators.edge);this._edgeManipulatorGeometry=(0,ot.PI)(this._edgeManipulatorMaterial,se,16,16),this._edgeManipulatorOutlineGeometry=(0,ot.PI)(this._edgeManipulatorOutlineMaterial,re,16,16)}const Z=(0,ae.pC)(this.graphic.geometry)&&"point"===this.graphic.geometry.type?[]:[new Ve(this._vertexManipulatorGeometry.instantiate(),ci.Vertex|Pe.Q9.Unselected),new Ve(this._vertexManipulatorOutlineGeometry.instantiate(),ci.Vertex|Pe.Q9.Unfocused|Pe.Q9.Unselected),new Ve(this._vertexManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ci.Vertex|Pe.Q9.Focused|Pe.Q9.Unselected),new Ve(this._vertexManipulatorGeometry.instantiate({material:this._selectedManipulatorMaterial}),Pe.Q9.Selected),new Ve(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorOutlineMaterial}),Pe.Q9.Selected|Pe.Q9.Unfocused),new Ve(this._vertexManipulatorOutlineGeometry.instantiate({material:this._selectedManipulatorHoverOutlineMaterial}),Pe.Q9.Selected|Pe.Q9.Focused)];this.enableMidpoints&&Z.push(new Ve(this._edgeManipulatorGeometry.instantiate({material:this._vertexManipulatorMaterial}),ci.Edge|Pe.Q9.Focused|Pe.Q9.Unselected),new Ve(this._edgeManipulatorOutlineGeometry.instantiate({material:this._vertexManipulatorHoverOutlineMaterial}),ci.Edge|Pe.Q9.Focused|Pe.Q9.Unselected),new Ve(this._edgeManipulatorGeometry.instantiate(),ci.Edge|Pe.Q9.Unfocused|Pe.Q9.Unselected),new Ve(this._edgeManipulatorOutlineGeometry.instantiate(),ci.Edge|Pe.Q9.Unfocused|Pe.Q9.Unselected));const K=new Ft({view:this.view,renderObjects:Z,elevationInfo:D,focusMultiplier:1,touchMultiplier:1,available:!(!this.graphic.visible||!this.graphic.layer?.visible),metadata:{deleting:!1}});K.selected=N,this._setTypeSpecificManipulatorSettings(K,G,D);const Q="edge"===G.type?{manipulator:K,handle:G,locationUpdateHandle:null,type:"edge",selectedIndex:0}:{manipulator:K,handle:G,type:"vertex",selectedIndex:0};if(this._manipulatorInfos.push(Q),this.manipulators.add(K),this._updateManipulatorPosition(Q),"edge"===Q.type){const se=[];for(const re of[Q.handle.leftVertex,Q.handle.rightVertex]){const le=this._getManipulatorInfoFromHandle(re);(0,ae.pC)(le)&&se.push(le.manipulator.events.on("location-update",()=>this._updateManipulatorPosition(Q)))}Q.locationUpdateHandle=(0,we.AL)(se),this._manipulatorHandles.add(Q.locationUpdateHandle,K)}this._manipulatorHandles.add(this._watchAndUpdateGrabState(K,!0),K);const J=(0,Qe.Xd)(K,(se,re,le,he)=>{let pe=null;const{snappingStep:ge,cancelSnapping:ye}=(0,Sa.W)({predicate:()=>!this._isMultiVertexSelection(),snappingManager:this.tool.snappingManager,snappingContext:new ba.N({editGeometryOperations:(0,ae.Wg)(this._editGeometryOperations),elevationInfo:D,pointer:he,excludeFeature:this.graphic,visualizer:new wn}),updatingHandles:this.updatingHandles,useZ:!1});le=le.next(fe=>(this._onDragCancel(!se.metadata.deleting,()=>pe=(0,ae.hw)(pe)),fe)).next(ye),re.next(fe=>this._trackNumDragging(fe)).next(fe=>{if("start"===fe.action&&(pe=(0,ae.Wg)(this._editGeometryOperations).createUndoGroup()),"edge"===Q.type){const Me=this._splitEdgeManipulator(Q);return{...fe,info:Me,snapOrigin:Me.handle.pos}}return{...fe,info:Q,snapOrigin:Q.handle.pos}}).next((0,Qe.kY)(this.view,se.elevationAlignedLocation)).next(Mr(this.view,this.graphic,se.elevationAlignedLocation,se.location.spatialReference,this.graphic)).next((0,Qe.BS)(this.view,D,this.graphic)).next(...ge).next((0,Qe.AN)()).next(fe=>{this._perVertexManipulatorDragAction(fe),"end"===fe.action&&(pe=(0,ae.hw)(pe)),this._updateTranslateVertexTooltip(se,Xe.XY,fe)})});return this._manipulatorHandles.add([J,K.events.on("immediate-click",se=>this._manipulatorClickCallback(se,Q)),K.events.on("select-changed",()=>{Q.selectedIndex=++this._selectedIndex,this._updateMoveManipulationPosition()}),K.events.on("focus-changed",({action:se})=>{"focus"===se&&"edge"!==Q.type?this._updateTranslateVertexTooltip(K,Xe.XY):this._tooltip.clear()})],K),this.emit("manipulators-changed"),Q}_trackNumDragging(G){switch(G.action){case"start":this._numDragging++;break;case"end":this._numDragging--}return G}_onDragCancel(G=!0,D){switch(this._numDragging--,G&&(this.undo(),this.outputGeometry=(0,ae.pC)(this._editGeometryOperations)?this._editGeometryOperations.data.geometry:null),(0,ae.pC)(this.tool.snappingManager)&&this.tool.snappingManager.doneSnapping(),this._tooltip.clear(),this._reshapeEventState){case gt.NONE:break;case gt.MOVING:this.emit("move",{type:"move",dx:0,dy:0,mover:this.graphic});break;case gt.RESHAPING:this.emit("reshape",{type:"reshape",mover:this.graphic})}D&&D(),this.destroyed||this._updateEventState(gt.NONE)}_setTypeSpecificManipulatorSettings(G,D,N){switch(D.type){case"vertex":G.state=ci.Vertex,G.selectable=!0,G.cursor="move",G.collisionPriority=2,G.radius=be.reshapeManipulators.vertex.size/2+be.reshapeManipulators.vertex.collisionPadding,G.elevationInfo=N,G.interactive=(0,ae.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type;break;case"edge":G.state=ci.Edge,G.selectable=!1,G.cursor="copy",G.collisionPriority=-1,G.radius=be.reshapeManipulators.edge.size/2+be.reshapeManipulators.edge.collisionPadding,G.elevationInfo="on-the-ground"!==N.mode||(0,Tr.YW)(this.graphic.symbol)?{mode:"absolute-height",offset:0}:N}}_watchAndUpdateGrabState(G,D){return G.events.on("grab-changed",N=>this._onGrabStateChanged(G,D,N.action,N.pointerType))}_onGrabStateChanged(G,D,N,Z="mouse"){if(!this._recreatingManipulators){if("start"===N)D&&this._updateSelection(G),this._numGrabbing++;else if(this._numGrabbing--,this._updateEventState(gt.NONE),this.destroyed)return;this._moveManipulation.interactive=!this._numGrabbing,("touch"!==Z||this.enableEdgeOffset)&&(this._manipulatorInfos.forEach(K=>{K.manipulator.interactive=K.manipulator.grabbing||!this._numGrabbing&&(0,ae.pC)(this.graphic.geometry)&&"point"!==this.graphic.geometry.type,"edgeManipulator"in K&&(K.edgeManipulator.interactive=K.edgeManipulator.grabbing||!this._numGrabbing)}),this._graphicMoveManipulation.forEachManipulator(K=>{K.interactive=K.grabbing||!this._numGrabbing}))}}_clearSelection(){for(const G of this._manipulatorInfos)G.manipulator.grabbing||(G.manipulator.selected=!1)}_updateSelection(G){G.grabbing&&!G.selected&&G.selectable&&(this._clearSelection(),G.selected=!0,this.emit("manipulators-changed"))}_removeManipulator(G){(0,ae.Wi)(G)||(G.manipulator.metadata.deleting=!0,this.manipulators.remove(G.manipulator),this._manipulatorHandles.remove(G.manipulator),(0,rt.e$)(this._manipulatorInfos,G),this.emit("manipulators-changed"))}_getManipulatorInfoFromHandle(G){if(G)for(const D of this._manipulatorInfos)if(G===D.handle)return D;return null}_updateManipulatorPosition(G){if((0,ae.Wi)(G))return;const D=(0,ae.Wg)(this._editGeometryOperations);if("vertex"===G.type)G.manipulator.location=D.data.coordinateHelper.vectorToDehydratedPoint(G.handle.pos,Wn),G.manipulator.grabbing&&(0,ae.pC)(this._vertexLaserLineVisualElement)&&(this._vertexLaserLineVisualElement.visualElement.intersectsWorldUpAtLocation=G.manipulator.renderLocation);else if("edge"===G.type){const N=this._getManipulatorInfoFromHandle(G.handle.leftVertex),Z=this._getManipulatorInfoFromHandle(G.handle.rightVertex);if((0,ae.Wi)(N)||(0,ae.Wi)(Z))return;const K=N.manipulator,Q=Z.manipulator;if((0,ae.pC)(G.manipulator.elevationInfo)&&"on-the-ground"===G.manipulator.elevationInfo.mode){const J=K.location,se=Q.location,re=.5;G.manipulator.location=(0,Yi.Tx)(J.x+re*(se.x-J.x),J.y+re*(se.y-J.y),J.hasZ&&se.hasZ?0:void 0,D.data.spatialReference)}else(0,de.h)(Ca,K.renderLocation,Q.renderLocation,.5),G.manipulator.renderLocation=Ca}}_splitEdgeManipulator(G,D=.5){const N=(0,ae.Wg)(this._editGeometryOperations),Z=(0,ae.Wg)(N.splitEdge(G.handle,D).createdVertex);G.locationUpdateHandle=(0,ae.hw)(G.locationUpdateHandle);const K=(0,Ge.RL)(this.graphic);let Q;this.enableEdgeOffset?(this._removeManipulator(G),Q=this._createVertexOrEdgeManipulator(Z)):(Q=G,Q.handle=Z,Q.type="vertex",this._setTypeSpecificManipulatorSettings(G.manipulator,G.handle,K)),Z.leftEdge&&this._createVertexOrEdgeManipulator(Z.leftEdge),Z.rightEdge&&this._createVertexOrEdgeManipulator(Z.rightEdge),this.outputGeometry=N.data.geometry,this._updateManipulatorPosition(Q),this.enableEdgeOffset||this._updateTranslateVertexTooltip(Q.manipulator,Xe.XY),this._updateSelection(G.manipulator);const J=this._updateEventState(gt.RESHAPING),se=N.data.coordinateHelper.vectorToArray(Q.handle.pos),re=N.data.components.indexOf(Z.component);return this.emit("vertex-add",{type:"vertex-add",vertices:[{coordinates:se,componentIndex:re,vertexIndex:(0,ae.Wg)(Z.index)}],added:se}),J&&this._updateEventState(gt.NONE),Q}_updateMoveManipulationPosition(){const G=(0,de.s)(Ca,0,0,0);let D=0,N=!1,Z=null,K=null;for(const Q of this._manipulatorInfos)"vertex"===Q.type&&(Q.manipulator.selected?(D++,(0,de.a)(G,G,Q.manipulator.renderLocation),(0,ae.Wi)(Z)||Q.selectedIndex>Z.selectedIndex?(K=Z,Z=Q):((0,ae.Wi)(K)||Q.selectedIndex>K.selectedIndex)&&(K=Q)):N=!0);if(0===D){const Q=this._graphicState.displaying&&this.enableMoveGraphic;this._moveManipulation.xyManipulation.available=Q,this._moveManipulation.xyAxisManipulation.available=Q,this._moveManipulation.xyAxisManipulation.orthogonalAvailable=Q,this._moveManipulation.zManipulation.available=Q&&this.enableZShape&&Ji(this.graphic),this._moveManipulation.angle=Or((0,ae.Wg)(this.graphic.geometry)),this._moveManipulation.radius=qi.radiusForSymbol(this.graphic.symbol)}else{const Q=this._graphicState.displaying;this._moveManipulation.xyManipulation.available=Q,this._moveManipulation.xyAxisManipulation.available=Q,this._moveManipulation.zManipulation.available=Q&&this.enableZVertex&&Ji(this.graphic),this._moveManipulation.xyAxisManipulation.orthogonalAvailable=Q&&1!==D;let J=0;if((0,ae.pC)(Z)){const se=Z.handle.pos,re=(0,ae.pC)(K)?K.handle.pos:Z.handle.leftEdge&&Z.handle.leftEdge.leftVertex?Z.handle.leftEdge.leftVertex.pos:null,le=(0,ae.Wi)(K)&&Z.handle.rightEdge&&Z.handle.rightEdge.rightVertex?Z.handle.rightEdge.rightVertex.pos:null;re&&le?this._moveManipulation.xyAxisManipulation.available=!1:re?J=Ir(re,se):le&&(J=Ir(se,le))}this._moveManipulation.angle=J,this._moveManipulation.radius=hr}0!==D&&N?((0,de.g)(G,G,1/D),Wn.spatialReference=(0,ae.Wg)(this._editGeometryOperations).data.spatialReference,Wn.hasZ=!0,this.view.renderCoordsHelper.fromRenderCoords(G,Wn),this._moveManipulation.elevationAlignedLocation=Wn):(0,ae.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,ae.pC)(this._outlineVisualElement.attachmentOrigin)?this._moveManipulation.elevationAlignedLocation=this._outlineVisualElement.attachmentOrigin:sr(this.view,this._moveManipulation,this.graphic)}_removeVertices(G){const D=new Array,N=(0,ae.Wg)(this._editGeometryOperations);for(const Z of G)if("vertex"===Z.type&&N.canRemoveVertex()){D.push(Z.handle),this._removeManipulator(Z),this._removeManipulator(this._getManipulatorInfoFromHandle(Z.handle.leftEdge)),this._removeManipulator(this._getManipulatorInfoFromHandle(Z.handle.rightEdge));const K=N.removeVertices([Z.handle]),Q=(0,ae.Wg)(K.removedVertices?.[0].createdEdge);Q&&this._createVertexOrEdgeManipulator(Q)}if(D.length>0){const Z=D.map(Q=>{const J=N.data.components.indexOf(Q.component);return{coordinates:N.data.coordinateHelper.vectorToArray(Q.pos),componentIndex:J,vertexIndex:(0,ae.Wg)(Q.index)}});this.outputGeometry=N.data.geometry;const K=this._updateEventState(gt.RESHAPING);if(this.destroyed||(this.emit("vertex-remove",{type:"vertex-remove",removed:Z.map(Q=>Q.coordinates),vertices:Z}),this.destroyed)||K&&(this._updateEventState(gt.NONE),this.destroyed))return;this._updateMoveManipulationPosition()}}_moveVertices(G,D,N=("start"===D.action?bi.O.NEW_STEP:bi.O.ACCUMULATE_STEPS)){const Z=(0,ae.Wg)(this._editGeometryOperations);Z.moveVertices(G.map(K=>K.handle),D.mapDeltaX,D.mapDeltaY,D.mapDeltaZ,N),this.outputGeometry=Z.data.geometry;for(const K of G)this._updateManipulatorPosition(K)}_offsetEdge(G,D){if((0,ae.Wi)(D.operation)||(0,ae.Wi)(D.signedDistance))return;const N=(0,ae.Wg)(this._editGeometryOperations),Z=D.operation.clone();Z.distance=D.signedDistance,N.updateVertices([G.handle.leftVertex,G.handle.rightVertex],Z),this.outputGeometry=N.data.geometry,this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(G.handle.leftVertex)),this._updateManipulatorPosition(this._getManipulatorInfoFromHandle(G.handle.rightVertex))}_manipulatorClickCallback(G,D){G.shiftKey||this._clearSelection(),"vertex"===D.type&&(D.manipulator.selected=!D.manipulator.selected,G.button===Lr.t.Right&&this._removeVertices([D])),"edge"===D.type&&G.button===Lr.t.Left&&this._splitEdgeManipulator(D),G.stopPropagation()}_updateTranslateTooltip(G,D){const N=this._manipulatorInfos.filter(Z=>"vertex"===Z.type&&Z.manipulator.selected);1===N.length?this._updateTranslateVertexTooltip(N[0].manipulator,G,D):this._updateTranslateGraphicTooltip(G,D)}_updateTranslateGraphicTooltip(G,D){const N=this._tooltipOptions;if(!N.enabled)return;const Z=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(G){case Xe.XY:this._tooltip.info=new Nt.$E({tooltipOptions:N}),this._updateTranslateTooltipDistance(this._tooltip.info,D,(K,Q)=>(0,He.GQ)(K,Q,Z));break;case Xe.XY_AXIS:this._tooltip.info=new Nt.in({tooltipOptions:N}),this._updateTranslateTooltipDistance(this._tooltip.info,D,(K,Q)=>{const J=(0,He.GQ)(K,Q,Z);return(0,It.bA)(J,va(D))});break;case Xe.Z:this._tooltip.info=new Nt.QW({tooltipOptions:N}),this._updateTranslateTooltipDistance(this._tooltip.info,D,_n._e)}}_updateTranslateVertexTooltip(G,D,N){const Z=this._tooltipOptions;if(!Z.enabled)return;let K;const Q=this._graphicState.isDraped?"on-the-ground":"absolute-height";switch(D){case Xe.XY:K=new Nt.nk({tooltipOptions:Z}),this._updateTranslateTooltipDistance(K,N,(se,re)=>(0,He.GQ)(se,re,Q)),this._updateTooltipAreaOrTotalLength(K);break;case Xe.XY_AXIS:K=new Nt.c1({tooltipOptions:Z}),this._updateTranslateTooltipDistance(K,N,(se,re)=>{const le=(0,He.GQ)(se,re,Q);return(0,It.bA)(le,va(N))}),this._updateTooltipAreaOrTotalLength(K);break;case Xe.Z:K=new Nt.j({tooltipOptions:Z}),this._updateTranslateTooltipDistance(K,N,_n._e)}const J=(0,_n.g1)(G.elevationAlignedLocation);(0,ae.pC)(J)&&(K.elevation={mode:"absolute-height",...J}),this._tooltip.info=K}_updateTranslateTooltipDistance(G,D,N){if((0,ae.pC)(D)&&"end"!==D.action){const{mapStart:Z,mapEnd:K}=D,Q=N(Z,K);G.distance=(0,ae.pC)(Q)?Q:It.yP}}_updateTooltipAreaOrTotalLength(G){const{geometry:D}=this.graphic;if((0,ae.Wi)(D))return;const N=this._graphicState.isDraped?"on-the-ground":"absolute-height";G.area="polygon"===D.type?(0,gc.k)(D,N):null,G.totalLength="polyline"===D.type?(0,He.Ul)(D,N):null}get test(){return{segmentLabels:this._segmentLabels,tooltip:this._tooltip}}};function Ir(G,D){return Math.atan2(D[1]-G[1],D[0]-G[0])+Math.PI/2}(0,ce._)([(0,ue.Cb)()],Et.prototype,"_editGeometryOperations",void 0),(0,ce._)([(0,ue.Cb)()],Et.prototype,"_segmentLabels",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Et.prototype,"tool",void 0),(0,ce._)([(0,ue.Cb)()],Et.prototype,"_tooltip",void 0),(0,ce._)([(0,ue.Cb)()],Et.prototype,"inputGeometry",null),(0,ce._)([(0,ue.Cb)()],Et.prototype,"outputGeometry",void 0),(0,ce._)([(0,ue.Cb)({readOnly:!0})],Et.prototype,"updating",null),(0,ce._)([(0,ue.Cb)()],Et.prototype,"manipulators",null),(0,ce._)([(0,ue.Cb)()],Et.prototype,"view",null),(0,ce._)([(0,ue.Cb)()],Et.prototype,"graphic",null),(0,ce._)([(0,ue.Cb)()],Et.prototype,"enableZShape",null),(0,ce._)([(0,ue.Cb)()],Et.prototype,"enableZVertex",null),(0,ce._)([(0,ue.Cb)()],Et.prototype,"enableMoveGraphic",null),(0,ce._)([(0,ue.Cb)()],Et.prototype,"enableMidpoints",null),(0,ce._)([(0,ue.Cb)()],Et.prototype,"enableEdgeOffset",null),(0,ce._)([(0,ue.Cb)()],Et.prototype,"_labelOptions",null),(0,ce._)([(0,ue.Cb)()],Et.prototype,"_tooltipOptions",null),Et=(0,ce._)([(0,Ze.j)("esri.views.3d.interactive.editingTools.reshapeGraphic.ReshapeOperation")],Et);const Wn=(0,Yi.Tx)(0,0,void 0,mc.Z.WGS84),Ca=(0,me.c)(),as=1e-6;var ci,gt,mn;(function(G){G.Vertex=Pe.jg.Custom1,G.Edge=Pe.jg.Custom2})(ci||(ci={})),function(G){G[G.NONE=0]="NONE",G[G.MOVING=1]="MOVING",G[G.RESHAPING=2]="RESHAPING"}(gt||(gt={})),function(G){G[G.ALL=0]="ALL",G[G.SELECTED_OR_ALL=1]="SELECTED_OR_ALL"}(mn||(mn={}));var Gr=oe(24959);let Gt=class extends(ai.Z.EventedMixin(ya.m)){constructor(G){super(G),this._handles=new un.Z,this._internalGeometryUpdate=!1,this.enableZShape=!0,this.enableZVertex=!0,this.enableMoveGraphic=!0,this.enableMidpoints=!0,this.enableEdgeOffset=!1,this.type="reshape-3d",this.labelOptions=new Gr.Z,this.tooltipOptions=new Gi.Z,this.snappingManager=null,this.automaticManipulatorSelection=!1}initialize(){const G=this._reshapeOperation=new Et({tool:this});this.addHandles([G.on("reshape",D=>{"reshape"===D.type&&this._onReshapeGeometryChanged(),this.emit("reshape",D)}),G.on("move",D=>{"move"===D.type&&this._onReshapeGeometryChanged(),this.emit("move",D)}),G.on("vertex-add",D=>{this._onReshapeGeometryChanged(),this.emit("vertex-add",D)}),G.on("vertex-remove",D=>{this._onReshapeGeometryChanged(),this.emit("vertex-remove",D)}),G.on("immediate-click",D=>this.emit("immediate-click",D)),this.view.on("pointer-down",["Shift"],D=>D.stopPropagation()),(0,ve.YP)(()=>this.graphic,()=>this._updateGraphic(),ve.tX)]),this.finishToolCreation()}destroy(){this._handles=(0,ae.SC)(this._handles),this._reshapeOperation=(0,ae.SC)(this._reshapeOperation)}get updating(){return this._reshapeOperation?.updating??!1}_updateGeometry(){const G=(0,wr.b)(this.graphic);this._reshapeOperation.inputGeometry=(0,ae.pC)(G)?G.clone():null}_updateGraphic(){if(this._handles.remove("onGraphicGeometryChange"),this._updateGeometry(),(0,wr.P)(this.graphic)!==rr.e.SUPPORTED)return;const G=(0,ve.YP)(()=>this.graphic?.geometry,()=>{!1===this._internalGeometryUpdate&&this._updateGeometry()},ve.Z_);this._handles.add(G,"onGraphicGeometryChange")}onManipulatorSelectionChanged(){this._reshapeOperation&&this._reshapeOperation.onManipulatorSelectionChanged()}_updateGeometryInternally(G){this._internalGeometryUpdate=!0,this.graphic.geometry=G,this._internalGeometryUpdate=!1}_onReshapeGeometryChanged(){const{outputGeometry:G}=this._reshapeOperation;!(0,ae.Wi)(this.graphic)&&G&&this._updateGeometryInternally(G.clone())}get canUndo(){return this._reshapeOperation.canUndo??!1}undo(){(0,ae.pC)(this.snappingManager)&&this.snappingManager.doneSnapping();const G=this._reshapeOperation.undo(),{outputGeometry:D}=this._reshapeOperation;G&&D&&this._updateGeometryInternally(D.clone())}get canRedo(){return this._reshapeOperation.canRedo??!1}redo(){(0,ae.pC)(this.snappingManager)&&this.snappingManager.doneSnapping();const G=this._reshapeOperation.redo(),{outputGeometry:D}=this._reshapeOperation;G&&D&&this._updateGeometryInternally(D.clone())}onInputEvent(G){"key-down"!==G.type||"Delete"!==G.key&&"Backspace"!==G.key||this._reshapeOperation.removeSelectedVertices()}reset(){}get test(){return{snappingManager:this.snappingManager,reshapeOperation:this._reshapeOperation}}};(0,ce._)([(0,ue.Cb)()],Gt.prototype,"_reshapeOperation",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],Gt.prototype,"view",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Gt.prototype,"graphic",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],Gt.prototype,"enableZShape",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],Gt.prototype,"enableZVertex",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],Gt.prototype,"enableMoveGraphic",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],Gt.prototype,"enableMidpoints",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],Gt.prototype,"enableEdgeOffset",void 0),(0,ce._)([(0,ue.Cb)()],Gt.prototype,"type",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,type:Gr.Z})],Gt.prototype,"labelOptions",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,type:Gi.Z})],Gt.prototype,"tooltipOptions",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Gt.prototype,"snappingManager",void 0),(0,ce._)([(0,ue.Cb)()],Gt.prototype,"updating",null),(0,ce._)([(0,ue.Cb)()],Gt.prototype,"automaticManipulatorSelection",void 0),Gt=(0,ce._)([(0,Ze.j)("esri.views.3d.interactive.editingTools.graphicReshape3D.GraphicReshapeTool")],Gt);var ss=oe(23719),vc=oe(50618);let Si=class extends Oa.h{constructor(G){super(G),this.type="transform-rotate",this.rotationType="geographic"}};(0,ce._)([(0,ue.Cb)()],Si.prototype,"type",void 0),(0,ce._)([(0,ue.Cb)()],Si.prototype,"rotation",void 0),(0,ce._)([(0,ue.Cb)()],Si.prototype,"rotationPrecision",void 0),(0,ce._)([(0,ue.Cb)()],Si.prototype,"orientation",void 0),(0,ce._)([(0,ue.Cb)()],Si.prototype,"orientationPrecision",void 0),(0,ce._)([(0,ue.Cb)()],Si.prototype,"rotationType",void 0),Si=(0,ce._)([(0,Ze.j)("esri.views.interactive.tooltip.TransformRotateTooltipInfo")],Si);let Wi=class extends Oa.h{constructor(G){super(G),this.type="transform-scale",this.sizeUnit=null,this.sizePrecision=null}};(0,ce._)([(0,ue.Cb)()],Wi.prototype,"type",void 0),(0,ce._)([(0,ue.Cb)()],Wi.prototype,"scale",void 0),(0,ce._)([(0,ue.Cb)()],Wi.prototype,"size",void 0),(0,ce._)([(0,ue.Cb)()],Wi.prototype,"sizeUnit",void 0),(0,ce._)([(0,ue.Cb)()],Wi.prototype,"sizePrecision",void 0),Wi=(0,ce._)([(0,Ze.j)("esri.views.interactive.tooltip.TransformScaleTooltipInfo")],Wi);let ei=class extends Oa.h{constructor(G){super(G),this.type="transform-absolute",this.orientationEnabled=!0,this.orientationPrecision=null,this.rotationType="geographic",this.sizeUnit=null,this.sizeEnabled=!0,this.sizePrecision=null}};var nt,fn;(0,ce._)([(0,ue.Cb)()],ei.prototype,"type",void 0),(0,ce._)([(0,ue.Cb)()],ei.prototype,"orientation",void 0),(0,ce._)([(0,ue.Cb)()],ei.prototype,"orientationEnabled",void 0),(0,ce._)([(0,ue.Cb)()],ei.prototype,"orientationPrecision",void 0),(0,ce._)([(0,ue.Cb)()],ei.prototype,"rotationType",void 0),(0,ce._)([(0,ue.Cb)()],ei.prototype,"size",void 0),(0,ce._)([(0,ue.Cb)()],ei.prototype,"sizeUnit",void 0),(0,ce._)([(0,ue.Cb)()],ei.prototype,"sizeEnabled",void 0),(0,ce._)([(0,ue.Cb)()],ei.prototype,"sizePrecision",void 0),ei=(0,ce._)([(0,Ze.j)("esri.views.interactive.tooltip.TransformAbsoluteTooltipInfo")],ei),function(G){G.ScaleIn=Pe.jg.Custom2,G.ScaleOut=Pe.jg.Custom3,G.RotateLeft=Pe.jg.Custom4,G.RotateRight=Pe.jg.Custom5,G.Unlocked=Pe.jg.Custom7,G.DelayedFocused=Pe.jg.Custom8,G.TouchInput=Pe.jg.Custom12}(nt||(nt={}));class yc{get angle(){return this._adapter.angle}get scale(){return this._adapter.scale}set location(D){this._ringManipulator.location=D}set elevationAlignedLocation(D){this._ringManipulator.elevationAlignedLocation=D}get grabbing(){return this._ringManipulator.grabbing}set interactive(D){this._ringManipulator.interactive=D}constructor({adapter:D,tooltipOptions:N,mode:Z,tool:K}){this._mode=null,this._handles=new un.Z,this._scaleRotateDragData=null,this._activeAnimation=null,this._ringIndicatorDelayMs=200,this.events=new ai.Z,this.getFocused=()=>this._ringManipulator.focused,this.getScale=()=>(0,ae.pC)(this._scaleRotateDragData)&&"scale"===this._scaleRotateDragData.mode?this._adapter.scale:1,this.tool=K,this._mode=Z,this._adapter=D,this._tooltipOptions=N,this._tooltip=new Vn.u({view:K.view}),this._createManipulator(),this._updateDragState(),this._updateManipulatorTransform(),this._handles.add((0,ve.gx)(()=>!this._tooltipOptions.enabled,()=>this._tooltip.clear(),ve.nn))}destroy(){(0,ae.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=null),this._handles=(0,ae.SC)(this._handles),this.tool.manipulators.remove(this._ringManipulator),this._ringManipulator=null,this._tooltip=(0,ae.SC)(this._tooltip)}startAnimation(D){this.cancelActiveAnimation(),D.start();const N=(0,vc.A)({update:({deltaTime:Z})=>{D.update(Z)&&this.cancelActiveAnimation()}});this._activeAnimation={...D,frameTask:N}}cancelActiveAnimation(){(0,ae.pC)(this._activeAnimation)&&(this._activeAnimation.frameTask.remove(),this._activeAnimation=(0,ae.SC)(this._activeAnimation))}forEachManipulator(D){D(this._ringManipulator,lt.SCALE_ROTATE)}_createManipulator(){const D=this._createRingManipulator();this._ringManipulator=D,this.tool.manipulators.add(D);const N=this.tool.graphicState.graphic,Z=(0,Qe.Xd)(D,(K,Q,J)=>{this._scaleRotateDragData=null;const se=this._adapter.startInteraction(),re={mode:"none",origin:(0,me.a)(K.renderLocation),initialAngle:this._adapter.angle,angle:0,angleDir:0,scaleDir:0};this._scaleRotateDragData=re,this._updateDragState();const le=Se.WM.get();this.tool.view.renderCoordsHelper.worldUpAtPosition(K.renderLocation,le),Q.next(_a(this.tool.view,(0,ft.Yq)(K.renderLocation,le,(0,ft.Ue)()))).next(he=>{const pe=(0,ft.mJ)(he.plane),ge=nr(he.renderStart,he.renderEnd,re.origin,pe),ye=ss.Q4.shortestSignedDiff(re.angle,ge);re.angleDir=(0,Ct.uZ)(re.angleDir+ye,-.3,.3),re.angle=ge;const fe=function Mc(G,D){const N=(0,de.b)(Se.WM.get(),D.renderStart,G.origin),Z=(0,de.b)(Se.WM.get(),D.renderEnd,G.origin),K=(0,de.l)(N),Q=(0,de.l)(Z);return 0===K?0:Q/K}(re,he);if(re.scaleDir=(0,Ct.uZ)(re.scaleDir+(fe-this._adapter.scale),-.2,.2),this._onScaleChanged(),"none"===re.mode){const Ie=this._mode||function bc(G,D,N,Z){const{renderStart:K,renderEnd:Q}=G,J=Pa(K,Z,Se.WM.get()),se=Pa(Q,Z,Se.WM.get());if((0,de.d)(J,se)<100)return null;const re=(0,de.b)(Se.WM.get(),K,N),le=(0,de.f)(Se.WM.get(),re,(0,ft.mJ)(D)),he=K,pe=(0,de.a)(Se.WM.get(),he,le),ge=Pa(N,Z,Se.WM.get()),ye=J,fe=Pa(pe,Z,Se.WM.get()),Me=(0,de.b)(Se.WM.get(),fe,ye),Ie=(0,de.b)(Se.WM.get(),J,ge),De=(0,Kt.re)(ye,Me),st=(0,Kt.re)(ge,Ie);return(0,Kt.Jk)(De,se)<(0,Kt.Jk)(st,se)?"rotate":"scale"}(he,he.plane,re.origin,this.tool.view.state.camera);if((0,ae.pC)(Ie)){switch(Ie){case"rotate":this.tool.emit("graphic-rotate-start",{graphic:N,angle:0}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()});break;case"scale":this.tool.emit("graphic-scale-start",{graphic:N,xScale:1,yScale:1}),this.tool.emit("record-undo",{record:this._adapter.createUndoRecord()})}re.mode=Ie}}switch(re.mode){case"rotate":se.state.angle=re.initialAngle+ge;break;case"scale":se.state.scale=fe,this._onScaleChanged()}switch(this._updateDragState(),this._updateManipulatorTransform(),he.action){case"start":case"update":switch(re.mode){case"rotate":this.tool.emit("graphic-rotate",{graphic:N,angle:(0,Ct.BV)(re.angle)});break;case"scale":this.tool.emit("graphic-scale",{graphic:N,xScale:fe,yScale:fe})}break;case"end":switch(re.mode){case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:N,angle:(0,Ct.BV)(re.angle)});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:N,xScale:fe,yScale:fe})}}return"end"===he.action&&(this.startAnimation(Vr(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState(),se.done()),he}).next(this._updateTooltipPipelineStep(re)),J.next(()=>{if(se.cancel(),(0,ae.pC)(this._scaleRotateDragData)){switch(this._scaleRotateDragData.mode){case"none":break;case"rotate":this.tool.emit("graphic-rotate-stop",{graphic:N,angle:0});break;case"scale":this.tool.emit("graphic-scale-stop",{graphic:N,xScale:1,yScale:1})}this.startAnimation(Vr(this,()=>this._onScaleChanged())),this._scaleRotateDragData=null,this._updateDragState()}this._updateFocusTooltip()})});this._handles.add([Z,D.events.on("focus-changed",K=>{"focus"===K.action?this.startAnimation(function Sc(G,D,N){let Z=0,K=null;const Q=()=>!1;return{start:()=>{K=G.getFocused,G.getFocused=Q,Z=0,D()},update:J=>(Z+=J,!K?.()||Z>=N.delayMs?fn.STOP:fn.CONTINUE),destroy:()=>{K&&(G.getFocused=K),D()}}}(this,()=>this._updateDelayedFocusedState(),{delayMs:this._ringIndicatorDelayMs})):this._updateDelayedFocusedState()}),D.events.on("immediate-click",K=>{K.stopPropagation()}),(0,ve.YP)(()=>this.tool.graphicState?.displaying,K=>this._ringManipulator.available=K,ve.nn)])}_updateTooltipPipelineStep(D){return N=>{const Z=this._tooltipOptions;if(!Z.enabled)return N;if("end"===N.action)return this._updateFocusTooltip(),N;const K=this._tooltip,Q=this._tooltipOptions.visualVariables,J=(0,ae.pC)(Q)?Q.size:null,se=(0,ae.pC)(Q)?Q.rotation:null;switch(D.mode){case"scale":K.info=new Wi({tooltipOptions:Z,scale:{value:this._adapter.scale},size:(0,It.yG)((0,ae.Pt)(this._adapter.size,-1),"meters"),sizeUnit:(0,ae.pC)(J)?J.unit:null,sizePrecision:(0,ae.pC)(J)?xa(J.valueType):null});break;case"rotate":{const re=(0,ae.pC)(se)?xa(se.valueType):null,le=(0,ae.pC)(se)?se.rotationType:"geographic";K.info=new Si({tooltipOptions:Z,rotation:(0,It.GJ)((0,ae.Pt)(-this._adapter.relativeAngle,0),"radians","geographic"),rotationPrecision:re,orientation:(0,It.GJ)(-this._adapter.angle,"radians","geographic"),orientationPrecision:re,rotationType:le})}}return N}}_updateFocusTooltip(){if(this._tooltipOptions.enabled)if(this.getFocused()){const D=this._tooltipOptions.visualVariables,N=(0,ae.pC)(D)?D.rotation:null,Z=(0,ae.pC)(D)?D.size:null;this._tooltip.info=new ei({tooltipOptions:this._tooltipOptions,orientation:(0,It.GJ)(-this._adapter.angle,"radians","geographic"),orientationEnabled:null==this._mode||"rotate"===this._mode,orientationPrecision:(0,ae.pC)(N)?xa(N.valueType):null,rotationType:(0,ae.pC)(N)?N.rotationType:"geographic",size:(0,It.yG)((0,ae.Pt)(this._adapter.size,-1),"meters"),sizeUnit:(0,ae.pC)(Z)?Z.unit:null,sizeEnabled:null==this._mode||"scale"===this._mode,sizePrecision:(0,ae.pC)(Z)?xa(Z.valueType):null})}else this._tooltip.clear()}_onScaleChanged(){this.events.emit("scale-changed"),this._updateManipulatorTransform()}_updateDelayedFocusedState(){this._ringManipulator.updateStateEnabled(nt.DelayedFocused,this.getFocused()),this._updateFocusTooltip()}_updateDragState(){if(this._ringManipulator.updateStateEnabled(nt.Unlocked,!((0,ae.pC)(this._scaleRotateDragData)&&"none"!==this._scaleRotateDragData.mode)),(0,ae.pC)(this._scaleRotateDragData))switch(this._scaleRotateDragData.mode){case"rotate":this._ringManipulator.updateStateEnabled(nt.ScaleIn|nt.ScaleOut,!1),this._ringManipulator.updateStateEnabled(nt.RotateLeft,this._scaleRotateDragData.angleDir<0),this._ringManipulator.updateStateEnabled(nt.RotateRight,this._scaleRotateDragData.angleDir>=0);break;case"scale":this._ringManipulator.updateStateEnabled(nt.RotateLeft|nt.RotateRight,!1),this._ringManipulator.updateStateEnabled(nt.ScaleIn,this._scaleRotateDragData.scaleDir<0),this._ringManipulator.updateStateEnabled(nt.ScaleOut,this._scaleRotateDragData.scaleDir>=0)}else this._ringManipulator.updateStateEnabled(nt.ScaleIn|nt.ScaleOut|nt.RotateLeft|nt.RotateRight,!1)}_updateManipulatorTransform(){const D=(0,je.d)(Se.MP.get(),this._adapter.angle,(0,me.f)(0,0,1));if((0,ae.Wi)(D))return;const N=this.getScale(),Z=(0,je.E)(Se.MP.get(),(0,de.s)(Se.WM.get(),N,N,N));this._ringManipulator.modelTransform=(0,je.m)(Se.MP.get(),Z,D)}_createRingManipulator(){const D=(Je,Bt,yi)=>{const ji=[],Fi=Math.ceil(128*(Bt-Je)/(2*Math.PI));for(let zt=0;zt<Fi+1;zt++){const Zn=Je+zt*(Bt-Je)/Fi;ji.push((0,me.f)(yi*Math.cos(Zn),yi*Math.sin(Zn),0))}return ji},N=Je=>D(0,2*Math.PI,Je),K=this._createMaterial(1),Q=(Je,Bt,yi=K)=>(0,ot.x2)(yi,(Je=>[[-Je/2,0],[Je/2,0],[Je/2,.25],[-Je/2,.25]])(Bt),Je,[],[],!1),J=N(160),se=Q(J,24),re={left:new Array,right:new Array},le=[];for(let Je=0;Je<2;Je++){const Bt=Je*Math.PI-Math.PI/4,yi=Math.PI/2-Hl,ji=Bt+yi,Fi=Bt+Math.PI/2-yi,zt=D(ji,Fi,190),Zn=Q(zt,9);le.push(zt),le.push(D(ji,Fi,201)),re.left.push(Zn),re.right.push(Zn.instantiate());for(let gs=0;gs<2;gs++){const no=0===gs,$t=(0,Wt.c)();if(no){(0,je.k)($t,$t,[1,-1,1]),(0,je.e)($t,$t,-ji,[0,0,1]);const en=Math.round(.2*(zt.length-1));$t[12]=zt[en][0],$t[13]=zt[en][1],$t[14]=zt[en][2]}else{(0,je.e)($t,$t,Fi,[0,0,1]);const en=Math.round(.8*(zt.length-1));$t[12]=zt[en][0],$t[13]=zt[en][1],$t[14]=zt[en][2]}const ao=(0,ot.DA)(K,60,0,23,.5);(0,ot.mx)(ao,$t),(no?re.left:re.right).push(ao)}}const he=[];for(let Je=0;Je<2;Je++){const Bt=Je*Math.PI-Math.PI/4,yi=Math.PI/2-Bl,Fi=Bt+Math.PI/2-yi,zt=D(Bt+yi,Fi,213);he.push(Q(zt,9))}const pe=this._createMaterial(.66),ge=this._createMaterial(.5),ye=this._createMaterial(.33),fe=N(190),Me=N(213),Ie=Q(fe,9,pe),De=Q(Me,9,ye),st=N(130),at=N(107),Ht=Q(st,9,pe),ti=Q(at,9,ye);let Ot=[new Ve(se,nt.DelayedFocused),new Ve(se.instantiate({material:ge}),Pe.Q9.None)];this._mode&&"scale"!==this._mode||(Ot=Ot.concat([...he.map(Je=>new Ve(Je,nt.DelayedFocused|nt.Unlocked)),new Ve(Ie,nt.DelayedFocused|nt.ScaleIn),new Ve(De,nt.DelayedFocused|nt.ScaleIn),new Ve(Ht,nt.DelayedFocused|nt.ScaleOut),new Ve(ti,nt.DelayedFocused|nt.ScaleOut)])),this._mode&&"rotate"!==this._mode||(Ot=Ot.concat([...re.right.map(Je=>new Ve(Je.instantiate(),nt.DelayedFocused|nt.Unlocked)),...re.left.map(Je=>new Ve(Je,nt.DelayedFocused|nt.RotateLeft)),...re.right.map(Je=>new Ve(Je,nt.DelayedFocused|nt.RotateRight))]));const vi=[J,...le];return new Ft({view:this.tool.view,renderObjects:Ot,autoScaleRenderObjects:!1,worldOriented:!0,radius:24,focusMultiplier:1,touchMultiplier:1.5,elevationInfo:(0,Ge.RL)(this.tool.graphicState.graphic),collisionType:{type:"ribbon",paths:vi,direction:(0,me.f)(0,0,1)}})}_createMaterial(D){const N=(0,Pt.b)([...Vl,D]);return new ni.E({color:N,transparent:1!==D,cullFace:Tt.Vr.Back,renderOccluded:ze.yD.Transparent})}get test(){return{ringManipulator:this._ringManipulator,setRingIndicatorDelayMs:D=>this._ringIndicatorDelayMs=D,tooltip:this._tooltip}}}function Pa(G,D,N){return D.projectToScreen(G,rs),(0,de.s)(N,rs[0],rs[1],0)}function Vr(G,D){let N=null,Z=1;const K=()=>Z;return{start:()=>{Z=G.getScale(),N=G.getScale,G.getScale=K,D()},update:Q=>(Z+=((Z+1)/2-Z)*Math.min(3*Q,1),D(),Math.abs(Z-1)<.01?fn.STOP:fn.CONTINUE),destroy:()=>{N&&(G.getScale=N),D()}}}function xa(G){switch(G){case"integer":case"long":return 0;default:return null}}!function(G){G[G.CONTINUE=0]="CONTINUE",G[G.STOP=1]="STOP"}(fn||(fn={}));const rs=(0,Te.s1)();var Wr=oe(89586);function Ur(G){return(0,ae.pC)(G.geometry)&&"mesh"===G.geometry.type?function Ec(G){return(0,ae.pC)(G.transform)?function Cc(G,D){let N=D.clone(),Z=null;return{undo:K=>{Z=(0,ae.pC)(G.transform)?G.transform.clone():null,G.transform=N,K.notifyGeometryChanged()},redo:K=>{N=(0,ae.pC)(G.transform)?G.transform.clone():null,G.transform=Z,K.notifyGeometryChanged()}}}(G,G.transform):function Pc(G){let D,N=G.vertexAttributes.clonePositional();return{undo:Z=>{D=G.vertexAttributes.clonePositional(),G.vertexAttributes=N,Z.notifyGeometryChanged()},redo:Z=>{N=G.vertexAttributes.clonePositional(),G.vertexAttributes=D,Z.notifyGeometryChanged()}}}(G)}(G.geometry):function Oc(G){let D=G.geometry,N=ae.YP;return{undo(Z){N=Z.geometry,Z.geometry=D},redo(Z){D=Z.geometry,Z.geometry=N}}}(G)}let Ei=class extends Dn.r{constructor(G){super(G),this._interactionState=null}initialize(){this.addHandles([(0,ve.gx)(()=>(0,ae.pC)(this._interactionState)&&this._interactionState.angle!==this._interactionState.previousAngle?{interactionState:this._interactionState,angle:this._interactionState.state.angle}:null,({interactionState:G})=>{this._updateMeshRotation(G)},ve.Z_),(0,ve.gx)(()=>(0,ae.pC)(this._interactionState)&&this._interactionState.scale!==this._interactionState.previousScale?{interactionState:this._interactionState,scale:this._interactionState.state.scale}:null,({interactionState:G})=>{this._updateMeshSize(G)},ve.Z_)])}get angle(){const G=this.geometry.transform;if((0,ae.Wi)(G))return 0;const D=(0,Wr.ZZ)(G.rotation)[2];return Math.abs(D)>.999999?(0,Ct.Vl)((0,Wr.EU)(G.rotation))*Math.sign(D):0}get scale(){return(0,ae.pC)(this._interactionState)?this._interactionState.scale:1}startInteraction(){const G=new Oi({angle:this.angle});this._interactionState=G;const D=()=>{this._interactionState=null};return{state:G,done:D,cancel:()=>{G.cancel(),D()}}}createUndoRecord(){return Ur(this.graphic)}_updateMeshRotation(G){const D=this.geometry.anchor,N=this.viewingMode===Mn.JY.Global,{angle:Z,previousAngle:K}=G;this.geometry.rotate(0,0,(0,Ct.BV)(Z-K),{origin:D,geographic:N}),G.previousAngle=Z,(0,ae.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}_updateMeshSize(G){const D=this.geometry.anchor,N=this.viewingMode===Mn.JY.Global,{scale:Z,previousScale:K}=G;this.geometry.scale(Z/K,{origin:D,geographic:N}),G.previousScale=Z,(0,ae.pC)(this.geometry.transform)&&this.graphic.notifyMeshTransformChanged(),this.graphic.notifyGeometryChanged()}};(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Ei.prototype,"graphic",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Ei.prototype,"geometry",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Ei.prototype,"viewingMode",void 0),(0,ce._)([(0,ue.Cb)()],Ei.prototype,"angle",null),(0,ce._)([(0,ue.Cb)()],Ei.prototype,"scale",null),(0,ce._)([(0,ue.Cb)()],Ei.prototype,"_interactionState",void 0),Ei=(0,ce._)([(0,Ze.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateMeshAdapter")],Ei);let Oi=class extends et.Z{get state(){const{angle:G,scale:D}=this;return{angle:G,scale:D}}constructor(G){super(G),this.angle=0,this.initialAngle=0,this.previousAngle=0,this.previousScale=1,this.scale=1,this.initialAngle=G.angle,this.previousAngle=G.angle}cancel(){this.angle=this.initialAngle,this.scale=1}};(0,ce._)([(0,ue.Cb)()],Oi.prototype,"angle",void 0),(0,ce._)([(0,ue.Cb)()],Oi.prototype,"initialAngle",void 0),(0,ce._)([(0,ue.Cb)()],Oi.prototype,"previousAngle",void 0),(0,ce._)([(0,ue.Cb)()],Oi.prototype,"previousScale",void 0),(0,ce._)([(0,ue.Cb)()],Oi.prototype,"scale",void 0),(0,ce._)([(0,ue.Cb)()],Oi.prototype,"state",null),Oi=(0,ce._)([(0,Ze.j)("InteractionState")],Oi);let Ut=class extends Dn.r{constructor(G){super(G),this.sizeAxis=null,this._interactionState=null}initialize(){this.addHandles((0,ve.gx)(()=>(0,ae.pC)(this._interactionState)?this._interactionState.state:null,G=>{this._updateSymbol(G)},ve.Z_))}get angle(){return(0,ae.pC)(this._interactionState)?this._interactionState.angle:(0,ae.pC)(this._orientationReferenceSymbolLayer)?function xc(G){return-(0,Ct.Vl)(G)}(this._orientationReferenceSymbolLayer.heading??0):0}get scale(){return(0,ae.pC)(this._interactionState)?this._interactionState.scale:1}get relativeAngle(){return this.angle-this.initialAngle}get initialAngle(){return(0,ae.pC)(this._interactionState)?this._interactionState.initialAngle:0}get size(){const G=this._sizeReferenceSymbolLayer;if((0,ae.Wi)(G))return null;const D=this.findLayerView(),N=this._graphicSymbol;if((0,ae.Wi)(D)||(0,ae.Wi)(N)||"point-3d"!==N.type)return null;const Z=D.getSymbolLayerSize(N,G);if("size"in Z&&(0,ae.pC)(Z.size))return Z.size;const K=this.sizeAxis;return"width"in Z&&(0,ae.pC)(Z.width)&&((0,ae.Wi)(K)||"width"===K||"all"===K||"width-and-depth"===K)?Z.width:"depth"in Z&&(0,ae.pC)(G.depth)&&((0,ae.Wi)(K)||"depth"===K||"all"===K||"width-and-depth"===K)?Z.depth:"height"in Z&&(0,ae.pC)(G.height)&&((0,ae.Wi)(K)||"height"===K||"all"===K)?Z.height:null}get _sizeReferenceSymbolLayer(){const G=this._graphicSymbol;return(0,ae.Wi)(G)||0===G.symbolLayers.length?null:G.symbolLayers.find(D=>"object"===D.type)}get _orientationReferenceSymbolLayer(){const G=this._graphicSymbol;return(0,ae.Wi)(G)||0===G.symbolLayers.length?null:G.symbolLayers.find(D=>"object"===D.type&&(0,ae.pC)(D.heading))}get _graphicSymbol(){return(0,ae.pC)(this.graphic)&&(0,ae.pC)(this.graphic.symbol)&&"point-3d"===this.graphic.symbol.type?this.graphic.symbol:null}set _graphicSymbol(G){this.graphic.symbol=G}startInteraction(){const G=this._graphicSymbol,D=this.findLayerView();if((0,ae.pC)(this._interactionState)||(0,ae.Wi)(G)||(0,ae.Wi)(D))return wc;const N=G.symbolLayers.map(se=>"object"===se.type?D.getSymbolLayerSize(G,se):null).toArray(),Z=G.clone(),Q=new Ci({originalSymbol:Z,angle:this.angle,initialSizes:N});this._interactionState=Q;const J=()=>{this._interactionState=null};return{state:Q,done:J,cancel:()=>{this._graphicSymbol=Z,J()}}}createUndoRecord(){let G=this.graphic.symbol,D=null;return{undo:N=>{D=N.symbol,N.symbol=G},redo:N=>{G=N.symbol,N.symbol=D}}}_updateSymbol({scale:G,angle:D,originalSymbol:N,initialSizes:Z}){const K=this._graphicSymbol;if((0,ae.Wi)(K)||"point-3d"!==K.type)return;const Q=K.clone(),J=-(0,Ct.BV)(D-this.initialAngle);let se=!1;this._forEachObjectSymbolLayerPair(N,Q,(re,le,he)=>{const pe=(0,ae.Pt)(re.heading,0)+J;le.heading!==pe&&(le.heading=pe,se=!0);const ge=Z[he];if((0,ae.pC)(ge)&&"width"in ge){ge.width=this.sizeFilter(ge.width),ge.height=this.sizeFilter(ge.height),ge.depth=this.sizeFilter(ge.depth);const ye=ge.width*G;le.width!==ye&&(le.width=ye,se=!0);const fe=ge.depth*G;le.depth!==fe&&(le.depth=fe,se=!0);const Me=ge.height*G;le.height!==Me&&(le.height=Me,se=!0)}}),se&&(this._graphicSymbol=Q)}_forEachObjectSymbolLayerPair(G,D,N){G.symbolLayers.forEach((Z,K)=>{const Q=D.symbolLayers.getItemAt(K);"object"===Z.type&&"object"===Q.type&&N(Z,Q,K)})}};(0,ce._)([(0,ue.Cb)()],Ut.prototype,"angle",null),(0,ce._)([(0,ue.Cb)()],Ut.prototype,"scale",null),(0,ce._)([(0,ue.Cb)()],Ut.prototype,"relativeAngle",null),(0,ce._)([(0,ue.Cb)()],Ut.prototype,"initialAngle",null),(0,ce._)([(0,ue.Cb)()],Ut.prototype,"size",null),(0,ce._)([(0,ue.Cb)()],Ut.prototype,"sizeAxis",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Ut.prototype,"graphic",void 0),(0,ce._)([(0,ue.Cb)()],Ut.prototype,"_interactionState",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Ut.prototype,"findLayerView",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Ut.prototype,"sizeFilter",void 0),(0,ce._)([(0,ue.Cb)()],Ut.prototype,"_sizeReferenceSymbolLayer",null),(0,ce._)([(0,ue.Cb)()],Ut.prototype,"_orientationReferenceSymbolLayer",null),(0,ce._)([(0,ue.Cb)()],Ut.prototype,"_graphicSymbol",null),Ut=(0,ce._)([(0,Ze.j)("esri.views.3d.interactive.editingTools.transformGraphic.ScaleRotateObjectSymbol3DAdapter")],Ut);const wc={state:{angle:0,scale:0},done:()=>{},cancel:()=>{}};let Ci=class extends et.Z{get state(){const{originalSymbol:G,angle:D,initialAngle:N,scale:Z,initialSizes:K}=this;return{originalSymbol:G,angle:D,initialAngle:N,scale:Z,initialSizes:K}}constructor(G){super(G),this.angle=0,this.initialAngle=0,this.scale=1,this.initialAngle=G.angle}};(0,ce._)([(0,ue.Cb)()],Ci.prototype,"originalSymbol",void 0),(0,ce._)([(0,ue.Cb)()],Ci.prototype,"angle",void 0),(0,ce._)([(0,ue.Cb)()],Ci.prototype,"initialAngle",void 0),(0,ce._)([(0,ue.Cb)()],Ci.prototype,"initialSizes",void 0),(0,ce._)([(0,ue.Cb)()],Ci.prototype,"scale",void 0),(0,ce._)([(0,ue.Cb)()],Ci.prototype,"state",null),Ci=(0,ce._)([(0,Ze.j)("InteractionState")],Ci);let Zt=class extends((0,Dn.p)(ai.Z.EventedMixin(ya.m))){constructor(G){super(G),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Gi.Z,this.type="transform-3d",this._scaleRotate=null,this._tooltip=null}initialize(){const{graphic:G,view:D}=this;this.graphicState=new Jt({graphic:G}),this.addHandles((0,ve.YP)(()=>this.tooltipOptions.enabled,Q=>{this._tooltip=Q?new Vn.u({view:D}):(0,ae.SC)(this._tooltip)},ve.tX)),this._moveManipulation=new qi({tool:this,view:D,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&Ji(G),radius:qi.radiusForSymbol(G.symbol)}),this._moveManipulation.forEachManipulator(Q=>this.handles.add(Q.events.on("immediate-click",J=>{this.emit("immediate-click",{...J,graphic:G}),J.stopPropagation()})));const N=Q=>J=>{this.handles.add(J.events.on("focus-changed",({action:se})=>{const re=this._tooltip;(0,ae.Wi)(re)||("focus"===se?this._updateMoveTooltip(Q):re.clear())}))};this._moveManipulation.xyManipulation.forEachManipulator(N(Xe.XY)),this._moveManipulation.xyAxisManipulation.forEachManipulator(N(Xe.XY_AXIS)),this._moveManipulation.zManipulation.forEachManipulator(N(Xe.Z));const Z=(0,Ge.RL)(G);this._moveManipulation.elevationInfo=Z;const K=G.geometry;this._moveManipulation.createGraphicDragPipeline((Q,J,se,re,le)=>{if((0,ae.pC)(K)&&Q===Xe.XY){const{snappingStep:he,cancelSnapping:pe}=(0,Sa.W)({snappingContext:new ba.N({elevationInfo:Z,pointer:le,editGeometryOperations:Ma.c.fromGeometry(new dn.Z({spatialReference:K.spatialReference}),D.state.viewingMode),visualizer:new wn,excludeFeature:G}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,useZ:!1});re=re.next(pe),se=se.next((0,Qe.Mz)(this.view,Z)).next(...he)}return{steps:se=se.next(he=>(this._updateMoveTooltip(Q,he),he)),cancel:re}},this.graphicState,Q=>{const{action:J,graphic:se,dxScreen:re,dyScreen:le}=Q,he={graphic:se,dxScreen:re,dyScreen:le};switch(J){case"start":this.emit("graphic-translate-start",he),this.emit("record-undo",{record:this._createGeometryUndoRecord()});break;case"update":this.emit("graphic-translate",he);break;case"end":this.emit("graphic-translate-stop",he)}}),this._moveManipulation.angle=(0,ae.pC)(this._scaleRotate)?this._scaleRotate.angle:0,this._scaleRotateAdapter=this._createScaleRotateAdapter(),this.handles.add((0,ve.YP)(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle())),(this.enableScaling||this.enableRotation)&&(this._scaleRotate=new yc({tool:this,mode:this.enableScaling&&this.enableRotation?null:this.enableScaling?"scale":"rotate",adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()))),this.handles.add([ga({view:this.view,graphic:this.graphic,forEachManipulator:Q=>this._forEachManipulator(Q),onManipulatorsChanged:()=>(0,we.kB)()}),this.graphicState.on("changed",()=>this._onGeometryChanged()),this._hideManipulatorsForGraphicState(),(0,ve.YP)(()=>D.scale,()=>this._updateMoveAngle())]),this.handles.add(this.view.trackGraphicState(this.graphicState)),this._onGeometryChanged(),this._updateMoveAngle(),this._forEachManipulator(Q=>{Q instanceof Ft&&this.handles.add(Q.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))}),this.finishToolCreation()}destroy(){this._tooltip=(0,ae.SC)(this._tooltip),this._moveManipulation.destroy(),this._scaleRotate=(0,ae.SC)(this._scaleRotate),this._scaleRotateAdapter=(0,ae.SC)(this._scaleRotateAdapter),this._set("view",null),this._set("graphic",null)}_updateManipulatorsInteractive(){(0,ae.Wi)(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)}_createScaleRotateAdapter(){return(0,ae.pC)(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new Ei({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):new Ut({graphic:this.graphic,sizeFilter:G=>this._enforceNonZeroSize(G),findLayerView:()=>this.view.allLayerViews.find(G=>G.layer===this.graphic.layer),sizeAxis:(0,ae.pC)(this.tooltipOptions.visualVariables)&&(0,ae.pC)(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})}_forEachManipulator(G){this._moveManipulation.forEachManipulator(G),(0,ae.pC)(this._scaleRotate)&&this._scaleRotate.forEachManipulator(G)}_hideManipulatorsForGraphicState(){return(0,ve.YP)(()=>this.graphicState.displaying,G=>{this._forEachManipulator(D=>D.available=G),this._moveManipulation.zManipulation.available=G&&this.enableZ&&Ji(this.graphic)})}_createGeometryUndoRecord(){return Ur(this.graphic)}set snapToScene(G){this._moveManipulation&&(this._moveManipulation.snapToScene=G),this._set("snapToScene",G)}get updating(){return this.updatingHandles.updating}set location(G){this._moveManipulation.location=G,(0,ae.pC)(this._scaleRotate)&&(this._scaleRotate.location=G)}set elevationAlignedLocation(G){this._moveManipulation.elevationAlignedLocation=G,(0,ae.pC)(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=G)}reset(){}onHide(){(0,ae.pC)(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()}_onScaleChanged(){if((0,ae.Wi)(this._scaleRotate))return;const G=this._scaleRotate.getScale();this._moveManipulation.displayScale=G}_updateMoveAngle(){this._moveManipulation.angle=this.view.state.viewingMode===Mn.JY.Local||this.view.scale<1e6?this._scaleRotateAdapter.angle:0}_onGeometryChanged(){sr(this.view,this,this.graphic)}_enforceNonZeroSize(G){return G||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)}_updateMoveTooltip(G,D){const{tooltipOptions:N,_tooltip:Z}=this;if((0,ae.Wi)(Z))return;Z.clear();const K=this.graphicState.isDraped?"on-the-ground":"absolute-height";switch(G){case Xe.XY:Z.info=new Nt.$E({tooltipOptions:N}),this._updateMoveTooltipDistance(Z.info,D,(Q,J)=>(0,He.GQ)(Q,J,K));break;case Xe.XY_AXIS:Z.info=new Nt.in({tooltipOptions:N}),this._updateMoveTooltipDistance(Z.info,D,(Q,J)=>{const se=(0,He.GQ)(Q,J,K);return(0,It.bA)(se,va(D))});break;case Xe.Z:Z.info=new Nt.QW({tooltipOptions:N}),this._updateMoveTooltipDistance(Z.info,D,_n._e)}}_updateMoveTooltipDistance(G,D,N){if((0,ae.pC)(D)&&"end"!==D.action){const{mapStart:Z,mapEnd:K}=D,Q=N(Z,K);G.distance=(0,ae.pC)(Q)?Q:It.yP}}get test(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:(0,ae.pC)(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,setRingIndicatorDelayMs:G=>(0,ae.pC)(this._scaleRotate)?this._scaleRotate.test.setRingIndicatorDelayMs(G):null,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}};(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],Zt.prototype,"view",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],Zt.prototype,"graphic",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],Zt.prototype,"enableZ",void 0),(0,ce._)([(0,ue.Cb)()],Zt.prototype,"enableRotation",void 0),(0,ce._)([(0,ue.Cb)()],Zt.prototype,"enableScaling",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,type:Gi.Z})],Zt.prototype,"tooltipOptions",void 0),(0,ce._)([(0,ue.Cb)()],Zt.prototype,"graphicState",void 0),(0,ce._)([(0,ue.Cb)({value:!1})],Zt.prototype,"snapToScene",null),(0,ce._)([(0,ue.Cb)({constructOnly:!0})],Zt.prototype,"snappingManager",void 0),(0,ce._)([(0,ue.Cb)({readOnly:!0})],Zt.prototype,"type",void 0),(0,ce._)([(0,ue.Cb)({readOnly:!0})],Zt.prototype,"updating",null),Zt=(0,ce._)([(0,Ze.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],Zt);var Pi=oe(41743),Tc=oe(79608),Dc=oe(86810),zr=oe(66656),Un=oe(128);let Ui=class extends((0,Tc.J)(Dc.wq)){constructor(G){super(G),this.type="plane",this.position=null,this.heading=0,this.tilt=0,this.width=10,this.height=10}equals(G){return this.heading===G.heading&&this.tilt===G.tilt&&(0,ae._W)(this.position,G.position)&&this.width===G.width&&this.height===G.height}};(0,ce._)([(0,ue.Cb)({readOnly:!0,json:{read:!1,write:!0}})],Ui.prototype,"type",void 0),(0,ce._)([(0,ue.Cb)({type:dn.Z}),(0,Un.B)()],Ui.prototype,"position",void 0),(0,ce._)([(0,ue.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Un.B)(),(0,zr.p)(G=>ss.BV.normalize((0,ht.q9)(G),0,!0))],Ui.prototype,"heading",void 0),(0,ce._)([(0,ue.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,Un.B)(),(0,zr.p)(G=>ss.BV.normalize((0,ht.q9)(G),0,!0))],Ui.prototype,"tilt",void 0),(0,ce._)([(0,ue.Cb)({type:Number,nonNullable:!0}),(0,Un.B)()],Ui.prototype,"width",void 0),(0,ce._)([(0,ue.Cb)({type:Number,nonNullable:!0}),(0,Un.B)()],Ui.prototype,"height",void 0),Ui=(0,ce._)([(0,Ze.j)("esri.analysis.SlicePlane")],Ui);var jr=oe(48977);oe(78172),(0,St.Z)("mac"),Math.cos((0,Ct.Vl)(45)),Math.cos((0,Ct.Vl)(5));const zn=(0,me.f)(1,.5,0),Gc=((0,Pt.b)([...zn,.7]),(0,Pt.b)([...zn,.5]),(0,Pt.f)(1,1,1,1)),Vc=(0,Pt.f)(1,.8,.6,1),Wc=(0,Pt.f)(1,.93,.86,1),Uc=(0,Pt.b)([...zn,1]),zc=(0,Pt.b)([...zn,1]),Nc=(0,Pt.b)([...zn,1]);(0,Wt.c)();var xi,Xc=oe(30750);class cs extends Sn.A{initializeProgram(D){return new En.$(D.rctx,cs.shader.get().build(this.configuration),Wa.i)}initializePipeline(){return(0,xt.sm)({blending:(0,xt.wK)(Lt.zi.ONE,Lt.zi.ONE,Lt.zi.ONE_MINUS_SRC_ALPHA,Lt.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:Lt.wb.LESS},colorWrite:xt.BK})}}function Qr(G){const D=(0,de.l)(G.basis1),N=(0,de.l)(G.basis2);return.3*Math.min(D,N)}function jn(G){return Qr(G)}function Fn(G){return 0!==G.direction[0]&&0!==G.direction[1]}cs.shader=new bn.J(Xc.S,()=>oe.e(5175).then(oe.bind(oe,15175))),oe(81863),oe(97126),(0,me.c)(),(0,me.c)(),oe(6178),oe(2004),function(G){G[G.POSITIVE_X=0]="POSITIVE_X",G[G.POSITIVE_Y=1]="POSITIVE_Y",G[G.NEGATIVE_X=2]="NEGATIVE_X",G[G.NEGATIVE_Y=3]="NEGATIVE_Y"}(xi||(xi={}));const wi=Pe.jg.Custom1;var Nn,zi;(function(G){G[G.HEADING=1]="HEADING",G[G.TILT=2]="TILT"})(Nn||(Nn={})),function(G){G[G.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",G[G.HORIZONTAL=1]="HORIZONTAL",G[G.VERTICAL=2]="VERTICAL",G[G.TILTED=3]="TILTED"}(zi||(zi={}));const Hn=Pe.jg.Custom2,yn=((0,Kt.Ue)(),Math.PI/2),Da=Pe.jg.Custom1,Jr=Pe.jg.Custom2;var Bn;!function(G){G[G.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",G[G.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(Bn||(Bn={}));const $r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",kr={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};class gh{constructor(){this._lastDragEvent=null,this._next=null,this._enabled=!1}get enabled(){return this._enabled}set enabled(D){if(this._enabled!==D&&(0,ae.pC)(this._lastDragEvent)&&(0,ae.pC)(this._next)){const N={...this._lastDragEvent,action:"update"};D&&this._adjustScaleFactors(N),this._next.execute(N)}this._enabled=D}createDragEventPipelineStep(){this._lastDragEvent=null;const D=new Qe.hM;return this._next=D,[N=>(this._lastDragEvent="end"!==N.action?{...N}:null,this._enabled&&this._adjustScaleFactors(N),N),D]}_adjustScaleFactors(D){const N=Fn(D.handle)?Math.max(Math.abs(D.factor1),Math.abs(D.factor2)):0===D.handle.direction[0]?Math.abs(D.factor2):Math.abs(D.factor1);D.factor1=D.factor1<0?-N:N,D.factor2=D.factor2<0?-N:N}get test(){return{_adjustScaleFactors:D=>this._adjustScaleFactors(D)}}}var qr=oe(15708),fi=oe(96792),eo=oe(51810);let Yt=class extends(ai.Z.EventedMixin(ya.m)){constructor(G){super(G),this.enableZ=!0,this.enableRotation=!0,this.enableScaling=!0,this.tooltipOptions=new Gi.Z,this._preserveAspectRatio=new gh,this.grabbing=!1,this.inputState=null,this.type="transform-3d",this._handles=new un.Z,this._attachmentOrigin=null,this._outlineVisualElement=null,this._mapBounds=(0,Pi.a)(),this._mapBoundsStart=(0,Pi.a)(),this._zmax=0,this._sizeStart=null,this._displayBounds=(0,Pi.a)(),this._displayBoundsStart=(0,Pi.a)(),this._displayBoundsMarginStart=0,this._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._rotateTooltipInfo=null,this._scaleTooltipInfo=null,this._startAngle=0,this._endAngle=0,this._startScale=(0,We.a)(),this._endScale=(0,We.a)()}initialize(){const{view:G,graphic:D,manipulators:N,_handles:Z}=this,K=this._graphicState=new Jt({graphic:D});this._editGeometryOperations=Ma.c.fromGeometry(D.geometry,G.state.viewingMode),this._graphicMoveManipulation=new is({tool:this,view:G,graphicState:K}),this._moveZManipulator=function sh(G,D=Bn.CENTER_ON_ARROW){const N=D===Bn.CENTER_ON_CALLOUT?40:0,Z=[(0,me.f)(N,0,-24),(0,me.f)(N,0,24)],K=function ch(G,D){const N=(0,de.b)((0,me.c)(),G[G.length-1],G[G.length-2]);if((0,de.n)(N,N),(0,de.g)(N,N,22.5),(0,de.a)(N,N,G[G.length-1]),D){const Z=(0,de.b)((0,me.c)(),G[0],G[1]);return(0,de.n)(Z,Z),(0,de.g)(Z,Z,22.5),(0,de.a)(Z,Z,G[0]),[Z,...G,N]}return[...G,N]}(Z,!0),Q=(pe,ge)=>function oh(G,D,N){const Z=new ni.E({color:Gc,cullFace:Tt.Vr.Back,renderOccluded:ze.yD.Opaque}),K=new ni.E({color:Vc,cullFace:Tt.Vr.Back,renderOccluded:ze.yD.Opaque}),Q=new ni.E({color:Wc,cullFace:Tt.Vr.Back,renderOccluded:ze.yD.Opaque}),J=new ni.E({color:zc,transparent:!0,writeDepth:!1,cullFace:Tt.Vr.Front,renderOccluded:ze.yD.Transparent}),se=re=>{G=G.slice(0);const le=(0,de.b)(Se.WM.get(),G[0],G[1]);(0,de.n)(le,le);const he=(0,de.b)(Se.WM.get(),G[G.length-1],G[G.length-2]);if((0,de.n)(he,he),D>0){const vi=(0,de.g)((0,me.c)(),he,-D);G[G.length-1]=(0,de.a)(vi,vi,G[G.length-1]);const Je=(0,de.g)((0,me.c)(),le,-D);G[0]=(0,de.a)(Je,Je,G[0])}const pe=re?1.15:1,ge=22.5*pe,ye=11*pe,fe=(0,je.i)(Se.MP.get());if(D>0){const vi=ge/4,Je=(0,de.s)(Se.WM.get(),0,vi,0),Bt=1+D/vi;(0,je.w)(fe,fe,Je),(0,je.k)(fe,fe,(0,de.s)(Se.WM.get(),Bt,Bt,Bt)),(0,je.w)(fe,fe,(0,de.g)(Je,Je,-1/Bt))}const Me=(0,je.i)((0,Wt.c)()),Ie=(0,me.f)(0,1,0),De=(0,je.F)((0,Wt.c)(),(0,jr.r)(Se.vD.get(),Ie,he));De[12]=G[G.length-1][0],De[13]=G[G.length-1][1],De[14]=G[G.length-1][2],(0,je.m)(De,De,fe);const st=function lh(G,D,N){const Z=[];for(let Q=0;Q<12;Q++){const J=Q/12*2*Math.PI;Z.push([Math.cos(J)*G,Math.sin(J)*G])}return(0,ot.x2)(N,Z,D,[],[],!1)}(3*(re?1.15:1)+D,G,N?J:Q);st.transformation=Me;const at=[st],Ht=(0,ot.QL)(N?J:Z,ge,ye,24,!1,!1,!0);Ht.transformation=De,at.push(Ht);const ti=(0,ot.QL)(N?J:K,ge,ye,24,!1,!0,!1);ti.transformation=De,at.push(ti);const Ot=(0,je.F)((0,Wt.c)(),(0,jr.r)(Se.vD.get(),Ie,le));return Ot[12]=G[0][0],Ot[13]=G[0][1],Ot[14]=G[0][2],(0,je.m)(Ot,Ot,fe),at.push(Ht.instantiate({transformation:Ot})),at.push(ti.instantiate({transformation:Ot})),at};return{normal:se(!1),focused:se(!0)}}(Z,pe,ge),J=Q(0,!1),se=Q(2.25,!0),re=new $a.Y({color:Uc,renderOccluded:ze.yD.OccludeAndTransparent}),le=(0,ot.rh)(re,[[N,0,0],[N-40,0,0]]),he=(0,ot.rh)(re,[[N,0,0],[N-40,0,0]]);return new Ft({view:G,renderObjects:[...J.normal.map(pe=>new Ve(pe,Pe.Q9.Unfocused|wi)),...se.normal.map(pe=>new Ve(pe,Pe.Q9.Unfocused|wi)),new Ve(le,Pe.Q9.Unfocused|wi|Hn),...J.focused.map(pe=>new Ve(pe,Pe.Q9.Focused|wi)),...se.focused.map(pe=>new Ve(pe,Pe.Q9.Focused|wi)),new Ve(he,Pe.Q9.Focused|wi|Hn)],autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[K]},collisionPriority:1,radius:11,state:wi})}(G,Bn.CENTER_ON_CALLOUT),this._moveZManipulator.state|=Hn,Z.add([this._createMoveXYGraphicDragPipeline(),(0,ve.YP)(()=>this.enableZ,()=>this._updateManipulatorAvailability(this._moveZManipulator,lt.TRANSLATE_Z)),this._createMoveZDragPipeline()]),N.add(this._moveZManipulator),this._resizeManipulators=this._resizeHandles.map(he=>{const pe=function rh(G,D){const N=Fn(D),Z=N?[(0,me.f)(1,0,0),(0,me.f)(0,0,0),(0,me.f)(0,1,0)]:[(0,me.f)(1,0,0),(0,me.f)(-1,0,0)],K=Nc,se=N?4:1,re=2*se,he=ye=>ye>1?(ye=>new di.U({color:K,width:ye,renderOccluded:ze.yD.OccludeAndTransparent}))(ye):new $a.Y({color:K,renderOccluded:ze.yD.OccludeAndTransparent}),pe=[new Ve((0,ot.rh)(he(se),Z),Pe.Q9.Unfocused|Da),new Ve((0,ot.rh)(he(re),Z),Pe.Q9.Focused|Da),new Ve((0,ot.rh)(he(1),Z),Jr)],ge=new Ft({view:G,renderObjects:pe,collisionType:{type:"line",paths:[Z]},radius:N?6:4,...Sl});return ge.state=Da,ge}(G,he);return Z.add([(0,ve.YP)(()=>this.enableScaling,()=>this._updateManipulatorAvailability(pe,lt.SCALE)),pe.events.on("grab-changed",ge=>this._onResizeGrab(ge)),this._createResizeDragPipeline(pe,he)]),pe}),N.addMany(this._resizeManipulators),this._rotateManipulatorTexture=function uh(G){return G.fromData($r,()=>new ys.x($r,kr))}(G.toolViewManager.textures),this._rotateManipulator=function Ml(G,D){const N=new Ft({view:G,autoScaleRenderObjects:!1,collisionPriority:1,metadata:D.metadata});return function bl(G,D){const N=D.material??new fl({transparent:!0,writeDepth:!1,textureId:D.texture?.id,renderOccluded:ze.yD.Opaque}),Z=D.focusMultiplier??Ln.focusMultiplier,K=D.calloutLength??Ln.calloutLength,Q=Ln.discRadius*(D.discScale??1),J=Q*Z,se=(fe,Me)=>{const Ie=[0,1,2,2,3,0];return new Is.Z(Me,[[qe.T.POSITION,new za.a([K-fe,-fe,0,K+fe,-fe,0,K+fe,fe,0,K-fe,fe,0],3,!0)],[qe.T.UV0,new za.a([0,0,1,0,1,1,0,1],2,!0)]],[[qe.T.POSITION,Ie],[qe.T.UV0,Ie]])},re=Ln.calloutColor,le=D.calloutWidth??Ln.calloutWidth,he=new(le>1?di.U:$a.Y)({width:le,color:(0,Pt.f)(re[0],re[1],re[2],D.calloutOpacity??1),renderOccluded:ze.yD.OccludeAndTransparent}),pe=(0,ot.rh)(he,[[0,0,0],[K-Q,0,0]]),ge=(0,ot.rh)(he,[[0,0,0],[K-J,0,0]]),ye=D.customStateMask??Pe.jg.None;G.collisionType={type:"disc",direction:[0,0,1],offset:[K,0,0]},G.focusMultiplier=Z,G.metadata=D.metadata,G.radius=Q,G.renderObjects=[new Ve(se(Q,N),Pe.Q9.Unfocused|ye),new Ve(pe,Pe.Q9.Unfocused|ye),new Ve(se(J,N),Pe.Q9.Focused|ye),new Ve(ge,Pe.Q9.Focused|ye)]}(N,D),N}(G,{texture:this._rotateManipulatorTexture.texture}),Z.add([(0,ve.YP)(()=>this.enableRotation,()=>this._updateManipulatorAvailability(this._rotateManipulator,lt.ROTATE)),this._rotateManipulator.events.on("grab-changed",he=>{this._onRotateGrab(he)}),this._createRotateDragPipeline(this._rotateManipulator)]),N.add(this._rotateManipulator),this._calculateMapBounds(),this._updateDisplayBounds();const J=ga({view:G,graphic:D,forEachManipulator:he=>this._forEachManipulator(he),onManipulatorsChanged:()=>(0,we.kB)()});(0,ae.pC)(J)&&(this._outlineVisualElement=J.visualElement instanceof Ki?J.visualElement:null),(0,ae.pC)(this._outlineVisualElement)&&Z.add(this._outlineVisualElement.events.on("attachment-origin-changed",()=>this._updateDisplayBounds())),Z.add(J),Z.add([K.on("changed",()=>this._onGeometryChanged()),(0,ve.YP)(()=>K.displaying,()=>this._updateAllManipulatorAvailability()),(0,ve.YP)(()=>K.isDraped,()=>this._graphicDrapedChanged(),ve.nn),G.trackGraphicState(K)]);const se=G.pointsOfInterest;Z.add((0,ve.YP)(()=>se?.centerOnSurfaceFrequent.location,()=>this._updateDisplayBounds())),this._forEachManipulator(he=>{Z.add(he.events.on("grab-changed",()=>{this.grabbing=he.grabbing,this._updateAllManipulatorAvailability()}))}),this._forEachManipulator((he,pe)=>{Z.add(he.events.on("immediate-click",ge=>{pe===lt.TRANSLATE_XY&&this.emit("immediate-click",{...ge,graphic:D}),ge.stopPropagation()}))}),this._onGeometryChanged(),this._updateAllManipulatorAvailability(),this._initializeTooltip(),this.finishToolCreation()}destroy(){this._mapBounds=null,this._displayBounds=null,this._rotateManipulatorTexture.release(),this._handles.destroy(),this._graphicMoveManipulation.destroy(),this._editGeometryOperations.destroy(),this._tooltip.destroy(),this._set("view",null),this._set("graphic",null)}_initializeTooltip(){const{_handles:G,view:D}=this,N=this._tooltip=new Vn.u({view:D}),Z=()=>{N.info=this._getUpdatedTooltipInfo()};G.add([this.on("graphic-translate-start",Z),this.on("graphic-translate",Z),this.on("graphic-translate-stop",()=>{this._moveXYTooltipInfo=null,this._moveZTooltipInfo=null,this._tooltip.clear()}),this.on("graphic-rotate-start",K=>{this._startAngle=K.angle,Z()}),this.on("graphic-rotate",K=>{this._endAngle=K.angle,Z()}),this.on("graphic-rotate-stop",()=>{this._startAngle=0,this._endAngle=0,Z()}),this.on("graphic-scale-start",K=>{(0,xe.s)(this._startScale,K.xScale,K.yScale),(0,xe.s)(this._endScale,K.xScale,K.yScale),Z()}),this.on("graphic-scale",K=>{(0,xe.s)(this._endScale,K.xScale,K.yScale),Z()}),this.on("graphic-scale-stop",()=>{(0,xe.s)(this._startScale,0,0),(0,xe.s)(this._endScale,0,0),Z()})]),this._forEachManipulator(K=>{G.add([K.events.on("focus-changed",Z),K.events.on("grab-changed",Z),K.events.on("drag",Q=>{"cancel"===Q.action?this._tooltip.clear():Z()})])})}_getUpdatedTooltipInfo(){return this.tooltipOptions.enabled?this._graphicMoveManipulation.grabbing||this._graphicMoveManipulation.dragging?this._computeMoveXYTooltipInfo():this._moveZManipulator.focused?this._computeMoveZTooltipInfo():this._rotateManipulator.focused?this._computeRotateTooltipInfo():this._resizeManipulators.some(G=>G.focused)?this._computeScaleTooltipInfo():null:null}_computeMoveXYTooltipInfo(){return this._moveXYTooltipInfo=(0,ae.Pt)(this._moveXYTooltipInfo,()=>new Nt.$E({tooltipOptions:this.tooltipOptions}))}_computeMoveZTooltipInfo(){const G=this._moveZTooltipInfo=(0,ae.Pt)(this._moveZTooltipInfo,()=>new Nt.QW({tooltipOptions:this.tooltipOptions})),D=this._moveUnit;if(this._moveZManipulator.dragging){const K=(0,_n.Cr)(this._mapBoundsStart.origin,this._mapBounds.origin,this.view.spatialReference);if((0,ae.Wi)(K))return null;G.distance=K}else G.distance=(0,It.yG)(0,D);return G}_computeRotateTooltipInfo(){const G=this._rotateTooltipInfo=(0,ae.Pt)(this._rotateTooltipInfo,()=>new eo.c({tooltipOptions:this.tooltipOptions}));return G.angle=this._startAngle-this._endAngle,G}_computeScaleTooltipInfo(){const G=this.graphic.geometry;if((0,ae.Wi)(G))return null;const D=this._scaleTooltipInfo=(0,ae.Pt)(this._scaleTooltipInfo,()=>new eo.p({tooltipOptions:this.tooltipOptions})),N=(0,fi.NI)(this._mapBounds,this._zmax,G.spatialReference,this._graphicState.isDraped);return(0,ae.Wi)(N)?null:(D.xSize=N[0],D.ySize=N[1],(0,ae.pC)(this._sizeStart)&&this._resizeManipulators.some(Z=>Z.dragging)?(D.xScale=N[0].value/this._sizeStart[0].value,D.yScale=N[1].value/this._sizeStart[1].value):(D.xScale=1,D.yScale=1),D)}_graphicDrapedChanged(){this._handles.remove(to),this._updateDisplayBounds(),this._graphicState.isDraped&&this._handles.add(this.view.elevationProvider.on("elevation-change",G=>{(0,ae.pC)(this._attachmentOrigin)&&(0,Xa.jE)(G.extent,this._attachmentOrigin.x,this._attachmentOrigin.y)&&this._updateDisplayBounds()}),to)}_updateAllManipulatorAvailability(){this._forEachManipulator((G,D)=>this._updateManipulatorAvailability(G,D))}_updateManipulatorAvailability(G,D){const N=this.grabbing&&!G.grabbing;if(G.interactive=!N,G instanceof Ft){const Z=this._graphicState.displaying,K=this.enableZ&&Ji(this.graphic);switch(D){case lt.ROTATE:G.available=Z&&this.enableRotation;break;case lt.SCALE:G.available=Z&&(this.enableScaling||this.enableRotation||K),G.interactive=!N&&this.enableScaling,G.state=this.enableScaling?Da:Jr;break;case lt.TRANSLATE_Z:G.available=Z&&K;break;default:G.available=Z}}}_forEachManipulator(G){this._graphicMoveManipulation.forEachManipulator(G),this._resizeManipulators.forEach(D=>G(D,lt.SCALE)),G(this._rotateManipulator,lt.ROTATE),G(this._moveZManipulator,lt.TRANSLATE_Z)}get preserveAspectRatio(){return this._preserveAspectRatio.enabled}set preserveAspectRatio(G){this._preserveAspectRatio.enabled=G,this._set("preserveAspectRatio",G)}get _moveUnit(){return(0,ae.Pt)((0,Ea.j5)(this.view.spatialReference),"meters")}reset(){}_onGeometryChanged(){this._updateDisplayBounds()}_calculateMapBounds(){const G=this.graphic.geometry,D=this._editGeometryOperations.data,N=D.components[0].edges[0],Z=(0,xe.a)(Se.qW.get(),N.leftVertex.pos,N.rightVertex.pos);(0,xe.f)(Z,Z);const K=(0,ae.Pt)(ua(this.view,this.graphic),()=>G.extent?.center);let Q=K?mh*this.view.pixelSizeAt(K):0;const J=this.view.spatialReference,se=G.spatialReference;J.equals(se)||(Q*=(0,Ea.c9)(J)/(0,Ea.c9)(se)),(0,fi.lv)(Z,D,Q,this._mapBounds),this._updateZMax()}_updateZMax(){const G=this._editGeometryOperations.data;if(!G.geometry.hasZ)return void(this._zmax=0);const D=G.coordinateHelper;let N=Number.NEGATIVE_INFINITY;for(const Z of G.components)for(const K of Z.vertices){const Q=D.getZ(K.pos)??0;N=Math.max(Q,N)}this._zmax=N}_updateDisplayBounds(){const{geometry:G}=this.graphic;if((0,ae.Wi)(G))return;const{extent:D}=G;if(!D)return;const N=(0,ae.pC)(this._outlineVisualElement)&&!this._graphicState.isDraped&&(0,ae.pC)(this._outlineVisualElement.attachmentOrigin)?this._outlineVisualElement.attachmentOrigin:ua(this.view,this.graphic);this._attachmentOrigin=(0,ae.Pt)(N,D.center);const Z=(0,ae.pC)(N)?N.z:(0,Pn.w7)(this._mapBounds.origin,this.view.elevationProvider,rn.o.fromElevationInfo((0,Ge.RL)(this.graphic)),this.view.renderCoordsHelper),K=(0,Pi.c)(this._mapBounds);K.origin[2]=Z??0,(0,fi.ny)(K,this.view.renderCoordsHelper,G.spatialReference,this._displayBoundsMargin,this._displayBounds),this._updateManipulators()}get _displayBoundsMargin(){const G=this.view.pointsOfInterest,D=G?G.centerOnSurfaceFrequent.location:this._editGeometryOperations.data.geometry.extent?.center;return D?_h*this.view.pixelSizeAt(D):0}_createMoveXYGraphicDragPipeline(){return this._graphicMoveManipulation.createDragPipeline((G,D,N)=>this._applyGraphicMoveSteps(D,N,Xe.XY))}_createMoveZDragPipeline(){const G=this.view,D=this._editGeometryOperations.data.spatialReference;return(0,Qe.Xd)(this._moveZManipulator,(N,Z,K)=>{const Q=(0,me.a)(N.renderLocation),J=Z.next(br(G,Q,D)).next((0,Qe.zh)());this._applyGraphicMoveSteps(J,K,Xe.Z)})}_applyGraphicMoveSteps(G,D,N){const Z=G.next(K=>("start"===K.action&&(this.inputState={type:"move"},this._updateOperationStartProperties(),this.emit("graphic-translate-start",{graphic:this.graphic,dxScreen:K.screenDeltaX,dyScreen:K.screenDeltaY})),K)).next((0,Qe.AN)()).next(this._moveDragUpdateGeometry()).next(K=>{const Q={graphic:this.graphic,dxScreen:K.screenDeltaX,dyScreen:K.screenDeltaY};switch(K.action){case"start":case"update":(K.mapEnd.x-K.mapStart.x||K.mapEnd.y-K.mapStart.y||(K.mapEnd.z??0)-(K.mapStart.z??0))&&this.emit("graphic-translate",Q);break;case"end":this.inputState=null,this.emit("graphic-translate-stop",Q)}return K}).next(K=>this._updateMoveTooltip(K,N));return D.next(()=>{(0,ae.pC)(this.inputState)&&this.emit("graphic-translate-stop",{graphic:this.graphic,dxScreen:0,dyScreen:0}),this._cancel()}),Z}_updateOperationStartProperties(){(0,Pi.c)(this._displayBounds,this._displayBoundsStart),(0,Pi.c)(this._mapBounds,this._mapBoundsStart),this._sizeStart=(0,ae.Wi)(this.graphic.geometry)?null:(0,fi.NI)(this._mapBoundsStart,this._zmax,this.graphic.geometry.spatialReference,this._graphicState.isDraped)}_moveDragUpdateGeometry(){return G=>{if((0,ae.Wi)(this.inputState)||"move"!==this.inputState.type)return G;const D=[];for(const K of this._editGeometryOperations.data.components)D.push(...K.vertices);const Z=this._editGeometryOperations.moveVertices(D,G.mapDeltaX,G.mapDeltaY,G.mapDeltaZ,"start"===G.action?bi.O.NEW_STEP:bi.O.ACCUMULATE_STEPS);return(0,fi.nn)(Z,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,G}}_updateMoveTooltip(G,D){if(D===Xe.XY||D===Xe.XY_AXIS){const N=(0,He.GQ)(G.mapStart,G.mapEnd,this._graphicState.isDraped?"on-the-ground":"absolute-height");(0,ae.pC)(N)&&(0,ae.pC)(this._moveXYTooltipInfo)&&(this._moveXYTooltipInfo.distance=N)}return G}_onResizeGrab({action:G,screenPoint:D}){if("start"!==G||!D)return;const N=this._calculatePickRay(D);(0,ft.BR)(this._displayBounds.plane,N,Se.WM.get())&&(this._updateOperationStartProperties(),this._displayBoundsMarginStart=this._displayBoundsMargin,this.inputState={type:"resize"})}_createResizeDragPipeline(G,D){return(0,Qe.Xd)(G,(N,Z,K)=>{(0,ae.Wi)(this.inputState)||(Z.next(Q=>("start"===Q.action&&this.emit("graphic-scale-start",{graphic:this.graphic,xScale:1,yScale:1}),Q)).next(_a(this.view,this._displayBoundsStart.plane)).next(Q=>({...Q,handle:D})).next(this._resizeDragRenderPlaneToFactors()).next(...this._preserveAspectRatio.createDragEventPipelineStep()).next(this._resizeDragUpdateGeometry()).next(Q=>{const J={graphic:this.graphic,xScale:Q.factor1,yScale:Q.factor2};switch(Q.action){case"start":case"update":this.emit("graphic-scale",J);break;case"end":this.inputState=null,this.emit("graphic-scale-stop",J)}return Q}),K.next(()=>{(0,ae.pC)(this.inputState)&&this.emit("graphic-scale-stop",{graphic:this.graphic,xScale:1,yScale:1}),this._cancel()}))})}_resizeDragRenderPlaneToFactors(){return G=>{const D=this._displayBoundsStart,N=G.handle.direction,Z=this._displayBoundsMargin,K=this._displayBoundsMarginStart,Q=(0,de.c)(Se.WM.get(),D.origin);(0,de.z)(Q,Q,D.basis1,-N[0]),(0,de.z)(Q,Q,D.basis2,-N[1]);const J=(0,de.b)(Se.WM.get(),G.renderEnd,Q),se=(0,de.b)(Se.WM.get(),G.renderStart,Q),re=Fn(G.handle),le=jn(D),he=jn(this._displayBounds)/le,pe=(ge,ye)=>{if(0===ge)return 1;let fe=(0,de.l)(ye),Me=.5*ge*(0,de.e)(ye,J)/fe;const Ie=Me<0?-1:1;re&&(Me+=(fe-.5*ge*(0,de.e)(ye,se)/fe)*Ie*he);const De=fe<1.5*K?1:io;return fe=Math.max(fe-K,io),Ie>0&&(Me-=Z),Ie*Math.max(Ie*(Me/fe),De)};return{...G,factor1:pe(N[0],D.basis1),factor2:pe(N[1],D.basis2)}}}_resizeDragUpdateGeometry(){return G=>{const D=(0,de.c)((0,me.c)(),this._mapBoundsStart.origin);(0,de.z)(D,D,this._mapBoundsStart.basis1,-G.handle.direction[0]),(0,de.z)(D,D,this._mapBoundsStart.basis2,-G.handle.direction[1]);const N=(0,xe.s)((0,We.a)(),this._mapBoundsStart.basis1[0],this._mapBoundsStart.basis1[1]);(0,xe.f)(N,N);const Z=[];for(const J of this._editGeometryOperations.data.components)Z.push(...J.vertices);const Q=this._editGeometryOperations.scaleVertices(Z,D,N,G.factor1,G.factor2,"start"===G.action?bi.O.NEW_STEP:bi.O.ACCUMULATE_STEPS,qr.w.REPLACE);return(0,Pi.c)(this._mapBoundsStart,this._mapBounds),(0,fi.nn)(Q,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,G}}_onRotateGrab({action:G,screenPoint:D}){if("start"!==G||!D)return;const N=function th(G,D,N,Z){const K=D.worldUpAtPosition(G.origin,Se.WM.get()),Q=Se.WM.get();switch(N){case Nn.HEADING:(0,de.c)(Q,K);break;case Nn.TILT:(0,de.c)(Q,G.basis1)}return(0,ft.Yq)(G.origin,Q,Z)}(this._displayBounds,this.view.renderCoordsHelper,Nn.HEADING,(0,ft.Ue)()),Z=this._calculatePickRay(D);(0,ft.BR)(N,Z,Se.WM.get())&&(this._updateOperationStartProperties(),this.inputState={type:"rotate",rotatePlane:N})}_createRotateDragPipeline(G){return(0,Qe.Xd)(G,(D,N,Z)=>{const K=this.inputState;(0,ae.Wi)(K)||(N.next(Q=>("start"===Q.action&&this.emit("graphic-rotate-start",{graphic:this.graphic,angle:0}),Q)).next(_a(this.view,K.rotatePlane)).next(this._rotateDragRenderPlaneToRotate(K)).next(this._rotateDragUpdateGeometry()).next(Q=>{const J={graphic:this.graphic,angle:(0,Ct.BV)(Q.rotateAngle)};switch(Q.action){case"start":case"update":this.emit("graphic-rotate",J);break;case"end":this.inputState=null,this.emit("graphic-rotate-stop",J)}return Q}),Z.next(()=>{(0,ae.pC)(this.inputState)&&this.emit("graphic-rotate-stop",{graphic:this.graphic,angle:0}),this._cancel()}))})}_rotateDragRenderPlaneToRotate(G){return D=>{const N=(0,ft.mJ)(G.rotatePlane),Z=nr(D.renderStart,D.renderEnd,this._displayBounds.origin,N);return{...D,rotateAxis:N,rotateAngle:Z}}}_rotateDragUpdateGeometry(){return G=>{const D=(0,de.c)((0,me.c)(),this._mapBoundsStart.origin),N=[];for(const Q of this._editGeometryOperations.data.components)N.push(...Q.vertices);const K=this._editGeometryOperations.rotateVertices(N,D,G.rotateAngle,"start"===G.action?bi.O.NEW_STEP:bi.O.ACCUMULATE_STEPS,qr.w.REPLACE);return(0,Pi.c)(this._mapBoundsStart,this._mapBounds),(0,fi.nn)(K,this._mapBounds),this.graphic.geometry=this._editGeometryOperations.data.geometry,G}}_calculatePickRay(G){const D=(0,Kt.Ue)(),N=(0,Te.md)(G);return hn(this.view.state.camera,N,D),(0,de.n)(D.direction,D.direction),D}_updateManipulators(){if(!this.visible)return;const G=function eh(G,D){return ar(G.basis1,G.basis2,G.origin,D)}(this._displayBounds,Se.MP.get());(function ah(G,D,N,Z){const K=Z.worldUpAtPosition(N.origin,Se.WM.get()),Q=function ps(G,D){switch(D){case xi.POSITIVE_X:return{basis:G.basis1,direction:1,position:(0,de.a)(Se.WM.get(),G.origin,G.basis1),edge:D};case xi.POSITIVE_Y:return{basis:G.basis2,direction:1,position:(0,de.a)(Se.WM.get(),G.origin,G.basis2),edge:D};case xi.NEGATIVE_X:return{basis:G.basis1,direction:-1,position:(0,de.b)(Se.WM.get(),G.origin,G.basis1),edge:D};case xi.NEGATIVE_Y:return{basis:G.basis2,direction:-1,position:(0,de.b)(Se.WM.get(),G.origin,G.basis2),edge:D}}}(N,xi.POSITIVE_X),J=(0,je.b)(Se.MP.get(),Q.edge*Math.PI/2);(0,je.r)(J,J,-function us(G,D){return(0,vr.cp)(D,G.basis2,G.basis1)+yn}(N,K)),(0,je.m)(J,D,J),J[12]=0,J[13]=0,J[14]=0,G.modelTransform=J,G.renderLocation=Q.position})(this._rotateManipulator,G,this._displayBounds,this.view.renderCoordsHelper),this._updateZMoveHandle(this._moveZManipulator,G),this._resizeManipulators.forEach((D,N)=>{!function nh(G,D,N,Z){const K=(0,de.l)(Z.basis1),Q=(0,de.l)(Z.basis2),J=Qr(Z),se=jn(Z),re=(0,de.s)(Se.WM.get(),0,0,0);(0,de.a)(re,(0,de.g)(Se.WM.get(),Z.basis1,D.direction[0]),(0,de.g)(Se.WM.get(),Z.basis2,D.direction[1])),(0,de.a)(re,Z.origin,re);let le=0,he=1;if(Fn(D))1===D.direction[0]&&-1===D.direction[1]?le=yn:1===D.direction[0]&&1===D.direction[1]?le=Math.PI:-1===D.direction[0]&&1===D.direction[1]&&(le=3*Math.PI/2),he=se;else{const ge=0!==D.direction[0]?1:2;le=1===ge?yn:0,he=(1===ge?Q:K)-J}const pe=(0,je.b)(Se.MP.get(),le);(0,je.k)(pe,pe,(0,de.s)(Se.WM.get(),he,he,he)),(0,je.m)(pe,N,pe),pe[12]=0,pe[13]=0,pe[14]=0,G.modelTransform=pe,G.renderLocation=re}(D,this._resizeHandles[N],G,this._displayBounds)})}_updateZMoveHandle(G,D){const N=this._displayBounds,Z={basis:N.basis1,direction:-1,position:(0,de.b)(Se.WM.get(),N.origin,N.basis1),edge:2},K=Se.MP.get();(0,je.o)(K,D,Z.edge*Math.PI/2),K[12]=0,K[13]=0,K[14]=0,G.modelTransform=K,G.renderLocation=Z.position}_cancel(){const G=this._editGeometryOperations.lastOperation;(0,ae.Wi)(G)||(this._editGeometryOperations.undo(),this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,fi.mO)(G,this._mapBounds),this._updateDisplayBounds(),this.inputState=null)}get canUndo(){return this._editGeometryOperations.canUndo}undo(){if((0,ae.pC)(this.inputState))this.view.activeTool=null;else if(this.canUndo){const G=this._editGeometryOperations.undo();this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,fi.mO)((0,ae.Wg)(G),this._mapBounds),this._updateDisplayBounds()}}get canRedo(){return this._editGeometryOperations.canRedo}redo(){if(this.canRedo){const G=this._editGeometryOperations.redo();this.graphic.geometry=this._editGeometryOperations.data.geometry,(0,fi.nn)((0,ae.Wg)(G),this._mapBounds),this._updateDisplayBounds()}}get test(){return{resizeManipulators:this._resizeManipulators,rotateManipulator:this._rotateManipulator,moveZManipulator:this._moveZManipulator,tooltip:this._tooltip}}};(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],Yt.prototype,"view",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],Yt.prototype,"graphic",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,nonNullable:!0})],Yt.prototype,"enableZ",void 0),(0,ce._)([(0,ue.Cb)()],Yt.prototype,"enableRotation",void 0),(0,ce._)([(0,ue.Cb)()],Yt.prototype,"enableScaling",void 0),(0,ce._)([(0,ue.Cb)({constructOnly:!0,type:Gi.Z})],Yt.prototype,"tooltipOptions",void 0),(0,ce._)([(0,ue.Cb)()],Yt.prototype,"preserveAspectRatio",null),(0,ce._)([(0,ue.Cb)()],Yt.prototype,"grabbing",void 0),(0,ce._)([(0,ue.Cb)()],Yt.prototype,"inputState",void 0),(0,ce._)([(0,ue.Cb)({readOnly:!0})],Yt.prototype,"type",void 0),(0,ce._)([(0,ue.Cb)()],Yt.prototype,"_moveUnit",null),Yt=(0,ce._)([(0,Ze.j)("esri.views.3d.interactive.editingTools.graphicTransform3D.ExtentTransformTool")],Yt);const to="draped-elevation-changes",_h=10,mh=80,io=1e-6},47634:(hi,vt,oe)=>{oe.d(vt,{j:()=>de});var ce=oe(62208),we=oe(47923),ae=oe(39832),ve=oe(95285),ue=oe(97139),ht=oe(65787),rt=oe(17625),Ze=oe(35387);function de(me,Ge){me.extensions.add("GL_OES_standard_derivatives");const Be=me.fragment;Be.include(we.S),me.include(ae.G),Be.uniforms.add([new ht.p("globalAlpha",Te=>Te.globalAlpha),new ue.J("glowColor",Te=>Te.glowColor),new ht.p("glowWidth",(Te,ct)=>Te.glowWidth*ct.camera.pixelRatio),new ht.p("glowFalloff",Te=>Te.glowFalloff),new ue.J("innerColor",Te=>Te.innerColor),new ht.p("innerWidth",(Te,ct)=>Te.innerWidth*ct.camera.pixelRatio),new Ze.A("depthMap",(Te,ct)=>ct.linearDepthTexture),new ve.A("nearFar",(Te,ct)=>ct.camera.nearFar),new Ze.A("frameColor",(Te,ct)=>ct.mainColorTexture)]),Be.code.add(rt.H`vec4 blendPremultiplied(vec4 source, vec4 dest) {
float oneMinusSourceAlpha = 1.0 - source.a;
return vec4(
source.rgb + dest.rgb * oneMinusSourceAlpha,
source.a + dest.a * oneMinusSourceAlpha
);
}`),Be.code.add(rt.H`vec4 premultipliedColor(vec3 rgb, float alpha) {
return vec4(rgb * alpha, alpha);
}`),Be.code.add(rt.H`vec4 laserlineProfile(float dist) {
if (dist > glowWidth) {
return vec4(0.0);
}
float innerAlpha = (1.0 - smoothstep(0.0, innerWidth, dist));
float glowAlpha = pow(max(0.0, 1.0 - dist / glowWidth), glowFalloff);
return blendPremultiplied(
premultipliedColor(innerColor, innerAlpha),
premultipliedColor(glowColor, glowAlpha)
);
}`),Be.code.add(rt.H`bool laserlineReconstructFromDepth(out vec3 pos, out vec3 normal, out float depthDiscontinuityAlpha) {
float depth = linearDepthFromTexture(depthMap, uv, nearFar);
if (-depth == nearFar[0]) {
return false;
}
pos = reconstructPosition(gl_FragCoord.xy, depth);
normal = normalize(cross(dFdx(pos), dFdy(pos)));
float ddepth = fwidth(depth);
depthDiscontinuityAlpha = 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);
return true;
}`),Ge.contrastControlEnabled?(Be.uniforms.add(new ht.p("globalAlphaContrastBoost",Te=>(0,ce.pC)(Te.globalAlphaContrastBoost)?Te.globalAlphaContrastBoost:1)),Be.code.add(rt.H`float rgbToLuminance(vec3 color) {
return dot(vec3(0.2126, 0.7152, 0.0722), color);
}
vec4 laserlineOutput(vec4 color) {
float backgroundLuminance = rgbToLuminance(texture2D(frameColor, uv).rgb);
float alpha = clamp(globalAlpha * max(backgroundLuminance * globalAlphaContrastBoost, 1.0), 0.0, 1.0);
return color * alpha;
}`)):Be.code.add(rt.H`vec4 laserlineOutput(vec4 color) {
return color * globalAlpha;
}`)}},81801:(hi,vt,oe)=>{oe.d(vt,{A:()=>ve});var ce=oe(99198),we=oe(65787),ae=oe(17625);function ve(ue,ht){if(!ht.screenSizeEnabled)return;const rt=ue.vertex;(0,ce.hY)(rt,ht),rt.uniforms.add(new we.p("perScreenPixelRatio",(Ze,de)=>de.camera.perScreenPixelRatio)),rt.uniforms.add(new we.p("screenSizeScale",Ze=>Ze.screenSizeScale)),rt.code.add(ae.H`float computeRenderPixelSizeAt( vec3 pWorld ){
vec3 viewForward = - vec3(view[0][2], view[1][2], view[2][2]);
float viewDirectionDistance = abs(dot(viewForward, pWorld - cameraPosition));
return viewDirectionDistance * perScreenPixelRatio;
}
vec3 screenSizeScaling(vec3 position, vec3 anchor){
return position * screenSizeScale * computeRenderPixelSizeAt(anchor) + anchor;
}`)}}}]);
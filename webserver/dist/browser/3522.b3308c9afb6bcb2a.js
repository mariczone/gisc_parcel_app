"use strict";(self.webpackChunkparcel_app=self.webpackChunkparcel_app||[]).push([[3522],{47916:(xt,st,i)=>{i.d(st,{T:()=>A,I:()=>Lt});var r=i(17626),F=i(88879),H=i(61885),E=i(80542),d=i(54024),h=i(62208),P=i(15572),it=i(32917),D=i(16730),l=i(77712),N=(i(90912),i(85931)),J=i(76898),K=i(51470),G=i(60507),z=(i(29132),i(58817)),Q=i(84161),Y=i(28093),S=i(72149),W=i(44766),g=i(25748),x=i(37053),T=i(31478),b=i(46342),M=i(48977),R=i(78451),V=i(78172),j=i(72642);function L(t,e,y=null){return(0,h.pC)(y)?[t,e,y]:[t,e]}function I(t,e,y=null){return(0,h.pC)(y)?{x:t,y:e,z:y}:{x:t,y:e}}class O{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return(0,h.lV)(e.map(y=>this.mapToLocal(y)))}get doUnnormalization(){return!1}}class nt extends O{constructor(e,y,C=null){super(y),this._defaultZ=C,this.transform=(0,b.c)(),this.transformInv=(0,b.c)(),this.transform=(0,b.a)(e),(0,T.c)(this.transformInv,this.transform)}makeMapPoint(e,y){return L(e,y,this._defaultZ)}mapToLocal(e){return I(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return L(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}}class a extends O{constructor(e,y){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=(0,Y.c)(),this.tangentFrameUpWS=(0,Y.c)(),this.tangentFrameRightWS=(0,Y.c)(),this.tangentFrameForwardWS=(0,Y.c)(),this.localFrameRightWS=(0,Y.c)(),this.localFrameUpWS=(0,Y.c)(),this.worldToLocalTransform=(0,R.a)(),this.localToWorldTransform=(0,R.a)(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=y,this.defaultZ=y.hasZ?y.z:null;const C=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,V.R.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,V.R.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,V.R.Z,this.tangentFrameForwardWS);const Z=(0,Y.c)();(0,Q.g)(Z,this.tangentFrameForwardWS,(0,Q.e)(C,this.tangentFrameForwardWS)),(0,Q.b)(this.localFrameRightWS,C,Z),(0,Q.n)(this.localFrameRightWS,this.localFrameRightWS),(0,Q.f)(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),(0,M.r)(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),(0,M.i)(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return"global"===this.view.viewingMode}makeMapPoint(e,y){return L(e,y,this.defaultZ)}mapToLocal(e){const y=(0,Y.c)();this.view.renderCoordsHelper.toRenderCoords(new j.Z({x:e[0],y:e[1],spatialReference:this.spatialReference}),y),(0,Q.q)(y,y,this.worldToLocalTransform);const C=this.view.renderCoordsHelper.fromRenderCoords(y,this.view.spatialReference);return(0,h.pC)(C)?I(C.x/this.scale,C.y/this.scale):null}localToMap(e){const y=(0,Y.c)();this.view.renderCoordsHelper.toRenderCoords(new j.Z({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),y),(0,Q.q)(y,y,this.localToWorldTransform);const C=this.view.renderCoordsHelper.fromRenderCoords(y,this.view.spatialReference);return(0,h.pC)(C)?L(C.x,C.y,this.defaultZ):null}}function v(t,e){if("2d"===t.type)return new nt(t.state.transform,t.spatialReference,e.length>2?e[2]:null);if("3d"===t.type){const y=new j.Z(e.length>2?{x:e[0],y:e[1],z:e[2],spatialReference:t.spatialReference}:{x:e[0],y:e[1],spatialReference:t.spatialReference});return new a(t,y)}return null}var n=i(72854),s=i(55214),c=i(37118);function o(t,e){const y=new j.Z({x:t[0],y:t[1],spatialReference:e});return t.length>2&&(y.z=t[2]),y}function m(t,e,y){const C=new s.Z({paths:t,spatialReference:e});return y&&(0,g.nc)(C),C}function f(t,e,y,C=!0){const Z=(0,z.d9)(t);Z.forEach(w=>{(0,N.fS)(w[0],w[w.length-1])&&1!==w.length||w.push(w[0])});let u=new c.Z({rings:Z,spatialReference:e});return u.rings.forEach(w=>{(0,g.bu)(w,!1,!1)||w.reverse()}),y&&(0,g.nc)(u),C&&u.isSelfIntersecting&&(0,x.JY)(e)&&(u=(0,W.simplify)(u)),u}function B(t,e,y){const C=e.mapToLocalMultiple(t),Z=[],u={x:C[0].x,y:C[0].y},w_y=C[1].y,$=Math.round(C[1].x-u.x),X=Math.round(w_y-u.y),k=Math.max(Math.abs($),Math.abs(X));if(y){const q={x:u.x+k,y:u.y+k},rt={x:u.x-k,y:u.y-k};Z.push(I(q.x,rt.y),I(rt.x,rt.y),I(rt.x,q.y),I(q.x,q.y))}else{const q={x:$>0?u.x+k:u.x-k,y:X>0?u.y+k:u.y-k};Z.push(I(u.x,u.y),I(q.x,u.y),I(q.x,q.y),I(u.x,q.y))}return et(f([(0,h.lV)(Z.map(q=>e.localToMap(q)))],e.spatialReference,e.doUnnormalization,!0),Z,e)}function et(t,e,y){const C=ot(e[3],e[2],y),Z=ot(e[1],e[2],y),u=ot(e[0],e[1],y),w=ot(e[0],e[3],y);return{geometry:t,midpoints:(0,h.pC)(C)&&(0,h.pC)(Z)&&(0,h.pC)(u)&&(0,h.pC)(w)?{top:C,right:Z,bottom:u,left:w}:null}}function ot(t,e,y){lt[0]=t.x,lt[1]=t.y,lt[2]=0,ht[0]=e.x,ht[1]=e.y,ht[2]=0,(0,Q.h)(lt,lt,ht,.5),pt.x=lt[0],pt.y=ht[1],pt.z=ht[2];const C=y.localToMap(pt);return(0,h.pC)(C)?o(C,y.spatialReference):null}const pt=I(0,0,0),lt=(0,Y.c)(),ht=(0,Y.c)();function Tt(t,e,y,C){const Z=e.mapToLocalMultiple(t);let u=null,w=null;if(y)u=Z[0],w=Z[1];else{const at=Z[0],ct=Z[1],Mt=Math.round(ct.x-at.x),Et=Math.round(ct.y-at.y),ut=Math.max(Math.abs(Mt),Math.abs(Et));u=I(Mt>0?at.x+ut/2:at.x-ut/2,Et>0?at.y+ut/2:at.y-ut/2),w=I(Math.abs(Mt)>Math.abs(Et)?u.x-ut/2:u.x,Math.abs(Mt)>Math.abs(Et)?u.y:u.y-ut/2)}const $=e.localToMap(u),X=e.localToMap(w);if((0,h.Wi)($)||(0,h.Wi)(X))return null;e.doUnnormalization&&(0,g.Sq)([[$,X]],e.spatialReference);const k=o($,e.spatialReference),q=o(X,e.spatialReference),rt=(0,D.c9)(e.spatialReference);let mt=0;if((0,x.JY)(e.spatialReference))mt=rt*(0,W.distance)(k,q,null);else{const at=u.x-w.x,ct=u.y-w.y;mt=rt*Math.sqrt(at*at+ct*ct)*(C||1)}const Pt=new S.Z({center:k,radius:mt,radiusUnit:"meters",spatialReference:e.spatialReference});return{geometry:f(Pt.rings,Pt.spatialReference,!1),center:k,edge:q}}function St(t,e){switch(t){case"point":case"multipoint":return"point";case"polyline":return((0,h.pC)(e)&&"polyline"===e.type&&e.paths.length?e.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex";case"polygon":{const y=(0,h.pC)(e)&&"polygon"===e.type&&e.rings.length?e.rings[0].length:0;return y<3?"polylineZeroVertices":y<4?"polygonOneVertex":"polygonTwoVertices"}default:return}}var Gt=i(22944),wt=i(24959),Wt=i(9997),bt=i(62980);let Ct=class extends bt.h{constructor(t){super(t),this.type="draw-point",this.helpMessage=void 0}};(0,r._)([(0,l.Cb)()],Ct.prototype,"type",void 0),(0,r._)([(0,l.Cb)()],Ct.prototype,"elevation",void 0),(0,r._)([(0,l.Cb)()],Ct.prototype,"viewType",void 0),(0,r._)([(0,l.Cb)()],Ct.prototype,"helpMessage",void 0),Ct=(0,r._)([(0,J.j)("esri.views.interactive.tooltip.DrawPointTooltipInfo")],Ct);let gt=class extends bt.h{constructor(t){super(t),this.type="draw-polyline",this.totalLength=P.yP,this.helpMessage=void 0}};(0,r._)([(0,l.Cb)()],gt.prototype,"type",void 0),(0,r._)([(0,l.Cb)()],gt.prototype,"elevation",void 0),(0,r._)([(0,l.Cb)()],gt.prototype,"totalLength",void 0),(0,r._)([(0,l.Cb)()],gt.prototype,"viewType",void 0),(0,r._)([(0,l.Cb)()],gt.prototype,"helpMessage",void 0),gt=(0,r._)([(0,J.j)("esri.views.interactive.tooltip.DrawPolylineTooltipInfo")],gt);let vt=class extends bt.h{constructor(t){super(t),this.type="draw-polygon",this.area=P.MQ,this.helpMessage=void 0}};(0,r._)([(0,l.Cb)()],vt.prototype,"type",void 0),(0,r._)([(0,l.Cb)()],vt.prototype,"elevation",void 0),(0,r._)([(0,l.Cb)()],vt.prototype,"area",void 0),(0,r._)([(0,l.Cb)()],vt.prototype,"viewType",void 0),(0,r._)([(0,l.Cb)()],vt.prototype,"helpMessage",void 0),vt=(0,r._)([(0,J.j)("esri.views.interactive.tooltip.DrawPolygonTooltipInfo")],vt);let _t=class extends bt.h{constructor(t){super(t),this.type="draw-rectangle",this.xSize=P.yP,this.ySize=P.yP,this.area=P.MQ}};(0,r._)([(0,l.Cb)()],_t.prototype,"type",void 0),(0,r._)([(0,l.Cb)()],_t.prototype,"xSize",void 0),(0,r._)([(0,l.Cb)()],_t.prototype,"ySize",void 0),(0,r._)([(0,l.Cb)()],_t.prototype,"area",void 0),_t=(0,r._)([(0,J.j)("esri.views.interactive.tooltip.DrawRectangleTooltipInfo")],_t);let yt=class extends bt.h{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=P.MQ}};(0,r._)([(0,l.Cb)()],yt.prototype,"type",void 0),(0,r._)([(0,l.Cb)()],yt.prototype,"radius",void 0),(0,r._)([(0,l.Cb)()],yt.prototype,"xSize",void 0),(0,r._)([(0,l.Cb)()],yt.prototype,"ySize",void 0),(0,r._)([(0,l.Cb)()],yt.prototype,"area",void 0),yt=(0,r._)([(0,J.j)("esri.views.interactive.tooltip.DrawCircleTooltipInfo")],yt);var zt=i(60358),Dt=i(65242),Ot=i(22463);let A=class extends((0,E.p)(H.Z.EventedMixin(Gt.m))){constructor(t){super(t),this._graphic=null,this._createOperationGeometry=null,this.defaultZ=0,this.geometryType=null,this.hasZ=!0,this.labelOptions=new wt.Z,this.mode=null,this.snappingManager=null,this.snapToScene=!1,this.tooltip=null,this.tooltipOptions=new Wt.Z}initialize(){this.internalGraphicsLayer=new K.Z({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer),this.drawOperation=this.makeDrawOperation(),this.handles.add([this.drawOperation.on("vertex-add",t=>this.onVertexAdd(t)),this.drawOperation.on("vertex-remove",t=>this.onVertexRemove(t)),this.drawOperation.on("vertex-update",t=>this.onVertexUpdate(t)),this.drawOperation.on("cursor-update",t=>this.onCursorUpdate(t)),this.drawOperation.on("complete",t=>this.onComplete(t)),(0,it.YP)(()=>this.tooltipOptions.enabled,t=>{this.tooltip=t?new zt.u({view:this.view,info:this._tooltipInfo}):(0,h.SC)(this.tooltip)},it.tX),(0,it.YP)(()=>this._tooltipInfo,t=>{(0,h.pC)(this.tooltip)&&(this.tooltip.info=t)},it.tX)]),this.finishToolCreation()}destroy(){this.drawOperation=(0,h.SC)(this.drawOperation),this.tooltip=(0,h.SC)(this.tooltip),this._destroyAllVisualisations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=(0,h.SC)(this.internalGraphicsLayer),this._set("view",null)}get _defaultElevation(){return(0,P.yG)(this.defaultZ,"meters")}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),(0,h.pC)(this._graphic)&&(this._graphic.symbol=t)}get updating(){return this.drawOperation?.updating??!1}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo()}_createGraphic(t){this._graphic=new F.Z({...this.graphicProperties,geometry:t,symbol:this.graphicSymbol}),this.internalGraphicsLayer.add(this._graphic),this.handles.add(this.initializeGraphic(this._graphic)),this.notifyChange("graphic"),this.handles.add((0,d.kB)(()=>{(0,h.pC)(this._graphic)&&(this.internalGraphicsLayer.remove(this._graphic),this._graphic=(0,h.SC)(this._graphic))}),It)}_destroyAllVisualisations(){this.handles.remove(dt.outline),this.handles.remove(dt.regularVertices),this.handles.remove(dt.activeVertex),this.handles.remove(It)}_getCreateOperationGeometry(t={operationComplete:!1}){if(null==this.drawOperation||0===this.drawOperation.numVertices)return null;const e=this.drawOperation.stagedVertex,y=this.drawOperation.committedVertices,C=y.slice();(0,h.pC)(e)&&C.push(this.drawOperation.coordinateHelper.pointToArray(e));const Z=(0,h.pC)(e)?this.drawOperation.coordinateHelper.pointToArray(e):y.splice(-1)[0],u={regularVertices:null,activeVertex:null,full:null,outline:null,circle:null,rectangle:null},w=C.length,$=this.view.spatialReference,X="3d"===this.view.type&&"global"===this.view.viewingMode;switch(this.geometryType){case"point":u.regularVertices=y,u.activeVertex=Z,u.full=this.drawOperation.coordinateHelper.arrayToPoint(C[0]);break;case"multipoint":u.regularVertices=y,u.activeVertex=Z,w>0&&(u.full=function p(t,e){return new n.Z({points:t,spatialReference:e})}(C,$));break;case"polyline":u.regularVertices=y,u.activeVertex=Z,w>0&&(u.full=m([C],$,X));break;case"polygon":u.regularVertices=y,u.activeVertex=Z,w>0&&(u.full=f([C],$,X,!0));break;case"circle":if(w>0){const k=v(this.view,C[0]);if(1===w&&t.operationComplete){const q=C[0],rt=k.makeMapPoint(q[0]+Rt*this.view.resolution,q[1]);u.circle=Tt([q,rt],k,!0),u.full=(0,h.pC)(u.circle)?u.circle.geometry:null}else 2===w&&(this.forceUniformSize?(u.circle=Tt(C,k,this.centered),u.full=(0,h.pC)(u.circle)?u.circle.geometry:null):(u.rectangle=function Zt(t,e,y){const C=e.mapToLocalMultiple(t),Z=C[0],u=C[1],w=Math.round(u.x-Z.x),$=Math.round(u.y-Z.y),X=I(y?Z.x:Z.x+w/2,y?Z.y:Z.y+$/2),k=y?w:w/2,q=y?$:$/2,mt=[],Pt=2*Math.PI/60;function at(ft){const Ft=Math.cos(ft),jt=Math.sin(ft);return I(k*Ft+X.x,q*jt+X.y)}for(let ft=0;ft<60;ft++)mt.push(at(ft*Pt));mt.push(mt[0]);const{spatialReference:ct,doUnnormalization:Mt}=e,Et=f([(0,h.lV)(mt.map(ft=>e.localToMap(ft)))],ct,Mt,!1),ut=e.localToMap(at(Math.PI/2)),Vt=e.localToMap(at(0)),Ut=e.localToMap(at(-Math.PI/2)),At=e.localToMap(at(Math.PI));return{geometry:Et,midpoints:(0,h.pC)(ut)&&(0,h.pC)(Vt)&&(0,h.pC)(Ut)&&(0,h.pC)(At)?{top:o(ut,ct),right:o(Vt,ct),bottom:o(Ut,ct),left:o(At,ct)}:null}}(C,k,this.centered),u.full=u.rectangle.geometry))}break;case"rectangle":if(w>0){const k=v(this.view,C[0]);if(1===w&&t.operationComplete){const q=C[0],rt=k.makeMapPoint(q[0]+Rt*this.view.resolution,q[1]);u.rectangle=B([q,rt],k,!0),u.full=u.rectangle.geometry}else 2===w&&(u.rectangle=this.forceUniformSize?B(C,k,this.centered):function tt(t,e,y){let C=e.mapToLocalMultiple(t);if(1===C.length){const X=C[0];C=[I(X.x-48,X.y+48),I(X.x+48,X.y-48),I(X.x+48,X.y-48),I(X.x-48,X.y+48)]}const Z=[],u={x:C[0].x,y:C[0].y},w={x:C[1].x,y:C[1].y};if(y){const $=Math.round(w.x-u.x),X=Math.round(w.y-u.y);Z.push(I(u.x-$,u.y-X),I(w.x,u.y-X),I(w.x,w.y),I(u.x-$,w.y))}else Z.push(I(u.x,u.y),I(w.x,u.y),I(w.x,w.y),I(u.x,w.y));return et(f([(0,h.lV)(Z.map($=>e.localToMap($)))],e.spatialReference,e.doUnnormalization,!0),Z,e)}(C,k,this.centered),u.full=u.rectangle.geometry)}break;default:return null}switch(this.geometryType){case"point":case"multipoint":break;case"polyline":case"polygon":w>1&&(u.outline=m([C],$,X));break;case"circle":case"rectangle":(0,h.pC)(u.full)&&"polygon"===u.full.type&&(u.outline=f(u.full.rings,$,X))}return u}initializeGraphic(t){return null}onComplete(t){this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const y=this._getCreateOperationGeometry({operationComplete:!0});(0,h.pC)(y)&&((0,h.Wi)(this._graphic)?this._createGraphic(y.full):this._graphic.geometry=y.full,e=(0,h.Wg)(this._graphic).clone())}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){this.drawOperation.isCompleted||this.drawOperation.cancel()}onVertexAdd(t){this._updateGraphic(),this.emit("vertex-add",t)}onVertexRemove(t){this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,(0,h.Wi)(t)?this._destroyAllVisualisations():((0,h.pC)(t.outline)?this.handles.add(this.onOutlineChanged(t.outline),dt.outline):this.handles.remove(dt.outline),(0,h.pC)(t.regularVertices)?this.handles.add(this.onRegularVerticesChanged(t.regularVertices),dt.regularVertices):this.handles.remove(dt.regularVertices),(0,h.pC)(t.activeVertex)?this.handles.add(this.onActiveVertexChanged(t.activeVertex),dt.activeVertex):this.handles.remove(dt.activeVertex),(0,h.pC)(t.full)?(0,h.Wi)(this._graphic)?this._createGraphic(t.full):this._graphic.geometry=t.full:this.handles.remove(It))}get _tooltipInfo(){const{drawOperation:t}=this;if(!t)return null;switch(this.geometryType){case"point":return this._drawPointTooltipInfo;case"polyline":return this._drawPolylineTooltipInfo;case"polygon":return this._drawPolygonTooltipInfo;case"rectangle":return this._drawRectangleTooltipInfo;case"circle":return this._drawCircleTooltipInfo;default:return null}}get _drawPointTooltipInfo(){const t=(0,h.yw)(this.graphic,e=>e.geometry);return(0,h.Wi)(t)||"point"!==t.type||"2d"===this.view.type&&0===this.defaultZ?null:new Ct({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,viewType:this.view.type,helpMessage:St("point",t)})}get _drawPolylineTooltipInfo(){const t=this._createOperationGeometry,e=(0,h.pC)(t)?t.full:null;if((0,h.Wi)(e)||"polyline"!==e.type)return null;const y=(0,Ot.Ul)(e,this._elevationMode);return new gt({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,totalLength:(0,h.Pt)(y,P.yP),viewType:this.view.type,helpMessage:St("polyline",e)})}get _drawPolygonTooltipInfo(){const t=this._createOperationGeometry,e=(0,h.pC)(t)?t.full:null;if((0,h.Wi)(e)||"polygon"!==e.type)return null;const y=(0,Dt.k)(e,this._elevationMode);return new vt({tooltipOptions:this.tooltipOptions,elevation:this._elevationTooltipDetail,area:(0,h.Pt)(y,P.MQ),viewType:this.view.type,helpMessage:St("polygon",e)})}get _drawRectangleTooltipInfo(){return(0,h.Wi)(this.drawOperation)?null:new _t({tooltipOptions:this.tooltipOptions,xSize:(0,h.Pt)(this._xSize,P.yP),ySize:(0,h.Pt)(this._ySize,P.yP),area:(0,h.Pt)(this._fullGeometryArea,P.MQ)})}get _drawCircleTooltipInfo(){if((0,h.Wi)(this.drawOperation))return null;const t=this.forceUniformSize;return new yt({tooltipOptions:this.tooltipOptions,radius:t?(0,h.Pt)(this._circleRadius,P.yP):null,xSize:t?null:(0,h.Pt)(this._xSize,P.yP),ySize:t?null:(0,h.Pt)(this._ySize,P.yP),area:(0,h.Pt)(this._fullGeometryArea,P.MQ)})}get _circleRadius(){const t=this._createOperationGeometry;return(0,h.pC)(t)&&(0,h.pC)(t.circle)&&(0,h.pC)(t.circle.center)&&(0,h.pC)(t.circle.edge)?(0,Ot.GQ)(t.circle.center,t.circle.edge,this._elevationMode):null}get _xSize(){const t=this._createOperationGeometry;if((0,h.Wi)(t)||(0,h.Wi)(t.rectangle))return null;const{midpoints:e}=t.rectangle;return(0,h.pC)(e)?(0,Ot.GQ)(e.left,e.right,this._elevationMode):null}get _ySize(){const t=this._createOperationGeometry;if((0,h.Wi)(t)||(0,h.Wi)(t.rectangle))return null;const{midpoints:e}=t.rectangle;return(0,h.pC)(e)?(0,Ot.GQ)(e.top,e.bottom,this._elevationMode):null}get _fullGeometryArea(){const t=this._createOperationGeometry,e=(0,h.pC)(t)?t.full:null;return(0,h.Wi)(e)||"polygon"!==e.type?null:(0,Dt.k)(e,this._elevationMode)}get _elevationTooltipDetail(){return{mode:this.drawOperation.elevationInfo.mode,...this._vertexTooltipElevation}}get _vertexTooltipElevation(){const{tooltipOptions:t,view:e,drawOperation:y}=this;if((0,h.Wi)(y))return this._defaultElevation;const C=y.stagedVertex??y.lastVertex;if((0,h.Wi)(C)||"2d"===e.type)return this._defaultElevation;const u=((0,G.vQ)(e,C,y.elevationInfo,{mode:t.elevation.mode,offset:0})??0)*(0,D._R)(C.spatialReference);return(0,P.yG)(u,"meters")}get _elevationMode(){return this.drawOperation.isDraped?"on-the-ground":"absolute-height"}};(0,r._)([(0,l.Cb)()],A.prototype,"_createOperationGeometry",void 0),(0,r._)([(0,l.Cb)()],A.prototype,"_defaultElevation",null),(0,r._)([(0,l.Cb)({value:!0})],A.prototype,"centered",null),(0,r._)([(0,l.Cb)({nonNullable:!0})],A.prototype,"defaultZ",void 0),(0,r._)([(0,l.Cb)()],A.prototype,"drawOperation",void 0),(0,r._)([(0,l.Cb)({value:!0})],A.prototype,"enabled",null),(0,r._)([(0,l.Cb)({value:!0})],A.prototype,"forceUniformSize",null),(0,r._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"geometryType",void 0),(0,r._)([(0,l.Cb)()],A.prototype,"graphic",null),(0,r._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"graphicProperties",void 0),(0,r._)([(0,l.Cb)()],A.prototype,"graphicSymbol",null),(0,r._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"hasZ",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0,type:wt.Z})],A.prototype,"labelOptions",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0})],A.prototype,"mode",void 0),(0,r._)([(0,l.Cb)()],A.prototype,"snappingManager",void 0),(0,r._)([(0,l.Cb)()],A.prototype,"snapToScene",void 0),(0,r._)([(0,l.Cb)()],A.prototype,"tooltip",void 0),(0,r._)([(0,l.Cb)({constructOnly:!0,type:Wt.Z})],A.prototype,"tooltipOptions",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],A.prototype,"type",void 0),(0,r._)([(0,l.Cb)({readOnly:!0})],A.prototype,"updating",null),(0,r._)([(0,l.Cb)({constructOnly:!0,nonNullable:!0})],A.prototype,"view",void 0),(0,r._)([(0,l.Cb)()],A.prototype,"_tooltipInfo",null),(0,r._)([(0,l.Cb)()],A.prototype,"_drawPointTooltipInfo",null),(0,r._)([(0,l.Cb)()],A.prototype,"_drawPolylineTooltipInfo",null),(0,r._)([(0,l.Cb)()],A.prototype,"_drawPolygonTooltipInfo",null),(0,r._)([(0,l.Cb)()],A.prototype,"_drawRectangleTooltipInfo",null),(0,r._)([(0,l.Cb)()],A.prototype,"_drawCircleTooltipInfo",null),(0,r._)([(0,l.Cb)()],A.prototype,"_circleRadius",null),(0,r._)([(0,l.Cb)()],A.prototype,"_xSize",null),(0,r._)([(0,l.Cb)()],A.prototype,"_ySize",null),(0,r._)([(0,l.Cb)()],A.prototype,"_fullGeometryArea",null),(0,r._)([(0,l.Cb)()],A.prototype,"_elevationTooltipDetail",null),(0,r._)([(0,l.Cb)()],A.prototype,"_vertexTooltipElevation",null),(0,r._)([(0,l.Cb)()],A.prototype,"_elevationMode",null),A=(0,r._)([(0,J.j)("esri.views.draw.DrawGraphicTool")],A);const It="create-operation-graphic",dt={outline:"outline-visual",regularVertices:"regular-vertices-visual",activeVertex:"active-vertex-visual"};function Lt(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment"}}const Rt=48},50566:(xt,st,i)=>{i.d(st,{w:()=>O});var r=i(17626),F=i(61885),H=i(80542),E=i(58817),d=i(62208),h=i(10699),P=i(32917),it=i(23841),D=i(77712),U=(i(90912),i(76898)),N=i(53639),J=i(60507),K=i(59617);const _="click";class z{constructor({grabbableForEvent:v}){this.events=new F.Z,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.grabbableForEvent=v}intersectionDistance(v,n){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}}var Q=i(50017),Y=i(75079),S=i(466),W=i(26777),g=i(24959),x=i(9997),T=i(9773),b=i(94009),M=i(15861),R=i(14517),j=(i(85931),i(84259));let L=class extends R.Z{constructor(a){var v;super(a),v=this,this.constrainResult=n=>n,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=(0,h.Ds)(function(){var n=(0,M.Z)(function*(s,c,o,p){const m=v._frameTask;if((0,d.Wi)(m))return;const f=yield m.schedule(()=>c.snap({...s,context:o,signal:p}),p);f.valid&&(yield m.schedule(()=>{v.stagedPoint=f.apply(),s!==v._snapPoints&&(0,d.pC)(v._snapPoints)&&(v.stagedPoint=c.update({...v._snapPoints,context:o}))},p))});return function(s,c,o,p){return n.apply(this,arguments)}}())}get stagedPoint(){return this._stagedPoint}set stagedPoint(a){this._stagedPoint=this.constrainResult(a)}initialize(){const a="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=(0,d.pC)(a)?a.registerTask(j.T8.SNAPPING):j.sq}destroy(){this._abortController=(0,d.IM)(this._abortController),this._frameTask=(0,d.hw)(this._frameTask)}update(a,v,n){this._snapPoints=a;const{point:s,scenePoint:c}=a,o=v.update({point:s,scenePoint:c,context:n});return this.stagedPoint=o,o}snap(a,v,n){var s=this;return(0,M.Z)(function*(){const{point:c,scenePoint:o}=a;return s.stagedPoint=v.update({point:c,scenePoint:o,context:n}),s._snapPoints=a,(0,d.Wi)(s._abortController)&&(s._abortController=new AbortController),s._snap(a,v,n,s._abortController.signal)})()}resnap(a,v){var n=this;return(0,M.Z)(function*(){(0,d.Wi)(n._snapPoints)||(yield n.snap(n._snapPoints,a,v))})()}abort(){this._abortController=(0,d.IM)(this._abortController),this._snapPoints=null}};(0,r._)([(0,D.Cb)({constructOnly:!0})],L.prototype,"view",void 0),(0,r._)([(0,D.Cb)()],L.prototype,"stagedPoint",null),(0,r._)([(0,D.Cb)()],L.prototype,"constrainResult",void 0),(0,r._)([(0,D.Cb)()],L.prototype,"_stagedPoint",void 0),L=(0,r._)([(0,U.j)("esri.views.interactive.snapping.SnappingOperation")],L);var I=i(44725);let O=class extends(F.Z.EventedMixin(H.r)){constructor(a){super(a),this._createOperationCompleted=!1,this._pointerDownStates=new Set,this.isDraped=!0,this.labelOptions=new g.Z,this.tooltipOptions=new x.Z,this.snapToSceneEnabled=null,this.lastVertex=null,(0,d.Wi)(a.elevationInfo)&&(this.elevationInfo=(0,J.mF)(!!a.hasZ))}initialize(){const{geometryType:a,view:v}=this,n=v.spatialReference,s="viewingMode"in v.state?v.state.viewingMode:K.JY.Local,c="segment"===a||"multipoint"===a?"polyline":a;this.coordinateHelper=(0,Q.Y6)(this.hasZ,this.hasM,n),this._editGeometryOperations=new W.c(new S.XE(c,this.coordinateHelper)),this._snappingOperation=new L({view:v,constrainResult:p=>(0,d.Wi)(p)?p:this._getEffectiveDrawSurface()?.constrainZ(p)}),this.handles.add((0,P.YP)(()=>this.stagedVertex,p=>{(0,d.Wi)(p)||this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(p)}],operation:"apply",type:"vertex-update"})},{sync:!0,equals:(p,m)=>(0,d._W)(p,m,N.k)})),this._activeComponent=new S.wA(n,s),this._editGeometryOperations.data.components.push(this._activeComponent);const o=this.segmentLabels;(0,d.pC)(o)&&(o.context={view:v,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.handles.add([(0,P.YP)(()=>this.labelOptions.enabled,p=>{o.visible=p},P.tX),this.on("cursor-update",()=>{const p=this.stagedVertex;o.stagedVertex=(0,d.pC)(p)?this.coordinateHelper.pointToVector(p):null})])),this.handles.add(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],p=>{const m=p.vertices.map(et=>({componentIndex:0,vertexIndex:et.index,coordinates:this.coordinateHelper.vectorToArray(et.pos)})),f=m.map(et=>et.coordinates);switch(p.type){case"vertex-add":this.emit(p.type,{...p,added:f,vertices:m});break;case"vertex-update":this.emit(p.type,{...p,updated:f,vertices:m});break;case"vertex-remove":this.emit(p.type,{...p,removed:f,vertices:m})}const B=this._activeComponent.getLastVertex(),tt=(0,d.pC)(B)?this.coordinateHelper.vectorToDehydratedPoint(B.pos):null;((0,d.Wi)(tt)||(0,d.Wi)(this.lastVertex)||!(0,N.k)(this.lastVertex,tt))&&(this.lastVertex=tt)})),this._manipulator=new z({grabbableForEvent:p=>"click"!==this.drawingMode||"touch"===p.pointerType&&this._snappingEnabled&&1===this._pointerDownStates.size}),this.manipulators.add(this._manipulator),this._manipulator.grabbable="point"!==a,this.handles.add([this._createManipulatorDragPipeline(this._manipulator),this._manipulator.events.on("immediate-click",p=>this._onImmediateClick(p)),this._manipulator.events.on("immediate-double-click",p=>this._onImmediateDoubleClick(p))]),(0,I.Ob)(this,()=>{const p=(0,d.Pt)(this.view.inputManager.latestPointerType,"mouse"),m=this._getSnappingContext(p);(0,d.pC)(this.snappingManager)&&this.updatingHandles.addPromise((0,h.R8)(this._snappingOperation.resnap(this.snappingManager,m)))})}destroy(){(0,d.SC)(this.segmentLabels),(0,d.SC)(this._snappingOperation),this._editGeometryOperations=(0,d.SC)(this._editGeometryOperations)}get _snappingEnabled(){return(0,d.pC)(this.snappingManager)&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const a=this._getEffectiveDrawSurface();return"3d"===this.view.type&&this.drawSurface!==a}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(a=>this.coordinateHelper.vectorToArray(a.pos))}set drawingMode(a){this._set("drawingMode",a??_)}get interactive(){return this._manipulator.interactive}set interactive(a){this._manipulator.interactive=a}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get numVertices(){return(0,d.pC)(this.stagedVertex)?this._activeComponent.vertices.length+1:this._activeComponent.vertices.length}get snappingOptions(){return(0,d.pC)(this.snappingManager)?this.snappingManager.options:null}get stagedVertex(){return this._snappingOperation.stagedPoint}set stagedVertex(a){this._snappingOperation.stagedPoint=(0,E.d9)(a)}get updating(){return this.updatingHandles.updating}get vertices(){const a=this.committedVertices;return(0,d.pC)(this.stagedVertex)&&a.push(this.coordinateHelper.pointToArray(this.stagedVertex)),a}cancel(){this.complete({aborted:!0})}commitStagedVertex(){if(this._snappingOperation.abort(),(0,d.pC)(this.stagedVertex)){const{stagedVertex:a}=this;this.stagedVertex=null,this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(a))}}complete(a){const v=a&&a.aborted||!1;this._snappingOperation.abort(),(0,d.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),"segment"===this.geometryType||"point"===this.geometryType?this.commitStagedVertex():this.stagedVertex=null,this._createOperationCompleted=!("multipoint"===this.geometryType&&0===this.numVertices||"polyline"===this.geometryType&&this.numVertices<2||"polygon"===this.geometryType&&this.numVertices<3),(this.isCompleted||v)&&this.emit("complete",{vertices:this.vertices.map((s,c)=>({componentIndex:0,vertexIndex:c,coordinates:s})),aborted:v,type:"complete"})}onInputEvent(a){switch(a.type){case"pointer-down":this._pointerDownStates.add(a.pointerId);break;case"pointer-up":this._pointerDownStates.delete(a.pointerId)}switch(a.type){case"pointer-move":return this._onPointerMove(a);case"hold":return this._onHold(a)}}redo(){this._editGeometryOperations.redo()}undo(){(0,d.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_closeOnClickVertexIndex(a){const v=this._activeComponent;if("polygon"===this.geometryType&&v.vertices.length>2){if(this._vertexWithinPointerDistance(v.vertices[0].pos,a))return 0;if(this._vertexWithinPointerDistance(v.vertices[v.vertices.length-1].pos,a))return v.vertices.length-1}return null}_createManipulatorDragPipeline(a){switch((0,d.Wg)(this.drawingMode)){case"click":return this._createManipulatorDragPipelineClick(a);case"freehand":return this._createManipulatorDragPipelineFreehand(a);case"hybrid":return this._createManipulatorDragPipelineHybrid(a)}}_createManipulatorDragPipelineClick(a){return(0,Y.Xd)(a,(v,n,s,c)=>{const o="touch"===c&&this._snappingEnabled;if(this.isCompleted||!o)return;const{snappingStep:p,cancelSnapping:m}=(0,b.W)({predicate:()=>o,snappingManager:this.snappingManager,snappingContext:new T.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:c,visualizer:this.snappingVisualizer}),updatingHandles:this.updatingHandles,useZ:!this._requiresScenePoint});s=s.next(f=>(o&&(0,d.pC)(this.snappingManager)&&this.snappingManager.doneSnapping(),f)).next(m),n.next(this._screenToMapDragEventStep()).next(f=>("start"===f.action&&(this.stagedVertex=f.mapStart,("segment"===this.geometryType||o&&0===this.numVertices)&&this.commitStagedVertex()),f)).next((0,Y.BS)(this.view,this.elevationInfo)).next(...p).next(f=>(o&&(this.stagedVertex=f.mapEnd,"end"===f.action&&this.commitStagedVertex()),f)).next(f=>("end"===f.action&&("segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()),f))})}_createManipulatorDragPipelineFreehand(a){return(0,Y.Xd)(a,(v,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(s=>("start"===s.action&&((0,d.Wi)(this.stagedVertex)&&(this.stagedVertex=s.mapStart),"segment"===this.geometryType&&this.commitStagedVertex()),s)).next(s=>{switch(s.action){case"start":case"update":this.stagedVertex=s.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":this.complete()}return s})})}_createManipulatorDragPipelineHybrid(a){return(0,Y.Xd)(a,(v,n)=>{this.isCompleted||n.next(this._screenToMapDragEventStep()).next(s=>("start"===s.action&&((0,d.Wi)(this.stagedVertex)&&(this.stagedVertex=s.mapStart),this.commitStagedVertex()),s)).next(s=>{switch(s.action){case"start":case"update":this.stagedVertex=s.mapEnd,"polygon"!==this.geometryType&&"polyline"!==this.geometryType||this.commitStagedVertex();break;case"end":"segment"!==this.geometryType&&"point"!==this.geometryType||this.complete()}return s})})}get _drawAtFixedElevation(){return("segment"===this.geometryType||"polygon"===this.geometryType)&&this.numCommittedVertices>0}_getEffectiveDrawSurface(){if((0,d.Wi)(this.elevationDrawSurface))return this.drawSurface;if(!this.coordinateHelper.hasZ())return this.elevationDrawSurface.defaultZ=null,this.elevationDrawSurface;let a=this.defaultZ,v=!1;return(0,d.pC)(this.elevationInfo)&&"absolute-height"===this.elevationInfo.mode&&(v=!0),(0,d.pC)(this.snapToSceneEnabled)&&(v=this.snapToSceneEnabled),(0,d.pC)(this.elevationInfo)&&"on-the-ground"===this.elevationInfo.mode&&(v=!1),this._drawAtFixedElevation&&(a=this.coordinateHelper.getZ(this._activeComponent.vertices[0].pos),v=!1),v?this.drawSurface:(this.elevationDrawSurface.defaultZ=a,this.elevationDrawSurface)}_mapToScreen(a){return this._getEffectiveDrawSurface()?.mapToScreen(a)}_onHold(a){this._snappingOperation.abort(),"click"===this.drawingMode&&"touch"===a.pointerType&&this._snappingEnabled&&(this.stagedVertex=a.mapPoint),a.stopPropagation()}_onImmediateClick(a){if("mouse"===a.pointerType&&2===a.button||this._manipulator.dragging)return;const v=this._activeComponent,n=this._closeOnClickVertexIndex(a.screenPoint);if((0,d.pC)(n))return a.stopPropagation(),void this.complete();const s=this._screenToMap(a.screenPoint);if((0,d.pC)(s))switch(this.drawingMode){case"freehand":"point"===this.geometryType&&((0,d.pC)(this.stagedVertex)?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(s)),this.complete());break;case"click":case"hybrid":this._snappingOperation.abort(),(0,d.pC)(this.stagedVertex)?this.commitStagedVertex():this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(s)),("point"===this.geometryType||"segment"===this.geometryType&&2===v.vertices.length||"segment"===this.geometryType&&"hybrid"===this.drawingMode&&1===v.vertices.length)&&this.complete()}a.stopPropagation()}_onImmediateDoubleClick(a){this._manipulator.dragging||"point"===this.geometryType||(this.complete(),a.stopPropagation())}_onPointerMove(a){const v=(0,it.vW)(a.x,a.y),n=this._snappingOperation;if(this._manipulator.dragging||this._pointerDownStates.has(a.pointerId)||this._manipulator.grabbing||!this._manipulator.interactive)return void n.abort();a.stopPropagation();const s=this._closeOnClickVertexIndex(v);if((0,d.pC)(s))return this._closeOnVertex(s),void n.abort();const c=this._screenToMap(v),o=this._requiresScenePoint?this.drawSurface?.screenToMap(v):null;if(this._manipulator.cursor=(0,d.pC)(c)?"crosshair":null,(0,d.Wi)(c))return void n.abort();const p=this.snappingManager;if((0,d.Wi)(p))return this.stagedVertex=c,void n.abort();const m=this._getSnappingContext(a.pointerType);this.updatingHandles.addPromise((0,h.R8)(n.snap({point:c,scenePoint:o},p,m)))}_closeOnVertex(a){this.stagedVertex=null;const v={componentIndex:0,vertexIndex:a,coordinates:this.coordinateHelper.vectorToArray(this._activeComponent.vertices[a].pos)};this.emit("cursor-update",{updated:null,vertices:[v],operation:"apply",type:"vertex-update"})}_screenToMap(a){return this._getEffectiveDrawSurface()?.screenToMap(a)}_screenToMapDragEventStep(){let a=null;return v=>{if("start"===v.action&&(a=this._screenToMap(v.screenStart)),(0,d.Wi)(a))return null;const n=this._screenToMap(v.screenEnd);return(0,d.pC)(n)?{...v,mapStart:a,mapEnd:n}:null}}_vertexWithinPointerDistance(a,v){const s=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(a));return!!(0,d.pC)(s)&&function nt(a,v,n){const s=a.x-v.x,c=a.y-v.y;return s*s+c*c<=n}(s,v,25)}_getSnappingContext(a){const v=this._drawAtFixedElevation?(0,d.yw)(this.elevationDrawSurface,({defaultZ:n})=>n):null;return new T.N({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:a,visualizer:this.snappingVisualizer,selfSnappingZ:(0,d.pC)(v)?{value:v,elevationInfo:this.elevationInfo}:null})}};(0,r._)([(0,D.Cb)()],O.prototype,"_snappingEnabled",null),(0,r._)([(0,D.Cb)()],O.prototype,"defaultZ",void 0),(0,r._)([(0,D.Cb)()],O.prototype,"isDraped",void 0),(0,r._)([(0,D.Cb)({value:_})],O.prototype,"drawingMode",null),(0,r._)([(0,D.Cb)({constructOnly:!0})],O.prototype,"elevationDrawSurface",void 0),(0,r._)([(0,D.Cb)({constructOnly:!0})],O.prototype,"elevationInfo",void 0),(0,r._)([(0,D.Cb)({constructOnly:!0,type:g.Z})],O.prototype,"labelOptions",void 0),(0,r._)([(0,D.Cb)({constructOnly:!0,type:x.Z})],O.prototype,"tooltipOptions",void 0),(0,r._)([(0,D.Cb)({constructOnly:!0})],O.prototype,"geometryType",void 0),(0,r._)([(0,D.Cb)({constructOnly:!0})],O.prototype,"hasM",void 0),(0,r._)([(0,D.Cb)({constructOnly:!0})],O.prototype,"hasZ",void 0),(0,r._)([(0,D.Cb)({constructOnly:!0})],O.prototype,"manipulators",void 0),(0,r._)([(0,D.Cb)({constructOnly:!0})],O.prototype,"drawSurface",void 0),(0,r._)([(0,D.Cb)({constructOnly:!0})],O.prototype,"segmentLabels",void 0),(0,r._)([(0,D.Cb)({constructOnly:!0})],O.prototype,"snappingManager",void 0),(0,r._)([(0,D.Cb)({constructOnly:!0})],O.prototype,"snappingVisualizer",void 0),(0,r._)([(0,D.Cb)()],O.prototype,"snapToSceneEnabled",void 0),(0,r._)([(0,D.Cb)()],O.prototype,"_snappingOperation",void 0),(0,r._)([(0,D.Cb)()],O.prototype,"stagedVertex",null),(0,r._)([(0,D.Cb)()],O.prototype,"lastVertex",void 0),(0,r._)([(0,D.Cb)()],O.prototype,"updating",null),(0,r._)([(0,D.Cb)({constructOnly:!0})],O.prototype,"view",void 0),O=(0,r._)([(0,U.j)("esri.views.draw.DrawOperation")],O)},52181:(xt,st,i)=>{i.d(st,{aL:()=>h,hP:()=>it,iW:()=>P});var r=i(62208),F=i(23841),H=i(38114),E=i(84786),d=i(60507);class h{constructor(l,U,N,J=null){this._elevationInfo=l,this.defaultZ=U,this._view=N,this._excludeGraphics=J}screenToMap(l){if((0,r.pC)(this.defaultZ))return this._view.sceneIntersectionHelper.intersectElevationFromScreen((0,F.s1)(l.x,l.y),this._elevationInfo,this.defaultZ,this._excludeGraphics);const U=this._view.sceneIntersectionHelper.intersectElevationFromScreen((0,F.s1)(l.x,l.y),this._elevationInfo,0,this._excludeGraphics);return(0,r.pC)(U)&&(U.z=void 0),U}mapToScreen(l){const U=(0,H.Tx)(l.x,l.y,(0,d.vQ)(this._view,l,this._elevationInfo),l.spatialReference);return this._view.toScreen(U)}constrainZ(l){const{defaultZ:U}=this;return(0,r.pC)(U)&&l.z!==U&&((l=(0,E.WG)(l)).z=U),l}}class P{constructor(l,U,N=[]){this.view=l,this.elevationInfo=U,this.exclude=N}screenToMap(l){const U=this.view.toMap(l,{exclude:this.exclude});return(0,r.pC)(U)&&(U.z=(0,d.Ou)(U,this.view,this.elevationInfo)),U}mapToScreen(l){let U=l;return(0,r.pC)(this.elevationInfo)&&(U=(0,H.Tx)(l.x,l.y,(0,d.vQ)(this.view,l,this.elevationInfo),l.spatialReference)),this.view.toScreen(U)}constrainZ(l){return l}}class it{constructor(l,U=!1,N=0){this.view=l,this.hasZ=U,this.defaultZ=N,this.mapToScreen=J=>l.toScreen(J),this.screenToMap=U?J=>{const K=l.toMap(J);return K.z=N,K}:J=>l.toMap(J)}constrainZ(l){const{defaultZ:U}=this;return this.hasZ&&l.z!==U&&((l=(0,E.WG)(l)).z=U),l}}},22944:(xt,st,i)=>{i.d(st,{m:()=>K});var N,G,r=i(17626),F=i(14517),H=i(63290),E=i(62208),d=i(10699),h=i(77712),D=(i(90912),i(85931),i(76898)),l=i(33786),U=i(74333);(G=N||(N={}))[G.WhenToolEditable=0]="WhenToolEditable",G[G.WhenToolNotEditable=1]="WhenToolNotEditable",G[G.Always=2]="Always";class J{constructor(){this._isToolEditable=!0,this._manipulators=new U.Z,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(_){this._isToolEditable=_}get length(){return this._manipulators.length}add(_,z=N.WhenToolEditable){this.addMany([_],z)}addMany(_,z=N.WhenToolEditable){for(const Q of _){const Y={manipulator:Q,visibilityPredicate:z,attached:!1};this._manipulators.add(Y),this._attached&&this._updateManipulatorAttachment(Y)}}remove(_){for(let z=0;z<this._manipulators.length;z++)if(this._manipulators.getItemAt(z).manipulator===_){const Q=this._manipulators.splice(z,1)[0];this._detachManipulator(Q);break}}removeAll(){this._manipulators.forEach(_=>{this._detachManipulator(_)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(_=>{this._updateManipulatorAttachment(_)}),this._attached=!0}detach(){this._manipulators.forEach(_=>{this._detachManipulator(_)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:_})=>{_.destroy&&_.destroy()}),this._manipulators.destroy(),this._resourceContexts=null}on(_,z){return this._manipulators.on(_,Q=>{z(Q)})}forEach(_){for(const z of this._manipulators.items)_(z)}some(_){return this._manipulators.items.some(_)}toArray(){const _=[];return this.forEach(z=>_.push(z.manipulator)),_}intersect(_,z){let Q=null,Y=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:S,attached:W})=>{if(!W||!S.interactive)return;const g=S.intersectionDistance(_,z);(0,E.pC)(g)&&g<Y&&(Y=g,Q=S)}),Q}_updateManipulatorAttachment(_){this._isManipulatorItemVisible(_)?this._attachManipulator(_):this._detachManipulator(_)}_attachManipulator(_){_.attached||(_.manipulator.attach&&_.manipulator.attach(this._resourceContexts),_.attached=!0)}_detachManipulator(_){if(!_.attached)return;const z=_.manipulator;z.grabbing=!1,z.dragging=!1,z.hovering=!1,z.selected=!1,z.detach&&z.detach(this._resourceContexts),_.attached=!1}_isManipulatorItemVisible(_){return _.visibilityPredicate===N.Always||(this._isToolEditable?_.visibilityPredicate===N.WhenToolEditable:_.visibilityPredicate===N.WhenToolNotEditable)}}let K=class extends F.Z{constructor(G){super(G),this.manipulators=new J,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[l.bH.MANAGER,!0],[l.bH.USER,!0]]),this._creationFinishedResolver=(0,d.hh)()}get active(){return null!=this.view&&this.view.activeTool===this}set visible(G){this._get("visible")!==G&&(this._set("visible",G),this._syncVisible())}get editable(){return this.getEditableFlag(l.bH.USER)}set editable(G){this.setEditableFlag(l.bH.USER,G)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){(0,E.Wi)(this.view)?H.Z.getLogger(this.declaredClass).error("Can't activate tool if view is not defined."):(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(G){this.onInputEvent(G)}handleInputEventAfter(G){this.onInputEventAfter(G)}setEditableFlag(G,_){this._editableFlags.set(G,_),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),G===l.bH.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(G){return this._editableFlags.get(G)??!1}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(G){}onInputEventAfter(G){}get internallyEditable(){return this.getEditableFlag(l.bH.USER)&&this.getEditableFlag(l.bH.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized)if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};(0,r._)([(0,h.Cb)({constructOnly:!0})],K.prototype,"view",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],K.prototype,"active",null),(0,r._)([(0,h.Cb)({value:!0})],K.prototype,"visible",null),(0,r._)([(0,h.Cb)({value:!0})],K.prototype,"editable",null),(0,r._)([(0,h.Cb)({readOnly:!0})],K.prototype,"manipulators",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],K.prototype,"updating",null),(0,r._)([(0,h.Cb)()],K.prototype,"cursor",null),(0,r._)([(0,h.Cb)({readOnly:!0})],K.prototype,"automaticManipulatorSelection",void 0),(0,r._)([(0,h.Cb)()],K.prototype,"hasFocusedManipulators",null),(0,r._)([(0,h.Cb)()],K.prototype,"hasGrabbedManipulators",void 0),(0,r._)([(0,h.Cb)()],K.prototype,"hasHoveredManipulators",void 0),(0,r._)([(0,h.Cb)()],K.prototype,"firstGrabbedManipulator",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],K.prototype,"created",void 0),(0,r._)([(0,h.Cb)({readOnly:!0})],K.prototype,"removeIncompleteOnCancel",void 0),K=(0,r._)([(0,D.j)("esri.views.interactive.InteractiveToolBase")],K)},75079:(xt,st,i)=>{i.d(st,{AN:()=>V,BS:()=>nt,Cf:()=>g,M2:()=>_,Mz:()=>v,QY:()=>R,Xd:()=>G,a9:()=>z,bD:()=>b,hM:()=>O,kY:()=>L,oq:()=>x,zh:()=>j}),i(29132),i(8314);var H=i(58817),E=i(21286),d=i(62208),h=i(23841),P=i(28093),it=i(55915),D=i(84786),l=i(60507),U=i(59617),N=i(36073),J=i(72642);function G(n,s){return n.events.on("drag",function K(n,s){let c=null,o=null;return p=>{if("cancel"===p.action)return void((0,d.pC)(o)&&(o.execute({action:"cancel"}),c=null,o=null));const m={action:p.action,screenStart:p.start,screenEnd:p.screenPoint};"start"===p.action&&(0,d.Wi)(c)&&(c=new O,o=new O,s(n,c,o,p.pointerType,m)),(0,d.pC)(c)&&c.execute(m),"end"===p.action&&(0,d.pC)(c)&&(c=null,o=null)}}(n,s))}function _(n,s){const c=[n.x,n.y,n.z??0],o=s,p=[Math.cos(o),Math.sin(o)],m=Math.sqrt(p[0]*p[0]+p[1]*p[1]);if(0===m)return null;p[0]/=m,p[1]/=m;const f=B=>{const tt=(B.x-c[0])*p[0]+(B.y-c[1])*p[1];B.x=c[0]+tt*p[0],B.y=c[1]+tt*p[1]};return B=>(f(B.mapStart),f(B.mapEnd),{...B,axis:p})}function z(n,s){let c=null;return o=>{if("start"===o.action&&(c=function Y(n,s,c){const o=n.geometry,p=(0,D.D)(s);if((0,d.Wi)(o))return null;if("mesh"===o.type)return function S(n,s,c,o){if((0,d.pC)(s.transform))return function W(n,s,c,o){const p=Q(c.getOriginPoint(s.spatialReference),o),m=s.spatialReference;return(0,d.Wi)(p)?null:{move:(f,B,tt)=>{const et=(0,N.pB)(p.clone(),f,B,tt);if(et.spatialReference.equals(m))c.origin=(0,P.f)(et.x,et.y,et.z);else{const ot=(0,it.iV)(et,m);(0,d.pC)(ot)&&(c.origin=(0,P.f)(ot.x,ot.y,ot.z))}n.notifyMeshTransformChanged(),n.notifyGeometryChanged()}}}(n,s,s.transform,c);if(!s.spatialReference.equals(c))return null;let p=0,m=0,f=0;return{move:(B,tt,et)=>{const ot=B-p,pt=tt-m,lt=et-f;if(ot||pt||lt){const ht=new J.Z(s.origin.x+ot,s.origin.y+pt,s.origin.z+lt,s.origin.spatialReference);s.centerAt(ht,{geographic:o===U.JY.Global}),n.notifyGeometryChanged(),p=B,m=tt,f=et}}}}(n,o,p,c);const m=Q(o,p),f=o.spatialReference;return(0,d.Wi)(m)?null:{move:(B,tt,et)=>{const ot=(0,N.pB)(m.clone(),B,tt,et);n.geometry=ot.spatialReference.equals(f)?ot:(0,it.iV)(ot,f)}}}(n,o.mapStart.spatialReference,s)),(0,d.Wi)(c))return null;const p=o.mapEnd.x-o.mapStart.x,m=o.mapEnd.y-o.mapStart.y,f=o.mapEnd.z-o.mapStart.z;return c.move(p,m,f),{...o,translationX:p,translationY:m,translationZ:f}}}function Q(n,s){return(0,d.Wi)(n)?null:n.spatialReference.equals(s)?n.clone():(0,it.iV)(n,s)}function g(n,s=null,c){let o=null;const p=(0,d.pC)(s)&&!n.spatialReference?.equals(s)?f=>(0,d.pC)(f)?(0,it.iV)(f,s):f:f=>f,m={exclude:[],...c};return f=>{if("start"===f.action&&(o=p(n.toMap(f.screenStart,m))),(0,d.Wi)(o))return null;const B=p(n.toMap(f.screenEnd,m));return(0,d.pC)(B)?{...f,mapStart:o,mapEnd:B}:null}}function x(n,s){const c=n.map(o=>(0,d.Wg)(z(o,s))).filter(o=>(0,d.pC)(o));return o=>{const p=o.mapEnd.x-o.mapStart.x,m=o.mapEnd.y-o.mapStart.y,f=o.mapEnd.z-o.mapStart.z;return c.forEach(B=>B(o)),{...o,translationX:p,translationY:m,translationZ:f}}}function b(n){return(0,d.pC)(n.geometry)&&"mesh"===n.geometry.type?function M(n,s){const c=(0,d.pC)(s.transform)?s.transform.clone():null,o=s.vertexAttributes.clonePositional();return p=>(s.transform=c,s.vertexAttributes=o,n.notifyGeometryChanged(),p)}(n,n.geometry):function T(n,s){const c=new Map;for(const o of s)c.set(o,(0,H.d9)(n[o]));return o=>(c.forEach((p,m)=>{n[m]=p}),o)}(n,["geometry"])}function R(n){const s=n.map(c=>(0,d.Wg)(b(c))).filter(c=>(0,d.pC)(c));return c=>(s.forEach(o=>o(c)),c)}function V(){let n=0,s=0,c=0;return o=>{"start"===o.action&&(n=o.mapStart.x,s=o.mapStart.y,c=o.mapStart.z);const p=o.mapEnd.x-n,m=o.mapEnd.y-s,f=o.mapEnd.z-c;return n=o.mapEnd.x,s=o.mapEnd.y,c=o.mapEnd.z,{...o,mapDeltaX:p,mapDeltaY:m,mapDeltaZ:f,mapDeltaSpatialReference:o.mapStart.spatialReference}}}function j(){let n=0,s=0;return c=>{"start"===c.action&&(n=c.screenStart.x,s=c.screenStart.y);const o=c.screenEnd.x-n,p=c.screenEnd.y-s;return n=c.screenEnd.x,s=c.screenEnd.y,{...c,screenDeltaX:o,screenDeltaY:p}}}function L(n,s){let c=null,o=0,p=0;return m=>{if("start"===m.action&&(c=n.toScreen?.(s),null!=c&&(c.x<0||c.x>n.width||c.y<0||c.y>n.height?c=null:(o=m.screenStart.x-c.x,p=m.screenStart.y-c.y))),null==c)return null;const f=(0,E.uZ)(m.screenEnd.x-o,0,n.width),B=(0,E.uZ)(m.screenEnd.y-p,0,n.height),tt=(0,h.vW)(f,B);return m.screenStart=c,m.screenEnd=tt,m}}const I=()=>{};class O{constructor(){this.execute=I}next(s,c=new O){return(0,d.pC)(s)&&(this.execute=o=>{const p=s(o);(0,d.pC)(p)&&c.execute(p)}),c}}function nt(n,s,c=[]){if("2d"===n.type)return p=>p;let o=null;return p=>{"start"===p.action&&(o=n.toMap(p.screenStart,{exclude:c}),(0,d.pC)(o)&&(o.z=(0,l.Ou)(o,n,s)));const m=n.toMap(p.screenEnd,{exclude:c});(0,d.pC)(m)&&(m.z=(0,l.Ou)(m,n,s));const f=(0,d.pC)(o)&&(0,d.pC)(m)?{sceneStart:o,sceneEnd:m}:null;return{...p,scenePoints:f}}}function a(n,s,c){const o=(0,d.WG)(s.elevationProvider.getElevation(n.x,n.y,n.z??0,n.spatialReference,"scene"))??0,p=(0,D.WG)(n);return p.z=o,p.hasZ=!0,p.z=(0,l.Ou)(p,s,c),p}function v(n,s){if("2d"===n.type)return o=>o;let c=null;return o=>{"start"===o.action&&(c=a(o.mapStart,n,s));const p=a(o.mapEnd,n,s),m=(0,d.pC)(c)&&(0,d.pC)(p)?{sceneStart:c,sceneEnd:p}:null;return{...o,scenePoints:m}}}},96792:(xt,st,i)=>{i.d(st,{NI:()=>W,lv:()=>Y,mO:()=>K,nn:()=>J,ny:()=>S});var r=i(62208),F=i(15572),H=i(67831),E=i(84161),d=i(28093),h=i(41743),P=i(26242),it=i(4517),D=i(67100),l=i(91672),U=i(15708),N=i(22463);function J(g,x){return G(g,x,!1)}function K(g,x){return G(g,x,!0)}function G(g,x,T){if(g instanceof U.y){if(g.operation instanceof it.z)return function _(g,x,T=!1){const b=T?-1:1,M=(0,d.f)(b*g.dx,b*g.dy,b*g.dz);(0,E.a)(x.origin,x.origin,M)}(g.operation,x,T),!0;if(g.operation instanceof D.S)return function z(g,x,T=!1){const b=T?-g.angle:g.angle;(0,E.I)(x.basis1,x.basis1,d.Z,b),(0,E.I)(x.basis2,x.basis2,d.Z,b)}(g.operation,x,T),!0;if(g.operation instanceof l.q)return function Q(g,x,T=!1){const b=T?1/g.factor1:g.factor1,M=T?1/g.factor2:g.factor2;(0,E.g)(x.basis1,x.basis1,b),(0,E.g)(x.basis2,x.basis2,M),(0,H.u)(x.origin,x.origin,g.origin,g.axis1,b),(0,H.u)(x.origin,x.origin,g.origin,g.axis2,M)}(g.operation,x,T),!0}return!1}function Y(g,x,T,b){b||(b=(0,h.a)());const M=(0,H.s)(P.qW.get(),g[1],-g[0]),R=(0,H.s)(P.qW.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),V=(0,H.s)(P.qW.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),j=P.qW.get();x.components.forEach(O=>O.vertices.forEach(nt=>{const a=nt.pos;(0,H.s)(j,(0,H.h)(g,a),(0,H.h)(M,a)),(0,H.y)(R,R,j),(0,H.z)(V,V,j)}));const L=1e-6,I=(0,H.s)(P.qW.get(),V[0]-R[0]<L?T/2:0,V[1]-R[1]<L?T/2:0);return(0,H.a)(R,R,I),(0,H.j)(V,V,I),(0,H.b)(b.basis1,g,(V[0]-R[0])/2),(0,H.b)(b.basis2,M,(V[1]-R[1])/2),(0,H.s)(b.origin,R[0]*g[0]+R[1]*M[0],R[0]*g[1]+R[1]*M[1]),(0,H.j)(b.origin,b.origin,b.basis1),(0,H.j)(b.origin,b.origin,b.basis2),b}function S(g,x,T,b=0,M){M||(M=(0,h.a)()),x.toRenderCoords(g.origin,T,M.origin);const R=P.WM.get();(0,E.a)(R,g.origin,g.basis1),(0,E.a)(R,R,g.basis2),x.toRenderCoords(R,T,R);const V=P.WM.get();(0,E.a)(V,g.origin,g.basis1),(0,E.b)(V,V,g.basis2),x.toRenderCoords(V,T,V);const j=P.WM.get();(0,E.b)(j,g.origin,g.basis1),(0,E.b)(j,j,g.basis2),x.toRenderCoords(j,T,j);const L=P.WM.get();(0,E.b)(L,g.origin,g.basis1),(0,E.a)(L,L,g.basis2),x.toRenderCoords(L,T,L);const I=(0,E.h)(P.WM.get(),R,V,.5);(0,E.b)(I,I,M.origin);const O=(0,E.h)(P.WM.get(),j,L,.5);(0,E.b)(O,M.origin,O),(0,E.h)(M.basis1,I,O,.5);const nt=(0,E.h)(P.WM.get(),L,R,.5);(0,E.b)(nt,nt,M.origin);const a=(0,E.h)(P.WM.get(),V,j,.5);(0,E.b)(a,M.origin,a),(0,E.h)(M.basis2,nt,a,.5);const v=(0,E.f)(P.WM.get(),M.basis1,M.basis2),n=(0,E.f)(v,v,M.basis1);return(0,E.n)(n,n),(0,E.g)(M.basis2,n,(0,E.e)(M.basis2,n)),(0,E.g)(M.basis1,M.basis1,1+b/(0,E.l)(M.basis1)),(0,E.g)(M.basis2,M.basis2,1+b/(0,E.l)(M.basis2)),(0,h.u)(M),M}function W(g,x,T,b){const M=P.WM.get();(0,E.b)(M,(0,E.b)(M,g.origin,g.basis1),g.basis2);const R=P.WM.get();(0,E.z)(R,M,g.basis1,2);const V=P.WM.get();(0,E.z)(V,R,g.basis2,2);const j=P.WM.get();(0,E.z)(j,M,g.basis2,2),M[2]=R[2]=V[2]=j[2]=x;const L=b?"on-the-ground":"absolute-height",I=(0,F.Fp)((0,N.bZ)(M,R,T,L),(0,N.bZ)(j,V,T,L)),O=(0,F.Fp)((0,N.bZ)(R,V,T,L),(0,N.bZ)(M,j,T,L));return(0,r.Wi)(O)||(0,r.Wi)(I)?null:[I,O]}},94009:(xt,st,i)=>{i.d(st,{W:()=>l});var r=i(15861),F=i(62208),H=i(10699),E=i(32917),d=i(53639),h=i(84786),P=i(75079),it=i(9773),D=i(84259);function l({predicate:S=(()=>!0),snappingManager:W,snappingContext:g,updatingHandles:x,useZ:T=!0}){const b=new P.hM;if((0,F.Wi)(W))return{snappingStep:[Y,b],cancelSnapping:Y};let M,R=null,V=null,j=null;const L=()=>{R=(0,F.IM)(R),W.doneSnapping(),(0,F.pC)(V)&&V.frameTask.remove(),V=null,M=(0,F.hw)(M),j=null},I=function U(S,W,g){return(0,H.Ds)(function(){var x=(0,r.Z)(function*({frameTask:T,point:b,scenePoint:M,context:R,event:V,delta:j,getLastState:L},I){const O=yield T.schedule(()=>S.snap({point:b,scenePoint:M,context:R,signal:I}),I);if(O.valid){let nt=yield T.schedule(()=>O.apply(),I);const a=L();(0,F.pC)(a.point)&&b!==a.point&&(nt=S.update({point:a.point,scenePoint:a.scenePoint,context:R})),!(0,F.Wi)(a.updatePoint)&&(0,d.k)(nt,a.updatePoint)||(z(V.mapEnd,nt,j,W),g.execute(V))}});return function(T,b){return x.apply(this,arguments)}}())}(W,T,b);let O=null,nt=null,a=null;return{snappingStep:[v=>{if(!S(v))return v;const{action:n}=v;if("start"===n){const{info:s}=v,c=function N(S){return"3d"===S.type?S.resourceController.scheduler.registerTask(D.T8.SNAPPING):D.sq}(W.view);if(V=function J(S,W,g){return{context:new it.N({editGeometryOperations:S.editGeometryOperations,elevationInfo:S.elevationInfo,pointer:S.pointer,vertexHandle:(0,F.pC)(W.info)?W.info.handle:null,excludeFeature:S.excludeFeature,visualizer:S.visualizer}),originalPos:(0,F.pC)(W.snapOrigin)?S.coordinateHelper.vectorToDehydratedPoint(W.snapOrigin):W.mapStart,originalScenePos:(0,F.pC)(W.scenePoints)?W.scenePoints.sceneStart:null,frameTask:g}}(g,v,c),V.context.selfSnappingZ=null,!T&&(0,F.pC)(s)){const o=function Q(S,W){if(!S.hasZ())return null;const g=W.vertices;let x=null;for(const T of g){const b=S.getZ(T.pos);if((0,F.pC)(x)&&(0,F.pC)(b)&&Math.abs(b-x)>1e-6)return null;(0,F.Wi)(x)&&(x=b)}return x}(g.coordinateHelper,s.handle.component);(0,F.pC)(o)&&(V.context.selfSnappingZ={value:o,elevationInfo:g.elevationInfo})}}if((0,F.pC)(V)){const{context:s,originalScenePos:c,originalPos:o}=V,{mapEnd:p,mapStart:m,scenePoints:f}=v,B=K(o,_(p,m)),tt=_(m,o),et={...v,action:"update"},ot=V.context,pt=function G(S,W){return(0,F.Wi)(S)||(0,F.Wi)(W)?null:K(S,_(W.sceneEnd,W.sceneStart))}(c,f),lt=W.update({point:B,scenePoint:pt,context:s});if(a=lt,z(p,lt,tt,T),O=B,nt=pt,"end"!==n){const{frameTask:ht}=V;(0,F.Wi)(R)&&(R=new AbortController),j=Tt=>{x.addPromise((0,H.R8)(I({frameTask:ht,event:et,context:ot,point:B,scenePoint:pt,delta:tt,getLastState:()=>({point:O,scenePoint:nt,updatePoint:Tt.forceUpdate?null:a})},(0,F.Wg)(R).signal)))},j({forceUpdate:!1}),(0,F.Wi)(M)&&(M=(0,E.YP)(()=>W.options.effectiveEnabled,()=>j?.({forceUpdate:!0})))}}return"end"===n&&L(),v},b],cancelSnapping:v=>(L(),v)}}function K(S,[W,g,x]){const T=(0,h.WG)(S);return T.x+=W,T.y+=g,T.hasZ&&(T.z+=x),T}function _(S,W){return[S.x-W.x,S.y-W.y,S.hasZ&&W.hasZ?S.z-W.z:0]}function z(S,W,[g,x,T],b){S.x=W.x+g,S.y=W.y+x,b&&S.hasZ&&W.hasZ&&(S.z=W.z+T)}function Y(S){return S}}}]);
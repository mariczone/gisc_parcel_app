"use strict";(self.webpackChunkparcel_app=self.webpackChunkparcel_app||[]).push([[8321],{83137:(ee,F,e)=>{e.d(F,{dp:()=>P,yZ:()=>M});var _=e(16730);function M(h,s){const c=s||h.extent,l=h.width,b=(0,_.c9)(c&&c.spatialReference);return c&&l?c.width/l*b*_.hd*96:0}function P(h,s){return h/((0,_.c9)(s)*_.hd*96)}},59990:(ee,F,e)=>{function _(P){const R=P.layer;return"floorInfo"in R&&R.floorInfo?.floorField&&"floors"in P.view?M(P.view.floors,R.floorInfo.floorField):null}function d(P,R){return"floorInfo"in R&&R.floorInfo?.floorField?M(P,R.floorInfo.floorField):null}function M(P,R){if(!P?.length)return null;const E=P.filter(o=>""!==o).map(o=>`'${o}'`);return E.push("''"),`${R} IN (${E.join(",")}) OR ${R} IS NULL`}e.d(F,{c:()=>_,f:()=>d})},13410:(ee,F,e)=>{e.d(F,{FN:()=>P,QV:()=>M,ac:()=>E});var _=e(62208),d=e(31283);function M(o,h,s){return h.flatten(({sublayers:l})=>l).length!==o.length||!!o.some(l=>l.originIdOf("minScale")>s||l.originIdOf("maxScale")>s||l.originIdOf("renderer")>s||l.originIdOf("labelingInfo")>s||l.originIdOf("opacity")>s||l.originIdOf("labelsVisible")>s||l.originIdOf("source")>s)||!R(o,h)}function P(o,h,s){return!!o.some(c=>{const l=c.source;return!(!l||"map-layer"===l.type&&l.mapLayerId===c.id&&((0,_.Wi)(l.gdbVersion)||l.gdbVersion===s))||c.originIdOf("renderer")>d.s3.SERVICE||c.originIdOf("labelingInfo")>d.s3.SERVICE||c.originIdOf("opacity")>d.s3.SERVICE||c.originIdOf("labelsVisible")>d.s3.SERVICE})||!R(o,h)}function R(o,h){if(!o||!o.length||(0,_.Wi)(h))return!0;const s=h.slice().reverse().flatten(({sublayers:b})=>b&&b.toArray().reverse()).map(b=>b.id).toArray();if(o.length>s.length)return!1;let c=0;const l=s.length;for(const{id:b}of o){for(;c<l&&s[c]!==b;)c++;if(c>=l)return!1}return!0}function E(o){return!!o&&o.some(h=>null!=h.minScale||h.layerDefinition&&null!=h.layerDefinition.minScale)}},22264:(ee,F,e)=>{function _(E,o){return o?"xoffset"in o&&o.xoffset?Math.max(E,Math.abs(o.xoffset)):"yoffset"in o&&o.yoffset?Math.max(E,Math.abs(o.yoffset||0)):E:E}function M(E,o){return"number"==typeof E?E:E&&E.stops&&E.stops.length?function d(E){let o=0,h=0;for(let s=0;s<E.length;s++){const c=E[s].size;"number"==typeof c&&(o+=c,h++)}return o/h}(E.stops):o}function R(E){const o=E&&E.renderer,h="touch"===(E&&E.event&&E.event.pointerType)?9:6;if(!o)return h;const s="visualVariables"in o?function P(E,o){if(!o)return E;const h=o.filter(b=>"size"===b.type).map(b=>{const{maxSize:p,minSize:K}=b;return(M(p,E)+M(K,E))/2});let s=0;const c=h.length;if(0===c)return E;for(let b=0;b<c;b++)s+=h[b];const l=Math.floor(s/c);return Math.max(l,E)}(h,o.visualVariables):h;if("simple"===o.type)return _(s,o.symbol);if("unique-value"===o.type){let c=s;return o.uniqueValueInfos?.forEach(l=>{c=_(c,l.symbol)}),c}if("class-breaks"===o.type){let c=s;return o.classBreakInfos.forEach(l=>{c=_(c,l.symbol)}),c}return s}e.d(F,{k:()=>R})},47123:(ee,F,e)=>{e.d(F,{T:()=>j});var _=e(15861),d=e(10699),M=e(35133),P=e(28082),R=e(26268),E=e(62208),o=e(23841),h=e(16730),s=e(21254),c=e(87526),l=e(17807),b=e(25575),p=e(31637);function K(J,i){const y=i.length;if(J<i[0].value||1===y)return i[0].size;for(let u=1;u<y;u++)if(J<i[u].value)return i[u-1].size+(J-i[u-1].value)/(i[u].value-i[u-1].value)*(i[u].size-i[u-1].size);return i[y-1].size}class ${constructor(){this.symbolLevels=[],this.vvColorValues=new Float32Array(8),this.vvColors=new Float32Array(32),this.vvOpacityValues=new Float32Array(8),this.vvOpacities=new Float32Array(8),this.vvSizeMinMaxValue=new Float32Array(4),this.outsideLabelsVisible=!1,this._vvMaterialParameters={vvSizeEnabled:!1,vvColorEnabled:!1,vvRotationEnabled:!1,vvRotationType:"geographic",vvOpacityEnabled:!1},this._technique=l.v}getSizeVVFieldStops(i){const y=this._vvSizeFieldStops;if(y)switch(y.type){case"static":return y;case"level-dependent":return(0,E.Pt)(y.levels[i],()=>{let u=1/0,O=0;for(const I in y.levels){const S=parseFloat(I),B=Math.abs(i-S);B<u&&(u=B,O=S)}if(u===1/0)return{sizes:new Float32Array([0,0,0,0,0,0]),values:new Float32Array([0,0,0,0,0,0])};const W=2**((i-O)/2),H=(0,E.Wg)(y.levels[O]),L=new Float32Array(H.values);return L[2]*=W,L[3]*=W,{sizes:(0,E.Wg)(H.sizes),values:L}});default:return}}get vvMaterialParameters(){return this._vvMaterialParameters}update(i){(0,E.pC)(this._vvInfo)&&this._updateVisualVariables(this._vvInfo.vvRanges,i)}setInfo(i,y,u){this._updateEffects(u),this._vvInfo=y,this._technique=(0,b.EJ)(i),this.rendererSchema=this._technique.createOrUpdateRendererSchema(this.rendererSchema,i)}getVariation(){return{...this._technique.getVariation(this.rendererSchema),outsideLabelsVisible:this.outsideLabelsVisible,supportsTextureFloat:(0,p.hc)("2d").supportsTextureFloat}}getVariationHash(){return this._technique.getVariationHash(this.rendererSchema)<<1|(this.outsideLabelsVisible?1:0)}_updateEffects(i){this.outsideLabelsVisible=!!(0,E.pC)(i)&&i.excludedLabelsVisible}_updateVisualVariables(i,y){const u=this._vvMaterialParameters;if(u.vvOpacityEnabled=!1,u.vvSizeEnabled=!1,u.vvColorEnabled=!1,u.vvRotationEnabled=!1,!i)return;const O=i.size;if(O){if(u.vvSizeEnabled=!0,O.minMaxValue){const I=O.minMaxValue;let S,B;if((0,c.$K)(I.minSize)&&(0,c.$K)(I.maxSize))if((0,c.hj)(I.minSize)&&(0,c.hj)(I.maxSize))S=(0,o.F2)(I.minSize),B=(0,o.F2)(I.maxSize);else{const Z=y.scale;S=(0,o.F2)(K(Z,I.minSize.stops)),B=(0,o.F2)(K(Z,I.maxSize.stops))}this.vvSizeMinMaxValue.set([I.minDataValue,I.maxDataValue,S,B])}if(O.scaleStops&&(this.vvSizeScaleStopsValue=(0,o.F2)(K(y.scale,O.scaleStops.stops))),O.unitValue){const I=(0,h.c9)(y.spatialReference)/s.a[O.unitValue.unit];this.vvSizeUnitValueToPixelsRatio=I/y.resolution}O.fieldStops&&(this._vvSizeFieldStops=O.fieldStops)}const W=i.color;W&&(u.vvColorEnabled=!0,this.vvColorValues.set(W.values),this.vvColors.set(W.colors));const H=i.opacity;H&&(u.vvOpacityEnabled=!0,this.vvOpacityValues.set(H.values),this.vvOpacities.set(H.opacities));const L=i.rotation;L&&(u.vvRotationEnabled=!0,u.vvRotationType=L.type)}}class j extends R.Z{constructor(i){super(i),this._rendererInfo=new $,this._materialItemsRequestQueue=new M.Z,this.attributeView=new P.H(()=>this.onAttributeStoreUpdate())}destroy(){this.children.forEach(i=>i.destroy()),this.removeAllChildren(),this.attributeView.destroy(),this._materialItemsRequestQueue.clear()}setRendererInfo(i,y,u){this._rendererInfo.setInfo(i,y,u),this.requestRender()}getMaterialItems(i,y){var u=this;return(0,_.Z)(function*(){if(!i||0===i.length)return[];const O=(0,d.hh)();return u._materialItemsRequestQueue.push({items:i,abortOptions:y,resolver:O}),u.requestRender(),O.promise})()}doRender(i){if(i.context.capabilities.enable("textureFloat"),i.context.capabilities.enable("vao"),this._materialItemsRequestQueue.length>0){let y=this._materialItemsRequestQueue.pop();for(;y;)this._processMaterialItemRequest(i,y),y=this._materialItemsRequestQueue.pop()}super.doRender(i)}renderChildren(i){for(const y of this.children)y.commit(i);this._rendererInfo.update(i.state),super.renderChildren(i)}updateTransforms(i){if(this.children.some(y=>y.hasData))for(const y of this.children)y.setTransform(i)}createRenderParams(i){const y=super.createRenderParams(i);return y.rendererInfo=this._rendererInfo,y.attributeView=this.attributeView,y}onAttributeStoreUpdate(){}_processMaterialItemRequest(i,{items:y,abortOptions:u,resolver:O}){const{painter:W,pixelRatio:H}=i,L=y.map(I=>W.textureManager.rasterizeItem(I.symbol,H,I.glyphIds,u));Promise.all(L).then(I=>{if(!this.stage)return void O.reject();const S=I.map((B,Z)=>({id:y[Z].id,mosaicItem:B}));O.resolve(S)},O.reject)}}},26268:(ee,F,e)=>{e.d(F,{Z:()=>o});var _=e(8314),d=e(39406),M=e(44589),P=e(8650),R=e(13382);const E=(h,s)=>h.key.level-s.key.level!=0?h.key.level-s.key.level:h.key.row-s.key.row!=0?h.key.row-s.key.row:h.key.col-s.key.col;class o extends M.Z{constructor(s){super(),this._tileInfoView=s}get requiresDedicatedFBO(){return!1}renderChildren(s){this.sortChildren(E),this.setStencilReference(s),super.renderChildren(s)}createRenderParams(s){const{state:c}=s,l=super.createRenderParams(s);return l.requiredLevel=this._tileInfoView.getClosestInfoForScale(c.scale).level,l.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(c.scale),l}prepareRenderPasses(s){const c=super.prepareRenderPasses(s);return c.push(s.registerRenderPass({name:"stencil",brushes:[R.Z],drawPhase:d.jx.DEBUG|d.jx.MAP|d.jx.HIGHLIGHT,target:()=>this.getStencilTarget()})),(0,_.Z)("esri-tiles-debug")&&c.push(s.registerRenderPass({name:"tileInfo",brushes:[P.Z],drawPhase:d.jx.DEBUG,target:()=>this.children})),c}getStencilTarget(){return this.children}setStencilReference(s){let c=1;for(const l of this.children)l.stencilRef=c++}}},55051:(ee,F,e)=>{e.d(F,{Z:()=>J});var _=e(62208),d=e(47123),M=e(30217),P=e(49966),R=e(9545),E=e(14658),o=e(93555),h=e(57477),s=e(87526),c=e(83994),l=e(67969),b=e(49353);const p=Math.PI/180;class $ extends h.s{constructor(y){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=(0,P.c)(),this._localOrigin={x:0,y:0},this._getBounds=y}destroy(){this._vao&&(this._vao.dispose(!0),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=(0,_.M2)(this._program)}doRender(y){const{context:u}=y,O=this._getBounds();if(O.length<1)return;this._createShaderProgram(u),this._updateMatricesAndLocalOrigin(y),this._updateBufferData(u,O),u.setBlendingEnabled(!0),u.setDepthTestEnabled(!1),u.setStencilWriteMask(0),u.setStencilTestEnabled(!1),u.setBlendFunction(l.zi.ONE,l.zi.ONE_MINUS_SRC_ALPHA),u.setColorMask(!0,!0,!0,!0);const W=this._program;u.bindVAO(this._vao),u.useProgram(W),W.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),u.gl.lineWidth(1),u.drawElements(l.MX.LINES,8*O.length,l.g.UNSIGNED_INT,0),u.bindVAO()}_createTransforms(){return{dvs:(0,P.c)()}}_createShaderProgram(y){this._program||(this._program=y.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",j().attributes))}_updateMatricesAndLocalOrigin(y){const{state:u}=y,{displayMat3:O,size:W,resolution:H,pixelRatio:L,rotation:I,viewpoint:S}=u,B=p*I,{x:Z,y:ue}=S.targetGeometry,de=(0,o.or)(Z,u.spatialReference);this._localOrigin.x=de,this._localOrigin.y=ue;const ae=L*W[0],oe=L*W[1],le=H*ae,ce=H*oe,q=(0,M.g)(this._dvsMat3);(0,M.m)(q,q,O),(0,M.h)(q,q,(0,R.f)(ae/2,oe/2)),(0,M.d)(q,q,(0,E.f)(W[0]/le,-oe/ce,1)),(0,M.r)(q,q,-B)}_updateBufferData(y,u){const{x:O,y:W}=this._localOrigin,L=new Float32Array(8*u.length),I=new Uint32Array(8*u.length);let S=0,B=0;for(const Z of u)Z&&(L[2*S+0]=Z[0]-O,L[2*S+1]=Z[1]-W,L[2*S+2]=Z[0]-O,L[2*S+3]=Z[3]-W,L[2*S+4]=Z[2]-O,L[2*S+5]=Z[3]-W,L[2*S+6]=Z[2]-O,L[2*S+7]=Z[1]-W,I[B+0]=S+0,I[B+1]=S+3,I[B+2]=S+3,I[B+3]=S+2,I[B+4]=S+2,I[B+5]=S+1,I[B+6]=S+1,I[B+7]=S+0,S+=4,B+=8);if(this._vertexBuffer?this._vertexBuffer.setData(L.buffer):this._vertexBuffer=c.f.createVertex(y,l.l1.DYNAMIC_DRAW,L.buffer),this._indexBuffer?this._indexBuffer.setData(I):this._indexBuffer=c.f.createIndex(y,l.l1.DYNAMIC_DRAW,I),!this._vao){const Z=j();this._vao=new b.U(y,Z.attributes,Z.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const j=()=>(0,s.cM)("bounds",{geometry:[{location:0,name:"a_position",count:2,type:l.g.FLOAT}]});let J=class extends d.T{constructor(i){super(i),this.hasHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=(0,_.SC)(this._boundsRenderer)}enableRenderingBounds(i){this._boundsRenderer=new $(i),this.requestRender()}get hasLabels(){return!1}onTileData(i,y){i.patch(y),this.contains(i)||this.addChild(i),this.requestRender()}onTileError(i){i.clear(),this.contains(i)||this.addChild(i)}_renderChildren(i,y){for(const u of this.children)u.isReady&&u.hasData&&(u.commit(i),i.context.setStencilFunction(l.wb.EQUAL,u.stencilRef,255),u.getDisplayList().replay(i,u,y))}}},13305:(ee,F,e)=>{e.d(F,{Z:()=>b});var _=e(17626),o=(e(63290),e(90912),e(85931),e(26584),e(8314),e(76898)),h=e(39406),s=e(55051),c=e(67969);let l=class extends s.Z{doRender(p){p.drawPhase===h.jx.HIGHLIGHT&&super.doRender(p)}renderChildren(p){if(this.attributeView.update(),!this.children.some(j=>j.hasData))return;this.attributeView.bindTextures(p.context),super.renderChildren(p);const{painter:K}=p,$=K.effects.highlight;$.bind(p),p.context.setColorMask(!0,!0,!0,!0),p.context.clear(c.lk.COLOR_BUFFER_BIT),this._renderChildren(p,$.defines.concat(["highlightAll"])),$.draw(p),$.unbind()}};l=(0,_._)([(0,o.j)("esri.views.2d.layers.support.HighlightGraphicContainer")],l);const b=l},94421:(ee,F,e)=>{e.d(F,{Z:()=>s});var _=e(17626),d=e(63290),M=e(10699),P=e(32917),R=e(77712),h=(e(90912),e(85931),e(76898));const s=c=>{let l=class extends c{initialize(){this.handles.add((0,P.on)(()=>this.layer,"refresh",b=>{this.doRefresh(b.dataChanged).catch(p=>{(0,M.D_)(p)||d.Z.getLogger(this.declaredClass).error(p)})}),"RefreshableLayerView")}};return(0,_._)([(0,R.Cb)()],l.prototype,"layer",void 0),l=(0,_._)([(0,h.j)("esri.layers.mixins.RefreshableLayerView")],l),l}},81243:(ee,F,e)=>{e.d(F,{VF:()=>re,Uf:()=>Se});var _=e(15861),d=e(17626),M=e(88879),P=e(14517),R=e(74333),E=e(26584),o=e(8314),h=e(88159),s=e(62208),c=e(10699),l=e(32917),b=e(16730),p=e(77712),K=e(90912),j=(e(85931),e(76898)),J=e(2004),i=e(83137),y=e(59990),u=e(22264),O=e(84792),W=e(93555),H=e(2618),L=e(95737),I=e(91179),S=e(13410);const B=a=>a.spatialReference.wkid||JSON.stringify(a.spatialReference);function Z(a,r){const{dpi:f,gdbVersion:m,geometry:v,geometryPrecision:g,height:T,layerOption:N,mapExtent:x,maxAllowableOffset:U,returnFieldName:D,returnGeometry:C,returnUnformattedValues:A,returnZ:z,spatialReference:V,timeExtent:X,tolerance:Q,width:G}=a.toJSON(),{dynamicLayers:k,layerDefs:se,layerIds:ne}=function ue(a){const{mapExtent:r,floors:f,width:m,sublayers:v,layerIds:g,layerOption:T,gdbVersion:N}=a,x=v?.find(V=>null!=V.layer)?.layer?.serviceSublayers,U="popup"===T,D={},C=(0,i.yZ)({extent:r,width:m,spatialReference:r?.spatialReference}),A=[],z=V=>{if(V.visible&&(0===C||(0===V.minScale||C<=V.minScale)&&(0===V.maxScale||C>=V.maxScale)))if(V.sublayers)V.sublayers.forEach(z);else{if(!1===g?.includes(V.id)||U&&(!V.popupTemplate||!V.popupEnabled))return;A.unshift(V)}};if(v?.forEach(z),v&&!A.length)D.layerIds=[];else{const V=(0,S.FN)(A,x,N),X=A.map(Q=>{const G=(0,y.f)(f,Q);return Q.toExportImageJSON(G)});if(V)D.dynamicLayers=JSON.stringify(X);else{if(v){let G=A.map(({id:k})=>k);g&&(G=G.filter(k=>g.includes(k))),D.layerIds=G}else g?.length&&(D.layerIds=g);const Q=function de(a,r){const f=!!a?.length,m=r.filter(v=>null!=v.definitionExpression||f&&null!=v.floorInfo);return m.length?m.map(v=>{const g=(0,y.f)(a,v),T=(0,L._)(g,v.definitionExpression);return{id:v.id,definitionExpression:(0,s.Pt)(T,void 0)}}):null}(f,A);if((0,s.pC)(Q)&&Q.length){const G={};for(const k of Q)k.definitionExpression&&(G[k.id]=k.definitionExpression);Object.keys(G).length&&(D.layerDefs=JSON.stringify(G))}}}return D}(a),Ee=r&&(0,s.pC)(r.geometry)?r.geometry:null,Y={geometryPrecision:g,maxAllowableOffset:U,returnFieldName:D,returnGeometry:C,returnUnformattedValues:A,returnZ:z,tolerance:Q},ie=Ee&&Ee.toJSON()||v;if(Y.imageDisplay=`${G},${T},${f}`,m&&(Y.gdbVersion=m),ie&&(delete ie.spatialReference,Y.geometry=JSON.stringify(ie),Y.geometryType=(0,I.Ji)(ie)),V?Y.sr=V.wkid||JSON.stringify(V):ie&&ie.spatialReference?Y.sr=B(ie):x&&x.spatialReference&&(Y.sr=B(x)),Y.time=X?[X.start,X.end].join(","):null,x){const{xmin:je,ymin:Le,xmax:Ve,ymax:Fe}=x;Y.mapExtent=`${je},${Le},${Ve},${Fe}`}return se&&(Y.layerDefs=se),k&&!se&&(Y.dynamicLayers=k),Y.layers="popup"===N?"visible":N,ne&&!k&&(Y.layers+=`:${ne.join(",")}`),Y}var q,ae=e(29132),oe=e(97478),le=e(86810),ce=e(65234);let w=q=class extends le.wq{static from(a){return(0,K.TJ)(q,a)}constructor(a){super(a),this.dpi=96,this.floors=null,this.gdbVersion=null,this.geometry=null,this.geometryPrecision=null,this.height=400,this.layerIds=null,this.layerOption="top",this.mapExtent=null,this.maxAllowableOffset=null,this.returnFieldName=!0,this.returnGeometry=!1,this.returnM=!1,this.returnUnformattedValues=!0,this.returnZ=!1,this.spatialReference=null,this.sublayers=null,this.timeExtent=null,this.tolerance=null,this.width=400}};(0,d._)([(0,p.Cb)({type:Number,json:{write:!0}})],w.prototype,"dpi",void 0),(0,d._)([(0,p.Cb)()],w.prototype,"floors",void 0),(0,d._)([(0,p.Cb)({type:String,json:{write:!0}})],w.prototype,"gdbVersion",void 0),(0,d._)([(0,p.Cb)({types:ae.qM,json:{read:I.im,write:!0}})],w.prototype,"geometry",void 0),(0,d._)([(0,p.Cb)({type:Number,json:{write:!0}})],w.prototype,"geometryPrecision",void 0),(0,d._)([(0,p.Cb)({type:Number,json:{write:!0}})],w.prototype,"height",void 0),(0,d._)([(0,p.Cb)({type:[Number],json:{write:!0}})],w.prototype,"layerIds",void 0),(0,d._)([(0,p.Cb)({type:["top","visible","all","popup"],json:{write:!0}})],w.prototype,"layerOption",void 0),(0,d._)([(0,p.Cb)({type:J.Z,json:{write:!0}})],w.prototype,"mapExtent",void 0),(0,d._)([(0,p.Cb)({type:Number,json:{write:!0}})],w.prototype,"maxAllowableOffset",void 0),(0,d._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],w.prototype,"returnFieldName",void 0),(0,d._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],w.prototype,"returnGeometry",void 0),(0,d._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],w.prototype,"returnM",void 0),(0,d._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],w.prototype,"returnUnformattedValues",void 0),(0,d._)([(0,p.Cb)({type:Boolean,json:{write:!0}})],w.prototype,"returnZ",void 0),(0,d._)([(0,p.Cb)({type:ce.Z,json:{write:!0}})],w.prototype,"spatialReference",void 0),(0,d._)([(0,p.Cb)()],w.prototype,"sublayers",void 0),(0,d._)([(0,p.Cb)({type:oe.Z,json:{write:!0}})],w.prototype,"timeExtent",void 0),(0,d._)([(0,p.Cb)({type:Number,json:{write:!0}})],w.prototype,"tolerance",void 0),(0,d._)([(0,p.Cb)({type:Number,json:{write:!0}})],w.prototype,"width",void 0),w=q=(0,d._)([(0,j.j)("esri.rest.support.IdentifyParameters")],w);const me=w;var _e=e(68653),be=e(99433),xe=e(71774);let te=class extends le.wq{constructor(a){super(a),this.displayFieldName=null,this.feature=null,this.layerId=null,this.layerName=null}readFeature(a,r){return M.Z.fromJSON({attributes:{...r.attributes},geometry:{...r.geometry}})}writeFeature(a,r){if(!a)return;const{attributes:f,geometry:m}=a;f&&(r.attributes={...f}),(0,s.pC)(m)&&(r.geometry=m.toJSON(),r.geometryType=xe.P.toJSON(m.type))}};(0,d._)([(0,p.Cb)({type:String,json:{write:!0}})],te.prototype,"displayFieldName",void 0),(0,d._)([(0,p.Cb)({type:M.Z})],te.prototype,"feature",void 0),(0,d._)([(0,_e.r)("feature",["attributes","geometry"])],te.prototype,"readFeature",null),(0,d._)([(0,be.c)("feature")],te.prototype,"writeFeature",null),(0,d._)([(0,p.Cb)({type:Number,json:{write:!0}})],te.prototype,"layerId",void 0),(0,d._)([(0,p.Cb)({type:String,json:{write:!0}})],te.prototype,"layerName",void 0),te=(0,d._)([(0,j.j)("esri.rest.support.IdentifyResult")],te);const Oe=te;function he(){return(he=(0,_.Z)(function*(a,r,f){const m=(r=Me(r)).geometry?[r.geometry]:[],v=(0,H.en)(a);return v.path+="/identify",(0,W.aX)(m).then(g=>{const T=Z(r,{geometry:g&&g[0]}),N=(0,H.cv)({...v.query,f:"json",...T}),x=(0,H.lA)(N,f);return(0,O.default)(v.path,x).then(Re).then(U=>Pe(U,r.sublayers))})})).apply(this,arguments)}function Re(a){const r=a.data;return r.results=r.results||[],r.exceededTransferLimit=Boolean(r.exceededTransferLimit),r.results=r.results.map(f=>Oe.fromJSON(f)),r}function Me(a){return me.from(a)}function Pe(a,r){if(!r?.length)return a;const f=new Map;r.forEach(function m(v){f.set(v.id,v),v.sublayers&&v.sublayers.forEach(m)});for(const v of a.results)v.feature.sourceLayer=f.get(v.layerId);return a}var Ce=e(46679),ve=e(57213),ge=e(10023);let pe=null;function Se(a,r){return"tile"===r.type||"map-image"===r.type}let re=class extends P.Z{constructor(a){var r;super(a),r=this,this._featuresResolutions=new WeakMap,this.highlightGraphics=null,this.highlightGraphicUpdated=null,this.updateHighlightedFeatures=(0,c.Ds)(function(){var f=(0,_.Z)(function*(m){r.destroyed||r.updatingHandles.addPromise(r._updateHighlightedFeaturesGeometries(m).catch(()=>{}))});return function(m){return f.apply(this,arguments)}}())}initialize(){const a=r=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(r).catch(()=>{})),this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([(0,l.on)(()=>this.highlightGraphics,"change",r=>a(r.added),{onListenerAdd:r=>a(r)})])}fetchPopupFeatures(a,r){var f=this;return(0,_.Z)(function*(){const{layerView:{layer:m,view:{scale:v}}}=f;if(!a)throw new E.Z("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:m});const g=function De(a,r,f){const m=[],v=g=>{if(g.visible&&(0===g.minScale||r<=g.minScale)&&(0===g.maxScale||r>=g.maxScale))if(g.sublayers)g.sublayers.forEach(v);else if(g.popupEnabled){const x=(0,ge.V)(g,{...f,defaultPopupTemplateEnabled:!1});(0,s.pC)(x)&&m.unshift({sublayer:g,popupTemplate:x})}};return(a?.toArray()??[]).reverse().map(v),m}(m.sublayers,v,r);if(!g.length)return[];const T=yield function Te(a,r){return fe.apply(this,arguments)}(m,g);if(!((m.capabilities?.operations?.supportsIdentify??1)&&m.version>=10.5||T))throw new E.Z("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:m});return T?f._fetchPopupFeaturesUsingQueries(a,g,r):f._fetchPopupFeaturesUsingIdentify(a,g,r)})()}clearHighlights(){this.highlightGraphics?.removeAll()}highlight(a){const r=this.highlightGraphics;if(!r)return{remove(){}};let f=null;if(a instanceof M.Z?f=[a]:R.Z.isCollection(a)&&a.length>0?f=a.toArray():Array.isArray(a)&&a.length>0&&(f=a),f=f?.filter(s.pC),!f||!f.length)return{remove:()=>{}};for(const m of f){const v=m.sourceLayer;null!=v&&"geometryType"in v&&"point"===v.geometryType&&(m.visible=!1)}return r.addMany(f),{remove:()=>{r.removeMany(f??[])}}}_updateHighlightedFeaturesSymbols(a){var r=this;return(0,_.Z)(function*(){const{layerView:{view:f},highlightGraphics:m,highlightGraphicUpdated:v}=r;if(m&&v)for(const g of a){const T=g.sourceLayer&&"renderer"in g.sourceLayer&&g.sourceLayer.renderer;g.sourceLayer&&"geometryType"in g.sourceLayer&&"point"===g.sourceLayer.geometryType&&T&&"getSymbolAsync"in T&&T.getSymbolAsync(g).then(function(){var N=(0,_.Z)(function*(x){x||(x=new ve.Z);let U=null;const D="visualVariables"in T?T.visualVariables?.find(C=>"size"===C.type):void 0;D&&(pe||(pe=(yield Promise.resolve().then(e.bind(e,81808))).getSize),U=pe(D,g,{view:f.type,scale:f.scale,shape:"simple-marker"===x.type?x.style:null})),U||(U="width"in x&&"height"in x&&null!=x.width&&null!=x.height?Math.max(x.width,x.height):"size"in x?x.size:16),m.includes(g)&&(g.symbol=new ve.Z({style:"square",size:U,xoffset:"xoffset"in x?x.xoffset:0,yoffset:"yoffset"in x?x.yoffset:0}),v(g,"symbol"),g.visible=!0)});return function(x){return N.apply(this,arguments)}}())}})()}_updateHighlightedFeaturesGeometries(a){var r=this;return(0,_.Z)(function*(){const{layerView:{layer:f,view:m},highlightGraphics:v,highlightGraphicUpdated:g}=r;if(r._highlightGeometriesResolution=a,!g||!v?.length||!f.capabilities.operations.supportsQuery)return;const T=r._getTargetResolution(a),N=new Map;for(const D of v)(!r._featuresResolutions.has(D)||r._featuresResolutions.get(D)>T)&&(0,h.s1)(N,D.sourceLayer,()=>new Map).set(D.getObjectId(),D);const x=Array.from(N,([D,C])=>{const A=D.createQuery();return A.objectIds=[...C.keys()],A.outFields=[D.objectIdField],A.returnGeometry=!0,A.maxAllowableOffset=T,A.outSpatialReference=m.spatialReference,D.queryFeatures(A)}),U=yield Promise.all(x);if(!r.destroyed)for(const{features:D}of U)for(const C of D){const z=N.get(C.sourceLayer).get(C.getObjectId());z&&v.includes(z)&&(z.geometry=C.geometry,g(z,"geometry"),r._featuresResolutions.set(z,T))}})()}_getTargetResolution(a){const r=a*(0,b.c9)(this.layerView.view.spatialReference),f=r/16;return f<=10?0:a/r*f}_fetchPopupFeaturesUsingIdentify(a,r,f){var m=this;return(0,_.Z)(function*(){const v=yield m._createIdentifyParameters(a,r,f);if((0,s.Wi)(v))return[];const{results:g}=yield function Ie(a,r,f){return he.apply(this,arguments)}(m.layerView.layer.parsedUrl,v);return g.map(T=>T.feature)})()}_createIdentifyParameters(a,r,f){var m=this;return(0,_.Z)(function*(){const{floors:v,layer:g,timeExtent:T,view:{spatialReference:N,scale:x}}=m.layerView,U=(0,s.pC)(f)?f.event:null;if(!r.length)return null;yield Promise.all(r.map(({sublayer:X})=>X.load().catch(()=>{})));const D=Math.min((0,o.Z)("mapservice-popup-identify-max-tolerance"),g.allSublayers.reduce((X,Q)=>Q.renderer?(0,u.k)({renderer:Q.renderer,event:U}):X,2)),C=m.createFetchPopupFeaturesQueryGeometry(a,D),A=(0,i.dp)(x,N),z=Math.round(C.width/A),V=new J.Z({xmin:C.center.x-A*z,ymin:C.center.y-A*z,xmax:C.center.x+A*z,ymax:C.center.y+A*z,spatialReference:C.spatialReference});return new me({floors:v,gdbVersion:"gdbVersion"in g?g.gdbVersion:void 0,geometry:a,height:z,layerOption:"popup",mapExtent:V,returnGeometry:!0,spatialReference:N,sublayers:g.sublayers,timeExtent:T,tolerance:D,width:z})})()}_fetchPopupFeaturesUsingQueries(a,r,f){var m=this;return(0,_.Z)(function*(){const{layerView:{floors:v,timeExtent:g}}=m,T=(0,s.pC)(f)?f.event:null,N=r.map(function(){var x=(0,_.Z)(function*({sublayer:U,popupTemplate:D}){if(yield U.load().catch(()=>{}),U.capabilities&&!U.capabilities.operations.supportsQuery)return[];const C=U.createQuery(),A=(0,u.k)({renderer:U.renderer,event:T}),z=m.createFetchPopupFeaturesQueryGeometry(a,A);if(C.geometry=z,C.outFields=yield(0,ge.e)(U,D),C.timeExtent=g,v){const se=v.clone(),ne=(0,y.f)(se,U);(0,s.pC)(ne)&&(C.where=C.where?`(${C.where}) AND (${ne})`:ne)}const V=m._getTargetResolution(z.width/A),X=yield function Ue(a){return a.expressionInfos?.length||Array.isArray(a.content)&&a.content.some(r=>"expression"===r.type)?(0,Ce.LC)():Promise.resolve()}(D),Q="point"===U.geometryType||X&&X.arcadeUtils.hasGeometryOperations(D);Q||(C.maxAllowableOffset=V);let{features:G}=yield U.queryFeatures(C);const k=Q?0:V;G=yield function Ae(a,r){return ye.apply(this,arguments)}(U,G);for(const se of G)m._featuresResolutions.set(se,k);return G});return function(U){return x.apply(this,arguments)}}());return(yield(0,c.as)(N)).reverse().reduce((x,U)=>U.value?[...x,...U.value]:x,[]).filter(x=>null!=x)})()}};function fe(){return(fe=(0,_.Z)(function*(a,r){if(a.capabilities?.operations?.supportsQuery)return!0;try{return yield Promise.any(r.map(({sublayer:f})=>f.load().then(()=>f.capabilities.operations.supportsQuery)))}catch{return!1}})).apply(this,arguments)}function ye(){return(ye=(0,_.Z)(function*(a,r){const f=a.renderer;return f&&"defaultSymbol"in f&&!f.defaultSymbol&&(r=f.valueExpression?yield Promise.all(r.map(m=>f.getSymbolAsync(m).then(v=>v?m:null))).then(m=>m.filter(v=>null!=v)):r.filter(m=>null!=f.getSymbol(m))),r})).apply(this,arguments)}(0,d._)([(0,p.Cb)({constructOnly:!0})],re.prototype,"createFetchPopupFeaturesQueryGeometry",void 0),(0,d._)([(0,p.Cb)({constructOnly:!0})],re.prototype,"layerView",void 0),(0,d._)([(0,p.Cb)({constructOnly:!0})],re.prototype,"highlightGraphics",void 0),(0,d._)([(0,p.Cb)({constructOnly:!0})],re.prototype,"highlightGraphicUpdated",void 0),(0,d._)([(0,p.Cb)({constructOnly:!0})],re.prototype,"updatingHandles",void 0),re=(0,d._)([(0,j.j)("esri.views.layers.support.MapService")],re)},10023:(ee,F,e)=>{e.d(F,{V:()=>E,e:()=>P});var _=e(15861),d=e(62208),M=e(36630);function P(o){return R.apply(this,arguments)}function R(){return(R=(0,_.Z)(function*(o,h=o.popupTemplate){if((0,d.Wi)(h))return[];const s=yield h.getRequiredFields(o.fieldsIndex),{lastEditInfoEnabled:c}=h,{objectIdField:l,typeIdField:b,globalIdField:p,relationships:K}=o;if(s.includes("*"))return["*"];const $=c?yield(0,M.CH)(o):[],j=(0,M.Q0)(o.fieldsIndex,[...s,...$]);return b&&j.push(b),j&&l&&o.fieldsIndex?.has(l)&&!j.includes(l)&&j.push(l),j&&p&&o.fieldsIndex?.has(p)&&!j.includes(p)&&j.push(p),K&&K.forEach(J=>{const{keyField:i}=J;j&&i&&o.fieldsIndex?.has(i)&&!j.includes(i)&&j.push(i)}),j})).apply(this,arguments)}function E(o,h){return o.popupTemplate?o.popupTemplate:(0,d.pC)(h)&&h.defaultPopupTemplateEnabled&&(0,d.pC)(o.defaultPopupTemplate)?o.defaultPopupTemplate:null}},94672:(ee,F,e)=>{e.d(F,{D:()=>o,K:()=>E}),e(29132);var d=e(62208),M=e(16730),P=e(22264),R=e(2004);function E(s,c,l,b=new R.Z){let p=0;if("2d"===l.type)p=c*(l.resolution??0);else if("3d"===l.type){const y=l.overlayPixelSizeInMapUnits(s),u=l.basemapSpatialReference;p=(0,d.pC)(u)&&!u.equals(l.spatialReference)?(0,M.c9)(u)/(0,M.c9)(l.spatialReference):c*y}const K=s.x-p,$=s.y-p,j=s.x+p,J=s.y+p,{spatialReference:i}=l;return b.xmin=Math.min(K,j),b.ymin=Math.min($,J),b.xmax=Math.max(K,j),b.ymax=Math.max($,J),b.spatialReference=i,b}function o(s,c,l){const b=l.toMap(s);return!(0,d.Wi)(b)&&E(b,(0,P.k)(),l,h).intersects(c)}const h=new R.Z}}]);